
define('article.app/content/scripts/truncation', [
  'vendor.asset.jquery/jquery'
  ], function ($) {


  function truncateLogic (captionObject, curString, isTrue) {

    var replaceString = curString.substring(0, curString.lastIndexOf(" "));
    if (curString.length - replaceString.length< 4) {
      replaceString = replaceString.substring(0, curString.lastIndexOf(" "));
    }
    curString = replaceString;
    curString = curString.replace(/[\s|;|,|!|.|?|\n|\u3000]+$/g, "");
    curString += ' ...';
    captionObject[0].innerHTML = curString;
  }

  var truncator = {
    captionTruncator: function (captionObject, fullCaptionText, creditElement, creditText, maxHeight) {
      // immediately return full text if caption object does not exist
      if (typeof captionObject === 'undefined' || !captionObject.length || captionObject === null) {
        return {
          isTruncated: false,
          truncatedHtml: fullCaptionText
        };
      }

      var isTruncated = false;
      var stringTokens = fullCaptionText.trim().split(" ");
      var captionString = '';
      var concanatingString = '';

      for (var i = 0; i < stringTokens.length; i++) {
        concanatingString = concanatingString + " " + stringTokens[i];
        captionObject[0].innerHTML = concanatingString;
        if (captionObject.height() > maxHeight) {
          truncateLogic(captionObject, captionString);
          isTruncated = true;
          break;
        }
        captionString = concanatingString;
      }

      //Now look at captions
      if (isTruncated !== true && typeof creditElement !== 'undefined' && creditElement !== null) {
        captionObject.append(creditElement);
        stringTokens = creditText.trim().split(" ");
        concanatingString = '';

        for (var j = 0; j < stringTokens.length; j++) {
          concanatingString = concanatingString + " " + stringTokens[j];
          creditElement.innerHTML = concanatingString;
          if (captionObject.height() > maxHeight) {
            //If it's just one character long
            if (j === 0) {
              truncateLogic(captionObject, captionString);
              isTruncated = true;
              break;
            }
            truncateLogic( $(creditElement), concanatingString);
            isTruncated = true;
            break;
          }
        }
      }

      return {
        isTruncated: isTruncated,
        truncatedHtml: captionObject[0].innerHTML
      };
    }
  };

  return truncator;
});

define("article.app/view/articleBody",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<!-- articleBody16u --> <div id=\"wsj-article-wrap\" class=\"article-wrap\" itemprop=\"articleBody\" data-sbId=\"{{articleId}}\"> {{! Check For Lead Inset }} {{#leadInset}} <div class=\"is-lead-inset\"> {{>media-objects}} </div> {{/leadInset}} <div class=\"clearfix byline-wrap\"> {{! Check For Columnist Hedcut }} {{#column}} {{#hedcutImage}} <div class=\"columnist_mini\"> <div class=\"a-size\"> <a href=\"{{authors.0.authorBiography}}\"> <img src=\"http://s.wsj.net{{hedcutImage}}\" height=\"76px\" width=\"76px\"> </a> </div> </div> {{/hedcutImage}} {{/column}} {{! Render Byline }} {{>byline}} {{>timestamp}} {{>comments-count}} </div> {{! Begin Loop Through Article Body }} {{#articleBody}} {{#htmlFragment}} {{{htmlFragment}}} {{/htmlFragment}} {{#isInset}} {{>media-objects}} {{/isInset}} {{#company}} {{^quoteData}} <a href=\"http://quotes.wsj.com/{{name}}\" class=\"t-company\"> {{{company}}} </a>{{type}} {{/quoteData}} {{#quoteData}} {{#hrefLink}} <a href=\"{{hrefLink}}\"class=\"t-company\"> {{{company}}} </a>{{type}} {{/hrefLink}} {{^hrefLink}} <a href=\"http://quotes.wsj.com/{{name}}\" class=\"t-company\"> {{{company}}} </a>{{type}} {{/hrefLink}} {{/quoteData}} {{/company}} {{#person}} {{#topicid}} <a href=\"{{link}}\"> {{person}} </a>{{{suffix}}} {{/topicid}} {{^topicid}} {{person}}{{{suffix}}} {{/topicid}} {{/person}} {{#mutualfund}} {{#fundsymbol}} <a href=\"{{link}}\"> {{mutualfund}} </a>{{{suffix}}} {{/fundsymbol}} {{^fundsymbol}} {{mutualfund}}{{{suffix}}} {{/fundsymbol}} {{/mutualfund}} {{#showDisclaimer}} <div class=\"pr-disclaimer pr-d-bottom\"> The Wall Street Journal news department was not involved in the creation of this content. </div> {{/showDisclaimer}} {{/articleBody}} </div> {{> partials/evernote-script}} ");});define("article.app/view/articleBodyExperiential",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<!-- articleBody16u --> <div data-sbId=\"{{articleId}}\" id=\"wsj-article-wrap\"> <!-- Check if there is a lead inset --> {{#leadInset}} <div class=\"is-lead-inset\"> {{>media-objects}} </div> {{/leadInset}} <!-- render main article body --> <div class=\"nc-exp-article\"> {{#articleBody}} {{#htmlFragment}} {{{htmlFragment}}} {{/htmlFragment}} {{#company}} <!-- module article chiclet --> {{^quoteData}} <a href=\"http://quotes.wsj.com/{{name}}\"class=\"t-company\">{{{company}}}</a>{{type}} {{/quoteData}} {{#quoteData}} {{#hrefLink}} <a href=\"{{hrefLink}}\"class=\"t-company\">{{{company}}}</a>{{type}} {{/hrefLink}} {{^hrefLink}} <a href=\"http://quotes.wsj.com/{{name}}\"class=\"t-company\">{{{company}}}</a>{{type}} {{/hrefLink}} {{#changePercent}} <span class=\"article-chiclet {{netChangeClass}}\" data-channel-path=\"{{channel}}\" data-channel-last-price=\"{{previousPriceValue}}\" data-channel-currency=\"{{currency}}\" data-utc-offset-hours=\"{{utcOffsetHours}}\" data-ticker-code=\"{{ticker}}\" data-country-code=\"{{countryCode}}\"> <!-- up, down, neutral --> <span class=\"ticker\"> <a href=\"{{hrefLink}}\">{{name}} <span>{{changePercent}}%</span></a> </span> <!--ticker content box--> <span class=\"t-content\"> <span class=\"t-name\"><a href=\"{{hrefLink}}\">{{{instrumentName}}}</a></span> <!--row 1--> <span class=\"t-sec-1\"> <span class=\"t-exch\">{{commonName}}</span> <span class=\"t-index\"> <span class=\"t-curnum {{netChangeClass}}\"> <!-- up, down ,neutral --> <sup>{{{currency}}}</sup>{{lastPrice}} </span> <span class=\"t-direction {{netChangeClass}}\"> <!-- up, down ,neutral --> <span>{{netChange}}</span> <span>{{changePercent}}%</span> </span> </span> <span class=\"t-dates\"> {{lastDate}} {{lastTime}} <span> {{#exchangeDelay}}{{#i18n}}Volume{{/i18n}} ({{#i18n}}Delayed {{/i18n}}{{exchangeDelay}}{{#i18n}}m{{/i18n}}){{/exchangeDelay}} {{^exchangeDelay}}{{#i18n}}Volume{{/i18n}} {{/exchangeDelay}}: {{#volume}} <span>{{volume}}</span> {{/volume}} {{^volume}} <span>0</span> {{/volume}} </span> </span> </span> {{#afterHoursPrice}} <!--row 2--> <span class=\"t-sec-2 a-hrs\"> <span class=\"t-exch\">{{#i18n}}AFTER HOURS{{/i18n}}</span> <span class=\"t-index\"> <span class=\"t-curnum {{afterHoursNetChangeClass}}\"> <!-- up, down, neutral --> <sup>{{{currency}}}</sup>{{afterHoursPrice}} </span> <span class=\"t-direction {{afterHoursNetChangeClass}}\"> <!-- up, down, neutral --> <span>{{afterHoursNetChange}}</span> <span>{{afterHoursChangePercent}}%</span> </span> </span> <span class=\"t-dates\"> {{afterHourslastDate}} {{afterHourslastTime}} {{#exchangeDelay}} <span>{{#i18n}}Volume{{/i18n}} ({{#i18n}}Delayed {{/i18n}}{{exchangeDelay}}{{#i18n}}m{{/i18n}}): <span>{{afterHoursVolume}}</span> </span> {{/exchangeDelay}} {{^exchangeDelay}} <span>{{#i18n}}Volume{{/i18n}} : <span>{{afterHoursVolume}}</span> </span> {{/exchangeDelay}} </span> </span> {{/afterHoursPrice}} <!--row 3--> <span class=\"t-sec-3\"> <span class=\"inline-list\"> {{#i18n}}P/E Ratio{{/i18n}} {{#peRatio}} <span>{{peRatio}}</span> {{/peRatio}} {{^peRatio}} <span>N/A</span> {{/peRatio}} </span> <span class=\"inline-list\">{{#i18n}}Market Cap{{/i18n}}<span> {{#marketCap}} {{{currency}}}{{marketCap}} {{/marketCap}} {{^marketCap}}N/A{{/marketCap}} </span></span> <span class=\"inline-list\"> {{#i18n}}Dividend Yield{{/i18n}} {{#dividendYeild}} <span>{{dividendYeild}}% </span> {{/dividendYeild}} {{^dividendYeild}} <span>N/A</span> {{/dividendYeild}} </span> <span class=\"inline-list\">{{#i18n}}Rev. per Employee{{/i18n}} {{#revPerEmployee}} <span>{{{currency}}}{{revPerEmployee}}</span> {{/revPerEmployee}} {{^revPerEmployee}} <span>N/A</span> {{/revPerEmployee}} </span> </span> <!--row 4--> <span class=\"t-sec-4\"> <!--canvas art--> <span id=\"{{chartId}}\" data-type=\"chart\" data-ticker=\"{{countryCode}}:{{ticker}}\"></span> </span> <!--row 5--> <span class=\"t-sec-5\"> {{#searchData}} {{#articles}} <span class=\"inline-list\">{{date}} <a href=\"{{targetUrl}}\">{{headline_text}}</a></span> {{/articles}} {{/searchData}} <a href=\"{{hrefLink}}?mod=articleInlineTicker\">{{#i18n}}More quote details and news{{/i18n}} &raquo;</a> </span> <!-- Portfolio --> <span class=\"t-sec-6\" style=\"display:none;\"> <span class=\"t-name\"> <a href=\"{{hrefLink}}\">{{name}}</a> <span>in</span> <span class=\"myPort\"> <a href=\"https://portfolio.wsj.com/portfolio?mod=WSJ_port_quotechicklet\" target=\"_blank\"> <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKwAAAAgCAYAAACPQ5N7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMDgwMTE3NDA3MjA2ODExODIyQTg2NzE2NDA3MDUyRCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5RkRFNUI4NDE0QjYxMUUzOTMzQ0M4QjgyNEMyMjcwNSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5RkRFNUI4MzE0QjYxMUUzOTMzQ0M4QjgyNEMyMjcwNSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDE4MDExNzQwNzIwNjgxMTgyMkFCRDlGMTk2MEE1QzIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDA4MDExNzQwNzIwNjgxMTgyMkE4NjcxNjQwNzA1MkQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7PuBBXAAAEoElEQVR42uxci3GjMBAVnmuAFkgJXAchJXAl4BLsEqwSohJMCSEdnEs4WqAEn8hImc16JQQSRk70ZjQeM1jsSk/7E3J2vV5ZQsKj4JdvB8/Pz2kU40IpW4WuCdkGj/5y4vrFo89PvL+/35ewCVHhjSCrJle3sM+Toc8XS58H9Tum7nkJamGllTTFBU9yBfSOfb3K1hDXj7LxO04aHCwXjJPZq4EVEZGvUq0e58FR7+qnhwTjIOwd+ikMZH0UF1oqYjRK30sEZH1bsFA1erX4LuD7UlyQXFETtpHWlztY2cM3iv9GT/H7weQuUJy59wgBKA+p4ZqhD+D5QRf/TgW+2diQcNDVT1kDyrpmqvE7Tx4Hz8YDnxHtDxrU8gG9RYG+dxvLI1Tc+mLglB9hpwgprWz1ja1rqwZ2iMn1JfhVCQ7UqlVEdpncSlkuG2l02NEYyijQgobGoGRoJgir9aiIpE046Kyz9Vw9qwLXj2DxFxNGoVWf9Yz7+4V6zLHytWFsjX0qDpGySK8vlhJ2tLK17KAlSh6useHJIVPXk1DdmbA4McELZvx+NshVAZLA8ILSWZP11bAoTWN0MiRCc+7vF+oxh7CUPKbqy6QsknMfskjeXVxDgs40CLKzBlmQreOmtZAzc30TT9jbhCepLGR9JD3uKovkWulqYTnotBhJCsz0AZG1swigXR4ufwm18nvkvjplaUvw+3blCa0NpRy8MFtkMaAlzZGFOhKLPSfKTjgjx+N0NHiDOfcv1WOOhzqChWkj42JZrISV5OwkSTvkLoSyrgUidjlhqbU7rIGF6QkXTy0IwdYt6uMBNNUeW2ISO0TKGumMCWvb+eGGygsPcP9SPeYQljsmrl9kkTy7kUVt+d/I4lIlgBsHo5U9oQkQM8KBAVnKxmLtcpegfQYqtQhwOxOlO2EYXOEYV1cTJZ8tEFqPVWWRJOZEcjaddI2bBvJmAch18EyCYF86s2wt7lkEHCSXCeBs3Z2ugSUsxs7xPm4h39xtvwuzb/cVKxHWNQY7JlrEC6eyFmFlfUtMArjhRpFkIKxrx/z2wak42rSIukSHb0JYkHnC2PKoiLzkua2Kg3NAWk7EtSErAx27/zZxwkYhwWhlBzDhvokQTr5qEB4UgZOthJ9IWODKP4irCOwDXHcrN4pdXWJbGF9TKCy/CYH8m+jhLIv03KQsswgLrGwIMuHk68BuNxViAN7tKwkyndHA9gGfyViYt8e20MNJFriTpch6I4t+xTUbDyFaThwwEK9yYhW4vGhsO3HQMPr1RZ9jFa4nDjLH/igdO+QdckLfKTmmdPzLbjczBvCMC5ve3oRjv1SPqWdoPVy4oI/VzJZF82/rM12tgbAtiwfjQO6RnJUlzAmV2HFkZUrPEGErPbxlgcZytzEZqMQqxmRLMPuhu15NwD7wYt4Hdstb6OEliyTrF1ky3/8lCHTMG7pPzuIv3lcGV70WCpCchHzevfWg8iIYXn7KYkrqYyHsPzAhTysG+wmRYe7/EuwikLkGZO0SWRNiJOwYAlxVOyMXdWXzjzgnJMImJCTCJiR4IUv/XpiQLGxCwkr4L8AA0B+ob0CpsK0AAAAASUVORK5CYII=\"> </a> </span> </span> <span class=\"numbers\"> <span class=\"sec-title\"> <span class=\"y-value\">{{#i18n}}Your Value{{/i18n}}</span> <span class=\"y-change\">{{#i18n}}Your Change{{/i18n}}</span> </span> <span class=\"n-values\"> <span></span> <span></span> <!-- up, down, neutral --> </span> <span class=\"n-values\"> <span></span> <span></span> <!-- up, down, neutral --> </span> <span class=\"shot-p\">{{#i18n}}Short position{{/i18n}}</span> </span> </span> <!-- end of data tooltip contents --> {{#tipAd}} <span class=\"data-tooltip-ad\"> <iframe src=\"iframe.html\" width=\"auto\" height=\"40px\"></iframe> </span> {{/tipAd}} </span> {{/changePercent}} {{/quoteData}} </span> {{/company}} {{#person}} {{#topicid}} <a href=\"{{link}}\">{{person}}</a>{{{suffix}}} {{/topicid}} {{^topicid}} {{person}}{{{suffix}}} {{/topicid}} {{/person}} {{#mutualfund}} {{#fundsymbol}} <a href=\"{{link}}\">{{mutualfund}}</a>{{{suffix}}} {{/fundsymbol}} {{^fundsymbol}} {{mutualfund}}{{{suffix}}} {{/fundsymbol}} {{/mutualfund}} {{#isInset}} {{>media-objects-experiential}} {{/isInset}} {{/articleBody}} </div> </div> ");});define("article.app/view/articleHeadline",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"wsj-article-headline-wrap {{#isSlideshow}}slideshow-article{{/isSlideshow}}\"> {{^isSlideshow}} {{#showDisclaimer}} <div class=\"pr-disclaimer pr-d-top\"> The Wall Street Journal news department was not involved in the creation of this content. </div> {{/showDisclaimer}} <div class=\"category{{#showDisclaimer}} pr-flashline{{/showDisclaimer}}\"> {{#searchURL}}<a href=\"{{searchURL}}\" class=\"flashline-category\" itemprop=\"articleSection\">{{/searchURL}}{{{searchText}}}{{#searchURL}}</a>{{/searchURL}} {{#englishSBID}} &nbsp;&nbsp;&nbsp;&nbsp;<a href=\"/news/articles/{{englishSBID}}\" class=\"flashline-category\" target=\"_blank\" itemprop=\"articleSection\">{{#i18n}}Original article (English){{/i18n}}</a> {{/englishSBID}} {{#articleFlashline}} <span class=\"region-cat\" itemprop=\"articleSection\">{{articleFlashline}}</span> {{/articleFlashline}} </div> {{/isSlideshow}} <h1 class=\"wsj-article-headline\" itemprop=\"headline\">{{{articleHeadline}}}</h1> {{#articleDeck}} <h2 class=\"sub-head\" itemprop=\"description\">{{{articleDeck}}}</h2> {{/articleDeck}} {{#isSlideshow}} <time class=\"timestamp\">{{{timestamp}}}</time> {{/isSlideshow}} </div> ");});define("article.app/view/articleHeadlineExperiential",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"wsj-article-headline-wrap\"> {{#articleFlashline}}<h5 class=\"region-cat\">{{{articleFlashline}}}</h5>{{/articleFlashline}} <h1 class=\"wsj-article-headline\" itemprop=\"headline\">{{{articleHeadline}}}</h1> {{#articleDeck}}<h2 class=\"subHed deck\">{{{articleDeck}}}</h2>{{/articleDeck}} </div>");});define("article.app/view/articleHeadlineExperientialFooter",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"nc-exp-footer-headline\"> {{#articleFlashline}}{{{articleFlashline}}}{{/articleFlashline}} {{#articleHeadline}} | {{{articleHeadline}}}{{/articleHeadline}} </div>");});define("article.app/view/articleSlideshow",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"wsj-slideshow stand-alone captions-on z-index-fix\" tabindex=\"1\"> <div class=\"wsj-slideshow-deck clearfix top-strap\"> <i class=\"wsj-slideshow-fullscreen-handle\"> fullscreen </i> </div> <div class=\"wsj-slideshow-wrap\"> <div class=\"wsj-slideshow-viewer\"> {{#slideshow.slides}} {{> partials/slideshow-slides}} {{/slideshow.slides}} <div class=\"wsj-slideshow-slide explore-more-slide\" data-slide-action=\"exploreMore\"> {{>exploreMore}} </div> </div> </div> <div class=\"wsj-slideshow-info-container\"> <div class=\"wsj-slideshow-counter\"> <span class=\"wsj-slideshow-currentIdx\"><!-- inserted --></span> of <span class=\"wsj-slideshow-total\"><!-- inserted --></span> <div class=\"wsj-slideshow-caption-toggle\"> <span class=\"wsj-slideshow-show-caption\">SHOW CAPTION</span> <span class=\"wsj-slideshow-hide-caption\">HIDE CAPTION</span> </div> <![if ! lte IE 8]> <i class=\"wsj-slideshow-fullscreen-handle\"> fullscreen </i> <![endif]> </div> <div class=\"wsj-slideshow-caption-container\"> <!-- captions inserted here --> </div> </div> </div> {{#isHOTD}} <div class=\"hotd-body\"> <ul class=\"hotd-info\"> <li class=\"hotd-location\"> <p class=\"hotd-info-title\">Location: </p> <p class=\"hotd-info\">{{#location}}{{{location}}}{{/location}} {{^location}}{{#i18n}}Unavailable{{/i18n}}{{/location}}</p> </li> <li class=\"hotd-price\"> <p><span class=\"hotd-info-title\">Price:&nbsp;</span><span class=\"hotd-info\">{{#price}}{{{price}}}{{/price}}{{^price}}{{#i18n}}Unavailable{{/i18n}}{{/price}}</span></p> </li> </ul> {{#articleDeck}} <p class=\"hotd-description\">{{{articleDeck}}}</p> {{/articleDeck}} </div> {{/isHOTD}} {{#hasRelatedContent}} <div class=\"media-object\"> <div class=\"media-object-rich-text\"> <h4>RELATED:</h4> <ul> {{#relatedContent}} <li><a class=\"related-link\" href={{url}}>{{headline}}</a></li> {{/relatedContent}} </ul> </div> </div> {{/hasRelatedContent}} ");});define("article.app/view/articleSnippet",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile(" <div class=\"snippet\"> {{>byline}} {{#articleSnippet}} <div class=\"wsj-snippet-body\"> {{{articleSnippet}}} </div> {{/articleSnippet}} <div class=\"wsj-snippet-login\"> <span class=\"wsj-snippet-login-text\"> {{#i18n}}To Read the Full Story,{{/i18n}} </span> <span> <a class=\"logInLink\" href=\"{{subscribeSnippetUrl}}\"> {{#i18n}}Subscribe{{/i18n}} </a> {{#i18n}}or{{/i18n}} <a class=\"logInLink\" href=\"{{loginUrl}}\"> {{#i18n}}Log In{{/i18n}} </a> </span> </div> </div> ");});define("article.app/view/articleSnippetLogin",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{^registeredUser}} <div class=\"drt-ad-login\"> <span>{{#i18n}}or &nbsp;{{/i18n}}<a class=\"logInLink\" href=\"{{loginUrl}}\"> {{#i18n}}Log In{{/i18n}}</a></span> </div> {{/registeredUser}} ");});define("article.app/view/byline",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile(" {{#formattedByline}} <div class=\"byline\"> {{#plainTextByline}} <span>{{plainTextByline}}</span> {{/plainTextByline}} {{^plainTextByline}} <span>By</span> {{#authors}} {{#.}} <div class=\"author {{#socialInfo}}mobile-scrim{{/socialInfo}} hasMenu\" data-scrim='{\"type\":\"author\",\"header\":\"{{authorName}}\",\"subhead\":\"The Wall Street Journal\",\"list\":[{{#socialInfo}}{{#authorBiography}}{\"type\":\"link\",\"icon\":\"bio\",\"url\":\"{{authorBiography}}\",\"text\":\"Biography\"}{{/authorBiography}}{{#email}},{\"type\":\"link\",\"icon\":\"email\",\"url\":\"mailto:{{email}}\",\"text\":\"{{email}}\"}{{/email}}{{#twitter}},{\"type\":\"link\",\"icon\":\"twitter\",\"url\":\"http://twitter.com/{{twitter}}\",\"text\":\"@{{twitter}}\"}{{/twitter}}{{#facebook}},{\"type\":\"link\",\"icon\":\"facebook\",\"url\":\"http://facebook.com/{{facebook}}\",\"text\":\"{{facebook}}\"}{{/facebook}}{{#googlePlus}},{\"type\":\"link\",\"icon\":\"google\",\"url\":\"{{googlePlus}}\",\"text\":\"Google+\"}{{/googlePlus}}{{/socialInfo}}]}' itemscope itemprop=\"author\" itemtype=\"http://schema.org/Person\"> {{#socialInfo}} <span class=\"name\" itemprop=\"name\">{{authorName}}</span>{{textFragment}} <ul class=\"author-info\"> <li class=\"tri\"></li> <div class=\"info-name\">{{authorName}}</div> <div class=\"info-title\">The Wall Street Journal</div> <div class=\"close-button-container\"> <a href=\"#\" class=\"close-button\">CANCEL</a> </div> {{#authorBiography}}<li><a href=\"{{authorBiography}}\" class=\"author icon bio\">Biography</a><a href=\"{{authorBiography}}\" style=\"display:none;\" itemprop=\"url\" rel=\"author\">{{authorName}}</a></li>{{/authorBiography}} {{#email}}<li><a href=\"mailto:{{email}}\" class=\"author icon email\" itemprop=\"email\">{{email}}</a></li>{{/email}} {{#twitter}}<li><a href=\"http://twitter.com/{{twitter}}\" target=\"blank\" class=\"author icon twitter\">@{{twitter}}</a></li>{{/twitter}} {{#facebook}}<li><a href=\"http://facebook.com/{{facebook}}\" target=\"blank\" class=\"author icon facebook\">{{facebook}}</a></li>{{/facebook}} {{#googlePlus}}<li><a href=\"{{googlePlus}}\" target=\"blank\" class=\"author icon google\">Google+</a></li>{{/googlePlus}} </ul> {{/socialInfo}} {{^socialInfo}} <span itemprop=\"name\">{{authorName}}</span>{{textFragment}} {{/socialInfo}} </div> {{/.}} {{/authors}} {{/plainTextByline}} </div> {{/formattedByline}} ");});define("article.app/view/columnist_mini",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"module columnist_mini\"> <div class=\"strap clear \" data-fxGroup=\"toggle\"> {{#authorInfo}} <h3 class=\"subhead\"><a href=\"{{authorBiography}}\">{{authorName}}</a></h3> <button class=\"connect\" data-fxTrigger=\"open\">{{#i18n}}CONNECT{{/i18n}}</button> <menu class=\"connect-menu\"> <!-- Twitter --> {{#twitterHandle}} <iframe scrolling=\"no\" frameborder=\"0\" name=\"twitter_iframe\" id=\"twitter_iframe\" data-dj-src=\"http://platform.twitter.com/widgets/follow_button.html?screen_name={{twitterHandle}}&amp;show_count=false\" style=\"width: 60px; height: 21px;\" allowtransparency=\"true\" src=\"http://platform.twitter.com/widgets/follow_button.html?screen_name={{twitterHandle}}&amp;show_count=false\" class=\"twitter_follow\"></iframe> <a class=\"twitter\" href=\"http://www.twitter.com/@{{{twitterHandle}}}\">{{twitterHandle}}</a> {{/twitterHandle}} <!-- Email --> {{#emailAddress}} <a class=\"email\" href=\"mailto:{{emailAddress}}\">{{emailAddress}}</a> {{/emailAddress}} <!-- Facebook --> {{#facebookAccount}} <iframe data-dj-src=\"http://www.facebook.com/plugins/follow.php?href=https%3A%2F%2Fwww.facebook.com%2F{{facebookAccount}}&amp;layout=button_count&amp;show_faces=false&amp;colorscheme=light&amp;font&amp;width=250&amp;height=21\" scrolling=\"no\" frameborder=\"0\" style=\"border:none; overflow:hidden; width:250px; height:21px;\" allowtransparency=\"true\" src=\"http://www.facebook.com/plugins/follow.php?href=https%3A%2F%2Fwww.facebook.com%2F{{facebookAccount}}&amp;layout=button_count&amp;show_faces=false&amp;colorscheme=light&amp;font&amp;width=250&amp;height=21\" class=\"facebook_follow\"></iframe> {{/facebookAccount}} <!-- Google+ --> {{#googlePlusAccount}} <div style=\"text-indent: 0px; margin: 0px; padding: 0px; background-color: transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 32px; height: 20px; background-position: initial initial; background-repeat: initial initial;\" id=\"___plusone_1\" class=\"google_recommend\"><iframe frameborder=\"0\" hspace=\"0\" marginheight=\"0\" marginwidth=\"0\" scrolling=\"no\" style=\"position: static; top: 0px; width: 32px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;\" tabindex=\"0\" vspace=\"0\" width=\"100%\" id=\"I1_1386264076134\" name=\"I1_1386264076134\" src=\"https://apis.google.com/u/0/_/+1/fastbutton?usegapi=1&amp;bsv=o&amp;size=medium&amp;annotation=none&amp;origin=http%3A%2F%2Fonline.wsj.com&amp;url=https%3A%2F%2Fplus.google.com%2F116194500568736613251%2Fposts&amp;gsrc=3p&amp;jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.RRZneeibGJw.O%2Fm%3D__features__%2Fam%3DEQ%2Frt%3Dj%2Fd%3D1%2Frs%3DAItRSTOIz0oCjmszHzv-ymJLogp6yLJBfg#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&amp;id=I1_1386264076134&amp;parent=http%3A%2F%2Fonline.wsj.com&amp;pfname=&amp;rpctoken=27016837\" data-gapiattached=\"true\" title=\"+1\"></iframe></div> <a href=\"#\" class=\"google\">{{authorName}}</a> {{/googlePlusAccount}} <!-- Bio --> <a class=\"bio\" href=\"{{authorBiography}}\">{{#i18n}}Biography{{/i18n}}</a> </menu> {{/authorInfo}} </div> <div class=\"article clear hedSumm{{^authorInfo}}plain{{/authorInfo}}\"> {{#authorInfo}} <img src=\"{{hedcutImage}}\" alt=\"{{authorName}}\"> {{/authorInfo}} {{^authorInfo}} <a href=\"{{tesla_url}}?mod=WSJ_TechWSJD_topRight\"><img src=\"{{image}}\" alt=\"{{text}}\"></a> {{/authorInfo}} {{#headlines.0}} <h4 class=\"headline {{#isFree}}subPrev{{/isFree}}\"><a href=\"{{tesla_url}}?mod=WSJ_TechWSJD_topRight\">{{{headline}}}</a></h4> {{/headlines.0}} {{^authorInfo}} {{#headlines.0}} <h5 class=\"subhead {{#isFree}}subPrev{{/isFree}}\">{{{text}}}</h5> {{/headlines.0}} {{/authorInfo}} </div> </div>");});define("article.app/view/comments-count",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<![if ! lte IE 8]> {{#showCommentsCount}} <div class=\"comments-count-container\"> <a class=\"comments_header\" href=\"#livefyre-comment\" rel=\"nofollow\"> <span class=\"comments_count_icon\"></span> {{#commentsCount}}{{commentsCount}} COMMENTS{{/commentsCount}} {{^commentsCount}}0 COMMENTS{{/commentsCount}} </a> {{#commentsCount}} <meta itemprop=\"interactionCount\" content=\"UserComments:{{commentsCount}}\"> {{/commentsCount}} </div> {{/showCommentsCount}} <![endif]> ");});define("article.app/view/experiential_byline",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile(" {{#formattedByline}} {{#plainTextByline}} <span>{{plainTextByline}}</span> {{/plainTextByline}} {{^plainTextByline}} <span>By</span> {{#authors}} {{#.}} <span>{{authorName}}</span>{{textFragment}} {{/.}} {{/authors}} {{/plainTextByline}} {{/formattedByline}} ");});define("article.app/view/experiential_byline_bottom",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"nc-exp-byline-bottom\"> {{#formattedByline}} <div class=\"byline clearfix position_rel\"> {{#plainTextByline}} <span>{{plainTextByline}}</span> {{/plainTextByline}} {{^plainTextByline}} <span>By</span> {{#authors}} {{#.}} <div class=\"author trigger target mobile-scrim\" data-scrim='{\"type\":\"author\",\"header\":\"{{authorName}}\",\"subhead\":\"The Wall Street Journal\",\"list\":[{{#socialInfo}}{{#authorBiography}}{\"type\":\"link\",\"icon\":\"bio\",\"url\":\"{{authorBiography}}\",\"text\":\"Biography\"}{{/authorBiography}}{{#email}},{\"type\":\"link\",\"icon\":\"email\",\"url\":\"mailto:{{email}}\",\"text\":\"{{email}}\"}{{/email}}{{#twitter}},{\"type\":\"link\",\"icon\":\"twitter\",\"url\":\"http://twitter.com/{{twitter}}\",\"text\":\"@{{twitter}}\"}{{/twitter}}{{#facebook}},{\"type\":\"link\",\"icon\":\"facebook\",\"url\":\"http://facebook.com/{{facebook}}\",\"text\":\"{{facebook}}\"}{{/facebook}}{{#googlePlus}},{\"type\":\"link\",\"icon\":\"google\",\"url\":\"{{googlePlus}}\",\"text\":\"Google+\"}{{/googlePlus}}{{/socialInfo}}]}'> {{#socialInfo}} <span class=\"name\">{{authorName}}</span>{{textFragment}} <ul class=\"author-info\"> <li class=\"tri\"></li> <h3 class=\"info-name\">{{authorName}}</h3> <h4 class=\"info-title\">The Wall Street Journal</h4> <div class=\"close-button-container\"> <a href=\"#\" class=\"close-button\">CANCEL</a> </div> {{#authorBiography}}<a href=\"{{authorBiography}}\"><li class=\"icon bio\">Biography</li></a>{{/authorBiography}} <![if ! lte IE 8]> {{#email}}<a href=\"mailto:{{email}}\"><li class=\"icon email\">{{email}}</li></a>{{/email}} {{#twitter}}<a href=\"http://twitter.com/{{twitter}}\" target=\"blank\"><li class=\"icon twitter\">@{{twitter}}</li></a>{{/twitter}} {{#facebook}}<a href=\"http://facebook.com/{{facebook}}\" target=\"blank\"><li class=\"icon facebook\">{{facebook}}</li></a>{{/facebook}} {{#googlePlus}}<a href=\"{{googlePlus}}\" target=\"blank\"><li class=\"icon google\">Google+</li></a>{{/googlePlus}} <![endif]> </ul> {{/socialInfo}} {{^socialInfo}} <span>{{authorName}}</span>{{textFragment}} {{/socialInfo}} </div> {{/.}} {{/authors}} {{/plainTextByline}} <time class=\"timestamp\"> {{timestamp}} </time> </div> {{/formattedByline}} </div> ");});define("article.app/view/exploreMore",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile(" <div class=\"explore-more-div\"> <div class=\"replay\"> <button class=\"wsj-gohome-button replay-button\" action=\"gotohome\"> <div id=\"slideshow_image\" style=\"background-image: url( {{slideshow_image}} );\"> <div id=\"filter-layer\"></div> <div id=\"replay-icon\"> <div id=\"replay_image\"></div> <div id=\"replay_text\">Replay</div> </div> </div> <p class=\"slideshow_headline\">{{slideshow_head}}</p> </button> </div> <div class=\"popular\"> <hr id=\"explore-more-separator\"> <p>More Slideshows</p> <ul class=\"explore-more-slideshows\"> {{#relatedSlideshows}} <li> <div class=\"popular-slideshow\"> <a class=\"popular-link\" href=\"{{url}}\" title=\"{{headline}}\"> <img src=\"http://si.wsj.net/public/resources/images/{{image.src}}\" alt=\"image\"/> <div class=\"explore-more-wrapper\"> {{headline}} </div> </a> </div> </li> {{/relatedSlideshows}} </ul> </div> </div> ");});define("article.app/view/hotdLogo",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#isHOTD}} <div class=\"hotd-logo\"> </div> {{/isHOTD}} ");});define("article.app/view/ie_warning",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"ie-flag\"> <button class=\"ie-button\"></button> <div class=\"ie-warning-wrapper\"> <p><span id=\"warning-label\">BROWSER UPDATE</span> To gain access to the full experience, please upgrade your browser: </p> <ul> <li><a href=\"https://www.google.com/intl/en_us/chrome/browser/\">Chrome</a> | </li> <li><a href=\"http://support.apple.com/downloads/#safari\">Safari</a> | </li> <li><a href=\"https://www.mozilla.org/en-US/firefox/new/\">Firefox</a> | </li> <li><a href=\"http://windows.microsoft.com/en-us/internet-explorer/download-ie\">Internet Explorer</a></li> </ul><br> <p><span id=\"warning-note\">Note: If you are running Internet Explorer 9 and above, make sure it is not in compatibility mode</span></p> </div> </div> ");});define("article.app/view/media-objects-experiential",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#bleed}} {{!close wrapper for bleed insets in experiential article}} </div> {{/bleed}} {{^insetnone}} {{!have layout wrapper only if there's an actual layout}} {{!so dynamic insets with no layout don't get one in experiential articles}} <div data-layout=\"{{layout}}\" class=\" media-object {{layout}} {{^layout}} reno-inset {{#full-width}}bleed{{/full-width}} {{^full-width}}wrap{{/full-width}} {{/layout}} {{#legacyInset}} {{#shaded-inset}}insetContentType-shaded{{/shaded-inset}} {{#newsletter}}newsletter{{/newsletter}} {{/legacyInset}} \"> {{/insetnone}} {{#InsetHtml}} <div class=\"media-object-rich-text\"> {{{html}}} </div> {{/InsetHtml}} {{#InsetMediaIllustration}} {{>media-objects/image}} {{/InsetMediaIllustration}} {{#InsetMediaVideo}} {{>media-objects/video}} {{/InsetMediaVideo}} {{#InsetPullQuote}} {{>media-objects/pullquote}} {{/InsetPullQuote}} {{#InsetSlideshow}} {{> media-objects/slideshow}} {{/InsetSlideshow}} {{#InsetRichText}} {{>media-objects/rich-text}} {{/InsetRichText}} {{#InsetMediaInteractiveLink}} {{>media-objects/interactive-link}} {{/InsetMediaInteractiveLink}} {{#InsetMediaInteractiveIframe}} {{>media-objects/interactive-iframe}} {{/InsetMediaInteractiveIframe}} {{#InsetDynamic}} {{#localDynamicInset}} {{>media-objects/dynamic-inset}} {{/localDynamicInset}} {{{renderedDynamicInset}}} {{/InsetDynamic}} {{#InsetMediaDocument}} {{>old-insets/media-document}} {{/InsetMediaDocument}} {{#InsetMediaInteractiveFlash}} {{>old-insets/interactive-flash}} {{/InsetMediaInteractiveFlash}} {{! TODO: how can we consolidate the four slideshow-like things we have? }} {{#InsetMediaInteractiveSlideshow}} {{>old-insets/related-slideshow}} {{/InsetMediaInteractiveSlideshow}} {{#InsetMediaEmbeddedSlideShow}} {{>old-insets/embedded-slideshow}} {{/InsetMediaEmbeddedSlideShow}} {{#InsetMediaSlideshow}} {{>old-insets/media-slideshow}} {{/InsetMediaSlideshow}} {{#InsetCustom}} {{>old-insets/explore-more}} {{/InsetCustom}} {{#InsetRichMedia}} {{! Note: Support media objects inside media objects whitelist of supported types }} <div class=\"media-object-rich-text\"> {{#elements}} {{#htmlElement}} {{{htmlElement}}} {{/htmlElement}} {{#InsetMediaVideo}} {{>media-objects/video}} {{/InsetMediaVideo}} {{#InsetMediaIllustration}} {{>media-objects/image}} {{/InsetMediaIllustration}} {{! Note: the rest are things which are in old articles but may render strangely }} {{#InsetMediaDocument}} {{>old-insets/media-document}} {{/InsetMediaDocument}} {{#InsetMediaInteractiveLink}} {{>media-objects/interactive-link}} {{/InsetMediaInteractiveLink}} {{#InsetMediaInteractiveIframe}} {{>media-objects/interactive-iframe}} {{/InsetMediaInteractiveIframe}} {{#InsetMediaInteractiveFlash}} {{>old-insets/interactive-flash}} {{/InsetMediaInteractiveFlash}} {{#InsetMediaInteractiveSlideshow}} {{>old-insets/related-slideshow}} {{/InsetMediaInteractiveSlideshow}} {{!-- rendering as new teaser inset --}} {{#InsetMediaSlideshow}} {{>old-insets/media-slideshow}} {{/InsetMediaSlideshow}} {{/elements}} </div> {{/InsetRichMedia}} {{^insetnone}} </div> {{! close media-object }} {{/insetnone}} {{#bleed}} {{!reopen wrapper for bleed insets in experiential article}} <div class=\"nc-exp-article nc-exp-article-internal\"> {{/bleed}}");});define("article.app/view/media-objects",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div data-layout=\"{{layout}}\" class=\" media-object {{layout}} {{^layout}} reno-inset {{#full-width}}inline{{/full-width}} {{^full-width}}wrap{{/full-width}} {{/layout}} {{#legacyInset}} {{#shaded-inset}}insetContentType-shaded{{/shaded-inset}} {{#newsletter}}newsletter{{/newsletter}} {{/legacyInset}} \"> {{#InsetHtml}} <div class=\"media-object-rich-text\"> {{{html}}} </div> {{/InsetHtml}} {{#InsetMediaIllustration}} {{>media-objects/image}} {{/InsetMediaIllustration}} {{#InsetMediaVideo}} {{>media-objects/video}} {{/InsetMediaVideo}} {{#InsetPullQuote}} {{>media-objects/pullquote}} {{/InsetPullQuote}} {{#InsetSlideshow}} {{> media-objects/slideshow}} {{/InsetSlideshow}} {{#InsetRichText}} {{>media-objects/rich-text}} {{/InsetRichText}} {{#InsetMediaInteractiveLink}} {{>media-objects/interactive-link}} {{/InsetMediaInteractiveLink}} {{#InsetMediaInteractiveIframe}} {{>media-objects/interactive-iframe}} {{/InsetMediaInteractiveIframe}} {{#InsetDynamic}} {{#localDynamicInset}} {{>media-objects/dynamic-inset}} {{/localDynamicInset}} {{{renderedDynamicInset}}} {{/InsetDynamic}} {{#InsetMediaDocument}} {{>old-insets/media-document}} {{/InsetMediaDocument}} {{#InsetMediaInteractiveFlash}} {{>old-insets/interactive-flash}} {{/InsetMediaInteractiveFlash}} {{! TODO: how can we consolidate the four slideshow-like things we have? }} {{#InsetMediaInteractiveSlideshow}} {{>old-insets/related-slideshow}} {{/InsetMediaInteractiveSlideshow}} {{#InsetMediaEmbeddedSlideShow}} {{>old-insets/embedded-slideshow}} {{/InsetMediaEmbeddedSlideShow}} {{#InsetMediaSlideshow}} {{>old-insets/media-slideshow}} {{/InsetMediaSlideshow}} {{#InsetCustom}} {{>old-insets/explore-more}} {{/InsetCustom}} {{#InsetRichMedia}} {{! Note: Support media objects inside media objects whitelist of supported types }} <div class=\"media-object-rich-text\"> {{#elements}} {{#htmlElement}} {{{htmlElement}}} {{/htmlElement}} {{#InsetMediaVideo}} {{>media-objects/video}} {{/InsetMediaVideo}} {{#InsetMediaIllustration}} {{>media-objects/image}} {{/InsetMediaIllustration}} {{! Note: the rest are things which are in old articles but may render strangely }} {{#InsetMediaDocument}} {{>old-insets/media-document}} {{/InsetMediaDocument}} {{#InsetMediaInteractiveLink}} {{>media-objects/interactive-link}} {{/InsetMediaInteractiveLink}} {{#InsetMediaInteractiveIframe}} {{>media-objects/interactive-iframe}} {{/InsetMediaInteractiveIframe}} {{#InsetMediaInteractiveFlash}} {{>old-insets/interactive-flash}} {{/InsetMediaInteractiveFlash}} {{#InsetMediaInteractiveSlideshow}} {{>old-insets/related-slideshow}} {{/InsetMediaInteractiveSlideshow}} {{!-- rendering as new teaser inset --}} {{#InsetMediaSlideshow}} {{>old-insets/media-slideshow}} {{/InsetMediaSlideshow}} {{/elements}} </div> {{/InsetRichMedia}} </div> {{! close media-object }} ");});define("article.app/view/plain_mini",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"module columnist_mini\"> <div class=\"strap clear \" data-fxGroup=\"toggle\"></div> <div class=\"article clear plain hedSumm\"> {{#headlines.0}} {{#image}}<a href=\"{{tesla_url}}?mod=WSJ_TechWSJD_topRight\"><img src=\"{{image}}\" ></a>{{/image}} <h4 class=\"headline {{#isFree}}subPrev{{/isFree}}\"><a href=\"{{tesla_url}}?mod=WSJ_TechWSJD_topRight\">{{{headline}}}</a></h4> <p>{{{text}}}</p> {{/headlines.0}} </div> </div>");});define("article.app/view/responsiveAd",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#adActivate}} <div class=\"wsj-responsive-ad-wrap\" id='{{adId}}' data-ad-options='{{adOptions}}' data-tracking=\"{{trackingKey}}\" {{#chartbeatId}}data-cb-ad-id=\"{{chartbeatId}}\"{{/chartbeatId}}> {{! responsive article ad }} </div> {{/adActivate}} ");});define("article.app/view/shareTools",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<ul class=\"article_tools clearFix\"> <li data-url=\"{{article.url.standard}}\" data-text=\"{{article.headline.social}}\" data-total=\"{{article.stats.facebook}}\" class=\"icon facebook\"> {{#article.stats.facebook}} {{article.stats.facebook}} <meta itemprop=\"interactionCount\" content=\"UserLikes:{{article.stats.facebook}}\"> {{/article.stats.facebook}} </li> <li data-url=\"{{article.url.social}}\" data-text=\"{{article.headline.social}}\" data-total=\"{{article.stats.twitter}}\" class=\"icon twitter\"> {{#article.stats.twitter}} {{article.stats.twitter}} <meta itemprop=\"interactionCount\" content=\"UserTweets:{{article.stats.twitter}}\"> {{/article.stats.twitter}} </li> <li class=\"icon email mobile-scrim\" data-scrim='{{article.emailscrim}}' data-headline=\"{{article.headline.social}}\" data-url=\"{{article.url.email}}\" data-timestamp=\"{{article.timestamp}}\" {{#article.emailimgsrc}}data-emailimgsrc=\"{{article.emailimgsrc}}\"{{/article.emailimgsrc}}> </li> {{#article.hasEvernote}} <li class=\"icon evernote evernote-clip-button\" data-id=\"{{article.sbId}}\" data-headline=\"{{article.headline.standard}}\" data-url=\"{{article.url.standard}}\" data-authors=\"{{article.authors}}\" data-date=\"{{article.timestamp}}\" data-summary=\"{{article.deck}}\" ></li> {{/article.hasEvernote}} <li class=\"icon text-size mobile-scrim hasMenu\" id=\"text-size\" data-scrim='{\"id\":\"text-size\",\"header\":\"Text Size\",\"list\":[{\"type\":\"option\",\"class\":\"selected regular\",\"text\":\"Regular\"},{\"type\":\"option\",\"class\":\"medium\",\"text\":\"Medium\"},{\"type\":\"option\",\"class\":\"large\",\"text\":\"Large\"}]}'> <menu> <li class=\"tri\"></li> <li class=\"menu-header\">Text Size</li> <li class=\"option regular selected\">Regular</li> <li class=\"option medium\">Medium</li> <li class=\"option large\">Large</li> </menu> </li> <li class=\"icon more mobile-scrim hasMenu\" data-scrim='{\"header\":\"More Tools\",\"list\":[{\"type\":\"share\",\"icon\":\"google\",\"url\":\"example_url\",\"text\":\"Google+\"},{\"type\":\"share\",\"icon\":\"linked\",\"url\":\"example_url\",\"text\":\"LinkedIn\"},{\"type\":\"link\",\"icon\":\"print\",\"url\":\"javascript:window.print();\",\"text\":\"Print\"}]}'> <menu> <li class=\"tri\"></li> {{#isHOTD}} <li data-url=\"{{article.url.social}}\" data-text=\"{{article.headline.social}}\" data-total=\"{{}}\" {{#article.emailimgsrc}}data-emailimgsrc=\"{{article.emailimgsrc}}\"{{/article.emailimgsrc}} class=\"icon pinterest\">Pinterest </li> {{/isHOTD}} <li data-url=\"{{article.url.social}}\" data-text=\"{{article.headline.social}}\" data-total=\"{{article.stats.googleplus}}\" class=\"icon google\">Google+ {{#article.stats.googleplus}} <meta itemprop=\"interactionCount\" content=\"UserPlusOnes:{{article.stats.googleplus}}\"> {{/article.stats.googleplus}} </li> <li data-url=\"{{article.url.social}}\" data-text=\"{{article.headline.social}}\" data-total=\"{{article.stats.linkedIn}}\" class=\"icon linked\">LinkedIn </li> <li class=\"border\"></li> <li class=\"icon print\">Print</li> <!-- <li class=\"icon save\"></li> --> </menu> </li> </ul> ");});define("article.app/view/shareToolsExperiential",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"nc-exp-tools\" id=\"ncExpTools\"> <nav class=\"nc-exp-nav\"> <a href=\"http://online.wsj.com\" class=\"nc-head-logo\">WSJ</a> </nav> <div class=\"nc-exp-sections\" id=\"expNav\"><span class=\"nc-percent-blocker\" id=\"expSectionTracker\"></span></div> <div class=\"nc-exp-headershare\" id=\"expShareTools\"> <menu class=\"nc-exp-social nc-exp-popbox-wrap\"> <li class=\"nc-exp-social-li\"> <span class=\"nc-exp-icon-wrap nc-exp-sociallabel\"> <span class=\"nc-exp-icon nc-exp-share\"></span>{{#i18n}}SHARE{{/i18n}} </span> <menu class=\"nc-exp-socialsub nc-exp-popbox\"> <li id=\"expShareLabel\"> <span class=\"nc-exp-icon-wrap\"> <span class=\"nc-exp-icon nc-exp-share nc-exp-icon-active\"></span>{{#i18n}}SHARE{{/i18n}} </span> </li> <li id=\"expShareTwtHidden\" class=\"\" data-url=\"{{article.url.standard}}\" data-via=\"WSJ\" data-text=\"{{article.headline.social}}\"></li> <li id=\"expShareTwt\" data-url=\"{{article.url.social}}\" data-via=\"WSJ\" data-total=\"{{article.stats.twitter}}\" data-text=\"{{article.headline.social}}\"></li> <li id=\"expShareFb\" data-url=\"{{article.url.standard}}\" data-text=\"{{article.headline.social}}\" data-total=\"{{article.stats.facebook}}\"></li> <li id=\"expSharePrint\"> <a href=\"{{article.url.standard}}#printMode\" target=\"_blank\" title=\"{{article.headline.social}}\" class=\"nc-exp-icon-wrap\"> <span class=\"nc-exp-icon nc-exp-print\"></span>{{#i18n}}PRINT{{/i18n}} </a> </li> <li id=\"expShareEmail\"> <a href=\"mailto:?subject={{article.headline.social}}&body={{article.headline.social}} : {{article.url.email}}\" class=\"nc-exp-icon-wrap\" data-scrim='{{article.emailscrim}}' data-headline=\"{{article.headline.social}}\" data-url=\"{{article.url.email}}\" data-timestamp=\"{{article.timestamp}}\" {{#article.emailimgsrc}}data-emailimgsrc=\"{{article.emailimgsrc}}\"{{/article.emailimgsrc}}><span class=\"nc-exp-icon nc-exp-email\"></span>{{#i18n}}EMAIL{{/i18n}} </a> </li> <li id=\"expShareComments\"> <a href=\"#comments\" class=\"nc-exp-icon-wrap\" id=\"expCommentLink\"><span class=\"nc-exp-icon nc-exp-comments\"><div class=\"nc-exp-comment-number\"></div></span>{{#i18n}}COMMENT{{/i18n}} </a> </li> </menu> </li> </menu> </div> </div>");});define("article.app/view/shareToolsExperiential_horizontal",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"sharebuttons-bottom\" id=\"ncShareBottom\"> <ul> <li id=\"expShareEmailBottom\" class=\"share-bottom\"> <a href=\"mailto:?subject={{article.headline.social}}&body={{article.headline.social}} : {{article.url.email}}\" data-scrim='{{article.emailscrim}}' data-headline=\"{{article.headline.social}}\" data-url=\"{{article.url.email}}\" data-timestamp=\"{{article.timestamp}}\" {{#article.emailimgsrc}}data-emailimgsrc=\"{{article.emailimgsrc}}\"{{/article.emailimgsrc}} class=\"nc-exp-icon-wrap\"><span class=\"nc-exp-icon nc-exp-email\"></span>{{#i18n}}EMAIL{{/i18n}} </a> </li> <li id=\"expSharePrintBottom\" class=\"share-bottom\"> <a href=\"#print\" target=\"_blank\" title=\"{{article.headline.social}}\" class=\"nc-exp-icon-wrap print\"> <span class=\"nc-exp-icon nc-exp-print\"></span>{{#i18n}}PRINT{{/i18n}} </a> </li> <li id=\"expShareTwtBottom\" class=\"share-bottom\" data-url=\"{{article.url.social}}\" data-total=\"{{article.stats.twitter}}\" data-via=\"WSJ\" data-text=\"{{article.headline.social}}\"></li> <li id=\"expShareFbBottom\" class=\"share-bottom\" data-url=\"{{article.url.social}}\" data-total=\"{{article.stats.facebook}}\" data-text=\"{{article.headline.social}}\"></li> </ul> </div>");});define("article.app/view/slideshowHeadline",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"wsj-article-headline-wrap\"> <h1 class=\"wsj-article-headline slideshow-headline\" itemprop=\"headline\">{{{articleHeadline}}}</h1> {{^isHOTD}} {{#articleDeck}} <h2 class=\"sub-head\" itemprop=\"description\">{{{articleDeck}}}</h2> {{/articleDeck}} {{/isHOTD}} <h2 class=\"timestamp\"> {{#timestamp}}{{{timestamp}}}{{/timestamp}} <![if ! lte IE 8]> <!-- COMMENT COUNT --> <a id=\"comments_header_slideshow\" class=\"comments_header\" href=\"#livefyre-comment\" rel=\"nofollow\"> <span class=\"comments_count_icon\"></span> {{#commentsCount}}{{commentsCount}} COMMENTS{{/commentsCount}} {{^commentsCount}}0 COMMENTS{{/commentsCount}} </a> {{#commentsCount}}<meta itemprop=\"interactionCount\" content=\"UserComments:{{commentsCount}}\">{{/commentsCount}} <![endif]> </h2> </div> ");});define("article.app/view/timestamp",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<time class=\"timestamp\"> {{timestamp}} </time>");});define("article.app/view/top_stories",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<ul class=\"top_stories clear\"> {{#articles}} {{#decoSummaryInset}} <li class=\"{{#isFree}}subPrev{{/isFree}}\"> <h4 class=\"category\">{{#flashline}}{{flashline}}{{/flashline}}{{^flashline}}Featured{{/flashline}}</h4> {{#imageInfo}} <a href=\"{{imageInfo.linkurl}}\"><img src=\"{{imageInfo.url}}\"></a> {{/imageInfo}} <h3><a href=\"{{url}}\" class=\"headline\"><p>{{headline}}</p></a></h3> {{^imageInfo}} <p class=\"summarytext\">{{text}}</p> {{/imageInfo}} </li> {{/decoSummaryInset}} {{^decoSummaryInset}} <li class=\"{{#isFree}}subPrev{{/isFree}}\"> <h4 class=\"category section-{{sectionclass}}\">{{#type}}{{type}}{{/type}}</h4> {{#images.d}} <a href=\"{{url}}\"><img src=\"{{images.d}}\"></a> {{/images.d}} <h3><a href=\"{{url}}\" class=\"headline\"><p>{{headline}}</p></a></h3> {{^images.d}} <p class=\"summarytext\">{{text}}</p> {{/images.d}} </li> {{/decoSummaryInset}} {{/articles}} {{#video.items}} <li class=\"video subPrev\"> <h4 class=\"category\">{{wsj-subsection}} {{^wsj-subsection}}{{wsj-section}}{{/wsj-subsection}}</h4> <a class=\"image\" href=\"{{linkURL}}\" intent in-touch-href=\"{{video464kMP4Url}}\" in-mouse-href=\"{{linkURL}}\"> <div class=\"center-image\"> <img src=\"{{videoStillURL}}\"> </div> <span class=\"video-play\">PLAY</span> </a> <h3><a href=\"{{linkURL}}\" class=\"headline\" intent in-touch-href=\"{{video464kMP4Url}}\" in-mouse-href=\"{{linkURL}}\"> <p>{{name}}</p> </a></h3> </li> {{/video.items}} </ul> ");});define("article.app/view/asset/scripts",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<!-- COMMON --> {{{page.assets.scripts.common}}} <!-- END COMMON --> <!-- MODULES --> {{{page.assets.scripts.modules}}} <!-- END MODULES --> ");});define("article.app/view/asset/styles",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#bundles}} {{{global.styles}}} {{#isIE}} {{{globalIE.styles}}} {{/isIE}} {{{modules.styles}}} <!--[if IE 9]> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Chronicle/font_HCo_Chronicle-ie.css\" /> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Whitney/font_HCo_Whitney-ie.css\" /> <![endif]--> <!--[if lte IE 8]> {{{lteIe8.styles}}} <![endif]--> {{/bundles}} ");});define("article.app/view/asset/styles_newnav",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#bundles}} {{{global_newnav.styles}}} {{{modules.styles}}} <!--[if IE 9]> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Chronicle/font_HCo_Chronicle-ie.css\" /> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Whitney/font_HCo_Whitney-ie.css\" /> <![endif]--> <!--[if lte IE 9]> {{{globalIEprint.styles}}} {{{lteIe9.styles}}} <![endif]--> <!--[if lte IE 8]> {{{globalIE.styles}}} {{{lteIe8.styles}}} <![endif]--> {{/bundles}} ");});define("article.app/view/asset/styles_slideshow",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#bundles}} {{{slideshow.styles}}} <!--[if IE 9]> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Chronicle/font_HCo_Chronicle-ie.css\" /> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Whitney/font_HCo_Whitney-ie.css\" /> <![endif]--> <!--[if lte IE 9]> {{{globalIEprint.styles}}} {{{lteIe9.styles}}} <![endif]--> <!--[if lte IE 8]> {{{globalIE.styles}}} {{{lteIe8.styles}}} <![endif]--> {{/bundles}} ");});define("article.app/view/asset/styles_slideshow_newnav",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#bundles}} {{{slideshow_newnav.styles}}} <!--[if IE 9]> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Chronicle/font_HCo_Chronicle-ie.css\" /> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Whitney/font_HCo_Whitney-ie.css\" /> <![endif]--> <!--[if lte IE 9]> {{{globalIEprint.styles}}} {{{lteIe9.styles}}} <![endif]--> <!--[if lte IE 8]> {{{globalIE.styles}}} {{{lteIe8.styles}}} <![endif]--> {{/bundles}} ");});define("article.app/view/asset/styles_snippet",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#bundles}} {{{snippet.styles}}} <!--[if IE 9]> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Chronicle/font_HCo_Chronicle-ie.css\" /> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Whitney/font_HCo_Whitney-ie.css\" /> <![endif]--> <!--[if lte IE 9]> {{{globalIEprint.styles}}} {{{lteIe9.styles}}} <![endif]--> <!--[if lte IE 8]> {{{globalIE.styles}}} {{{lteIe8.styles}}} <![endif]--> {{/bundles}} ");});define("article.app/view/asset/styles_snippet_newnav",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#bundles}} {{{snippet_newnav.styles}}} <!--[if IE 9]> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Chronicle/font_HCo_Chronicle-ie.css\" /> <link rel=\"stylesheet\" type=\"text/css\" href=\"//fonts.wsj.net/HCo_Whitney/font_HCo_Whitney-ie.css\" /> <![endif]--> <!--[if lte IE 9]> {{{globalIEprint.styles}}} {{{lteIe9.styles}}} <![endif]--> <!--[if lte IE 8]> {{{globalIE.styles}}} {{{lteIe8.styles}}} <![endif]--> {{/bundles}} ");});define("article.app/view/media-objects/dynamic-inset",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#InsetYouTubeVideo}} {{#data}} <style> div.youtube { height:0; position:relative; padding-bottom:56.25%; } div.youtube > iframe { position: absolute; left: 0; top: 0; width: 100%; height: 100%; } </style> <div class=\"nc-exp-inset-iframe-media nc-exp-inset-youtube\"> {{#data.media-hed}} <div class=\"strap-container\"> <h4 class=\"strap\">{{media-hed}}</h4> </div> {{/data.media-hed}} <div class=\"nc-exp-inset-iframe-mediawrap youtube\"> <iframe src=\"//www.youtube.com/embed/{{id}}?hd=1&rel=0&autohide=1&showinfo=0\" frameborder=\"0\" allowfullscreen></iframe> </div> {{#caption}} <div class=\"nc-exp-inset-iframe-caption wsj-article-caption\">{{caption}}</div> {{/caption}} </div> {{/data}} {{/InsetYouTubeVideo}} {{#InsetTweet}} <style> iframe.twitter-tweet { width: 100% !important; } </style> <blockquote class=\"twitter-tweet\" lang=\"en\"> <a href=\"{{url}}\"></a> </blockquote> <script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script> {{/InsetTweet}} {{#InsetStorifyPost}} <style> .storify iframe { width:100% !important; } </style> <div class=\"storify\"><iframe src=\"{{url}}/embed?header=false\" width=\"100%\" height=750 frameborder=no allowtransparency=true></iframe><script src=\"{{url}}.js?header=false\"></script></div> {{/InsetStorifyPost}} {{#InsetFacebookPost}} <div class=\"fb-embed\"> <div id=\"fb-root\"></div><script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = \"//connect.facebook.net/en_US/all.js#xfbml=1\"; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script> <div class=\"fb-post\" data-href=\"{{url}}\" data-width=\"540\"><div class=\"fb-xfbml-parse-ignore\"><a href=\"{{url}}\">Facebook Post</a></div></div> </div> {{/InsetFacebookPost}} {{#InsetTwittertimeline}} <style> iframe.twitter-timeline { width:100% !important; } </style> <a class=\"twitter-timeline\" data-widget-id=\"{{widgetId}}\"></a> <script>!function(d,s,idma){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=\"//platform.twitter.com/widgets.js\";fjs.parentNode.insertBefore(js,fjs);}}(document,\"script\",\"twitter-wjs\");</script> {{/InsetTwittertimeline}} ");});define("article.app/view/media-objects/image",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile(" <div class=\"media-object-image {{#includeIcon}}enlarge-image{{/includeIcon}} renoImageFormat-{{src.layoutFit.size}} img-{{layout}}\" itemscope itemtype=\"http://schema.org/ImageObject\"> {{#strap}} <div class=\"strap-container\"> <h4 class=\"strap\" itemprop=\"description\">{{strap}}</h4> </div> {{/strap}} <div style=\"padding-bottom:{{src.baseUnit.ratio}}%;\" data-mobile-ratio=\"{{src.baseUnit.ratio}}%\" data-layout-ratio=\"{{src.layoutFit.ratio}}%\" class=\"image-container responsive-media\"> <meta itemprop=\"representativeOfPage contentUrl\" content=\"{{src.layoutFit.url}}\" /> {{#caption}} <meta itemprop=\"caption description\" content=\"{{caption}}\" /> {{/caption}} <img src=\"{{src.baseUnit.url}}\" data-intent data-in-base-src=\"{{src.layoutFit.url}}\" data-in-at4units-src=\"{{src.baseUnit.url}}\" data-enlarge=\"{{src.biggest.url}}\" alt=\"{{caption}}\" title=\"{{#truncatedCaption}}{{truncatedCaption}}{{/truncatedCaption}}{{#isTruncated}}...{{/isTruncated}}\" /> {{#includeIcon}} <![if ! lte IE 8]> <span class=\"image-enlarge\"> ENLARGE </span> <![endif]> {{/includeIcon}} </div> <div class=\"wsj-article-caption\" itemprop=\"caption\"> {{{caption}}} <span class=\"wsj-article-credit\" itemprop=\"creator\"> {{{credit}}} </span> </div> </div> ");});define("article.app/view/media-objects/interactive-iframe",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"media-object-interactiveIframe {{#iframe.isIggy}}iggyRule{{/iframe.isIggy}}\"> {{#strap}} <div class=\"strap-container\"> <h4 class=\"strap\">{{strap}}</h4> </div> {{/strap}} {{#iframe}} <iframe class=\"wsj-interactive {{#iframe.isIggy}}iggy{{/iframe.isIggy}}\" {{#iframe.isIggy}} src=\"\" {{/iframe.isIggy}} {{^iframe.isIggy}} src=\"{{iframeURL}}\" {{/iframe.isIggy}} data-src=\"{{iframeURL}}\" width=\"{{width}}\" height=\"{{height}}\" data-slug=\"{{projects}}\" scrolling=\"no\" frameborder=\"0\" style=\"max-width:100%;\"></iframe> {{/iframe}} </div> ");});define("article.app/view/media-objects/interactive-link",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"media-object-interactiveLink renoImageFormat-{{src.layoutFit.size}}\"> <div class=\"image-container\"> {{#strap}} <div class=\"strap-container\"> <h4 class=\"strap\">{{strap}}</h4> </div> {{/strap}} {{#srcid}} <a class=\"interactive-link\" href=\"/news/interactive/{{srcid}}\"> {{/srcid}} {{^srcid}} <a class=\"interactive-link\" href=\"{{link}}\"> {{/srcid}} <img src=\"{{src.baseUnit.url}}\" data-intent data-in-base-src=\"{{src.layoutFit.url}}\" data-in-at4units-src=\"{{src.baseUnit.url}}\" data-enlarge=\"{{src.biggest.url}}\" alt=\"{{caption}}\"/> <span class=\"image-interactive-icon\"> ENLARGE </span> </a> </div> <div class=\"wsj-article-caption\">{{caption}} <span class=\"wsj-article-credit\">{{credit}}</span></div> </div> ");});define("article.app/view/media-objects/pullquote",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"wsj-article-pullquote {{#newsletter}}newsletter{{/newsletter}}\" > {{#smallhead}} <h4>{{{smallhead}}}</h4> {{/smallhead}} {{^smallhead}} <div class=\"pullquote-border\"> {{/smallhead}} <blockquote> <p> <span class=\"l-qt\">&lsquo;</span>{{{html}}}<span class=\"r-qt\">&rsquo;</span> </p> <small>{{#tagline}}<span class=\"inset-author\">{{{tagline}}}</span>{{/tagline}}</small> </blockquote> {{^smallhead}} </div> {{/smallhead}} </div> ");});define("article.app/view/media-objects/rich-text",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"media-object-rich-text\"> {{{html}}} </div>");});define("article.app/view/media-objects/slideshow",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile(" <div class=\"wsj-slideshow captions-on \" tabindex=\"1\"> <div class=\"wsj-slideshow-deck clearfix\"> <div class=\"strap-container\"> <h3 class=\"wsj-slideshow-title strap\"> <a href=\"{{slideshow.meta.url}}\">{{slideshow.meta.headline.standard}}</a> </h3> {{#slideshow.meta.deck}} <h4 class=\"wsj-slideshow-summary sub-strap\"> {{slideshow.meta.deck}} </h4> {{/slideshow.meta.deck}} </div> <i class=\"wsj-slideshow-fullscreen-handle\"> fullscreen </i> </div> <div class=\"wsj-slideshow-wrap\"> <div class=\"wsj-slideshow-viewer\"> {{#slideshow.slides}} {{> partials/slideshow-slides}} {{/slideshow.slides}} {{! <div class=\"wsj-slideshow-slide\" data-slide-action=\"exploreMore\"> TODO: JAVASCRIPT SLIDE for explore more </div> }} </div> </div> <div class=\"wsj-slideshow-info-container\"> <div class=\"wsj-slideshow-counter\"> <span class=\"wsj-slideshow-currentIdx\"><!-- inserted --></span> of <span class=\"wsj-slideshow-total\"><!-- inserted --></span> <div class=\"wsj-slideshow-caption-toggle\"> <span class=\"wsj-slideshow-show-caption\">SHOW CAPTION</span> <span class=\"wsj-slideshow-hide-caption\">HIDE CAPTION</span> </div> <![if ! lte IE 8]> <i class=\"wsj-slideshow-fullscreen-handle\"> fullscreen </i> <![endif]> </div> <div class=\"wsj-slideshow-caption-container\"> <!-- captions inserted here --> </div> </div> </div> ");});define("article.app/view/media-objects/video",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"media-object-video\"> {{#strap}} <div class=\"strap-container\"> <h4 class=\"strap\">{{strap}}</h4> </div> {{/strap}} <div id=\"videoplayer\" class=\"video-container\" data-src=\"{{srcId}}\" data-esplash=\"{{eSplash}}\" data-msplash=\"{{mSplash}}\"> </div> <div class=\"wsj-article-caption\">{{caption}}</div> </div> ");});define("article.app/view/old-insets/embedded-slideshow",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"insettipUnit insetZoomTarget\"> <div class=\"inset-image-box insetZoomTargetBox\"> <div class=\"insettipBox\"> <div class=\"insettip\"> <a href=\"/news/articles/{{alternatetext}}\" data-referer=\"{{articleId}}\" class=\"inset-tip-link-text\"> <span>{{#i18n}}View Slideshow{{/i18n}}</span> </a> </div> </div> <a href=\"/news/articles/{{alternatetext}}\" data-referer=\"{{articleId}}\" > <img src=\"{{image}}\" class=\"inset-thumbnail-small\"> </a> </div> </div> ");});define("article.app/view/old-insets/explore-more",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"module editors-picks\"> {{#exploreMoreData.length}}<h3 class=\"section\">{{#i18n}}Explore More{{/i18n}}</h3>{{/exploreMoreData.length}} <ul class=\"setList\"> {{#exploreMoreData}} {{#image.src}} <li class=\"hedSumm editors-p-none\"> <img alt=\"image\" src=\"http://si.wsj.net/public/resources/images/{{image.src}}\"> <h4 class=\"h-line\"> <a href=\"{{url}}?mod=WSJ_article_exploremore\">{{{headline}}}</a> </h4> </li> {{/image.src}} {{/exploreMoreData}} </ul> </div> ");});define("article.app/view/old-insets/interactive-flash",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div id=\"flash_player_{{index}}\" class=\"media-object-interactiveIframe\" style=\"width:{{flashData.requiredSettings.swfwidth}}px;height:{{flashData.requiredSettings.swfheight}}px;\"> {{#strap}} <h4 class=\"strap\">{{strap}}</h4> {{/strap}} <object id=\"{{srcid}}\" width=\"{{flashData.requiredSettings.swfwidth}}\" height=\"{{flashData.requiredSettings.swfheight}}\" {{^useIECompat}} type=\"application/x-shockwave-flash\" data=\"http://online.wsj.com/public/resources/documents/info-flashAS3-preloader.swf\" {{/useIECompat}} {{#useIECompat}} classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" {{/useIECompat}} > <param name=\"allowScriptAccess\" value=\"always\"> <param name=\"wmode\" value=\"opaque\"> <param name=\"serverDomain\" value=\"http://online.wsj.com\"> <param name=\"base\" value=\"/public/resources/documents\"> <param name=\"menu\" value=\"false\"> <param name=\"bgcolor\" value=\"#FFFFFF\"> <param name=\"allowfullscreen\" value=\"true\"> <param name=\"height\" value=\"174\"> <param name=\"flashvars\" value=\"{{flashData.flashVars}}{{#subscriber}}&amp;asub=subscribed{{/subscriber}}&amp;id={{alternatetext}}&amp;containermodule=flash_player_{{index}}\"> <param name=\"movie\" value=\"http://online.wsj.com/public/resources/documents/info-flashAS3-preloader.swf\"> </object> </div> ");});define("article.app/view/old-insets/media-document",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"insettipUnit insetZoomTarget\"> <div class=\"inset-image-box insetZoomTargetBox\"> <div class=\"insettipBox\"> <div class=\"insettip\"> <a href=\"/news/interactive/{{alternatetext}}\" data-referer=\"{{articleId}}\" class=\"inset-tip-link-text\"> <span>{{#i18n}}View Document{{/i18n}}</span> </a> </div> </div> <a href=\"/news/interactive/{{alternatetext}}\" data-referer=\"{{articleId}}\" > <img src=\"{{thumbnail}}\" {{#width}} width=\"{{width}}\" {{/width}} {{#height}} height=\"{{height}}\" {{/height}}> </a> </div> </div> ");});define("article.app/view/old-insets/media-slideshow",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{!-- rendering as new teaser inset --}} <div class=\"media-object-interactiveLink\"> <div class=\"image-container\"> <a class=\"interactive-link\" href=\"/news/articles/{{alternatetext}}\"> <img src=\"{{thumbnail}}\"/> <span class=\"image-interactive-icon\"> </span> </a> </div> <div class=\"wsj-article-caption\">{{caption}} <span class=\"wsj-article-credit\">{{credit}}</span></div> </div> ");});define("article.app/view/old-insets/related-slideshow",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<h4>{{#i18n}}Related Slideshow{{/i18n}}</h4> <a href=\"/news/articles/{{alternatetext}}\" data-referer=\"{{articleId}}\" >&lt;&lt;</a>");});define("article.app/view/partials/slideshow-slides",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"wsj-slideshow-slide\" itemscope itemtype=\"http://schema.org/ImageObject\"> <meta itemprop=\"contentUrl\" content=\"{{src.layoutFit.url}}\" /> <div class=\"wsj-slideshow-image-wrap\"> <div class=\"wsj-slideshow-image-center\"> <img alt=\"{{caption}}\" class=\"wsj-slideshow-image\" data-intent data-in-at4units-data-lazy=\"{{src.baseUnit.url}}\" data-in-at4units-data-width=\"{{src.baseUnit.width}}\" data-in-at4units-data-height=\"{{src.baseUnit.height}}\" data-in-at4units-data-lazy-large=\"{{src.baseUnit.url}}\" data-in-at4units-data-width-large=\"{{src.baseUnit.width}}\" data-in-at4units-data-height-large=\"{{src.baseUnit.height}}\" data-in-base-data-lazy=\"{{src.layoutFit.url}}\" data-in-base-data-width=\"{{src.layoutFit.width}}\" data-in-base-data-height=\"{{src.layoutFit.height}}\" data-in-base-data-lazy-large=\"{{src.biggest.url}}\" data-in-base-data-width-large=\"{{src.biggest.width}}\" data-in-base-data-height-large=\"{{src.biggest.height}}\"> </div> </div> <div class=\"wsj-slideshow-caption\" itemprop=\"caption\"> {{{caption}}} <em class=\"wsj-slideshow-credit\" itemprop=\"creator\">{{{credit}}}</em> <span class=\"wsj-article-ellipsis\">&hellip;</span> </div> </div> ");});
/*!
 * jQuery JavaScript Library v1.8.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Tue Nov 13 2012 08:20:33 GMT-0500 (Eastern Standard Time)
 */

(function( window, undefined ) {
var
	// A central reference to the root jQuery(document)
	rootjQuery,

	// The deferred used on DOM ready
	readyList,

	// Use the correct document accordingly with window argument (sandbox)
	document = window.document,
	location = window.location,
	navigator = window.navigator,

	// Map over jQuery in case of overwrite
	_jQuery = window.jQuery,

	// Map over the $ in case of overwrite
	_$ = window.$,

	// Save a reference to some core methods
	core_push = Array.prototype.push,
	core_slice = Array.prototype.slice,
	core_indexOf = Array.prototype.indexOf,
	core_toString = Object.prototype.toString,
	core_hasOwn = Object.prototype.hasOwnProperty,
	core_trim = String.prototype.trim,

	// Define a local copy of jQuery
	jQuery = function( selector, context ) {
		// The jQuery object is actually just the init constructor 'enhanced'
		return new jQuery.fn.init( selector, context, rootjQuery );
	},

	// Used for matching numbers
	core_pnum = /[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,

	// Used for detecting and trimming whitespace
	core_rnotwhite = /\S/,
	core_rspace = /\s+/,

	// Make sure we trim BOM and NBSP (here's looking at you, Safari 5.0 and IE)
	rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,

	// A simple way to check for HTML strings
	// Prioritize #id over <tag> to avoid XSS via location.hash (#9521)
	rquickExpr = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,

	// Match a standalone tag
	rsingleTag = /^<(\w+)\s*\/?>(?:<\/\1>|)$/,

	// JSON RegExp
	rvalidchars = /^[\],:{}\s]*$/,
	rvalidbraces = /(?:^|:|,)(?:\s*\[)+/g,
	rvalidescape = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,
	rvalidtokens = /"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,

	// Matches dashed string for camelizing
	rmsPrefix = /^-ms-/,
	rdashAlpha = /-([\da-z])/gi,

	// Used by jQuery.camelCase as callback to replace()
	fcamelCase = function( all, letter ) {
		return ( letter + "" ).toUpperCase();
	},

	// The ready event handler and self cleanup method
	DOMContentLoaded = function() {
		if ( document.addEventListener ) {
			document.removeEventListener( "DOMContentLoaded", DOMContentLoaded, false );
			jQuery.ready();
		} else if ( document.readyState === "complete" ) {
			// we're here because readyState === "complete" in oldIE
			// which is good enough for us to call the dom ready!
			document.detachEvent( "onreadystatechange", DOMContentLoaded );
			jQuery.ready();
		}
	},

	// [[Class]] -> type pairs
	class2type = {};

jQuery.fn = jQuery.prototype = {
	constructor: jQuery,
	init: function( selector, context, rootjQuery ) {
		var match, elem, ret, doc;

		// Handle $(""), $(null), $(undefined), $(false)
		if ( !selector ) {
			return this;
		}

		// Handle $(DOMElement)
		if ( selector.nodeType ) {
			this.context = this[0] = selector;
			this.length = 1;
			return this;
		}

		// Handle HTML strings
		if ( typeof selector === "string" ) {
			if ( selector.charAt(0) === "<" && selector.charAt( selector.length - 1 ) === ">" && selector.length >= 3 ) {
				// Assume that strings that start and end with <> are HTML and skip the regex check
				match = [ null, selector, null ];

			} else {
				match = rquickExpr.exec( selector );
			}

			// Match html or make sure no context is specified for #id
			if ( match && (match[1] || !context) ) {

				// HANDLE: $(html) -> $(array)
				if ( match[1] ) {
					context = context instanceof jQuery ? context[0] : context;
					doc = ( context && context.nodeType ? context.ownerDocument || context : document );

					// scripts is true for back-compat
					selector = jQuery.parseHTML( match[1], doc, true );
					if ( rsingleTag.test( match[1] ) && jQuery.isPlainObject( context ) ) {
						this.attr.call( selector, context, true );
					}

					return jQuery.merge( this, selector );

				// HANDLE: $(#id)
				} else {
					elem = document.getElementById( match[2] );

					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					if ( elem && elem.parentNode ) {
						// Handle the case where IE and Opera return items
						// by name instead of ID
						if ( elem.id !== match[2] ) {
							return rootjQuery.find( selector );
						}

						// Otherwise, we inject the element directly into the jQuery object
						this.length = 1;
						this[0] = elem;
					}

					this.context = document;
					this.selector = selector;
					return this;
				}

			// HANDLE: $(expr, $(...))
			} else if ( !context || context.jquery ) {
				return ( context || rootjQuery ).find( selector );

			// HANDLE: $(expr, context)
			// (which is just equivalent to: $(context).find(expr)
			} else {
				return this.constructor( context ).find( selector );
			}

		// HANDLE: $(function)
		// Shortcut for document ready
		} else if ( jQuery.isFunction( selector ) ) {
			return rootjQuery.ready( selector );
		}

		if ( selector.selector !== undefined ) {
			this.selector = selector.selector;
			this.context = selector.context;
		}

		return jQuery.makeArray( selector, this );
	},

	// Start with an empty selector
	selector: "",

	// The current version of jQuery being used
	jquery: "1.8.3",

	// The default length of a jQuery object is 0
	length: 0,

	// The number of elements contained in the matched element set
	size: function() {
		return this.length;
	},

	toArray: function() {
		return core_slice.call( this );
	},

	// Get the Nth element in the matched element set OR
	// Get the whole matched element set as a clean array
	get: function( num ) {
		return num == null ?

			// Return a 'clean' array
			this.toArray() :

			// Return just the object
			( num < 0 ? this[ this.length + num ] : this[ num ] );
	},

	// Take an array of elements and push it onto the stack
	// (returning the new matched element set)
	pushStack: function( elems, name, selector ) {

		// Build a new jQuery matched element set
		var ret = jQuery.merge( this.constructor(), elems );

		// Add the old object onto the stack (as a reference)
		ret.prevObject = this;

		ret.context = this.context;

		if ( name === "find" ) {
			ret.selector = this.selector + ( this.selector ? " " : "" ) + selector;
		} else if ( name ) {
			ret.selector = this.selector + "." + name + "(" + selector + ")";
		}

		// Return the newly-formed element set
		return ret;
	},

	// Execute a callback for every element in the matched set.
	// (You can seed the arguments with an array of args, but this is
	// only used internally.)
	each: function( callback, args ) {
		return jQuery.each( this, callback, args );
	},

	ready: function( fn ) {
		// Add the callback
		jQuery.ready.promise().done( fn );

		return this;
	},

	eq: function( i ) {
		i = +i;
		return i === -1 ?
			this.slice( i ) :
			this.slice( i, i + 1 );
	},

	first: function() {
		return this.eq( 0 );
	},

	last: function() {
		return this.eq( -1 );
	},

	slice: function() {
		return this.pushStack( core_slice.apply( this, arguments ),
			"slice", core_slice.call(arguments).join(",") );
	},

	map: function( callback ) {
		return this.pushStack( jQuery.map(this, function( elem, i ) {
			return callback.call( elem, i, elem );
		}));
	},

	end: function() {
		return this.prevObject || this.constructor(null);
	},

	// For internal use only.
	// Behaves like an Array's method, not like a jQuery method.
	push: core_push,
	sort: [].sort,
	splice: [].splice
};

// Give the init function the jQuery prototype for later instantiation
jQuery.fn.init.prototype = jQuery.fn;

jQuery.extend = jQuery.fn.extend = function() {
	var options, name, src, copy, copyIsArray, clone,
		target = arguments[0] || {},
		i = 1,
		length = arguments.length,
		deep = false;

	// Handle a deep copy situation
	if ( typeof target === "boolean" ) {
		deep = target;
		target = arguments[1] || {};
		// skip the boolean and the target
		i = 2;
	}

	// Handle case when target is a string or something (possible in deep copy)
	if ( typeof target !== "object" && !jQuery.isFunction(target) ) {
		target = {};
	}

	// extend jQuery itself if only one argument is passed
	if ( length === i ) {
		target = this;
		--i;
	}

	for ( ; i < length; i++ ) {
		// Only deal with non-null/undefined values
		if ( (options = arguments[ i ]) != null ) {
			// Extend the base object
			for ( name in options ) {
				src = target[ name ];
				copy = options[ name ];

				// Prevent never-ending loop
				if ( target === copy ) {
					continue;
				}

				// Recurse if we're merging plain objects or arrays
				if ( deep && copy && ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) {
					if ( copyIsArray ) {
						copyIsArray = false;
						clone = src && jQuery.isArray(src) ? src : [];

					} else {
						clone = src && jQuery.isPlainObject(src) ? src : {};
					}

					// Never move original objects, clone them
					target[ name ] = jQuery.extend( deep, clone, copy );

				// Don't bring in undefined values
				} else if ( copy !== undefined ) {
					target[ name ] = copy;
				}
			}
		}
	}

	// Return the modified object
	return target;
};

jQuery.extend({
	noConflict: function( deep ) {
		if ( window.$ === jQuery ) {
			window.$ = _$;
		}

		if ( deep && window.jQuery === jQuery ) {
			window.jQuery = _jQuery;
		}

		return jQuery;
	},

	// Is the DOM ready to be used? Set to true once it occurs.
	isReady: false,

	// A counter to track how many items to wait for before
	// the ready event fires. See #6781
	readyWait: 1,

	// Hold (or release) the ready event
	holdReady: function( hold ) {
		if ( hold ) {
			jQuery.readyWait++;
		} else {
			jQuery.ready( true );
		}
	},

	// Handle when the DOM is ready
	ready: function( wait ) {

		// Abort if there are pending holds or we're already ready
		if ( wait === true ? --jQuery.readyWait : jQuery.isReady ) {
			return;
		}

		// Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
		if ( !document.body ) {
			return setTimeout( jQuery.ready, 1 );
		}

		// Remember that the DOM is ready
		jQuery.isReady = true;

		// If a normal DOM Ready event fired, decrement, and wait if need be
		if ( wait !== true && --jQuery.readyWait > 0 ) {
			return;
		}

		// If there are functions bound, to execute
		readyList.resolveWith( document, [ jQuery ] );

		// Trigger any bound ready events
		if ( jQuery.fn.trigger ) {
			jQuery( document ).trigger("ready").off("ready");
		}
	},

	// See test/unit/core.js for details concerning isFunction.
	// Since version 1.3, DOM methods and functions like alert
	// aren't supported. They return false on IE (#2968).
	isFunction: function( obj ) {
		return jQuery.type(obj) === "function";
	},

	isArray: Array.isArray || function( obj ) {
		return jQuery.type(obj) === "array";
	},

	isWindow: function( obj ) {
		return obj != null && obj == obj.window;
	},

	isNumeric: function( obj ) {
		return !isNaN( parseFloat(obj) ) && isFinite( obj );
	},

	type: function( obj ) {
		return obj == null ?
			String( obj ) :
			class2type[ core_toString.call(obj) ] || "object";
	},

	isPlainObject: function( obj ) {
		// Must be an Object.
		// Because of IE, we also have to check the presence of the constructor property.
		// Make sure that DOM nodes and window objects don't pass through, as well
		if ( !obj || jQuery.type(obj) !== "object" || obj.nodeType || jQuery.isWindow( obj ) ) {
			return false;
		}

		try {
			// Not own constructor property must be Object
			if ( obj.constructor &&
				!core_hasOwn.call(obj, "constructor") &&
				!core_hasOwn.call(obj.constructor.prototype, "isPrototypeOf") ) {
				return false;
			}
		} catch ( e ) {
			// IE8,9 Will throw exceptions on certain host objects #9897
			return false;
		}

		// Own properties are enumerated firstly, so to speed up,
		// if last one is own, then all properties are own.

		var key;
		for ( key in obj ) {}

		return key === undefined || core_hasOwn.call( obj, key );
	},

	isEmptyObject: function( obj ) {
		var name;
		for ( name in obj ) {
			return false;
		}
		return true;
	},

	error: function( msg ) {
		throw new Error( msg );
	},

	// data: string of html
	// context (optional): If specified, the fragment will be created in this context, defaults to document
	// scripts (optional): If true, will include scripts passed in the html string
	parseHTML: function( data, context, scripts ) {
		var parsed;
		if ( !data || typeof data !== "string" ) {
			return null;
		}
		if ( typeof context === "boolean" ) {
			scripts = context;
			context = 0;
		}
		context = context || document;

		// Single tag
		if ( (parsed = rsingleTag.exec( data )) ) {
			return [ context.createElement( parsed[1] ) ];
		}

		parsed = jQuery.buildFragment( [ data ], context, scripts ? null : [] );
		return jQuery.merge( [],
			(parsed.cacheable ? jQuery.clone( parsed.fragment ) : parsed.fragment).childNodes );
	},

	parseJSON: function( data ) {
		if ( !data || typeof data !== "string") {
			return null;
		}

		// Make sure leading/trailing whitespace is removed (IE can't handle it)
		data = jQuery.trim( data );

		// Attempt to parse using the native JSON parser first
		if ( window.JSON && window.JSON.parse ) {
			return window.JSON.parse( data );
		}

		// Make sure the incoming data is actual JSON
		// Logic borrowed from http://json.org/json2.js
		if ( rvalidchars.test( data.replace( rvalidescape, "@" )
			.replace( rvalidtokens, "]" )
			.replace( rvalidbraces, "")) ) {

			return ( new Function( "return " + data ) )();

		}
		jQuery.error( "Invalid JSON: " + data );
	},

	// Cross-browser xml parsing
	parseXML: function( data ) {
		var xml, tmp;
		if ( !data || typeof data !== "string" ) {
			return null;
		}
		try {
			if ( window.DOMParser ) { // Standard
				tmp = new DOMParser();
				xml = tmp.parseFromString( data , "text/xml" );
			} else { // IE
				xml = new ActiveXObject( "Microsoft.XMLDOM" );
				xml.async = "false";
				xml.loadXML( data );
			}
		} catch( e ) {
			xml = undefined;
		}
		if ( !xml || !xml.documentElement || xml.getElementsByTagName( "parsererror" ).length ) {
			jQuery.error( "Invalid XML: " + data );
		}
		return xml;
	},

	noop: function() {},

	// Evaluates a script in a global context
	// Workarounds based on findings by Jim Driscoll
	// http://weblogs.java.net/blog/driscoll/archive/2009/09/08/eval-javascript-global-context
	globalEval: function( data ) {
		if ( data && core_rnotwhite.test( data ) ) {
			// We use execScript on Internet Explorer
			// We use an anonymous function so that context is window
			// rather than jQuery in Firefox
			( window.execScript || function( data ) {
				window[ "eval" ].call( window, data );
			} )( data );
		}
	},

	// Convert dashed to camelCase; used by the css and data modules
	// Microsoft forgot to hump their vendor prefix (#9572)
	camelCase: function( string ) {
		return string.replace( rmsPrefix, "ms-" ).replace( rdashAlpha, fcamelCase );
	},

	nodeName: function( elem, name ) {
		return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
	},

	// args is for internal usage only
	each: function( obj, callback, args ) {
		var name,
			i = 0,
			length = obj.length,
			isObj = length === undefined || jQuery.isFunction( obj );

		if ( args ) {
			if ( isObj ) {
				for ( name in obj ) {
					if ( callback.apply( obj[ name ], args ) === false ) {
						break;
					}
				}
			} else {
				for ( ; i < length; ) {
					if ( callback.apply( obj[ i++ ], args ) === false ) {
						break;
					}
				}
			}

		// A special, fast, case for the most common use of each
		} else {
			if ( isObj ) {
				for ( name in obj ) {
					if ( callback.call( obj[ name ], name, obj[ name ] ) === false ) {
						break;
					}
				}
			} else {
				for ( ; i < length; ) {
					if ( callback.call( obj[ i ], i, obj[ i++ ] ) === false ) {
						break;
					}
				}
			}
		}

		return obj;
	},

	// Use native String.trim function wherever possible
	trim: core_trim && !core_trim.call("\uFEFF\xA0") ?
		function( text ) {
			return text == null ?
				"" :
				core_trim.call( text );
		} :

		// Otherwise use our own trimming functionality
		function( text ) {
			return text == null ?
				"" :
				( text + "" ).replace( rtrim, "" );
		},

	// results is for internal usage only
	makeArray: function( arr, results ) {
		var type,
			ret = results || [];

		if ( arr != null ) {
			// The window, strings (and functions) also have 'length'
			// Tweaked logic slightly to handle Blackberry 4.7 RegExp issues #6930
			type = jQuery.type( arr );

			if ( arr.length == null || type === "string" || type === "function" || type === "regexp" || jQuery.isWindow( arr ) ) {
				core_push.call( ret, arr );
			} else {
				jQuery.merge( ret, arr );
			}
		}

		return ret;
	},

	inArray: function( elem, arr, i ) {
		var len;

		if ( arr ) {
			if ( core_indexOf ) {
				return core_indexOf.call( arr, elem, i );
			}

			len = arr.length;
			i = i ? i < 0 ? Math.max( 0, len + i ) : i : 0;

			for ( ; i < len; i++ ) {
				// Skip accessing in sparse arrays
				if ( i in arr && arr[ i ] === elem ) {
					return i;
				}
			}
		}

		return -1;
	},

	merge: function( first, second ) {
		var l = second.length,
			i = first.length,
			j = 0;

		if ( typeof l === "number" ) {
			for ( ; j < l; j++ ) {
				first[ i++ ] = second[ j ];
			}

		} else {
			while ( second[j] !== undefined ) {
				first[ i++ ] = second[ j++ ];
			}
		}

		first.length = i;

		return first;
	},

	grep: function( elems, callback, inv ) {
		var retVal,
			ret = [],
			i = 0,
			length = elems.length;
		inv = !!inv;

		// Go through the array, only saving the items
		// that pass the validator function
		for ( ; i < length; i++ ) {
			retVal = !!callback( elems[ i ], i );
			if ( inv !== retVal ) {
				ret.push( elems[ i ] );
			}
		}

		return ret;
	},

	// arg is for internal usage only
	map: function( elems, callback, arg ) {
		var value, key,
			ret = [],
			i = 0,
			length = elems.length,
			// jquery objects are treated as arrays
			isArray = elems instanceof jQuery || length !== undefined && typeof length === "number" && ( ( length > 0 && elems[ 0 ] && elems[ length -1 ] ) || length === 0 || jQuery.isArray( elems ) ) ;

		// Go through the array, translating each of the items to their
		if ( isArray ) {
			for ( ; i < length; i++ ) {
				value = callback( elems[ i ], i, arg );

				if ( value != null ) {
					ret[ ret.length ] = value;
				}
			}

		// Go through every key on the object,
		} else {
			for ( key in elems ) {
				value = callback( elems[ key ], key, arg );

				if ( value != null ) {
					ret[ ret.length ] = value;
				}
			}
		}

		// Flatten any nested arrays
		return ret.concat.apply( [], ret );
	},

	// A global GUID counter for objects
	guid: 1,

	// Bind a function to a context, optionally partially applying any
	// arguments.
	proxy: function( fn, context ) {
		var tmp, args, proxy;

		if ( typeof context === "string" ) {
			tmp = fn[ context ];
			context = fn;
			fn = tmp;
		}

		// Quick check to determine if target is callable, in the spec
		// this throws a TypeError, but we will just return undefined.
		if ( !jQuery.isFunction( fn ) ) {
			return undefined;
		}

		// Simulated bind
		args = core_slice.call( arguments, 2 );
		proxy = function() {
			return fn.apply( context, args.concat( core_slice.call( arguments ) ) );
		};

		// Set the guid of unique handler to the same of original handler, so it can be removed
		proxy.guid = fn.guid = fn.guid || jQuery.guid++;

		return proxy;
	},

	// Multifunctional method to get and set values of a collection
	// The value/s can optionally be executed if it's a function
	access: function( elems, fn, key, value, chainable, emptyGet, pass ) {
		var exec,
			bulk = key == null,
			i = 0,
			length = elems.length;

		// Sets many values
		if ( key && typeof key === "object" ) {
			for ( i in key ) {
				jQuery.access( elems, fn, i, key[i], 1, emptyGet, value );
			}
			chainable = 1;

		// Sets one value
		} else if ( value !== undefined ) {
			// Optionally, function values get executed if exec is true
			exec = pass === undefined && jQuery.isFunction( value );

			if ( bulk ) {
				// Bulk operations only iterate when executing function values
				if ( exec ) {
					exec = fn;
					fn = function( elem, key, value ) {
						return exec.call( jQuery( elem ), value );
					};

				// Otherwise they run against the entire set
				} else {
					fn.call( elems, value );
					fn = null;
				}
			}

			if ( fn ) {
				for (; i < length; i++ ) {
					fn( elems[i], key, exec ? value.call( elems[i], i, fn( elems[i], key ) ) : value, pass );
				}
			}

			chainable = 1;
		}

		return chainable ?
			elems :

			// Gets
			bulk ?
				fn.call( elems ) :
				length ? fn( elems[0], key ) : emptyGet;
	},

	now: function() {
		return ( new Date() ).getTime();
	}
});

jQuery.ready.promise = function( obj ) {
	if ( !readyList ) {

		readyList = jQuery.Deferred();

		// Catch cases where $(document).ready() is called after the browser event has already occurred.
		// we once tried to use readyState "interactive" here, but it caused issues like the one
		// discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15
		if ( document.readyState === "complete" ) {
			// Handle it asynchronously to allow scripts the opportunity to delay ready
			setTimeout( jQuery.ready, 1 );

		// Standards-based browsers support DOMContentLoaded
		} else if ( document.addEventListener ) {
			// Use the handy event callback
			document.addEventListener( "DOMContentLoaded", DOMContentLoaded, false );

			// A fallback to window.onload, that will always work
			window.addEventListener( "load", jQuery.ready, false );

		// If IE event model is used
		} else {
			// Ensure firing before onload, maybe late but safe also for iframes
			document.attachEvent( "onreadystatechange", DOMContentLoaded );

			// A fallback to window.onload, that will always work
			window.attachEvent( "onload", jQuery.ready );

			// If IE and not a frame
			// continually check to see if the document is ready
			var top = false;

			try {
				top = window.frameElement == null && document.documentElement;
			} catch(e) {}

			if ( top && top.doScroll ) {
				(function doScrollCheck() {
					if ( !jQuery.isReady ) {

						try {
							// Use the trick by Diego Perini
							// http://javascript.nwbox.com/IEContentLoaded/
							top.doScroll("left");
						} catch(e) {
							return setTimeout( doScrollCheck, 50 );
						}

						// and execute any waiting functions
						jQuery.ready();
					}
				})();
			}
		}
	}
	return readyList.promise( obj );
};

// Populate the class2type map
jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "), function(i, name) {
	class2type[ "[object " + name + "]" ] = name.toLowerCase();
});

// All jQuery objects should point back to these
rootjQuery = jQuery(document);
// String to Object options format cache
var optionsCache = {};

// Convert String-formatted options into Object-formatted ones and store in cache
function createOptions( options ) {
	var object = optionsCache[ options ] = {};
	jQuery.each( options.split( core_rspace ), function( _, flag ) {
		object[ flag ] = true;
	});
	return object;
}

/*
 * Create a callback list using the following parameters:
 *
 *	options: an optional list of space-separated options that will change how
 *			the callback list behaves or a more traditional option object
 *
 * By default a callback list will act like an event callback list and can be
 * "fired" multiple times.
 *
 * Possible options:
 *
 *	once:			will ensure the callback list can only be fired once (like a Deferred)
 *
 *	memory:			will keep track of previous values and will call any callback added
 *					after the list has been fired right away with the latest "memorized"
 *					values (like a Deferred)
 *
 *	unique:			will ensure a callback can only be added once (no duplicate in the list)
 *
 *	stopOnFalse:	interrupt callings when a callback returns false
 *
 */
jQuery.Callbacks = function( options ) {

	// Convert options from String-formatted to Object-formatted if needed
	// (we check in cache first)
	options = typeof options === "string" ?
		( optionsCache[ options ] || createOptions( options ) ) :
		jQuery.extend( {}, options );

	var // Last fire value (for non-forgettable lists)
		memory,
		// Flag to know if list was already fired
		fired,
		// Flag to know if list is currently firing
		firing,
		// First callback to fire (used internally by add and fireWith)
		firingStart,
		// End of the loop when firing
		firingLength,
		// Index of currently firing callback (modified by remove if needed)
		firingIndex,
		// Actual callback list
		list = [],
		// Stack of fire calls for repeatable lists
		stack = !options.once && [],
		// Fire callbacks
		fire = function( data ) {
			memory = options.memory && data;
			fired = true;
			firingIndex = firingStart || 0;
			firingStart = 0;
			firingLength = list.length;
			firing = true;
			for ( ; list && firingIndex < firingLength; firingIndex++ ) {
				if ( list[ firingIndex ].apply( data[ 0 ], data[ 1 ] ) === false && options.stopOnFalse ) {
					memory = false; // To prevent further calls using add
					break;
				}
			}
			firing = false;
			if ( list ) {
				if ( stack ) {
					if ( stack.length ) {
						fire( stack.shift() );
					}
				} else if ( memory ) {
					list = [];
				} else {
					self.disable();
				}
			}
		},
		// Actual Callbacks object
		self = {
			// Add a callback or a collection of callbacks to the list
			add: function() {
				if ( list ) {
					// First, we save the current length
					var start = list.length;
					(function add( args ) {
						jQuery.each( args, function( _, arg ) {
							var type = jQuery.type( arg );
							if ( type === "function" ) {
								if ( !options.unique || !self.has( arg ) ) {
									list.push( arg );
								}
							} else if ( arg && arg.length && type !== "string" ) {
								// Inspect recursively
								add( arg );
							}
						});
					})( arguments );
					// Do we need to add the callbacks to the
					// current firing batch?
					if ( firing ) {
						firingLength = list.length;
					// With memory, if we're not firing then
					// we should call right away
					} else if ( memory ) {
						firingStart = start;
						fire( memory );
					}
				}
				return this;
			},
			// Remove a callback from the list
			remove: function() {
				if ( list ) {
					jQuery.each( arguments, function( _, arg ) {
						var index;
						while( ( index = jQuery.inArray( arg, list, index ) ) > -1 ) {
							list.splice( index, 1 );
							// Handle firing indexes
							if ( firing ) {
								if ( index <= firingLength ) {
									firingLength--;
								}
								if ( index <= firingIndex ) {
									firingIndex--;
								}
							}
						}
					});
				}
				return this;
			},
			// Control if a given callback is in the list
			has: function( fn ) {
				return jQuery.inArray( fn, list ) > -1;
			},
			// Remove all callbacks from the list
			empty: function() {
				list = [];
				return this;
			},
			// Have the list do nothing anymore
			disable: function() {
				list = stack = memory = undefined;
				return this;
			},
			// Is it disabled?
			disabled: function() {
				return !list;
			},
			// Lock the list in its current state
			lock: function() {
				stack = undefined;
				if ( !memory ) {
					self.disable();
				}
				return this;
			},
			// Is it locked?
			locked: function() {
				return !stack;
			},
			// Call all callbacks with the given context and arguments
			fireWith: function( context, args ) {
				args = args || [];
				args = [ context, args.slice ? args.slice() : args ];
				if ( list && ( !fired || stack ) ) {
					if ( firing ) {
						stack.push( args );
					} else {
						fire( args );
					}
				}
				return this;
			},
			// Call all the callbacks with the given arguments
			fire: function() {
				self.fireWith( this, arguments );
				return this;
			},
			// To know if the callbacks have already been called at least once
			fired: function() {
				return !!fired;
			}
		};

	return self;
};
jQuery.extend({

	Deferred: function( func ) {
		var tuples = [
				// action, add listener, listener list, final state
				[ "resolve", "done", jQuery.Callbacks("once memory"), "resolved" ],
				[ "reject", "fail", jQuery.Callbacks("once memory"), "rejected" ],
				[ "notify", "progress", jQuery.Callbacks("memory") ]
			],
			state = "pending",
			promise = {
				state: function() {
					return state;
				},
				always: function() {
					deferred.done( arguments ).fail( arguments );
					return this;
				},
				then: function( /* fnDone, fnFail, fnProgress */ ) {
					var fns = arguments;
					return jQuery.Deferred(function( newDefer ) {
						jQuery.each( tuples, function( i, tuple ) {
							var action = tuple[ 0 ],
								fn = fns[ i ];
							// deferred[ done | fail | progress ] for forwarding actions to newDefer
							deferred[ tuple[1] ]( jQuery.isFunction( fn ) ?
								function() {
									var returned = fn.apply( this, arguments );
									if ( returned && jQuery.isFunction( returned.promise ) ) {
										returned.promise()
											.done( newDefer.resolve )
											.fail( newDefer.reject )
											.progress( newDefer.notify );
									} else {
										newDefer[ action + "With" ]( this === deferred ? newDefer : this, [ returned ] );
									}
								} :
								newDefer[ action ]
							);
						});
						fns = null;
					}).promise();
				},
				// Get a promise for this deferred
				// If obj is provided, the promise aspect is added to the object
				promise: function( obj ) {
					return obj != null ? jQuery.extend( obj, promise ) : promise;
				}
			},
			deferred = {};

		// Keep pipe for back-compat
		promise.pipe = promise.then;

		// Add list-specific methods
		jQuery.each( tuples, function( i, tuple ) {
			var list = tuple[ 2 ],
				stateString = tuple[ 3 ];

			// promise[ done | fail | progress ] = list.add
			promise[ tuple[1] ] = list.add;

			// Handle state
			if ( stateString ) {
				list.add(function() {
					// state = [ resolved | rejected ]
					state = stateString;

				// [ reject_list | resolve_list ].disable; progress_list.lock
				}, tuples[ i ^ 1 ][ 2 ].disable, tuples[ 2 ][ 2 ].lock );
			}

			// deferred[ resolve | reject | notify ] = list.fire
			deferred[ tuple[0] ] = list.fire;
			deferred[ tuple[0] + "With" ] = list.fireWith;
		});

		// Make the deferred a promise
		promise.promise( deferred );

		// Call given func if any
		if ( func ) {
			func.call( deferred, deferred );
		}

		// All done!
		return deferred;
	},

	// Deferred helper
	when: function( subordinate /* , ..., subordinateN */ ) {
		var i = 0,
			resolveValues = core_slice.call( arguments ),
			length = resolveValues.length,

			// the count of uncompleted subordinates
			remaining = length !== 1 || ( subordinate && jQuery.isFunction( subordinate.promise ) ) ? length : 0,

			// the master Deferred. If resolveValues consist of only a single Deferred, just use that.
			deferred = remaining === 1 ? subordinate : jQuery.Deferred(),

			// Update function for both resolve and progress values
			updateFunc = function( i, contexts, values ) {
				return function( value ) {
					contexts[ i ] = this;
					values[ i ] = arguments.length > 1 ? core_slice.call( arguments ) : value;
					if( values === progressValues ) {
						deferred.notifyWith( contexts, values );
					} else if ( !( --remaining ) ) {
						deferred.resolveWith( contexts, values );
					}
				};
			},

			progressValues, progressContexts, resolveContexts;

		// add listeners to Deferred subordinates; treat others as resolved
		if ( length > 1 ) {
			progressValues = new Array( length );
			progressContexts = new Array( length );
			resolveContexts = new Array( length );
			for ( ; i < length; i++ ) {
				if ( resolveValues[ i ] && jQuery.isFunction( resolveValues[ i ].promise ) ) {
					resolveValues[ i ].promise()
						.done( updateFunc( i, resolveContexts, resolveValues ) )
						.fail( deferred.reject )
						.progress( updateFunc( i, progressContexts, progressValues ) );
				} else {
					--remaining;
				}
			}
		}

		// if we're not waiting on anything, resolve the master
		if ( !remaining ) {
			deferred.resolveWith( resolveContexts, resolveValues );
		}

		return deferred.promise();
	}
});
jQuery.support = (function() {

	var support,
		all,
		a,
		select,
		opt,
		input,
		fragment,
		eventName,
		i,
		isSupported,
		clickFn,
		div = document.createElement("div");

	// Setup
	div.setAttribute( "className", "t" );
	div.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";

	// Support tests won't run in some limited or non-browser environments
	all = div.getElementsByTagName("*");
	a = div.getElementsByTagName("a")[ 0 ];
	if ( !all || !a || !all.length ) {
		return {};
	}

	// First batch of tests
	select = document.createElement("select");
	opt = select.appendChild( document.createElement("option") );
	input = div.getElementsByTagName("input")[ 0 ];

	a.style.cssText = "top:1px;float:left;opacity:.5";
	support = {
		// IE strips leading whitespace when .innerHTML is used
		leadingWhitespace: ( div.firstChild.nodeType === 3 ),

		// Make sure that tbody elements aren't automatically inserted
		// IE will insert them into empty tables
		tbody: !div.getElementsByTagName("tbody").length,

		// Make sure that link elements get serialized correctly by innerHTML
		// This requires a wrapper element in IE
		htmlSerialize: !!div.getElementsByTagName("link").length,

		// Get the style information from getAttribute
		// (IE uses .cssText instead)
		style: /top/.test( a.getAttribute("style") ),

		// Make sure that URLs aren't manipulated
		// (IE normalizes it by default)
		hrefNormalized: ( a.getAttribute("href") === "/a" ),

		// Make sure that element opacity exists
		// (IE uses filter instead)
		// Use a regex to work around a WebKit issue. See #5145
		opacity: /^0.5/.test( a.style.opacity ),

		// Verify style float existence
		// (IE uses styleFloat instead of cssFloat)
		cssFloat: !!a.style.cssFloat,

		// Make sure that if no value is specified for a checkbox
		// that it defaults to "on".
		// (WebKit defaults to "" instead)
		checkOn: ( input.value === "on" ),

		// Make sure that a selected-by-default option has a working selected property.
		// (WebKit defaults to false instead of true, IE too, if it's in an optgroup)
		optSelected: opt.selected,

		// Test setAttribute on camelCase class. If it works, we need attrFixes when doing get/setAttribute (ie6/7)
		getSetAttribute: div.className !== "t",

		// Tests for enctype support on a form (#6743)
		enctype: !!document.createElement("form").enctype,

		// Makes sure cloning an html5 element does not cause problems
		// Where outerHTML is undefined, this still works
		html5Clone: document.createElement("nav").cloneNode( true ).outerHTML !== "<:nav></:nav>",

		// jQuery.support.boxModel DEPRECATED in 1.8 since we don't support Quirks Mode
		boxModel: ( document.compatMode === "CSS1Compat" ),

		// Will be defined later
		submitBubbles: true,
		changeBubbles: true,
		focusinBubbles: false,
		deleteExpando: true,
		noCloneEvent: true,
		inlineBlockNeedsLayout: false,
		shrinkWrapBlocks: false,
		reliableMarginRight: true,
		boxSizingReliable: true,
		pixelPosition: false
	};

	// Make sure checked status is properly cloned
	input.checked = true;
	support.noCloneChecked = input.cloneNode( true ).checked;

	// Make sure that the options inside disabled selects aren't marked as disabled
	// (WebKit marks them as disabled)
	select.disabled = true;
	support.optDisabled = !opt.disabled;

	// Test to see if it's possible to delete an expando from an element
	// Fails in Internet Explorer
	try {
		delete div.test;
	} catch( e ) {
		support.deleteExpando = false;
	}

	if ( !div.addEventListener && div.attachEvent && div.fireEvent ) {
		div.attachEvent( "onclick", clickFn = function() {
			// Cloning a node shouldn't copy over any
			// bound event handlers (IE does this)
			support.noCloneEvent = false;
		});
		div.cloneNode( true ).fireEvent("onclick");
		div.detachEvent( "onclick", clickFn );
	}

	// Check if a radio maintains its value
	// after being appended to the DOM
	input = document.createElement("input");
	input.value = "t";
	input.setAttribute( "type", "radio" );
	support.radioValue = input.value === "t";

	input.setAttribute( "checked", "checked" );

	// #11217 - WebKit loses check when the name is after the checked attribute
	input.setAttribute( "name", "t" );

	div.appendChild( input );
	fragment = document.createDocumentFragment();
	fragment.appendChild( div.lastChild );

	// WebKit doesn't clone checked state correctly in fragments
	support.checkClone = fragment.cloneNode( true ).cloneNode( true ).lastChild.checked;

	// Check if a disconnected checkbox will retain its checked
	// value of true after appended to the DOM (IE6/7)
	support.appendChecked = input.checked;

	fragment.removeChild( input );
	fragment.appendChild( div );

	// Technique from Juriy Zaytsev
	// http://perfectionkills.com/detecting-event-support-without-browser-sniffing/
	// We only care about the case where non-standard event systems
	// are used, namely in IE. Short-circuiting here helps us to
	// avoid an eval call (in setAttribute) which can cause CSP
	// to go haywire. See: https://developer.mozilla.org/en/Security/CSP
	if ( div.attachEvent ) {
		for ( i in {
			submit: true,
			change: true,
			focusin: true
		}) {
			eventName = "on" + i;
			isSupported = ( eventName in div );
			if ( !isSupported ) {
				div.setAttribute( eventName, "return;" );
				isSupported = ( typeof div[ eventName ] === "function" );
			}
			support[ i + "Bubbles" ] = isSupported;
		}
	}

	// Run tests that need a body at doc ready
	jQuery(function() {
		var container, div, tds, marginDiv,
			divReset = "padding:0;margin:0;border:0;display:block;overflow:hidden;",
			body = document.getElementsByTagName("body")[0];

		if ( !body ) {
			// Return for frameset docs that don't have a body
			return;
		}

		container = document.createElement("div");
		container.style.cssText = "visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";
		body.insertBefore( container, body.firstChild );

		// Construct the test element
		div = document.createElement("div");
		container.appendChild( div );

		// Check if table cells still have offsetWidth/Height when they are set
		// to display:none and there are still other visible table cells in a
		// table row; if so, offsetWidth/Height are not reliable for use when
		// determining if an element has been hidden directly using
		// display:none (it is still safe to use offsets if a parent element is
		// hidden; don safety goggles and see bug #4512 for more information).
		// (only IE 8 fails this test)
		div.innerHTML = "<table><tr><td></td><td>t</td></tr></table>";
		tds = div.getElementsByTagName("td");
		tds[ 0 ].style.cssText = "padding:0;margin:0;border:0;display:none";
		isSupported = ( tds[ 0 ].offsetHeight === 0 );

		tds[ 0 ].style.display = "";
		tds[ 1 ].style.display = "none";

		// Check if empty table cells still have offsetWidth/Height
		// (IE <= 8 fail this test)
		support.reliableHiddenOffsets = isSupported && ( tds[ 0 ].offsetHeight === 0 );

		// Check box-sizing and margin behavior
		div.innerHTML = "";
		div.style.cssText = "box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";
		support.boxSizing = ( div.offsetWidth === 4 );
		support.doesNotIncludeMarginInBodyOffset = ( body.offsetTop !== 1 );

		// NOTE: To any future maintainer, we've window.getComputedStyle
		// because jsdom on node.js will break without it.
		if ( window.getComputedStyle ) {
			support.pixelPosition = ( window.getComputedStyle( div, null ) || {} ).top !== "1%";
			support.boxSizingReliable = ( window.getComputedStyle( div, null ) || { width: "4px" } ).width === "4px";

			// Check if div with explicit width and no margin-right incorrectly
			// gets computed margin-right based on width of container. For more
			// info see bug #3333
			// Fails in WebKit before Feb 2011 nightlies
			// WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
			marginDiv = document.createElement("div");
			marginDiv.style.cssText = div.style.cssText = divReset;
			marginDiv.style.marginRight = marginDiv.style.width = "0";
			div.style.width = "1px";
			div.appendChild( marginDiv );
			support.reliableMarginRight =
				!parseFloat( ( window.getComputedStyle( marginDiv, null ) || {} ).marginRight );
		}

		if ( typeof div.style.zoom !== "undefined" ) {
			// Check if natively block-level elements act like inline-block
			// elements when setting their display to 'inline' and giving
			// them layout
			// (IE < 8 does this)
			div.innerHTML = "";
			div.style.cssText = divReset + "width:1px;padding:1px;display:inline;zoom:1";
			support.inlineBlockNeedsLayout = ( div.offsetWidth === 3 );

			// Check if elements with layout shrink-wrap their children
			// (IE 6 does this)
			div.style.display = "block";
			div.style.overflow = "visible";
			div.innerHTML = "<div></div>";
			div.firstChild.style.width = "5px";
			support.shrinkWrapBlocks = ( div.offsetWidth !== 3 );

			container.style.zoom = 1;
		}

		// Null elements to avoid leaks in IE
		body.removeChild( container );
		container = div = tds = marginDiv = null;
	});

	// Null elements to avoid leaks in IE
	fragment.removeChild( div );
	all = a = select = opt = input = fragment = div = null;

	return support;
})();
var rbrace = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/,
	rmultiDash = /([A-Z])/g;

jQuery.extend({
	cache: {},

	deletedIds: [],

	// Remove at next major release (1.9/2.0)
	uuid: 0,

	// Unique for each copy of jQuery on the page
	// Non-digits removed to match rinlinejQuery
	expando: "jQuery" + ( jQuery.fn.jquery + Math.random() ).replace( /\D/g, "" ),

	// The following elements throw uncatchable exceptions if you
	// attempt to add expando properties to them.
	noData: {
		"embed": true,
		// Ban all objects except for Flash (which handle expandos)
		"object": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",
		"applet": true
	},

	hasData: function( elem ) {
		elem = elem.nodeType ? jQuery.cache[ elem[jQuery.expando] ] : elem[ jQuery.expando ];
		return !!elem && !isEmptyDataObject( elem );
	},

	data: function( elem, name, data, pvt /* Internal Use Only */ ) {
		if ( !jQuery.acceptData( elem ) ) {
			return;
		}

		var thisCache, ret,
			internalKey = jQuery.expando,
			getByName = typeof name === "string",

			// We have to handle DOM nodes and JS objects differently because IE6-7
			// can't GC object references properly across the DOM-JS boundary
			isNode = elem.nodeType,

			// Only DOM nodes need the global jQuery cache; JS object data is
			// attached directly to the object so GC can occur automatically
			cache = isNode ? jQuery.cache : elem,

			// Only defining an ID for JS objects if its cache already exists allows
			// the code to shortcut on the same path as a DOM node with no cache
			id = isNode ? elem[ internalKey ] : elem[ internalKey ] && internalKey;

		// Avoid doing any more work than we need to when trying to get data on an
		// object that has no data at all
		if ( (!id || !cache[id] || (!pvt && !cache[id].data)) && getByName && data === undefined ) {
			return;
		}

		if ( !id ) {
			// Only DOM nodes need a new unique ID for each element since their data
			// ends up in the global cache
			if ( isNode ) {
				elem[ internalKey ] = id = jQuery.deletedIds.pop() || jQuery.guid++;
			} else {
				id = internalKey;
			}
		}

		if ( !cache[ id ] ) {
			cache[ id ] = {};

			// Avoids exposing jQuery metadata on plain JS objects when the object
			// is serialized using JSON.stringify
			if ( !isNode ) {
				cache[ id ].toJSON = jQuery.noop;
			}
		}

		// An object can be passed to jQuery.data instead of a key/value pair; this gets
		// shallow copied over onto the existing cache
		if ( typeof name === "object" || typeof name === "function" ) {
			if ( pvt ) {
				cache[ id ] = jQuery.extend( cache[ id ], name );
			} else {
				cache[ id ].data = jQuery.extend( cache[ id ].data, name );
			}
		}

		thisCache = cache[ id ];

		// jQuery data() is stored in a separate object inside the object's internal data
		// cache in order to avoid key collisions between internal data and user-defined
		// data.
		if ( !pvt ) {
			if ( !thisCache.data ) {
				thisCache.data = {};
			}

			thisCache = thisCache.data;
		}

		if ( data !== undefined ) {
			thisCache[ jQuery.camelCase( name ) ] = data;
		}

		// Check for both converted-to-camel and non-converted data property names
		// If a data property was specified
		if ( getByName ) {

			// First Try to find as-is property data
			ret = thisCache[ name ];

			// Test for null|undefined property data
			if ( ret == null ) {

				// Try to find the camelCased property
				ret = thisCache[ jQuery.camelCase( name ) ];
			}
		} else {
			ret = thisCache;
		}

		return ret;
	},

	removeData: function( elem, name, pvt /* Internal Use Only */ ) {
		if ( !jQuery.acceptData( elem ) ) {
			return;
		}

		var thisCache, i, l,

			isNode = elem.nodeType,

			// See jQuery.data for more information
			cache = isNode ? jQuery.cache : elem,
			id = isNode ? elem[ jQuery.expando ] : jQuery.expando;

		// If there is already no cache entry for this object, there is no
		// purpose in continuing
		if ( !cache[ id ] ) {
			return;
		}

		if ( name ) {

			thisCache = pvt ? cache[ id ] : cache[ id ].data;

			if ( thisCache ) {

				// Support array or space separated string names for data keys
				if ( !jQuery.isArray( name ) ) {

					// try the string as a key before any manipulation
					if ( name in thisCache ) {
						name = [ name ];
					} else {

						// split the camel cased version by spaces unless a key with the spaces exists
						name = jQuery.camelCase( name );
						if ( name in thisCache ) {
							name = [ name ];
						} else {
							name = name.split(" ");
						}
					}
				}

				for ( i = 0, l = name.length; i < l; i++ ) {
					delete thisCache[ name[i] ];
				}

				// If there is no data left in the cache, we want to continue
				// and let the cache object itself get destroyed
				if ( !( pvt ? isEmptyDataObject : jQuery.isEmptyObject )( thisCache ) ) {
					return;
				}
			}
		}

		// See jQuery.data for more information
		if ( !pvt ) {
			delete cache[ id ].data;

			// Don't destroy the parent cache unless the internal data object
			// had been the only thing left in it
			if ( !isEmptyDataObject( cache[ id ] ) ) {
				return;
			}
		}

		// Destroy the cache
		if ( isNode ) {
			jQuery.cleanData( [ elem ], true );

		// Use delete when supported for expandos or `cache` is not a window per isWindow (#10080)
		} else if ( jQuery.support.deleteExpando || cache != cache.window ) {
			delete cache[ id ];

		// When all else fails, null
		} else {
			cache[ id ] = null;
		}
	},

	// For internal use only.
	_data: function( elem, name, data ) {
		return jQuery.data( elem, name, data, true );
	},

	// A method for determining if a DOM node can handle the data expando
	acceptData: function( elem ) {
		var noData = elem.nodeName && jQuery.noData[ elem.nodeName.toLowerCase() ];

		// nodes accept data unless otherwise specified; rejection can be conditional
		return !noData || noData !== true && elem.getAttribute("classid") === noData;
	}
});

jQuery.fn.extend({
	data: function( key, value ) {
		var parts, part, attr, name, l,
			elem = this[0],
			i = 0,
			data = null;

		// Gets all values
		if ( key === undefined ) {
			if ( this.length ) {
				data = jQuery.data( elem );

				if ( elem.nodeType === 1 && !jQuery._data( elem, "parsedAttrs" ) ) {
					attr = elem.attributes;
					for ( l = attr.length; i < l; i++ ) {
						name = attr[i].name;

						if ( !name.indexOf( "data-" ) ) {
							name = jQuery.camelCase( name.substring(5) );

							dataAttr( elem, name, data[ name ] );
						}
					}
					jQuery._data( elem, "parsedAttrs", true );
				}
			}

			return data;
		}

		// Sets multiple values
		if ( typeof key === "object" ) {
			return this.each(function() {
				jQuery.data( this, key );
			});
		}

		parts = key.split( ".", 2 );
		parts[1] = parts[1] ? "." + parts[1] : "";
		part = parts[1] + "!";

		return jQuery.access( this, function( value ) {

			if ( value === undefined ) {
				data = this.triggerHandler( "getData" + part, [ parts[0] ] );

				// Try to fetch any internally stored data first
				if ( data === undefined && elem ) {
					data = jQuery.data( elem, key );
					data = dataAttr( elem, key, data );
				}

				return data === undefined && parts[1] ?
					this.data( parts[0] ) :
					data;
			}

			parts[1] = value;
			this.each(function() {
				var self = jQuery( this );

				self.triggerHandler( "setData" + part, parts );
				jQuery.data( this, key, value );
				self.triggerHandler( "changeData" + part, parts );
			});
		}, null, value, arguments.length > 1, null, false );
	},

	removeData: function( key ) {
		return this.each(function() {
			jQuery.removeData( this, key );
		});
	}
});

function dataAttr( elem, key, data ) {
	// If nothing was found internally, try to fetch any
	// data from the HTML5 data-* attribute
	if ( data === undefined && elem.nodeType === 1 ) {

		var name = "data-" + key.replace( rmultiDash, "-$1" ).toLowerCase();

		data = elem.getAttribute( name );

		if ( typeof data === "string" ) {
			try {
				data = data === "true" ? true :
				data === "false" ? false :
				data === "null" ? null :
				// Only convert to a number if it doesn't change the string
				+data + "" === data ? +data :
				rbrace.test( data ) ? jQuery.parseJSON( data ) :
					data;
			} catch( e ) {}

			// Make sure we set the data so it isn't changed later
			jQuery.data( elem, key, data );

		} else {
			data = undefined;
		}
	}

	return data;
}

// checks a cache object for emptiness
function isEmptyDataObject( obj ) {
	var name;
	for ( name in obj ) {

		// if the public data object is empty, the private is still empty
		if ( name === "data" && jQuery.isEmptyObject( obj[name] ) ) {
			continue;
		}
		if ( name !== "toJSON" ) {
			return false;
		}
	}

	return true;
}
jQuery.extend({
	queue: function( elem, type, data ) {
		var queue;

		if ( elem ) {
			type = ( type || "fx" ) + "queue";
			queue = jQuery._data( elem, type );

			// Speed up dequeue by getting out quickly if this is just a lookup
			if ( data ) {
				if ( !queue || jQuery.isArray(data) ) {
					queue = jQuery._data( elem, type, jQuery.makeArray(data) );
				} else {
					queue.push( data );
				}
			}
			return queue || [];
		}
	},

	dequeue: function( elem, type ) {
		type = type || "fx";

		var queue = jQuery.queue( elem, type ),
			startLength = queue.length,
			fn = queue.shift(),
			hooks = jQuery._queueHooks( elem, type ),
			next = function() {
				jQuery.dequeue( elem, type );
			};

		// If the fx queue is dequeued, always remove the progress sentinel
		if ( fn === "inprogress" ) {
			fn = queue.shift();
			startLength--;
		}

		if ( fn ) {

			// Add a progress sentinel to prevent the fx queue from being
			// automatically dequeued
			if ( type === "fx" ) {
				queue.unshift( "inprogress" );
			}

			// clear up the last queue stop function
			delete hooks.stop;
			fn.call( elem, next, hooks );
		}

		if ( !startLength && hooks ) {
			hooks.empty.fire();
		}
	},

	// not intended for public consumption - generates a queueHooks object, or returns the current one
	_queueHooks: function( elem, type ) {
		var key = type + "queueHooks";
		return jQuery._data( elem, key ) || jQuery._data( elem, key, {
			empty: jQuery.Callbacks("once memory").add(function() {
				jQuery.removeData( elem, type + "queue", true );
				jQuery.removeData( elem, key, true );
			})
		});
	}
});

jQuery.fn.extend({
	queue: function( type, data ) {
		var setter = 2;

		if ( typeof type !== "string" ) {
			data = type;
			type = "fx";
			setter--;
		}

		if ( arguments.length < setter ) {
			return jQuery.queue( this[0], type );
		}

		return data === undefined ?
			this :
			this.each(function() {
				var queue = jQuery.queue( this, type, data );

				// ensure a hooks for this queue
				jQuery._queueHooks( this, type );

				if ( type === "fx" && queue[0] !== "inprogress" ) {
					jQuery.dequeue( this, type );
				}
			});
	},
	dequeue: function( type ) {
		return this.each(function() {
			jQuery.dequeue( this, type );
		});
	},
	// Based off of the plugin by Clint Helfers, with permission.
	// http://blindsignals.com/index.php/2009/07/jquery-delay/
	delay: function( time, type ) {
		time = jQuery.fx ? jQuery.fx.speeds[ time ] || time : time;
		type = type || "fx";

		return this.queue( type, function( next, hooks ) {
			var timeout = setTimeout( next, time );
			hooks.stop = function() {
				clearTimeout( timeout );
			};
		});
	},
	clearQueue: function( type ) {
		return this.queue( type || "fx", [] );
	},
	// Get a promise resolved when queues of a certain type
	// are emptied (fx is the type by default)
	promise: function( type, obj ) {
		var tmp,
			count = 1,
			defer = jQuery.Deferred(),
			elements = this,
			i = this.length,
			resolve = function() {
				if ( !( --count ) ) {
					defer.resolveWith( elements, [ elements ] );
				}
			};

		if ( typeof type !== "string" ) {
			obj = type;
			type = undefined;
		}
		type = type || "fx";

		while( i-- ) {
			tmp = jQuery._data( elements[ i ], type + "queueHooks" );
			if ( tmp && tmp.empty ) {
				count++;
				tmp.empty.add( resolve );
			}
		}
		resolve();
		return defer.promise( obj );
	}
});
var nodeHook, boolHook, fixSpecified,
	rclass = /[\t\r\n]/g,
	rreturn = /\r/g,
	rtype = /^(?:button|input)$/i,
	rfocusable = /^(?:button|input|object|select|textarea)$/i,
	rclickable = /^a(?:rea|)$/i,
	rboolean = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
	getSetAttribute = jQuery.support.getSetAttribute;

jQuery.fn.extend({
	attr: function( name, value ) {
		return jQuery.access( this, jQuery.attr, name, value, arguments.length > 1 );
	},

	removeAttr: function( name ) {
		return this.each(function() {
			jQuery.removeAttr( this, name );
		});
	},

	prop: function( name, value ) {
		return jQuery.access( this, jQuery.prop, name, value, arguments.length > 1 );
	},

	removeProp: function( name ) {
		name = jQuery.propFix[ name ] || name;
		return this.each(function() {
			// try/catch handles cases where IE balks (such as removing a property on window)
			try {
				this[ name ] = undefined;
				delete this[ name ];
			} catch( e ) {}
		});
	},

	addClass: function( value ) {
		var classNames, i, l, elem,
			setClass, c, cl;

		if ( jQuery.isFunction( value ) ) {
			return this.each(function( j ) {
				jQuery( this ).addClass( value.call(this, j, this.className) );
			});
		}

		if ( value && typeof value === "string" ) {
			classNames = value.split( core_rspace );

			for ( i = 0, l = this.length; i < l; i++ ) {
				elem = this[ i ];

				if ( elem.nodeType === 1 ) {
					if ( !elem.className && classNames.length === 1 ) {
						elem.className = value;

					} else {
						setClass = " " + elem.className + " ";

						for ( c = 0, cl = classNames.length; c < cl; c++ ) {
							if ( setClass.indexOf( " " + classNames[ c ] + " " ) < 0 ) {
								setClass += classNames[ c ] + " ";
							}
						}
						elem.className = jQuery.trim( setClass );
					}
				}
			}
		}

		return this;
	},

	removeClass: function( value ) {
		var removes, className, elem, c, cl, i, l;

		if ( jQuery.isFunction( value ) ) {
			return this.each(function( j ) {
				jQuery( this ).removeClass( value.call(this, j, this.className) );
			});
		}
		if ( (value && typeof value === "string") || value === undefined ) {
			removes = ( value || "" ).split( core_rspace );

			for ( i = 0, l = this.length; i < l; i++ ) {
				elem = this[ i ];
				if ( elem.nodeType === 1 && elem.className ) {

					className = (" " + elem.className + " ").replace( rclass, " " );

					// loop over each item in the removal list
					for ( c = 0, cl = removes.length; c < cl; c++ ) {
						// Remove until there is nothing to remove,
						while ( className.indexOf(" " + removes[ c ] + " ") >= 0 ) {
							className = className.replace( " " + removes[ c ] + " " , " " );
						}
					}
					elem.className = value ? jQuery.trim( className ) : "";
				}
			}
		}

		return this;
	},

	toggleClass: function( value, stateVal ) {
		var type = typeof value,
			isBool = typeof stateVal === "boolean";

		if ( jQuery.isFunction( value ) ) {
			return this.each(function( i ) {
				jQuery( this ).toggleClass( value.call(this, i, this.className, stateVal), stateVal );
			});
		}

		return this.each(function() {
			if ( type === "string" ) {
				// toggle individual class names
				var className,
					i = 0,
					self = jQuery( this ),
					state = stateVal,
					classNames = value.split( core_rspace );

				while ( (className = classNames[ i++ ]) ) {
					// check each className given, space separated list
					state = isBool ? state : !self.hasClass( className );
					self[ state ? "addClass" : "removeClass" ]( className );
				}

			} else if ( type === "undefined" || type === "boolean" ) {
				if ( this.className ) {
					// store className if set
					jQuery._data( this, "__className__", this.className );
				}

				// toggle whole className
				this.className = this.className || value === false ? "" : jQuery._data( this, "__className__" ) || "";
			}
		});
	},

	hasClass: function( selector ) {
		var className = " " + selector + " ",
			i = 0,
			l = this.length;
		for ( ; i < l; i++ ) {
			if ( this[i].nodeType === 1 && (" " + this[i].className + " ").replace(rclass, " ").indexOf( className ) >= 0 ) {
				return true;
			}
		}

		return false;
	},

	val: function( value ) {
		var hooks, ret, isFunction,
			elem = this[0];

		if ( !arguments.length ) {
			if ( elem ) {
				hooks = jQuery.valHooks[ elem.type ] || jQuery.valHooks[ elem.nodeName.toLowerCase() ];

				if ( hooks && "get" in hooks && (ret = hooks.get( elem, "value" )) !== undefined ) {
					return ret;
				}

				ret = elem.value;

				return typeof ret === "string" ?
					// handle most common string cases
					ret.replace(rreturn, "") :
					// handle cases where value is null/undef or number
					ret == null ? "" : ret;
			}

			return;
		}

		isFunction = jQuery.isFunction( value );

		return this.each(function( i ) {
			var val,
				self = jQuery(this);

			if ( this.nodeType !== 1 ) {
				return;
			}

			if ( isFunction ) {
				val = value.call( this, i, self.val() );
			} else {
				val = value;
			}

			// Treat null/undefined as ""; convert numbers to string
			if ( val == null ) {
				val = "";
			} else if ( typeof val === "number" ) {
				val += "";
			} else if ( jQuery.isArray( val ) ) {
				val = jQuery.map(val, function ( value ) {
					return value == null ? "" : value + "";
				});
			}

			hooks = jQuery.valHooks[ this.type ] || jQuery.valHooks[ this.nodeName.toLowerCase() ];

			// If set returns undefined, fall back to normal setting
			if ( !hooks || !("set" in hooks) || hooks.set( this, val, "value" ) === undefined ) {
				this.value = val;
			}
		});
	}
});

jQuery.extend({
	valHooks: {
		option: {
			get: function( elem ) {
				// attributes.value is undefined in Blackberry 4.7 but
				// uses .value. See #6932
				var val = elem.attributes.value;
				return !val || val.specified ? elem.value : elem.text;
			}
		},
		select: {
			get: function( elem ) {
				var value, option,
					options = elem.options,
					index = elem.selectedIndex,
					one = elem.type === "select-one" || index < 0,
					values = one ? null : [],
					max = one ? index + 1 : options.length,
					i = index < 0 ?
						max :
						one ? index : 0;

				// Loop through all the selected options
				for ( ; i < max; i++ ) {
					option = options[ i ];

					// oldIE doesn't update selected after form reset (#2551)
					if ( ( option.selected || i === index ) &&
							// Don't return options that are disabled or in a disabled optgroup
							( jQuery.support.optDisabled ? !option.disabled : option.getAttribute("disabled") === null ) &&
							( !option.parentNode.disabled || !jQuery.nodeName( option.parentNode, "optgroup" ) ) ) {

						// Get the specific value for the option
						value = jQuery( option ).val();

						// We don't need an array for one selects
						if ( one ) {
							return value;
						}

						// Multi-Selects return an array
						values.push( value );
					}
				}

				return values;
			},

			set: function( elem, value ) {
				var values = jQuery.makeArray( value );

				jQuery(elem).find("option").each(function() {
					this.selected = jQuery.inArray( jQuery(this).val(), values ) >= 0;
				});

				if ( !values.length ) {
					elem.selectedIndex = -1;
				}
				return values;
			}
		}
	},

	// Unused in 1.8, left in so attrFn-stabbers won't die; remove in 1.9
	attrFn: {},

	attr: function( elem, name, value, pass ) {
		var ret, hooks, notxml,
			nType = elem.nodeType;

		// don't get/set attributes on text, comment and attribute nodes
		if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {
			return;
		}

		if ( pass && jQuery.isFunction( jQuery.fn[ name ] ) ) {
			return jQuery( elem )[ name ]( value );
		}

		// Fallback to prop when attributes are not supported
		if ( typeof elem.getAttribute === "undefined" ) {
			return jQuery.prop( elem, name, value );
		}

		notxml = nType !== 1 || !jQuery.isXMLDoc( elem );

		// All attributes are lowercase
		// Grab necessary hook if one is defined
		if ( notxml ) {
			name = name.toLowerCase();
			hooks = jQuery.attrHooks[ name ] || ( rboolean.test( name ) ? boolHook : nodeHook );
		}

		if ( value !== undefined ) {

			if ( value === null ) {
				jQuery.removeAttr( elem, name );
				return;

			} else if ( hooks && "set" in hooks && notxml && (ret = hooks.set( elem, value, name )) !== undefined ) {
				return ret;

			} else {
				elem.setAttribute( name, value + "" );
				return value;
			}

		} else if ( hooks && "get" in hooks && notxml && (ret = hooks.get( elem, name )) !== null ) {
			return ret;

		} else {

			ret = elem.getAttribute( name );

			// Non-existent attributes return null, we normalize to undefined
			return ret === null ?
				undefined :
				ret;
		}
	},

	removeAttr: function( elem, value ) {
		var propName, attrNames, name, isBool,
			i = 0;

		if ( value && elem.nodeType === 1 ) {

			attrNames = value.split( core_rspace );

			for ( ; i < attrNames.length; i++ ) {
				name = attrNames[ i ];

				if ( name ) {
					propName = jQuery.propFix[ name ] || name;
					isBool = rboolean.test( name );

					// See #9699 for explanation of this approach (setting first, then removal)
					// Do not do this for boolean attributes (see #10870)
					if ( !isBool ) {
						jQuery.attr( elem, name, "" );
					}
					elem.removeAttribute( getSetAttribute ? name : propName );

					// Set corresponding property to false for boolean attributes
					if ( isBool && propName in elem ) {
						elem[ propName ] = false;
					}
				}
			}
		}
	},

	attrHooks: {
		type: {
			set: function( elem, value ) {
				// We can't allow the type property to be changed (since it causes problems in IE)
				if ( rtype.test( elem.nodeName ) && elem.parentNode ) {
					jQuery.error( "type property can't be changed" );
				} else if ( !jQuery.support.radioValue && value === "radio" && jQuery.nodeName(elem, "input") ) {
					// Setting the type on a radio button after the value resets the value in IE6-9
					// Reset value to it's default in case type is set after value
					// This is for element creation
					var val = elem.value;
					elem.setAttribute( "type", value );
					if ( val ) {
						elem.value = val;
					}
					return value;
				}
			}
		},
		// Use the value property for back compat
		// Use the nodeHook for button elements in IE6/7 (#1954)
		value: {
			get: function( elem, name ) {
				if ( nodeHook && jQuery.nodeName( elem, "button" ) ) {
					return nodeHook.get( elem, name );
				}
				return name in elem ?
					elem.value :
					null;
			},
			set: function( elem, value, name ) {
				if ( nodeHook && jQuery.nodeName( elem, "button" ) ) {
					return nodeHook.set( elem, value, name );
				}
				// Does not return so that setAttribute is also used
				elem.value = value;
			}
		}
	},

	propFix: {
		tabindex: "tabIndex",
		readonly: "readOnly",
		"for": "htmlFor",
		"class": "className",
		maxlength: "maxLength",
		cellspacing: "cellSpacing",
		cellpadding: "cellPadding",
		rowspan: "rowSpan",
		colspan: "colSpan",
		usemap: "useMap",
		frameborder: "frameBorder",
		contenteditable: "contentEditable"
	},

	prop: function( elem, name, value ) {
		var ret, hooks, notxml,
			nType = elem.nodeType;

		// don't get/set properties on text, comment and attribute nodes
		if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {
			return;
		}

		notxml = nType !== 1 || !jQuery.isXMLDoc( elem );

		if ( notxml ) {
			// Fix name and attach hooks
			name = jQuery.propFix[ name ] || name;
			hooks = jQuery.propHooks[ name ];
		}

		if ( value !== undefined ) {
			if ( hooks && "set" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ) {
				return ret;

			} else {
				return ( elem[ name ] = value );
			}

		} else {
			if ( hooks && "get" in hooks && (ret = hooks.get( elem, name )) !== null ) {
				return ret;

			} else {
				return elem[ name ];
			}
		}
	},

	propHooks: {
		tabIndex: {
			get: function( elem ) {
				// elem.tabIndex doesn't always return the correct value when it hasn't been explicitly set
				// http://fluidproject.org/blog/2008/01/09/getting-setting-and-removing-tabindex-values-with-javascript/
				var attributeNode = elem.getAttributeNode("tabindex");

				return attributeNode && attributeNode.specified ?
					parseInt( attributeNode.value, 10 ) :
					rfocusable.test( elem.nodeName ) || rclickable.test( elem.nodeName ) && elem.href ?
						0 :
						undefined;
			}
		}
	}
});

// Hook for boolean attributes
boolHook = {
	get: function( elem, name ) {
		// Align boolean attributes with corresponding properties
		// Fall back to attribute presence where some booleans are not supported
		var attrNode,
			property = jQuery.prop( elem, name );
		return property === true || typeof property !== "boolean" && ( attrNode = elem.getAttributeNode(name) ) && attrNode.nodeValue !== false ?
			name.toLowerCase() :
			undefined;
	},
	set: function( elem, value, name ) {
		var propName;
		if ( value === false ) {
			// Remove boolean attributes when set to false
			jQuery.removeAttr( elem, name );
		} else {
			// value is true since we know at this point it's type boolean and not false
			// Set boolean attributes to the same name and set the DOM property
			propName = jQuery.propFix[ name ] || name;
			if ( propName in elem ) {
				// Only set the IDL specifically if it already exists on the element
				elem[ propName ] = true;
			}

			elem.setAttribute( name, name.toLowerCase() );
		}
		return name;
	}
};

// IE6/7 do not support getting/setting some attributes with get/setAttribute
if ( !getSetAttribute ) {

	fixSpecified = {
		name: true,
		id: true,
		coords: true
	};

	// Use this for any attribute in IE6/7
	// This fixes almost every IE6/7 issue
	nodeHook = jQuery.valHooks.button = {
		get: function( elem, name ) {
			var ret;
			ret = elem.getAttributeNode( name );
			return ret && ( fixSpecified[ name ] ? ret.value !== "" : ret.specified ) ?
				ret.value :
				undefined;
		},
		set: function( elem, value, name ) {
			// Set the existing or create a new attribute node
			var ret = elem.getAttributeNode( name );
			if ( !ret ) {
				ret = document.createAttribute( name );
				elem.setAttributeNode( ret );
			}
			return ( ret.value = value + "" );
		}
	};

	// Set width and height to auto instead of 0 on empty string( Bug #8150 )
	// This is for removals
	jQuery.each([ "width", "height" ], function( i, name ) {
		jQuery.attrHooks[ name ] = jQuery.extend( jQuery.attrHooks[ name ], {
			set: function( elem, value ) {
				if ( value === "" ) {
					elem.setAttribute( name, "auto" );
					return value;
				}
			}
		});
	});

	// Set contenteditable to false on removals(#10429)
	// Setting to empty string throws an error as an invalid value
	jQuery.attrHooks.contenteditable = {
		get: nodeHook.get,
		set: function( elem, value, name ) {
			if ( value === "" ) {
				value = "false";
			}
			nodeHook.set( elem, value, name );
		}
	};
}


// Some attributes require a special call on IE
if ( !jQuery.support.hrefNormalized ) {
	jQuery.each([ "href", "src", "width", "height" ], function( i, name ) {
		jQuery.attrHooks[ name ] = jQuery.extend( jQuery.attrHooks[ name ], {
			get: function( elem ) {
				var ret = elem.getAttribute( name, 2 );
				return ret === null ? undefined : ret;
			}
		});
	});
}

if ( !jQuery.support.style ) {
	jQuery.attrHooks.style = {
		get: function( elem ) {
			// Return undefined in the case of empty string
			// Normalize to lowercase since IE uppercases css property names
			return elem.style.cssText.toLowerCase() || undefined;
		},
		set: function( elem, value ) {
			return ( elem.style.cssText = value + "" );
		}
	};
}

// Safari mis-reports the default selected property of an option
// Accessing the parent's selectedIndex property fixes it
if ( !jQuery.support.optSelected ) {
	jQuery.propHooks.selected = jQuery.extend( jQuery.propHooks.selected, {
		get: function( elem ) {
			var parent = elem.parentNode;

			if ( parent ) {
				parent.selectedIndex;

				// Make sure that it also works with optgroups, see #5701
				if ( parent.parentNode ) {
					parent.parentNode.selectedIndex;
				}
			}
			return null;
		}
	});
}

// IE6/7 call enctype encoding
if ( !jQuery.support.enctype ) {
	jQuery.propFix.enctype = "encoding";
}

// Radios and checkboxes getter/setter
if ( !jQuery.support.checkOn ) {
	jQuery.each([ "radio", "checkbox" ], function() {
		jQuery.valHooks[ this ] = {
			get: function( elem ) {
				// Handle the case where in Webkit "" is returned instead of "on" if a value isn't specified
				return elem.getAttribute("value") === null ? "on" : elem.value;
			}
		};
	});
}
jQuery.each([ "radio", "checkbox" ], function() {
	jQuery.valHooks[ this ] = jQuery.extend( jQuery.valHooks[ this ], {
		set: function( elem, value ) {
			if ( jQuery.isArray( value ) ) {
				return ( elem.checked = jQuery.inArray( jQuery(elem).val(), value ) >= 0 );
			}
		}
	});
});
var rformElems = /^(?:textarea|input|select)$/i,
	rtypenamespace = /^([^\.]*|)(?:\.(.+)|)$/,
	rhoverHack = /(?:^|\s)hover(\.\S+|)\b/,
	rkeyEvent = /^key/,
	rmouseEvent = /^(?:mouse|contextmenu)|click/,
	rfocusMorph = /^(?:focusinfocus|focusoutblur)$/,
	hoverHack = function( events ) {
		return jQuery.event.special.hover ? events : events.replace( rhoverHack, "mouseenter$1 mouseleave$1" );
	};

/*
 * Helper functions for managing events -- not part of the public interface.
 * Props to Dean Edwards' addEvent library for many of the ideas.
 */
jQuery.event = {

	add: function( elem, types, handler, data, selector ) {

		var elemData, eventHandle, events,
			t, tns, type, namespaces, handleObj,
			handleObjIn, handlers, special;

		// Don't attach events to noData or text/comment nodes (allow plain objects tho)
		if ( elem.nodeType === 3 || elem.nodeType === 8 || !types || !handler || !(elemData = jQuery._data( elem )) ) {
			return;
		}

		// Caller can pass in an object of custom data in lieu of the handler
		if ( handler.handler ) {
			handleObjIn = handler;
			handler = handleObjIn.handler;
			selector = handleObjIn.selector;
		}

		// Make sure that the handler has a unique ID, used to find/remove it later
		if ( !handler.guid ) {
			handler.guid = jQuery.guid++;
		}

		// Init the element's event structure and main handler, if this is the first
		events = elemData.events;
		if ( !events ) {
			elemData.events = events = {};
		}
		eventHandle = elemData.handle;
		if ( !eventHandle ) {
			elemData.handle = eventHandle = function( e ) {
				// Discard the second event of a jQuery.event.trigger() and
				// when an event is called after a page has unloaded
				return typeof jQuery !== "undefined" && (!e || jQuery.event.triggered !== e.type) ?
					jQuery.event.dispatch.apply( eventHandle.elem, arguments ) :
					undefined;
			};
			// Add elem as a property of the handle fn to prevent a memory leak with IE non-native events
			eventHandle.elem = elem;
		}

		// Handle multiple events separated by a space
		// jQuery(...).bind("mouseover mouseout", fn);
		types = jQuery.trim( hoverHack(types) ).split( " " );
		for ( t = 0; t < types.length; t++ ) {

			tns = rtypenamespace.exec( types[t] ) || [];
			type = tns[1];
			namespaces = ( tns[2] || "" ).split( "." ).sort();

			// If event changes its type, use the special event handlers for the changed type
			special = jQuery.event.special[ type ] || {};

			// If selector defined, determine special event api type, otherwise given type
			type = ( selector ? special.delegateType : special.bindType ) || type;

			// Update special based on newly reset type
			special = jQuery.event.special[ type ] || {};

			// handleObj is passed to all event handlers
			handleObj = jQuery.extend({
				type: type,
				origType: tns[1],
				data: data,
				handler: handler,
				guid: handler.guid,
				selector: selector,
				needsContext: selector && jQuery.expr.match.needsContext.test( selector ),
				namespace: namespaces.join(".")
			}, handleObjIn );

			// Init the event handler queue if we're the first
			handlers = events[ type ];
			if ( !handlers ) {
				handlers = events[ type ] = [];
				handlers.delegateCount = 0;

				// Only use addEventListener/attachEvent if the special events handler returns false
				if ( !special.setup || special.setup.call( elem, data, namespaces, eventHandle ) === false ) {
					// Bind the global event handler to the element
					if ( elem.addEventListener ) {
						elem.addEventListener( type, eventHandle, false );

					} else if ( elem.attachEvent ) {
						elem.attachEvent( "on" + type, eventHandle );
					}
				}
			}

			if ( special.add ) {
				special.add.call( elem, handleObj );

				if ( !handleObj.handler.guid ) {
					handleObj.handler.guid = handler.guid;
				}
			}

			// Add to the element's handler list, delegates in front
			if ( selector ) {
				handlers.splice( handlers.delegateCount++, 0, handleObj );
			} else {
				handlers.push( handleObj );
			}

			// Keep track of which events have ever been used, for event optimization
			jQuery.event.global[ type ] = true;
		}

		// Nullify elem to prevent memory leaks in IE
		elem = null;
	},

	global: {},

	// Detach an event or set of events from an element
	remove: function( elem, types, handler, selector, mappedTypes ) {

		var t, tns, type, origType, namespaces, origCount,
			j, events, special, eventType, handleObj,
			elemData = jQuery.hasData( elem ) && jQuery._data( elem );

		if ( !elemData || !(events = elemData.events) ) {
			return;
		}

		// Once for each type.namespace in types; type may be omitted
		types = jQuery.trim( hoverHack( types || "" ) ).split(" ");
		for ( t = 0; t < types.length; t++ ) {
			tns = rtypenamespace.exec( types[t] ) || [];
			type = origType = tns[1];
			namespaces = tns[2];

			// Unbind all events (on this namespace, if provided) for the element
			if ( !type ) {
				for ( type in events ) {
					jQuery.event.remove( elem, type + types[ t ], handler, selector, true );
				}
				continue;
			}

			special = jQuery.event.special[ type ] || {};
			type = ( selector? special.delegateType : special.bindType ) || type;
			eventType = events[ type ] || [];
			origCount = eventType.length;
			namespaces = namespaces ? new RegExp("(^|\\.)" + namespaces.split(".").sort().join("\\.(?:.*\\.|)") + "(\\.|$)") : null;

			// Remove matching events
			for ( j = 0; j < eventType.length; j++ ) {
				handleObj = eventType[ j ];

				if ( ( mappedTypes || origType === handleObj.origType ) &&
					 ( !handler || handler.guid === handleObj.guid ) &&
					 ( !namespaces || namespaces.test( handleObj.namespace ) ) &&
					 ( !selector || selector === handleObj.selector || selector === "**" && handleObj.selector ) ) {
					eventType.splice( j--, 1 );

					if ( handleObj.selector ) {
						eventType.delegateCount--;
					}
					if ( special.remove ) {
						special.remove.call( elem, handleObj );
					}
				}
			}

			// Remove generic event handler if we removed something and no more handlers exist
			// (avoids potential for endless recursion during removal of special event handlers)
			if ( eventType.length === 0 && origCount !== eventType.length ) {
				if ( !special.teardown || special.teardown.call( elem, namespaces, elemData.handle ) === false ) {
					jQuery.removeEvent( elem, type, elemData.handle );
				}

				delete events[ type ];
			}
		}

		// Remove the expando if it's no longer used
		if ( jQuery.isEmptyObject( events ) ) {
			delete elemData.handle;

			// removeData also checks for emptiness and clears the expando if empty
			// so use it instead of delete
			jQuery.removeData( elem, "events", true );
		}
	},

	// Events that are safe to short-circuit if no handlers are attached.
	// Native DOM events should not be added, they may have inline handlers.
	customEvent: {
		"getData": true,
		"setData": true,
		"changeData": true
	},

	trigger: function( event, data, elem, onlyHandlers ) {
		// Don't do events on text and comment nodes
		if ( elem && (elem.nodeType === 3 || elem.nodeType === 8) ) {
			return;
		}

		// Event object or event type
		var cache, exclusive, i, cur, old, ontype, special, handle, eventPath, bubbleType,
			type = event.type || event,
			namespaces = [];

		// focus/blur morphs to focusin/out; ensure we're not firing them right now
		if ( rfocusMorph.test( type + jQuery.event.triggered ) ) {
			return;
		}

		if ( type.indexOf( "!" ) >= 0 ) {
			// Exclusive events trigger only for the exact event (no namespaces)
			type = type.slice(0, -1);
			exclusive = true;
		}

		if ( type.indexOf( "." ) >= 0 ) {
			// Namespaced trigger; create a regexp to match event type in handle()
			namespaces = type.split(".");
			type = namespaces.shift();
			namespaces.sort();
		}

		if ( (!elem || jQuery.event.customEvent[ type ]) && !jQuery.event.global[ type ] ) {
			// No jQuery handlers for this event type, and it can't have inline handlers
			return;
		}

		// Caller can pass in an Event, Object, or just an event type string
		event = typeof event === "object" ?
			// jQuery.Event object
			event[ jQuery.expando ] ? event :
			// Object literal
			new jQuery.Event( type, event ) :
			// Just the event type (string)
			new jQuery.Event( type );

		event.type = type;
		event.isTrigger = true;
		event.exclusive = exclusive;
		event.namespace = namespaces.join( "." );
		event.namespace_re = event.namespace? new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)") : null;
		ontype = type.indexOf( ":" ) < 0 ? "on" + type : "";

		// Handle a global trigger
		if ( !elem ) {

			// TODO: Stop taunting the data cache; remove global events and always attach to document
			cache = jQuery.cache;
			for ( i in cache ) {
				if ( cache[ i ].events && cache[ i ].events[ type ] ) {
					jQuery.event.trigger( event, data, cache[ i ].handle.elem, true );
				}
			}
			return;
		}

		// Clean up the event in case it is being reused
		event.result = undefined;
		if ( !event.target ) {
			event.target = elem;
		}

		// Clone any incoming data and prepend the event, creating the handler arg list
		data = data != null ? jQuery.makeArray( data ) : [];
		data.unshift( event );

		// Allow special events to draw outside the lines
		special = jQuery.event.special[ type ] || {};
		if ( special.trigger && special.trigger.apply( elem, data ) === false ) {
			return;
		}

		// Determine event propagation path in advance, per W3C events spec (#9951)
		// Bubble up to document, then to window; watch for a global ownerDocument var (#9724)
		eventPath = [[ elem, special.bindType || type ]];
		if ( !onlyHandlers && !special.noBubble && !jQuery.isWindow( elem ) ) {

			bubbleType = special.delegateType || type;
			cur = rfocusMorph.test( bubbleType + type ) ? elem : elem.parentNode;
			for ( old = elem; cur; cur = cur.parentNode ) {
				eventPath.push([ cur, bubbleType ]);
				old = cur;
			}

			// Only add window if we got to document (e.g., not plain obj or detached DOM)
			if ( old === (elem.ownerDocument || document) ) {
				eventPath.push([ old.defaultView || old.parentWindow || window, bubbleType ]);
			}
		}

		// Fire handlers on the event path
		for ( i = 0; i < eventPath.length && !event.isPropagationStopped(); i++ ) {

			cur = eventPath[i][0];
			event.type = eventPath[i][1];

			handle = ( jQuery._data( cur, "events" ) || {} )[ event.type ] && jQuery._data( cur, "handle" );
			if ( handle ) {
				handle.apply( cur, data );
			}
			// Note that this is a bare JS function and not a jQuery handler
			handle = ontype && cur[ ontype ];
			if ( handle && jQuery.acceptData( cur ) && handle.apply && handle.apply( cur, data ) === false ) {
				event.preventDefault();
			}
		}
		event.type = type;

		// If nobody prevented the default action, do it now
		if ( !onlyHandlers && !event.isDefaultPrevented() ) {

			if ( (!special._default || special._default.apply( elem.ownerDocument, data ) === false) &&
				!(type === "click" && jQuery.nodeName( elem, "a" )) && jQuery.acceptData( elem ) ) {

				// Call a native DOM method on the target with the same name name as the event.
				// Can't use an .isFunction() check here because IE6/7 fails that test.
				// Don't do default actions on window, that's where global variables be (#6170)
				// IE<9 dies on focus/blur to hidden element (#1486)
				if ( ontype && elem[ type ] && ((type !== "focus" && type !== "blur") || event.target && event.target.offsetWidth !== 0) && !jQuery.isWindow( elem ) ) {

					// Don't re-trigger an onFOO event when we call its FOO() method
					old = elem[ ontype ];

					if ( old ) {
						elem[ ontype ] = null;
					}

					// Prevent re-triggering of the same event, since we already bubbled it above
					jQuery.event.triggered = type;
					elem[ type ]();
					jQuery.event.triggered = undefined;

					if ( old ) {
						elem[ ontype ] = old;
					}
				}
			}
		}

		return event.result;
	},

	dispatch: function( event ) {

		// Make a writable jQuery.Event from the native event object
		event = jQuery.event.fix( event || window.event );

		var i, j, cur, ret, selMatch, matched, matches, handleObj, sel, related,
			handlers = ( (jQuery._data( this, "events" ) || {} )[ event.type ] || []),
			delegateCount = handlers.delegateCount,
			args = core_slice.call( arguments ),
			run_all = !event.exclusive && !event.namespace,
			special = jQuery.event.special[ event.type ] || {},
			handlerQueue = [];

		// Use the fix-ed jQuery.Event rather than the (read-only) native event
		args[0] = event;
		event.delegateTarget = this;

		// Call the preDispatch hook for the mapped type, and let it bail if desired
		if ( special.preDispatch && special.preDispatch.call( this, event ) === false ) {
			return;
		}

		// Determine handlers that should run if there are delegated events
		// Avoid non-left-click bubbling in Firefox (#3861)
		if ( delegateCount && !(event.button && event.type === "click") ) {

			for ( cur = event.target; cur != this; cur = cur.parentNode || this ) {

				// Don't process clicks (ONLY) on disabled elements (#6911, #8165, #11382, #11764)
				if ( cur.disabled !== true || event.type !== "click" ) {
					selMatch = {};
					matches = [];
					for ( i = 0; i < delegateCount; i++ ) {
						handleObj = handlers[ i ];
						sel = handleObj.selector;

						if ( selMatch[ sel ] === undefined ) {
							selMatch[ sel ] = handleObj.needsContext ?
								jQuery( sel, this ).index( cur ) >= 0 :
								jQuery.find( sel, this, null, [ cur ] ).length;
						}
						if ( selMatch[ sel ] ) {
							matches.push( handleObj );
						}
					}
					if ( matches.length ) {
						handlerQueue.push({ elem: cur, matches: matches });
					}
				}
			}
		}

		// Add the remaining (directly-bound) handlers
		if ( handlers.length > delegateCount ) {
			handlerQueue.push({ elem: this, matches: handlers.slice( delegateCount ) });
		}

		// Run delegates first; they may want to stop propagation beneath us
		for ( i = 0; i < handlerQueue.length && !event.isPropagationStopped(); i++ ) {
			matched = handlerQueue[ i ];
			event.currentTarget = matched.elem;

			for ( j = 0; j < matched.matches.length && !event.isImmediatePropagationStopped(); j++ ) {
				handleObj = matched.matches[ j ];

				// Triggered event must either 1) be non-exclusive and have no namespace, or
				// 2) have namespace(s) a subset or equal to those in the bound event (both can have no namespace).
				if ( run_all || (!event.namespace && !handleObj.namespace) || event.namespace_re && event.namespace_re.test( handleObj.namespace ) ) {

					event.data = handleObj.data;
					event.handleObj = handleObj;

					ret = ( (jQuery.event.special[ handleObj.origType ] || {}).handle || handleObj.handler )
							.apply( matched.elem, args );

					if ( ret !== undefined ) {
						event.result = ret;
						if ( ret === false ) {
							event.preventDefault();
							event.stopPropagation();
						}
					}
				}
			}
		}

		// Call the postDispatch hook for the mapped type
		if ( special.postDispatch ) {
			special.postDispatch.call( this, event );
		}

		return event.result;
	},

	// Includes some event props shared by KeyEvent and MouseEvent
	// *** attrChange attrName relatedNode srcElement  are not normalized, non-W3C, deprecated, will be removed in 1.8 ***
	props: "attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),

	fixHooks: {},

	keyHooks: {
		props: "char charCode key keyCode".split(" "),
		filter: function( event, original ) {

			// Add which for key events
			if ( event.which == null ) {
				event.which = original.charCode != null ? original.charCode : original.keyCode;
			}

			return event;
		}
	},

	mouseHooks: {
		props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
		filter: function( event, original ) {
			var eventDoc, doc, body,
				button = original.button,
				fromElement = original.fromElement;

			// Calculate pageX/Y if missing and clientX/Y available
			if ( event.pageX == null && original.clientX != null ) {
				eventDoc = event.target.ownerDocument || document;
				doc = eventDoc.documentElement;
				body = eventDoc.body;

				event.pageX = original.clientX + ( doc && doc.scrollLeft || body && body.scrollLeft || 0 ) - ( doc && doc.clientLeft || body && body.clientLeft || 0 );
				event.pageY = original.clientY + ( doc && doc.scrollTop  || body && body.scrollTop  || 0 ) - ( doc && doc.clientTop  || body && body.clientTop  || 0 );
			}

			// Add relatedTarget, if necessary
			if ( !event.relatedTarget && fromElement ) {
				event.relatedTarget = fromElement === event.target ? original.toElement : fromElement;
			}

			// Add which for click: 1 === left; 2 === middle; 3 === right
			// Note: button is not normalized, so don't use it
			if ( !event.which && button !== undefined ) {
				event.which = ( button & 1 ? 1 : ( button & 2 ? 3 : ( button & 4 ? 2 : 0 ) ) );
			}

			return event;
		}
	},

	fix: function( event ) {
		if ( event[ jQuery.expando ] ) {
			return event;
		}

		// Create a writable copy of the event object and normalize some properties
		var i, prop,
			originalEvent = event,
			fixHook = jQuery.event.fixHooks[ event.type ] || {},
			copy = fixHook.props ? this.props.concat( fixHook.props ) : this.props;

		event = jQuery.Event( originalEvent );

		for ( i = copy.length; i; ) {
			prop = copy[ --i ];
			event[ prop ] = originalEvent[ prop ];
		}

		// Fix target property, if necessary (#1925, IE 6/7/8 & Safari2)
		if ( !event.target ) {
			event.target = originalEvent.srcElement || document;
		}

		// Target should not be a text node (#504, Safari)
		if ( event.target.nodeType === 3 ) {
			event.target = event.target.parentNode;
		}

		// For mouse/key events, metaKey==false if it's undefined (#3368, #11328; IE6/7/8)
		event.metaKey = !!event.metaKey;

		return fixHook.filter? fixHook.filter( event, originalEvent ) : event;
	},

	special: {
		load: {
			// Prevent triggered image.load events from bubbling to window.load
			noBubble: true
		},

		focus: {
			delegateType: "focusin"
		},
		blur: {
			delegateType: "focusout"
		},

		beforeunload: {
			setup: function( data, namespaces, eventHandle ) {
				// We only want to do this special case on windows
				if ( jQuery.isWindow( this ) ) {
					this.onbeforeunload = eventHandle;
				}
			},

			teardown: function( namespaces, eventHandle ) {
				if ( this.onbeforeunload === eventHandle ) {
					this.onbeforeunload = null;
				}
			}
		}
	},

	simulate: function( type, elem, event, bubble ) {
		// Piggyback on a donor event to simulate a different one.
		// Fake originalEvent to avoid donor's stopPropagation, but if the
		// simulated event prevents default then we do the same on the donor.
		var e = jQuery.extend(
			new jQuery.Event(),
			event,
			{ type: type,
				isSimulated: true,
				originalEvent: {}
			}
		);
		if ( bubble ) {
			jQuery.event.trigger( e, null, elem );
		} else {
			jQuery.event.dispatch.call( elem, e );
		}
		if ( e.isDefaultPrevented() ) {
			event.preventDefault();
		}
	}
};

// Some plugins are using, but it's undocumented/deprecated and will be removed.
// The 1.7 special event interface should provide all the hooks needed now.
jQuery.event.handle = jQuery.event.dispatch;

jQuery.removeEvent = document.removeEventListener ?
	function( elem, type, handle ) {
		if ( elem.removeEventListener ) {
			elem.removeEventListener( type, handle, false );
		}
	} :
	function( elem, type, handle ) {
		var name = "on" + type;

		if ( elem.detachEvent ) {

			// #8545, #7054, preventing memory leaks for custom events in IE6-8
			// detachEvent needed property on element, by name of that event, to properly expose it to GC
			if ( typeof elem[ name ] === "undefined" ) {
				elem[ name ] = null;
			}

			elem.detachEvent( name, handle );
		}
	};

jQuery.Event = function( src, props ) {
	// Allow instantiation without the 'new' keyword
	if ( !(this instanceof jQuery.Event) ) {
		return new jQuery.Event( src, props );
	}

	// Event object
	if ( src && src.type ) {
		this.originalEvent = src;
		this.type = src.type;

		// Events bubbling up the document may have been marked as prevented
		// by a handler lower down the tree; reflect the correct value.
		this.isDefaultPrevented = ( src.defaultPrevented || src.returnValue === false ||
			src.getPreventDefault && src.getPreventDefault() ) ? returnTrue : returnFalse;

	// Event type
	} else {
		this.type = src;
	}

	// Put explicitly provided properties onto the event object
	if ( props ) {
		jQuery.extend( this, props );
	}

	// Create a timestamp if incoming event doesn't have one
	this.timeStamp = src && src.timeStamp || jQuery.now();

	// Mark it as fixed
	this[ jQuery.expando ] = true;
};

function returnFalse() {
	return false;
}
function returnTrue() {
	return true;
}

// jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding
// http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html
jQuery.Event.prototype = {
	preventDefault: function() {
		this.isDefaultPrevented = returnTrue;

		var e = this.originalEvent;
		if ( !e ) {
			return;
		}

		// if preventDefault exists run it on the original event
		if ( e.preventDefault ) {
			e.preventDefault();

		// otherwise set the returnValue property of the original event to false (IE)
		} else {
			e.returnValue = false;
		}
	},
	stopPropagation: function() {
		this.isPropagationStopped = returnTrue;

		var e = this.originalEvent;
		if ( !e ) {
			return;
		}
		// if stopPropagation exists run it on the original event
		if ( e.stopPropagation ) {
			e.stopPropagation();
		}
		// otherwise set the cancelBubble property of the original event to true (IE)
		e.cancelBubble = true;
	},
	stopImmediatePropagation: function() {
		this.isImmediatePropagationStopped = returnTrue;
		this.stopPropagation();
	},
	isDefaultPrevented: returnFalse,
	isPropagationStopped: returnFalse,
	isImmediatePropagationStopped: returnFalse
};

// Create mouseenter/leave events using mouseover/out and event-time checks
jQuery.each({
	mouseenter: "mouseover",
	mouseleave: "mouseout"
}, function( orig, fix ) {
	jQuery.event.special[ orig ] = {
		delegateType: fix,
		bindType: fix,

		handle: function( event ) {
			var ret,
				target = this,
				related = event.relatedTarget,
				handleObj = event.handleObj,
				selector = handleObj.selector;

			// For mousenter/leave call the handler if related is outside the target.
			// NB: No relatedTarget if the mouse left/entered the browser window
			if ( !related || (related !== target && !jQuery.contains( target, related )) ) {
				event.type = handleObj.origType;
				ret = handleObj.handler.apply( this, arguments );
				event.type = fix;
			}
			return ret;
		}
	};
});

// IE submit delegation
if ( !jQuery.support.submitBubbles ) {

	jQuery.event.special.submit = {
		setup: function() {
			// Only need this for delegated form submit events
			if ( jQuery.nodeName( this, "form" ) ) {
				return false;
			}

			// Lazy-add a submit handler when a descendant form may potentially be submitted
			jQuery.event.add( this, "click._submit keypress._submit", function( e ) {
				// Node name check avoids a VML-related crash in IE (#9807)
				var elem = e.target,
					form = jQuery.nodeName( elem, "input" ) || jQuery.nodeName( elem, "button" ) ? elem.form : undefined;
				if ( form && !jQuery._data( form, "_submit_attached" ) ) {
					jQuery.event.add( form, "submit._submit", function( event ) {
						event._submit_bubble = true;
					});
					jQuery._data( form, "_submit_attached", true );
				}
			});
			// return undefined since we don't need an event listener
		},

		postDispatch: function( event ) {
			// If form was submitted by the user, bubble the event up the tree
			if ( event._submit_bubble ) {
				delete event._submit_bubble;
				if ( this.parentNode && !event.isTrigger ) {
					jQuery.event.simulate( "submit", this.parentNode, event, true );
				}
			}
		},

		teardown: function() {
			// Only need this for delegated form submit events
			if ( jQuery.nodeName( this, "form" ) ) {
				return false;
			}

			// Remove delegated handlers; cleanData eventually reaps submit handlers attached above
			jQuery.event.remove( this, "._submit" );
		}
	};
}

// IE change delegation and checkbox/radio fix
if ( !jQuery.support.changeBubbles ) {

	jQuery.event.special.change = {

		setup: function() {

			if ( rformElems.test( this.nodeName ) ) {
				// IE doesn't fire change on a check/radio until blur; trigger it on click
				// after a propertychange. Eat the blur-change in special.change.handle.
				// This still fires onchange a second time for check/radio after blur.
				if ( this.type === "checkbox" || this.type === "radio" ) {
					jQuery.event.add( this, "propertychange._change", function( event ) {
						if ( event.originalEvent.propertyName === "checked" ) {
							this._just_changed = true;
						}
					});
					jQuery.event.add( this, "click._change", function( event ) {
						if ( this._just_changed && !event.isTrigger ) {
							this._just_changed = false;
						}
						// Allow triggered, simulated change events (#11500)
						jQuery.event.simulate( "change", this, event, true );
					});
				}
				return false;
			}
			// Delegated event; lazy-add a change handler on descendant inputs
			jQuery.event.add( this, "beforeactivate._change", function( e ) {
				var elem = e.target;

				if ( rformElems.test( elem.nodeName ) && !jQuery._data( elem, "_change_attached" ) ) {
					jQuery.event.add( elem, "change._change", function( event ) {
						if ( this.parentNode && !event.isSimulated && !event.isTrigger ) {
							jQuery.event.simulate( "change", this.parentNode, event, true );
						}
					});
					jQuery._data( elem, "_change_attached", true );
				}
			});
		},

		handle: function( event ) {
			var elem = event.target;

			// Swallow native change events from checkbox/radio, we already triggered them above
			if ( this !== elem || event.isSimulated || event.isTrigger || (elem.type !== "radio" && elem.type !== "checkbox") ) {
				return event.handleObj.handler.apply( this, arguments );
			}
		},

		teardown: function() {
			jQuery.event.remove( this, "._change" );

			return !rformElems.test( this.nodeName );
		}
	};
}

// Create "bubbling" focus and blur events
if ( !jQuery.support.focusinBubbles ) {
	jQuery.each({ focus: "focusin", blur: "focusout" }, function( orig, fix ) {

		// Attach a single capturing handler while someone wants focusin/focusout
		var attaches = 0,
			handler = function( event ) {
				jQuery.event.simulate( fix, event.target, jQuery.event.fix( event ), true );
			};

		jQuery.event.special[ fix ] = {
			setup: function() {
				if ( attaches++ === 0 ) {
					document.addEventListener( orig, handler, true );
				}
			},
			teardown: function() {
				if ( --attaches === 0 ) {
					document.removeEventListener( orig, handler, true );
				}
			}
		};
	});
}

jQuery.fn.extend({

	on: function( types, selector, data, fn, /*INTERNAL*/ one ) {
		var origFn, type;

		// Types can be a map of types/handlers
		if ( typeof types === "object" ) {
			// ( types-Object, selector, data )
			if ( typeof selector !== "string" ) { // && selector != null
				// ( types-Object, data )
				data = data || selector;
				selector = undefined;
			}
			for ( type in types ) {
				this.on( type, selector, data, types[ type ], one );
			}
			return this;
		}

		if ( data == null && fn == null ) {
			// ( types, fn )
			fn = selector;
			data = selector = undefined;
		} else if ( fn == null ) {
			if ( typeof selector === "string" ) {
				// ( types, selector, fn )
				fn = data;
				data = undefined;
			} else {
				// ( types, data, fn )
				fn = data;
				data = selector;
				selector = undefined;
			}
		}
		if ( fn === false ) {
			fn = returnFalse;
		} else if ( !fn ) {
			return this;
		}

		if ( one === 1 ) {
			origFn = fn;
			fn = function( event ) {
				// Can use an empty set, since event contains the info
				jQuery().off( event );
				return origFn.apply( this, arguments );
			};
			// Use same guid so caller can remove using origFn
			fn.guid = origFn.guid || ( origFn.guid = jQuery.guid++ );
		}
		return this.each( function() {
			jQuery.event.add( this, types, fn, data, selector );
		});
	},
	one: function( types, selector, data, fn ) {
		return this.on( types, selector, data, fn, 1 );
	},
	off: function( types, selector, fn ) {
		var handleObj, type;
		if ( types && types.preventDefault && types.handleObj ) {
			// ( event )  dispatched jQuery.Event
			handleObj = types.handleObj;
			jQuery( types.delegateTarget ).off(
				handleObj.namespace ? handleObj.origType + "." + handleObj.namespace : handleObj.origType,
				handleObj.selector,
				handleObj.handler
			);
			return this;
		}
		if ( typeof types === "object" ) {
			// ( types-object [, selector] )
			for ( type in types ) {
				this.off( type, selector, types[ type ] );
			}
			return this;
		}
		if ( selector === false || typeof selector === "function" ) {
			// ( types [, fn] )
			fn = selector;
			selector = undefined;
		}
		if ( fn === false ) {
			fn = returnFalse;
		}
		return this.each(function() {
			jQuery.event.remove( this, types, fn, selector );
		});
	},

	bind: function( types, data, fn ) {
		return this.on( types, null, data, fn );
	},
	unbind: function( types, fn ) {
		return this.off( types, null, fn );
	},

	live: function( types, data, fn ) {
		jQuery( this.context ).on( types, this.selector, data, fn );
		return this;
	},
	die: function( types, fn ) {
		jQuery( this.context ).off( types, this.selector || "**", fn );
		return this;
	},

	delegate: function( selector, types, data, fn ) {
		return this.on( types, selector, data, fn );
	},
	undelegate: function( selector, types, fn ) {
		// ( namespace ) or ( selector, types [, fn] )
		return arguments.length === 1 ? this.off( selector, "**" ) : this.off( types, selector || "**", fn );
	},

	trigger: function( type, data ) {
		return this.each(function() {
			jQuery.event.trigger( type, data, this );
		});
	},
	triggerHandler: function( type, data ) {
		if ( this[0] ) {
			return jQuery.event.trigger( type, data, this[0], true );
		}
	},

	toggle: function( fn ) {
		// Save reference to arguments for access in closure
		var args = arguments,
			guid = fn.guid || jQuery.guid++,
			i = 0,
			toggler = function( event ) {
				// Figure out which function to execute
				var lastToggle = ( jQuery._data( this, "lastToggle" + fn.guid ) || 0 ) % i;
				jQuery._data( this, "lastToggle" + fn.guid, lastToggle + 1 );

				// Make sure that clicks stop
				event.preventDefault();

				// and execute the function
				return args[ lastToggle ].apply( this, arguments ) || false;
			};

		// link all the functions, so any of them can unbind this click handler
		toggler.guid = guid;
		while ( i < args.length ) {
			args[ i++ ].guid = guid;
		}

		return this.click( toggler );
	},

	hover: function( fnOver, fnOut ) {
		return this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );
	}
});

jQuery.each( ("blur focus focusin focusout load resize scroll unload click dblclick " +
	"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " +
	"change select submit keydown keypress keyup error contextmenu").split(" "), function( i, name ) {

	// Handle event binding
	jQuery.fn[ name ] = function( data, fn ) {
		if ( fn == null ) {
			fn = data;
			data = null;
		}

		return arguments.length > 0 ?
			this.on( name, null, data, fn ) :
			this.trigger( name );
	};

	if ( rkeyEvent.test( name ) ) {
		jQuery.event.fixHooks[ name ] = jQuery.event.keyHooks;
	}

	if ( rmouseEvent.test( name ) ) {
		jQuery.event.fixHooks[ name ] = jQuery.event.mouseHooks;
	}
});
/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */
(function( window, undefined ) {

var cachedruns,
	assertGetIdNotName,
	Expr,
	getText,
	isXML,
	contains,
	compile,
	sortOrder,
	hasDuplicate,
	outermostContext,

	baseHasDuplicate = true,
	strundefined = "undefined",

	expando = ( "sizcache" + Math.random() ).replace( ".", "" ),

	Token = String,
	document = window.document,
	docElem = document.documentElement,
	dirruns = 0,
	done = 0,
	pop = [].pop,
	push = [].push,
	slice = [].slice,
	// Use a stripped-down indexOf if a native one is unavailable
	indexOf = [].indexOf || function( elem ) {
		var i = 0,
			len = this.length;
		for ( ; i < len; i++ ) {
			if ( this[i] === elem ) {
				return i;
			}
		}
		return -1;
	},

	// Augment a function for special use by Sizzle
	markFunction = function( fn, value ) {
		fn[ expando ] = value == null || value;
		return fn;
	},

	createCache = function() {
		var cache = {},
			keys = [];

		return markFunction(function( key, value ) {
			// Only keep the most recent entries
			if ( keys.push( key ) > Expr.cacheLength ) {
				delete cache[ keys.shift() ];
			}

			// Retrieve with (key + " ") to avoid collision with native Object.prototype properties (see Issue #157)
			return (cache[ key + " " ] = value);
		}, cache );
	},

	classCache = createCache(),
	tokenCache = createCache(),
	compilerCache = createCache(),

	// Regex

	// Whitespace characters http://www.w3.org/TR/css3-selectors/#whitespace
	whitespace = "[\\x20\\t\\r\\n\\f]",
	// http://www.w3.org/TR/css3-syntax/#characters
	characterEncoding = "(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",

	// Loosely modeled on CSS identifier characters
	// An unquoted value should be a CSS identifier (http://www.w3.org/TR/css3-selectors/#attribute-selectors)
	// Proper syntax: http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier
	identifier = characterEncoding.replace( "w", "w#" ),

	// Acceptable operators http://www.w3.org/TR/selectors/#attribute-selectors
	operators = "([*^$|!~]?=)",
	attributes = "\\[" + whitespace + "*(" + characterEncoding + ")" + whitespace +
		"*(?:" + operators + whitespace + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + identifier + ")|)|)" + whitespace + "*\\]",

	// Prefer arguments not in parens/brackets,
	//   then attribute selectors and non-pseudos (denoted by :),
	//   then anything else
	// These preferences are here to reduce the number of selectors
	//   needing tokenize in the PSEUDO preFilter
	pseudos = ":(" + characterEncoding + ")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:" + attributes + ")|[^:]|\\\\.)*|.*))\\)|)",

	// For matchExpr.POS and matchExpr.needsContext
	pos = ":(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + whitespace +
		"*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)",

	// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
	rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),

	rcomma = new RegExp( "^" + whitespace + "*," + whitespace + "*" ),
	rcombinators = new RegExp( "^" + whitespace + "*([\\x20\\t\\r\\n\\f>+~])" + whitespace + "*" ),
	rpseudo = new RegExp( pseudos ),

	// Easily-parseable/retrievable ID or TAG or CLASS selectors
	rquickExpr = /^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,

	rnot = /^:not/,
	rsibling = /[\x20\t\r\n\f]*[+~]/,
	rendsWithNot = /:not\($/,

	rheader = /h\d/i,
	rinputs = /input|select|textarea|button/i,

	rbackslash = /\\(?!\\)/g,

	matchExpr = {
		"ID": new RegExp( "^#(" + characterEncoding + ")" ),
		"CLASS": new RegExp( "^\\.(" + characterEncoding + ")" ),
		"NAME": new RegExp( "^\\[name=['\"]?(" + characterEncoding + ")['\"]?\\]" ),
		"TAG": new RegExp( "^(" + characterEncoding.replace( "w", "w*" ) + ")" ),
		"ATTR": new RegExp( "^" + attributes ),
		"PSEUDO": new RegExp( "^" + pseudos ),
		"POS": new RegExp( pos, "i" ),
		"CHILD": new RegExp( "^:(only|nth|first|last)-child(?:\\(" + whitespace +
			"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
			"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
		// For use in libraries implementing .is()
		"needsContext": new RegExp( "^" + whitespace + "*[>+~]|" + pos, "i" )
	},

	// Support

	// Used for testing something on an element
	assert = function( fn ) {
		var div = document.createElement("div");

		try {
			return fn( div );
		} catch (e) {
			return false;
		} finally {
			// release memory in IE
			div = null;
		}
	},

	// Check if getElementsByTagName("*") returns only elements
	assertTagNameNoComments = assert(function( div ) {
		div.appendChild( document.createComment("") );
		return !div.getElementsByTagName("*").length;
	}),

	// Check if getAttribute returns normalized href attributes
	assertHrefNotNormalized = assert(function( div ) {
		div.innerHTML = "<a href='#'></a>";
		return div.firstChild && typeof div.firstChild.getAttribute !== strundefined &&
			div.firstChild.getAttribute("href") === "#";
	}),

	// Check if attributes should be retrieved by attribute nodes
	assertAttributes = assert(function( div ) {
		div.innerHTML = "<select></select>";
		var type = typeof div.lastChild.getAttribute("multiple");
		// IE8 returns a string for some attributes even when not present
		return type !== "boolean" && type !== "string";
	}),

	// Check if getElementsByClassName can be trusted
	assertUsableClassName = assert(function( div ) {
		// Opera can't find a second classname (in 9.6)
		div.innerHTML = "<div class='hidden e'></div><div class='hidden'></div>";
		if ( !div.getElementsByClassName || !div.getElementsByClassName("e").length ) {
			return false;
		}

		// Safari 3.2 caches class attributes and doesn't catch changes
		div.lastChild.className = "e";
		return div.getElementsByClassName("e").length === 2;
	}),

	// Check if getElementById returns elements by name
	// Check if getElementsByName privileges form controls or returns elements by ID
	assertUsableName = assert(function( div ) {
		// Inject content
		div.id = expando + 0;
		div.innerHTML = "<a name='" + expando + "'></a><div name='" + expando + "'></div>";
		docElem.insertBefore( div, docElem.firstChild );

		// Test
		var pass = document.getElementsByName &&
			// buggy browsers will return fewer than the correct 2
			document.getElementsByName( expando ).length === 2 +
			// buggy browsers will return more than the correct 0
			document.getElementsByName( expando + 0 ).length;
		assertGetIdNotName = !document.getElementById( expando );

		// Cleanup
		docElem.removeChild( div );

		return pass;
	});

// If slice is not available, provide a backup
try {
	slice.call( docElem.childNodes, 0 )[0].nodeType;
} catch ( e ) {
	slice = function( i ) {
		var elem,
			results = [];
		for ( ; (elem = this[i]); i++ ) {
			results.push( elem );
		}
		return results;
	};
}

function Sizzle( selector, context, results, seed ) {
	results = results || [];
	context = context || document;
	var match, elem, xml, m,
		nodeType = context.nodeType;

	if ( !selector || typeof selector !== "string" ) {
		return results;
	}

	if ( nodeType !== 1 && nodeType !== 9 ) {
		return [];
	}

	xml = isXML( context );

	if ( !xml && !seed ) {
		if ( (match = rquickExpr.exec( selector )) ) {
			// Speed-up: Sizzle("#ID")
			if ( (m = match[1]) ) {
				if ( nodeType === 9 ) {
					elem = context.getElementById( m );
					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					if ( elem && elem.parentNode ) {
						// Handle the case where IE, Opera, and Webkit return items
						// by name instead of ID
						if ( elem.id === m ) {
							results.push( elem );
							return results;
						}
					} else {
						return results;
					}
				} else {
					// Context is not a document
					if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&
						contains( context, elem ) && elem.id === m ) {
						results.push( elem );
						return results;
					}
				}

			// Speed-up: Sizzle("TAG")
			} else if ( match[2] ) {
				push.apply( results, slice.call(context.getElementsByTagName( selector ), 0) );
				return results;

			// Speed-up: Sizzle(".CLASS")
			} else if ( (m = match[3]) && assertUsableClassName && context.getElementsByClassName ) {
				push.apply( results, slice.call(context.getElementsByClassName( m ), 0) );
				return results;
			}
		}
	}

	// All others
	return select( selector.replace( rtrim, "$1" ), context, results, seed, xml );
}

Sizzle.matches = function( expr, elements ) {
	return Sizzle( expr, null, null, elements );
};

Sizzle.matchesSelector = function( elem, expr ) {
	return Sizzle( expr, null, null, [ elem ] ).length > 0;
};

// Returns a function to use in pseudos for input types
function createInputPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return name === "input" && elem.type === type;
	};
}

// Returns a function to use in pseudos for buttons
function createButtonPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return (name === "input" || name === "button") && elem.type === type;
	};
}

// Returns a function to use in pseudos for positionals
function createPositionalPseudo( fn ) {
	return markFunction(function( argument ) {
		argument = +argument;
		return markFunction(function( seed, matches ) {
			var j,
				matchIndexes = fn( [], seed.length, argument ),
				i = matchIndexes.length;

			// Match elements found at the specified indexes
			while ( i-- ) {
				if ( seed[ (j = matchIndexes[i]) ] ) {
					seed[j] = !(matches[j] = seed[j]);
				}
			}
		});
	});
}

/**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( nodeType ) {
		if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
			// Use textContent for elements
			// innerText usage removed for consistency of new lines (see #11153)
			if ( typeof elem.textContent === "string" ) {
				return elem.textContent;
			} else {
				// Traverse its children
				for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
					ret += getText( elem );
				}
			}
		} else if ( nodeType === 3 || nodeType === 4 ) {
			return elem.nodeValue;
		}
		// Do not include comment or processing instruction nodes
	} else {

		// If no nodeType, this is expected to be an array
		for ( ; (node = elem[i]); i++ ) {
			// Do not traverse comment nodes
			ret += getText( node );
		}
	}
	return ret;
};

isXML = Sizzle.isXML = function( elem ) {
	// documentElement is verified for cases where it doesn't yet exist
	// (such as loading iframes in IE - #4833)
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};

// Element contains another
contains = Sizzle.contains = docElem.contains ?
	function( a, b ) {
		var adown = a.nodeType === 9 ? a.documentElement : a,
			bup = b && b.parentNode;
		return a === bup || !!( bup && bup.nodeType === 1 && adown.contains && adown.contains(bup) );
	} :
	docElem.compareDocumentPosition ?
	function( a, b ) {
		return b && !!( a.compareDocumentPosition( b ) & 16 );
	} :
	function( a, b ) {
		while ( (b = b.parentNode) ) {
			if ( b === a ) {
				return true;
			}
		}
		return false;
	};

Sizzle.attr = function( elem, name ) {
	var val,
		xml = isXML( elem );

	if ( !xml ) {
		name = name.toLowerCase();
	}
	if ( (val = Expr.attrHandle[ name ]) ) {
		return val( elem );
	}
	if ( xml || assertAttributes ) {
		return elem.getAttribute( name );
	}
	val = elem.getAttributeNode( name );
	return val ?
		typeof elem[ name ] === "boolean" ?
			elem[ name ] ? name : null :
			val.specified ? val.value : null :
		null;
};

Expr = Sizzle.selectors = {

	// Can be adjusted by the user
	cacheLength: 50,

	createPseudo: markFunction,

	match: matchExpr,

	// IE6/7 return a modified href
	attrHandle: assertHrefNotNormalized ?
		{} :
		{
			"href": function( elem ) {
				return elem.getAttribute( "href", 2 );
			},
			"type": function( elem ) {
				return elem.getAttribute("type");
			}
		},

	find: {
		"ID": assertGetIdNotName ?
			function( id, context, xml ) {
				if ( typeof context.getElementById !== strundefined && !xml ) {
					var m = context.getElementById( id );
					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					return m && m.parentNode ? [m] : [];
				}
			} :
			function( id, context, xml ) {
				if ( typeof context.getElementById !== strundefined && !xml ) {
					var m = context.getElementById( id );

					return m ?
						m.id === id || typeof m.getAttributeNode !== strundefined && m.getAttributeNode("id").value === id ?
							[m] :
							undefined :
						[];
				}
			},

		"TAG": assertTagNameNoComments ?
			function( tag, context ) {
				if ( typeof context.getElementsByTagName !== strundefined ) {
					return context.getElementsByTagName( tag );
				}
			} :
			function( tag, context ) {
				var results = context.getElementsByTagName( tag );

				// Filter out possible comments
				if ( tag === "*" ) {
					var elem,
						tmp = [],
						i = 0;

					for ( ; (elem = results[i]); i++ ) {
						if ( elem.nodeType === 1 ) {
							tmp.push( elem );
						}
					}

					return tmp;
				}
				return results;
			},

		"NAME": assertUsableName && function( tag, context ) {
			if ( typeof context.getElementsByName !== strundefined ) {
				return context.getElementsByName( name );
			}
		},

		"CLASS": assertUsableClassName && function( className, context, xml ) {
			if ( typeof context.getElementsByClassName !== strundefined && !xml ) {
				return context.getElementsByClassName( className );
			}
		}
	},

	relative: {
		">": { dir: "parentNode", first: true },
		" ": { dir: "parentNode" },
		"+": { dir: "previousSibling", first: true },
		"~": { dir: "previousSibling" }
	},

	preFilter: {
		"ATTR": function( match ) {
			match[1] = match[1].replace( rbackslash, "" );

			// Move the given value to match[3] whether quoted or unquoted
			match[3] = ( match[4] || match[5] || "" ).replace( rbackslash, "" );

			if ( match[2] === "~=" ) {
				match[3] = " " + match[3] + " ";
			}

			return match.slice( 0, 4 );
		},

		"CHILD": function( match ) {
			/* matches from matchExpr["CHILD"]
				1 type (only|nth|...)
				2 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				3 xn-component of xn+y argument ([+-]?\d*n|)
				4 sign of xn-component
				5 x of xn-component
				6 sign of y-component
				7 y of y-component
			*/
			match[1] = match[1].toLowerCase();

			if ( match[1] === "nth" ) {
				// nth-child requires argument
				if ( !match[2] ) {
					Sizzle.error( match[0] );
				}

				// numeric x and y parameters for Expr.filter.CHILD
				// remember that false/true cast respectively to 0/1
				match[3] = +( match[3] ? match[4] + (match[5] || 1) : 2 * ( match[2] === "even" || match[2] === "odd" ) );
				match[4] = +( ( match[6] + match[7] ) || match[2] === "odd" );

			// other types prohibit arguments
			} else if ( match[2] ) {
				Sizzle.error( match[0] );
			}

			return match;
		},

		"PSEUDO": function( match ) {
			var unquoted, excess;
			if ( matchExpr["CHILD"].test( match[0] ) ) {
				return null;
			}

			if ( match[3] ) {
				match[2] = match[3];
			} else if ( (unquoted = match[4]) ) {
				// Only check arguments that contain a pseudo
				if ( rpseudo.test(unquoted) &&
					// Get excess from tokenize (recursively)
					(excess = tokenize( unquoted, true )) &&
					// advance to the next closing parenthesis
					(excess = unquoted.indexOf( ")", unquoted.length - excess ) - unquoted.length) ) {

					// excess is a negative index
					unquoted = unquoted.slice( 0, excess );
					match[0] = match[0].slice( 0, excess );
				}
				match[2] = unquoted;
			}

			// Return only captures needed by the pseudo filter method (type and argument)
			return match.slice( 0, 3 );
		}
	},

	filter: {
		"ID": assertGetIdNotName ?
			function( id ) {
				id = id.replace( rbackslash, "" );
				return function( elem ) {
					return elem.getAttribute("id") === id;
				};
			} :
			function( id ) {
				id = id.replace( rbackslash, "" );
				return function( elem ) {
					var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode("id");
					return node && node.value === id;
				};
			},

		"TAG": function( nodeName ) {
			if ( nodeName === "*" ) {
				return function() { return true; };
			}
			nodeName = nodeName.replace( rbackslash, "" ).toLowerCase();

			return function( elem ) {
				return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
			};
		},

		"CLASS": function( className ) {
			var pattern = classCache[ expando ][ className + " " ];

			return pattern ||
				(pattern = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" )) &&
				classCache( className, function( elem ) {
					return pattern.test( elem.className || (typeof elem.getAttribute !== strundefined && elem.getAttribute("class")) || "" );
				});
		},

		"ATTR": function( name, operator, check ) {
			return function( elem, context ) {
				var result = Sizzle.attr( elem, name );

				if ( result == null ) {
					return operator === "!=";
				}
				if ( !operator ) {
					return true;
				}

				result += "";

				return operator === "=" ? result === check :
					operator === "!=" ? result !== check :
					operator === "^=" ? check && result.indexOf( check ) === 0 :
					operator === "*=" ? check && result.indexOf( check ) > -1 :
					operator === "$=" ? check && result.substr( result.length - check.length ) === check :
					operator === "~=" ? ( " " + result + " " ).indexOf( check ) > -1 :
					operator === "|=" ? result === check || result.substr( 0, check.length + 1 ) === check + "-" :
					false;
			};
		},

		"CHILD": function( type, argument, first, last ) {

			if ( type === "nth" ) {
				return function( elem ) {
					var node, diff,
						parent = elem.parentNode;

					if ( first === 1 && last === 0 ) {
						return true;
					}

					if ( parent ) {
						diff = 0;
						for ( node = parent.firstChild; node; node = node.nextSibling ) {
							if ( node.nodeType === 1 ) {
								diff++;
								if ( elem === node ) {
									break;
								}
							}
						}
					}

					// Incorporate the offset (or cast to NaN), then check against cycle size
					diff -= last;
					return diff === first || ( diff % first === 0 && diff / first >= 0 );
				};
			}

			return function( elem ) {
				var node = elem;

				switch ( type ) {
					case "only":
					case "first":
						while ( (node = node.previousSibling) ) {
							if ( node.nodeType === 1 ) {
								return false;
							}
						}

						if ( type === "first" ) {
							return true;
						}

						node = elem;

						/* falls through */
					case "last":
						while ( (node = node.nextSibling) ) {
							if ( node.nodeType === 1 ) {
								return false;
							}
						}

						return true;
				}
			};
		},

		"PSEUDO": function( pseudo, argument ) {
			// pseudo-class names are case-insensitive
			// http://www.w3.org/TR/selectors/#pseudo-classes
			// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
			// Remember that setFilters inherits from pseudos
			var args,
				fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||
					Sizzle.error( "unsupported pseudo: " + pseudo );

			// The user may use createPseudo to indicate that
			// arguments are needed to create the filter function
			// just as Sizzle does
			if ( fn[ expando ] ) {
				return fn( argument );
			}

			// But maintain support for old signatures
			if ( fn.length > 1 ) {
				args = [ pseudo, pseudo, "", argument ];
				return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?
					markFunction(function( seed, matches ) {
						var idx,
							matched = fn( seed, argument ),
							i = matched.length;
						while ( i-- ) {
							idx = indexOf.call( seed, matched[i] );
							seed[ idx ] = !( matches[ idx ] = matched[i] );
						}
					}) :
					function( elem ) {
						return fn( elem, 0, args );
					};
			}

			return fn;
		}
	},

	pseudos: {
		"not": markFunction(function( selector ) {
			// Trim the selector passed to compile
			// to avoid treating leading and trailing
			// spaces as combinators
			var input = [],
				results = [],
				matcher = compile( selector.replace( rtrim, "$1" ) );

			return matcher[ expando ] ?
				markFunction(function( seed, matches, context, xml ) {
					var elem,
						unmatched = matcher( seed, null, xml, [] ),
						i = seed.length;

					// Match elements unmatched by `matcher`
					while ( i-- ) {
						if ( (elem = unmatched[i]) ) {
							seed[i] = !(matches[i] = elem);
						}
					}
				}) :
				function( elem, context, xml ) {
					input[0] = elem;
					matcher( input, null, xml, results );
					return !results.pop();
				};
		}),

		"has": markFunction(function( selector ) {
			return function( elem ) {
				return Sizzle( selector, elem ).length > 0;
			};
		}),

		"contains": markFunction(function( text ) {
			return function( elem ) {
				return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
			};
		}),

		"enabled": function( elem ) {
			return elem.disabled === false;
		},

		"disabled": function( elem ) {
			return elem.disabled === true;
		},

		"checked": function( elem ) {
			// In CSS3, :checked should return both checked and selected elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			var nodeName = elem.nodeName.toLowerCase();
			return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
		},

		"selected": function( elem ) {
			// Accessing this property makes selected-by-default
			// options in Safari work properly
			if ( elem.parentNode ) {
				elem.parentNode.selectedIndex;
			}

			return elem.selected === true;
		},

		"parent": function( elem ) {
			return !Expr.pseudos["empty"]( elem );
		},

		"empty": function( elem ) {
			// http://www.w3.org/TR/selectors/#empty-pseudo
			// :empty is only affected by element nodes and content nodes(including text(3), cdata(4)),
			//   not comment, processing instructions, or others
			// Thanks to Diego Perini for the nodeName shortcut
			//   Greater than "@" means alpha characters (specifically not starting with "#" or "?")
			var nodeType;
			elem = elem.firstChild;
			while ( elem ) {
				if ( elem.nodeName > "@" || (nodeType = elem.nodeType) === 3 || nodeType === 4 ) {
					return false;
				}
				elem = elem.nextSibling;
			}
			return true;
		},

		"header": function( elem ) {
			return rheader.test( elem.nodeName );
		},

		"text": function( elem ) {
			var type, attr;
			// IE6 and 7 will map elem.type to 'text' for new HTML5 types (search, etc)
			// use getAttribute instead to test this case
			return elem.nodeName.toLowerCase() === "input" &&
				(type = elem.type) === "text" &&
				( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === type );
		},

		// Input types
		"radio": createInputPseudo("radio"),
		"checkbox": createInputPseudo("checkbox"),
		"file": createInputPseudo("file"),
		"password": createInputPseudo("password"),
		"image": createInputPseudo("image"),

		"submit": createButtonPseudo("submit"),
		"reset": createButtonPseudo("reset"),

		"button": function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === "button" || name === "button";
		},

		"input": function( elem ) {
			return rinputs.test( elem.nodeName );
		},

		"focus": function( elem ) {
			var doc = elem.ownerDocument;
			return elem === doc.activeElement && (!doc.hasFocus || doc.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
		},

		"active": function( elem ) {
			return elem === elem.ownerDocument.activeElement;
		},

		// Positional types
		"first": createPositionalPseudo(function() {
			return [ 0 ];
		}),

		"last": createPositionalPseudo(function( matchIndexes, length ) {
			return [ length - 1 ];
		}),

		"eq": createPositionalPseudo(function( matchIndexes, length, argument ) {
			return [ argument < 0 ? argument + length : argument ];
		}),

		"even": createPositionalPseudo(function( matchIndexes, length ) {
			for ( var i = 0; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"odd": createPositionalPseudo(function( matchIndexes, length ) {
			for ( var i = 1; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"lt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			for ( var i = argument < 0 ? argument + length : argument; --i >= 0; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"gt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			for ( var i = argument < 0 ? argument + length : argument; ++i < length; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		})
	}
};

function siblingCheck( a, b, ret ) {
	if ( a === b ) {
		return ret;
	}

	var cur = a.nextSibling;

	while ( cur ) {
		if ( cur === b ) {
			return -1;
		}

		cur = cur.nextSibling;
	}

	return 1;
}

sortOrder = docElem.compareDocumentPosition ?
	function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		return ( !a.compareDocumentPosition || !b.compareDocumentPosition ?
			a.compareDocumentPosition :
			a.compareDocumentPosition(b) & 4
		) ? -1 : 1;
	} :
	function( a, b ) {
		// The nodes are identical, we can exit early
		if ( a === b ) {
			hasDuplicate = true;
			return 0;

		// Fallback to using sourceIndex (in IE) if it's available on both nodes
		} else if ( a.sourceIndex && b.sourceIndex ) {
			return a.sourceIndex - b.sourceIndex;
		}

		var al, bl,
			ap = [],
			bp = [],
			aup = a.parentNode,
			bup = b.parentNode,
			cur = aup;

		// If the nodes are siblings (or identical) we can do a quick check
		if ( aup === bup ) {
			return siblingCheck( a, b );

		// If no parents were found then the nodes are disconnected
		} else if ( !aup ) {
			return -1;

		} else if ( !bup ) {
			return 1;
		}

		// Otherwise they're somewhere else in the tree so we need
		// to build up a full list of the parentNodes for comparison
		while ( cur ) {
			ap.unshift( cur );
			cur = cur.parentNode;
		}

		cur = bup;

		while ( cur ) {
			bp.unshift( cur );
			cur = cur.parentNode;
		}

		al = ap.length;
		bl = bp.length;

		// Start walking down the tree looking for a discrepancy
		for ( var i = 0; i < al && i < bl; i++ ) {
			if ( ap[i] !== bp[i] ) {
				return siblingCheck( ap[i], bp[i] );
			}
		}

		// We ended someplace up the tree so do a sibling check
		return i === al ?
			siblingCheck( a, bp[i], -1 ) :
			siblingCheck( ap[i], b, 1 );
	};

// Always assume the presence of duplicates if sort doesn't
// pass them to our comparison function (as in Google Chrome).
[0, 0].sort( sortOrder );
baseHasDuplicate = !hasDuplicate;

// Document sorting and removing duplicates
Sizzle.uniqueSort = function( results ) {
	var elem,
		duplicates = [],
		i = 1,
		j = 0;

	hasDuplicate = baseHasDuplicate;
	results.sort( sortOrder );

	if ( hasDuplicate ) {
		for ( ; (elem = results[i]); i++ ) {
			if ( elem === results[ i - 1 ] ) {
				j = duplicates.push( i );
			}
		}
		while ( j-- ) {
			results.splice( duplicates[ j ], 1 );
		}
	}

	return results;
};

Sizzle.error = function( msg ) {
	throw new Error( "Syntax error, unrecognized expression: " + msg );
};

function tokenize( selector, parseOnly ) {
	var matched, match, tokens, type,
		soFar, groups, preFilters,
		cached = tokenCache[ expando ][ selector + " " ];

	if ( cached ) {
		return parseOnly ? 0 : cached.slice( 0 );
	}

	soFar = selector;
	groups = [];
	preFilters = Expr.preFilter;

	while ( soFar ) {

		// Comma and first run
		if ( !matched || (match = rcomma.exec( soFar )) ) {
			if ( match ) {
				// Don't consume trailing commas as valid
				soFar = soFar.slice( match[0].length ) || soFar;
			}
			groups.push( tokens = [] );
		}

		matched = false;

		// Combinators
		if ( (match = rcombinators.exec( soFar )) ) {
			tokens.push( matched = new Token( match.shift() ) );
			soFar = soFar.slice( matched.length );

			// Cast descendant combinators to space
			matched.type = match[0].replace( rtrim, " " );
		}

		// Filters
		for ( type in Expr.filter ) {
			if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
				(match = preFilters[ type ]( match ))) ) {

				tokens.push( matched = new Token( match.shift() ) );
				soFar = soFar.slice( matched.length );
				matched.type = type;
				matched.matches = match;
			}
		}

		if ( !matched ) {
			break;
		}
	}

	// Return the length of the invalid excess
	// if we're just parsing
	// Otherwise, throw an error or return tokens
	return parseOnly ?
		soFar.length :
		soFar ?
			Sizzle.error( selector ) :
			// Cache the tokens
			tokenCache( selector, groups ).slice( 0 );
}

function addCombinator( matcher, combinator, base ) {
	var dir = combinator.dir,
		checkNonElements = base && combinator.dir === "parentNode",
		doneName = done++;

	return combinator.first ?
		// Check against closest ancestor/preceding element
		function( elem, context, xml ) {
			while ( (elem = elem[ dir ]) ) {
				if ( checkNonElements || elem.nodeType === 1  ) {
					return matcher( elem, context, xml );
				}
			}
		} :

		// Check against all ancestor/preceding elements
		function( elem, context, xml ) {
			// We can't set arbitrary data on XML nodes, so they don't benefit from dir caching
			if ( !xml ) {
				var cache,
					dirkey = dirruns + " " + doneName + " ",
					cachedkey = dirkey + cachedruns;
				while ( (elem = elem[ dir ]) ) {
					if ( checkNonElements || elem.nodeType === 1 ) {
						if ( (cache = elem[ expando ]) === cachedkey ) {
							return elem.sizset;
						} else if ( typeof cache === "string" && cache.indexOf(dirkey) === 0 ) {
							if ( elem.sizset ) {
								return elem;
							}
						} else {
							elem[ expando ] = cachedkey;
							if ( matcher( elem, context, xml ) ) {
								elem.sizset = true;
								return elem;
							}
							elem.sizset = false;
						}
					}
				}
			} else {
				while ( (elem = elem[ dir ]) ) {
					if ( checkNonElements || elem.nodeType === 1 ) {
						if ( matcher( elem, context, xml ) ) {
							return elem;
						}
					}
				}
			}
		};
}

function elementMatcher( matchers ) {
	return matchers.length > 1 ?
		function( elem, context, xml ) {
			var i = matchers.length;
			while ( i-- ) {
				if ( !matchers[i]( elem, context, xml ) ) {
					return false;
				}
			}
			return true;
		} :
		matchers[0];
}

function condense( unmatched, map, filter, context, xml ) {
	var elem,
		newUnmatched = [],
		i = 0,
		len = unmatched.length,
		mapped = map != null;

	for ( ; i < len; i++ ) {
		if ( (elem = unmatched[i]) ) {
			if ( !filter || filter( elem, context, xml ) ) {
				newUnmatched.push( elem );
				if ( mapped ) {
					map.push( i );
				}
			}
		}
	}

	return newUnmatched;
}

function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {
	if ( postFilter && !postFilter[ expando ] ) {
		postFilter = setMatcher( postFilter );
	}
	if ( postFinder && !postFinder[ expando ] ) {
		postFinder = setMatcher( postFinder, postSelector );
	}
	return markFunction(function( seed, results, context, xml ) {
		var temp, i, elem,
			preMap = [],
			postMap = [],
			preexisting = results.length,

			// Get initial elements from seed or context
			elems = seed || multipleContexts( selector || "*", context.nodeType ? [ context ] : context, [] ),

			// Prefilter to get matcher input, preserving a map for seed-results synchronization
			matcherIn = preFilter && ( seed || !selector ) ?
				condense( elems, preMap, preFilter, context, xml ) :
				elems,

			matcherOut = matcher ?
				// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,
				postFinder || ( seed ? preFilter : preexisting || postFilter ) ?

					// ...intermediate processing is necessary
					[] :

					// ...otherwise use results directly
					results :
				matcherIn;

		// Find primary matches
		if ( matcher ) {
			matcher( matcherIn, matcherOut, context, xml );
		}

		// Apply postFilter
		if ( postFilter ) {
			temp = condense( matcherOut, postMap );
			postFilter( temp, [], context, xml );

			// Un-match failing elements by moving them back to matcherIn
			i = temp.length;
			while ( i-- ) {
				if ( (elem = temp[i]) ) {
					matcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);
				}
			}
		}

		if ( seed ) {
			if ( postFinder || preFilter ) {
				if ( postFinder ) {
					// Get the final matcherOut by condensing this intermediate into postFinder contexts
					temp = [];
					i = matcherOut.length;
					while ( i-- ) {
						if ( (elem = matcherOut[i]) ) {
							// Restore matcherIn since elem is not yet a final match
							temp.push( (matcherIn[i] = elem) );
						}
					}
					postFinder( null, (matcherOut = []), temp, xml );
				}

				// Move matched elements from seed to results to keep them synchronized
				i = matcherOut.length;
				while ( i-- ) {
					if ( (elem = matcherOut[i]) &&
						(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {

						seed[temp] = !(results[temp] = elem);
					}
				}
			}

		// Add elements to results, through postFinder if defined
		} else {
			matcherOut = condense(
				matcherOut === results ?
					matcherOut.splice( preexisting, matcherOut.length ) :
					matcherOut
			);
			if ( postFinder ) {
				postFinder( null, results, matcherOut, xml );
			} else {
				push.apply( results, matcherOut );
			}
		}
	});
}

function matcherFromTokens( tokens ) {
	var checkContext, matcher, j,
		len = tokens.length,
		leadingRelative = Expr.relative[ tokens[0].type ],
		implicitRelative = leadingRelative || Expr.relative[" "],
		i = leadingRelative ? 1 : 0,

		// The foundational matcher ensures that elements are reachable from top-level context(s)
		matchContext = addCombinator( function( elem ) {
			return elem === checkContext;
		}, implicitRelative, true ),
		matchAnyContext = addCombinator( function( elem ) {
			return indexOf.call( checkContext, elem ) > -1;
		}, implicitRelative, true ),
		matchers = [ function( elem, context, xml ) {
			return ( !leadingRelative && ( xml || context !== outermostContext ) ) || (
				(checkContext = context).nodeType ?
					matchContext( elem, context, xml ) :
					matchAnyContext( elem, context, xml ) );
		} ];

	for ( ; i < len; i++ ) {
		if ( (matcher = Expr.relative[ tokens[i].type ]) ) {
			matchers = [ addCombinator( elementMatcher( matchers ), matcher ) ];
		} else {
			matcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );

			// Return special upon seeing a positional matcher
			if ( matcher[ expando ] ) {
				// Find the next relative operator (if any) for proper handling
				j = ++i;
				for ( ; j < len; j++ ) {
					if ( Expr.relative[ tokens[j].type ] ) {
						break;
					}
				}
				return setMatcher(
					i > 1 && elementMatcher( matchers ),
					i > 1 && tokens.slice( 0, i - 1 ).join("").replace( rtrim, "$1" ),
					matcher,
					i < j && matcherFromTokens( tokens.slice( i, j ) ),
					j < len && matcherFromTokens( (tokens = tokens.slice( j )) ),
					j < len && tokens.join("")
				);
			}
			matchers.push( matcher );
		}
	}

	return elementMatcher( matchers );
}

function matcherFromGroupMatchers( elementMatchers, setMatchers ) {
	var bySet = setMatchers.length > 0,
		byElement = elementMatchers.length > 0,
		superMatcher = function( seed, context, xml, results, expandContext ) {
			var elem, j, matcher,
				setMatched = [],
				matchedCount = 0,
				i = "0",
				unmatched = seed && [],
				outermost = expandContext != null,
				contextBackup = outermostContext,
				// We must always have either seed elements or context
				elems = seed || byElement && Expr.find["TAG"]( "*", expandContext && context.parentNode || context ),
				// Nested matchers should use non-integer dirruns
				dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.E);

			if ( outermost ) {
				outermostContext = context !== document && context;
				cachedruns = superMatcher.el;
			}

			// Add elements passing elementMatchers directly to results
			for ( ; (elem = elems[i]) != null; i++ ) {
				if ( byElement && elem ) {
					for ( j = 0; (matcher = elementMatchers[j]); j++ ) {
						if ( matcher( elem, context, xml ) ) {
							results.push( elem );
							break;
						}
					}
					if ( outermost ) {
						dirruns = dirrunsUnique;
						cachedruns = ++superMatcher.el;
					}
				}

				// Track unmatched elements for set filters
				if ( bySet ) {
					// They will have gone through all possible matchers
					if ( (elem = !matcher && elem) ) {
						matchedCount--;
					}

					// Lengthen the array for every element, matched or not
					if ( seed ) {
						unmatched.push( elem );
					}
				}
			}

			// Apply set filters to unmatched elements
			matchedCount += i;
			if ( bySet && i !== matchedCount ) {
				for ( j = 0; (matcher = setMatchers[j]); j++ ) {
					matcher( unmatched, setMatched, context, xml );
				}

				if ( seed ) {
					// Reintegrate element matches to eliminate the need for sorting
					if ( matchedCount > 0 ) {
						while ( i-- ) {
							if ( !(unmatched[i] || setMatched[i]) ) {
								setMatched[i] = pop.call( results );
							}
						}
					}

					// Discard index placeholder values to get only actual matches
					setMatched = condense( setMatched );
				}

				// Add matches to results
				push.apply( results, setMatched );

				// Seedless set matches succeeding multiple successful matchers stipulate sorting
				if ( outermost && !seed && setMatched.length > 0 &&
					( matchedCount + setMatchers.length ) > 1 ) {

					Sizzle.uniqueSort( results );
				}
			}

			// Override manipulation of globals by nested matchers
			if ( outermost ) {
				dirruns = dirrunsUnique;
				outermostContext = contextBackup;
			}

			return unmatched;
		};

	superMatcher.el = 0;
	return bySet ?
		markFunction( superMatcher ) :
		superMatcher;
}

compile = Sizzle.compile = function( selector, group /* Internal Use Only */ ) {
	var i,
		setMatchers = [],
		elementMatchers = [],
		cached = compilerCache[ expando ][ selector + " " ];

	if ( !cached ) {
		// Generate a function of recursive functions that can be used to check each element
		if ( !group ) {
			group = tokenize( selector );
		}
		i = group.length;
		while ( i-- ) {
			cached = matcherFromTokens( group[i] );
			if ( cached[ expando ] ) {
				setMatchers.push( cached );
			} else {
				elementMatchers.push( cached );
			}
		}

		// Cache the compiled function
		cached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );
	}
	return cached;
};

function multipleContexts( selector, contexts, results ) {
	var i = 0,
		len = contexts.length;
	for ( ; i < len; i++ ) {
		Sizzle( selector, contexts[i], results );
	}
	return results;
}

function select( selector, context, results, seed, xml ) {
	var i, tokens, token, type, find,
		match = tokenize( selector ),
		j = match.length;

	if ( !seed ) {
		// Try to minimize operations if there is only one group
		if ( match.length === 1 ) {

			// Take a shortcut and set the context if the root selector is an ID
			tokens = match[0] = match[0].slice( 0 );
			if ( tokens.length > 2 && (token = tokens[0]).type === "ID" &&
					context.nodeType === 9 && !xml &&
					Expr.relative[ tokens[1].type ] ) {

				context = Expr.find["ID"]( token.matches[0].replace( rbackslash, "" ), context, xml )[0];
				if ( !context ) {
					return results;
				}

				selector = selector.slice( tokens.shift().length );
			}

			// Fetch a seed set for right-to-left matching
			for ( i = matchExpr["POS"].test( selector ) ? -1 : tokens.length - 1; i >= 0; i-- ) {
				token = tokens[i];

				// Abort if we hit a combinator
				if ( Expr.relative[ (type = token.type) ] ) {
					break;
				}
				if ( (find = Expr.find[ type ]) ) {
					// Search, expanding context for leading sibling combinators
					if ( (seed = find(
						token.matches[0].replace( rbackslash, "" ),
						rsibling.test( tokens[0].type ) && context.parentNode || context,
						xml
					)) ) {

						// If seed is empty or no tokens remain, we can return early
						tokens.splice( i, 1 );
						selector = seed.length && tokens.join("");
						if ( !selector ) {
							push.apply( results, slice.call( seed, 0 ) );
							return results;
						}

						break;
					}
				}
			}
		}
	}

	// Compile and execute a filtering function
	// Provide `match` to avoid retokenization if we modified the selector above
	compile( selector, match )(
		seed,
		context,
		xml,
		results,
		rsibling.test( selector )
	);
	return results;
}

if ( document.querySelectorAll ) {
	(function() {
		var disconnectedMatch,
			oldSelect = select,
			rescape = /'|\\/g,
			rattributeQuotes = /\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,

			// qSa(:focus) reports false when true (Chrome 21), no need to also add to buggyMatches since matches checks buggyQSA
			// A support test would require too much code (would include document ready)
			rbuggyQSA = [ ":focus" ],

			// matchesSelector(:active) reports false when true (IE9/Opera 11.5)
			// A support test would require too much code (would include document ready)
			// just skip matchesSelector for :active
			rbuggyMatches = [ ":active" ],
			matches = docElem.matchesSelector ||
				docElem.mozMatchesSelector ||
				docElem.webkitMatchesSelector ||
				docElem.oMatchesSelector ||
				docElem.msMatchesSelector;

		// Build QSA regex
		// Regex strategy adopted from Diego Perini
		assert(function( div ) {
			// Select is set to empty string on purpose
			// This is to test IE's treatment of not explictly
			// setting a boolean content attribute,
			// since its presence should be enough
			// http://bugs.jquery.com/ticket/12359
			div.innerHTML = "<select><option selected=''></option></select>";

			// IE8 - Some boolean attributes are not treated correctly
			if ( !div.querySelectorAll("[selected]").length ) {
				rbuggyQSA.push( "\\[" + whitespace + "*(?:checked|disabled|ismap|multiple|readonly|selected|value)" );
			}

			// Webkit/Opera - :checked should return selected option elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			// IE8 throws error here (do not put tests after this one)
			if ( !div.querySelectorAll(":checked").length ) {
				rbuggyQSA.push(":checked");
			}
		});

		assert(function( div ) {

			// Opera 10-12/IE9 - ^= $= *= and empty values
			// Should not select anything
			div.innerHTML = "<p test=''></p>";
			if ( div.querySelectorAll("[test^='']").length ) {
				rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:\"\"|'')" );
			}

			// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
			// IE8 throws error here (do not put tests after this one)
			div.innerHTML = "<input type='hidden'/>";
			if ( !div.querySelectorAll(":enabled").length ) {
				rbuggyQSA.push(":enabled", ":disabled");
			}
		});

		// rbuggyQSA always contains :focus, so no need for a length check
		rbuggyQSA = /* rbuggyQSA.length && */ new RegExp( rbuggyQSA.join("|") );

		select = function( selector, context, results, seed, xml ) {
			// Only use querySelectorAll when not filtering,
			// when this is not xml,
			// and when no QSA bugs apply
			if ( !seed && !xml && !rbuggyQSA.test( selector ) ) {
				var groups, i,
					old = true,
					nid = expando,
					newContext = context,
					newSelector = context.nodeType === 9 && selector;

				// qSA works strangely on Element-rooted queries
				// We can work around this by specifying an extra ID on the root
				// and working up from there (Thanks to Andrew Dupont for the technique)
				// IE 8 doesn't work on object elements
				if ( context.nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
					groups = tokenize( selector );

					if ( (old = context.getAttribute("id")) ) {
						nid = old.replace( rescape, "\\$&" );
					} else {
						context.setAttribute( "id", nid );
					}
					nid = "[id='" + nid + "'] ";

					i = groups.length;
					while ( i-- ) {
						groups[i] = nid + groups[i].join("");
					}
					newContext = rsibling.test( selector ) && context.parentNode || context;
					newSelector = groups.join(",");
				}

				if ( newSelector ) {
					try {
						push.apply( results, slice.call( newContext.querySelectorAll(
							newSelector
						), 0 ) );
						return results;
					} catch(qsaError) {
					} finally {
						if ( !old ) {
							context.removeAttribute("id");
						}
					}
				}
			}

			return oldSelect( selector, context, results, seed, xml );
		};

		if ( matches ) {
			assert(function( div ) {
				// Check to see if it's possible to do matchesSelector
				// on a disconnected node (IE 9)
				disconnectedMatch = matches.call( div, "div" );

				// This should fail with an exception
				// Gecko does not error, returns false instead
				try {
					matches.call( div, "[test!='']:sizzle" );
					rbuggyMatches.push( "!=", pseudos );
				} catch ( e ) {}
			});

			// rbuggyMatches always contains :active and :focus, so no need for a length check
			rbuggyMatches = /* rbuggyMatches.length && */ new RegExp( rbuggyMatches.join("|") );

			Sizzle.matchesSelector = function( elem, expr ) {
				// Make sure that attribute selectors are quoted
				expr = expr.replace( rattributeQuotes, "='$1']" );

				// rbuggyMatches always contains :active, so no need for an existence check
				if ( !isXML( elem ) && !rbuggyMatches.test( expr ) && !rbuggyQSA.test( expr ) ) {
					try {
						var ret = matches.call( elem, expr );

						// IE 9's matchesSelector returns false on disconnected nodes
						if ( ret || disconnectedMatch ||
								// As well, disconnected nodes are said to be in a document
								// fragment in IE 9
								elem.document && elem.document.nodeType !== 11 ) {
							return ret;
						}
					} catch(e) {}
				}

				return Sizzle( expr, null, null, [ elem ] ).length > 0;
			};
		}
	})();
}

// Deprecated
Expr.pseudos["nth"] = Expr.pseudos["eq"];

// Back-compat
function setFilters() {}
Expr.filters = setFilters.prototype = Expr.pseudos;
Expr.setFilters = new setFilters();

// Override sizzle attribute retrieval
Sizzle.attr = jQuery.attr;
jQuery.find = Sizzle;
jQuery.expr = Sizzle.selectors;
jQuery.expr[":"] = jQuery.expr.pseudos;
jQuery.unique = Sizzle.uniqueSort;
jQuery.text = Sizzle.getText;
jQuery.isXMLDoc = Sizzle.isXML;
jQuery.contains = Sizzle.contains;


})( window );
var runtil = /Until$/,
	rparentsprev = /^(?:parents|prev(?:Until|All))/,
	isSimple = /^.[^:#\[\.,]*$/,
	rneedsContext = jQuery.expr.match.needsContext,
	// methods guaranteed to produce a unique set when starting from a unique set
	guaranteedUnique = {
		children: true,
		contents: true,
		next: true,
		prev: true
	};

jQuery.fn.extend({
	find: function( selector ) {
		var i, l, length, n, r, ret,
			self = this;

		if ( typeof selector !== "string" ) {
			return jQuery( selector ).filter(function() {
				for ( i = 0, l = self.length; i < l; i++ ) {
					if ( jQuery.contains( self[ i ], this ) ) {
						return true;
					}
				}
			});
		}

		ret = this.pushStack( "", "find", selector );

		for ( i = 0, l = this.length; i < l; i++ ) {
			length = ret.length;
			jQuery.find( selector, this[i], ret );

			if ( i > 0 ) {
				// Make sure that the results are unique
				for ( n = length; n < ret.length; n++ ) {
					for ( r = 0; r < length; r++ ) {
						if ( ret[r] === ret[n] ) {
							ret.splice(n--, 1);
							break;
						}
					}
				}
			}
		}

		return ret;
	},

	has: function( target ) {
		var i,
			targets = jQuery( target, this ),
			len = targets.length;

		return this.filter(function() {
			for ( i = 0; i < len; i++ ) {
				if ( jQuery.contains( this, targets[i] ) ) {
					return true;
				}
			}
		});
	},

	not: function( selector ) {
		return this.pushStack( winnow(this, selector, false), "not", selector);
	},

	filter: function( selector ) {
		return this.pushStack( winnow(this, selector, true), "filter", selector );
	},

	is: function( selector ) {
		return !!selector && (
			typeof selector === "string" ?
				// If this is a positional/relative selector, check membership in the returned set
				// so $("p:first").is("p:last") won't return true for a doc with two "p".
				rneedsContext.test( selector ) ?
					jQuery( selector, this.context ).index( this[0] ) >= 0 :
					jQuery.filter( selector, this ).length > 0 :
				this.filter( selector ).length > 0 );
	},

	closest: function( selectors, context ) {
		var cur,
			i = 0,
			l = this.length,
			ret = [],
			pos = rneedsContext.test( selectors ) || typeof selectors !== "string" ?
				jQuery( selectors, context || this.context ) :
				0;

		for ( ; i < l; i++ ) {
			cur = this[i];

			while ( cur && cur.ownerDocument && cur !== context && cur.nodeType !== 11 ) {
				if ( pos ? pos.index(cur) > -1 : jQuery.find.matchesSelector(cur, selectors) ) {
					ret.push( cur );
					break;
				}
				cur = cur.parentNode;
			}
		}

		ret = ret.length > 1 ? jQuery.unique( ret ) : ret;

		return this.pushStack( ret, "closest", selectors );
	},

	// Determine the position of an element within
	// the matched set of elements
	index: function( elem ) {

		// No argument, return index in parent
		if ( !elem ) {
			return ( this[0] && this[0].parentNode ) ? this.prevAll().length : -1;
		}

		// index in selector
		if ( typeof elem === "string" ) {
			return jQuery.inArray( this[0], jQuery( elem ) );
		}

		// Locate the position of the desired element
		return jQuery.inArray(
			// If it receives a jQuery object, the first element is used
			elem.jquery ? elem[0] : elem, this );
	},

	add: function( selector, context ) {
		var set = typeof selector === "string" ?
				jQuery( selector, context ) :
				jQuery.makeArray( selector && selector.nodeType ? [ selector ] : selector ),
			all = jQuery.merge( this.get(), set );

		return this.pushStack( isDisconnected( set[0] ) || isDisconnected( all[0] ) ?
			all :
			jQuery.unique( all ) );
	},

	addBack: function( selector ) {
		return this.add( selector == null ?
			this.prevObject : this.prevObject.filter(selector)
		);
	}
});

jQuery.fn.andSelf = jQuery.fn.addBack;

// A painfully simple check to see if an element is disconnected
// from a document (should be improved, where feasible).
function isDisconnected( node ) {
	return !node || !node.parentNode || node.parentNode.nodeType === 11;
}

function sibling( cur, dir ) {
	do {
		cur = cur[ dir ];
	} while ( cur && cur.nodeType !== 1 );

	return cur;
}

jQuery.each({
	parent: function( elem ) {
		var parent = elem.parentNode;
		return parent && parent.nodeType !== 11 ? parent : null;
	},
	parents: function( elem ) {
		return jQuery.dir( elem, "parentNode" );
	},
	parentsUntil: function( elem, i, until ) {
		return jQuery.dir( elem, "parentNode", until );
	},
	next: function( elem ) {
		return sibling( elem, "nextSibling" );
	},
	prev: function( elem ) {
		return sibling( elem, "previousSibling" );
	},
	nextAll: function( elem ) {
		return jQuery.dir( elem, "nextSibling" );
	},
	prevAll: function( elem ) {
		return jQuery.dir( elem, "previousSibling" );
	},
	nextUntil: function( elem, i, until ) {
		return jQuery.dir( elem, "nextSibling", until );
	},
	prevUntil: function( elem, i, until ) {
		return jQuery.dir( elem, "previousSibling", until );
	},
	siblings: function( elem ) {
		return jQuery.sibling( ( elem.parentNode || {} ).firstChild, elem );
	},
	children: function( elem ) {
		return jQuery.sibling( elem.firstChild );
	},
	contents: function( elem ) {
		return jQuery.nodeName( elem, "iframe" ) ?
			elem.contentDocument || elem.contentWindow.document :
			jQuery.merge( [], elem.childNodes );
	}
}, function( name, fn ) {
	jQuery.fn[ name ] = function( until, selector ) {
		var ret = jQuery.map( this, fn, until );

		if ( !runtil.test( name ) ) {
			selector = until;
		}

		if ( selector && typeof selector === "string" ) {
			ret = jQuery.filter( selector, ret );
		}

		ret = this.length > 1 && !guaranteedUnique[ name ] ? jQuery.unique( ret ) : ret;

		if ( this.length > 1 && rparentsprev.test( name ) ) {
			ret = ret.reverse();
		}

		return this.pushStack( ret, name, core_slice.call( arguments ).join(",") );
	};
});

jQuery.extend({
	filter: function( expr, elems, not ) {
		if ( not ) {
			expr = ":not(" + expr + ")";
		}

		return elems.length === 1 ?
			jQuery.find.matchesSelector(elems[0], expr) ? [ elems[0] ] : [] :
			jQuery.find.matches(expr, elems);
	},

	dir: function( elem, dir, until ) {
		var matched = [],
			cur = elem[ dir ];

		while ( cur && cur.nodeType !== 9 && (until === undefined || cur.nodeType !== 1 || !jQuery( cur ).is( until )) ) {
			if ( cur.nodeType === 1 ) {
				matched.push( cur );
			}
			cur = cur[dir];
		}
		return matched;
	},

	sibling: function( n, elem ) {
		var r = [];

		for ( ; n; n = n.nextSibling ) {
			if ( n.nodeType === 1 && n !== elem ) {
				r.push( n );
			}
		}

		return r;
	}
});

// Implement the identical functionality for filter and not
function winnow( elements, qualifier, keep ) {

	// Can't pass null or undefined to indexOf in Firefox 4
	// Set to 0 to skip string check
	qualifier = qualifier || 0;

	if ( jQuery.isFunction( qualifier ) ) {
		return jQuery.grep(elements, function( elem, i ) {
			var retVal = !!qualifier.call( elem, i, elem );
			return retVal === keep;
		});

	} else if ( qualifier.nodeType ) {
		return jQuery.grep(elements, function( elem, i ) {
			return ( elem === qualifier ) === keep;
		});

	} else if ( typeof qualifier === "string" ) {
		var filtered = jQuery.grep(elements, function( elem ) {
			return elem.nodeType === 1;
		});

		if ( isSimple.test( qualifier ) ) {
			return jQuery.filter(qualifier, filtered, !keep);
		} else {
			qualifier = jQuery.filter( qualifier, filtered );
		}
	}

	return jQuery.grep(elements, function( elem, i ) {
		return ( jQuery.inArray( elem, qualifier ) >= 0 ) === keep;
	});
}
function createSafeFragment( document ) {
	var list = nodeNames.split( "|" ),
	safeFrag = document.createDocumentFragment();

	if ( safeFrag.createElement ) {
		while ( list.length ) {
			safeFrag.createElement(
				list.pop()
			);
		}
	}
	return safeFrag;
}

var nodeNames = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|" +
		"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
	rinlinejQuery = / jQuery\d+="(?:null|\d+)"/g,
	rleadingWhitespace = /^\s+/,
	rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,
	rtagName = /<([\w:]+)/,
	rtbody = /<tbody/i,
	rhtml = /<|&#?\w+;/,
	rnoInnerhtml = /<(?:script|style|link)/i,
	rnocache = /<(?:script|object|embed|option|style)/i,
	rnoshimcache = new RegExp("<(?:" + nodeNames + ")[\\s/>]", "i"),
	rcheckableType = /^(?:checkbox|radio)$/,
	// checked="checked" or checked
	rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i,
	rscriptType = /\/(java|ecma)script/i,
	rcleanScript = /^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,
	wrapMap = {
		option: [ 1, "<select multiple='multiple'>", "</select>" ],
		legend: [ 1, "<fieldset>", "</fieldset>" ],
		thead: [ 1, "<table>", "</table>" ],
		tr: [ 2, "<table><tbody>", "</tbody></table>" ],
		td: [ 3, "<table><tbody><tr>", "</tr></tbody></table>" ],
		col: [ 2, "<table><tbody></tbody><colgroup>", "</colgroup></table>" ],
		area: [ 1, "<map>", "</map>" ],
		_default: [ 0, "", "" ]
	},
	safeFragment = createSafeFragment( document ),
	fragmentDiv = safeFragment.appendChild( document.createElement("div") );

wrapMap.optgroup = wrapMap.option;
wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;
wrapMap.th = wrapMap.td;

// IE6-8 can't serialize link, script, style, or any html5 (NoScope) tags,
// unless wrapped in a div with non-breaking characters in front of it.
if ( !jQuery.support.htmlSerialize ) {
	wrapMap._default = [ 1, "X<div>", "</div>" ];
}

jQuery.fn.extend({
	text: function( value ) {
		return jQuery.access( this, function( value ) {
			return value === undefined ?
				jQuery.text( this ) :
				this.empty().append( ( this[0] && this[0].ownerDocument || document ).createTextNode( value ) );
		}, null, value, arguments.length );
	},

	wrapAll: function( html ) {
		if ( jQuery.isFunction( html ) ) {
			return this.each(function(i) {
				jQuery(this).wrapAll( html.call(this, i) );
			});
		}

		if ( this[0] ) {
			// The elements to wrap the target around
			var wrap = jQuery( html, this[0].ownerDocument ).eq(0).clone(true);

			if ( this[0].parentNode ) {
				wrap.insertBefore( this[0] );
			}

			wrap.map(function() {
				var elem = this;

				while ( elem.firstChild && elem.firstChild.nodeType === 1 ) {
					elem = elem.firstChild;
				}

				return elem;
			}).append( this );
		}

		return this;
	},

	wrapInner: function( html ) {
		if ( jQuery.isFunction( html ) ) {
			return this.each(function(i) {
				jQuery(this).wrapInner( html.call(this, i) );
			});
		}

		return this.each(function() {
			var self = jQuery( this ),
				contents = self.contents();

			if ( contents.length ) {
				contents.wrapAll( html );

			} else {
				self.append( html );
			}
		});
	},

	wrap: function( html ) {
		var isFunction = jQuery.isFunction( html );

		return this.each(function(i) {
			jQuery( this ).wrapAll( isFunction ? html.call(this, i) : html );
		});
	},

	unwrap: function() {
		return this.parent().each(function() {
			if ( !jQuery.nodeName( this, "body" ) ) {
				jQuery( this ).replaceWith( this.childNodes );
			}
		}).end();
	},

	append: function() {
		return this.domManip(arguments, true, function( elem ) {
			if ( this.nodeType === 1 || this.nodeType === 11 ) {
				this.appendChild( elem );
			}
		});
	},

	prepend: function() {
		return this.domManip(arguments, true, function( elem ) {
			if ( this.nodeType === 1 || this.nodeType === 11 ) {
				this.insertBefore( elem, this.firstChild );
			}
		});
	},

	before: function() {
		if ( !isDisconnected( this[0] ) ) {
			return this.domManip(arguments, false, function( elem ) {
				this.parentNode.insertBefore( elem, this );
			});
		}

		if ( arguments.length ) {
			var set = jQuery.clean( arguments );
			return this.pushStack( jQuery.merge( set, this ), "before", this.selector );
		}
	},

	after: function() {
		if ( !isDisconnected( this[0] ) ) {
			return this.domManip(arguments, false, function( elem ) {
				this.parentNode.insertBefore( elem, this.nextSibling );
			});
		}

		if ( arguments.length ) {
			var set = jQuery.clean( arguments );
			return this.pushStack( jQuery.merge( this, set ), "after", this.selector );
		}
	},

	// keepData is for internal use only--do not document
	remove: function( selector, keepData ) {
		var elem,
			i = 0;

		for ( ; (elem = this[i]) != null; i++ ) {
			if ( !selector || jQuery.filter( selector, [ elem ] ).length ) {
				if ( !keepData && elem.nodeType === 1 ) {
					jQuery.cleanData( elem.getElementsByTagName("*") );
					jQuery.cleanData( [ elem ] );
				}

				if ( elem.parentNode ) {
					elem.parentNode.removeChild( elem );
				}
			}
		}

		return this;
	},

	empty: function() {
		var elem,
			i = 0;

		for ( ; (elem = this[i]) != null; i++ ) {
			// Remove element nodes and prevent memory leaks
			if ( elem.nodeType === 1 ) {
				jQuery.cleanData( elem.getElementsByTagName("*") );
			}

			// Remove any remaining nodes
			while ( elem.firstChild ) {
				elem.removeChild( elem.firstChild );
			}
		}

		return this;
	},

	clone: function( dataAndEvents, deepDataAndEvents ) {
		dataAndEvents = dataAndEvents == null ? false : dataAndEvents;
		deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;

		return this.map( function () {
			return jQuery.clone( this, dataAndEvents, deepDataAndEvents );
		});
	},

	html: function( value ) {
		return jQuery.access( this, function( value ) {
			var elem = this[0] || {},
				i = 0,
				l = this.length;

			if ( value === undefined ) {
				return elem.nodeType === 1 ?
					elem.innerHTML.replace( rinlinejQuery, "" ) :
					undefined;
			}

			// See if we can take a shortcut and just use innerHTML
			if ( typeof value === "string" && !rnoInnerhtml.test( value ) &&
				( jQuery.support.htmlSerialize || !rnoshimcache.test( value )  ) &&
				( jQuery.support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &&
				!wrapMap[ ( rtagName.exec( value ) || ["", ""] )[1].toLowerCase() ] ) {

				value = value.replace( rxhtmlTag, "<$1></$2>" );

				try {
					for (; i < l; i++ ) {
						// Remove element nodes and prevent memory leaks
						elem = this[i] || {};
						if ( elem.nodeType === 1 ) {
							jQuery.cleanData( elem.getElementsByTagName( "*" ) );
							elem.innerHTML = value;
						}
					}

					elem = 0;

				// If using innerHTML throws an exception, use the fallback method
				} catch(e) {}
			}

			if ( elem ) {
				this.empty().append( value );
			}
		}, null, value, arguments.length );
	},

	replaceWith: function( value ) {
		if ( !isDisconnected( this[0] ) ) {
			// Make sure that the elements are removed from the DOM before they are inserted
			// this can help fix replacing a parent with child elements
			if ( jQuery.isFunction( value ) ) {
				return this.each(function(i) {
					var self = jQuery(this), old = self.html();
					self.replaceWith( value.call( this, i, old ) );
				});
			}

			if ( typeof value !== "string" ) {
				value = jQuery( value ).detach();
			}

			return this.each(function() {
				var next = this.nextSibling,
					parent = this.parentNode;

				jQuery( this ).remove();

				if ( next ) {
					jQuery(next).before( value );
				} else {
					jQuery(parent).append( value );
				}
			});
		}

		return this.length ?
			this.pushStack( jQuery(jQuery.isFunction(value) ? value() : value), "replaceWith", value ) :
			this;
	},

	detach: function( selector ) {
		return this.remove( selector, true );
	},

	domManip: function( args, table, callback ) {

		// Flatten any nested arrays
		args = [].concat.apply( [], args );

		var results, first, fragment, iNoClone,
			i = 0,
			value = args[0],
			scripts = [],
			l = this.length;

		// We can't cloneNode fragments that contain checked, in WebKit
		if ( !jQuery.support.checkClone && l > 1 && typeof value === "string" && rchecked.test( value ) ) {
			return this.each(function() {
				jQuery(this).domManip( args, table, callback );
			});
		}

		if ( jQuery.isFunction(value) ) {
			return this.each(function(i) {
				var self = jQuery(this);
				args[0] = value.call( this, i, table ? self.html() : undefined );
				self.domManip( args, table, callback );
			});
		}

		if ( this[0] ) {
			results = jQuery.buildFragment( args, this, scripts );
			fragment = results.fragment;
			first = fragment.firstChild;

			if ( fragment.childNodes.length === 1 ) {
				fragment = first;
			}

			if ( first ) {
				table = table && jQuery.nodeName( first, "tr" );

				// Use the original fragment for the last item instead of the first because it can end up
				// being emptied incorrectly in certain situations (#8070).
				// Fragments from the fragment cache must always be cloned and never used in place.
				for ( iNoClone = results.cacheable || l - 1; i < l; i++ ) {
					callback.call(
						table && jQuery.nodeName( this[i], "table" ) ?
							findOrAppend( this[i], "tbody" ) :
							this[i],
						i === iNoClone ?
							fragment :
							jQuery.clone( fragment, true, true )
					);
				}
			}

			// Fix #11809: Avoid leaking memory
			fragment = first = null;

			if ( scripts.length ) {
				jQuery.each( scripts, function( i, elem ) {
					if ( elem.src ) {
						if ( jQuery.ajax ) {
							jQuery.ajax({
								url: elem.src,
								type: "GET",
								dataType: "script",
								async: false,
								global: false,
								"throws": true
							});
						} else {
							jQuery.error("no ajax");
						}
					} else {
						jQuery.globalEval( ( elem.text || elem.textContent || elem.innerHTML || "" ).replace( rcleanScript, "" ) );
					}

					if ( elem.parentNode ) {
						elem.parentNode.removeChild( elem );
					}
				});
			}
		}

		return this;
	}
});

function findOrAppend( elem, tag ) {
	return elem.getElementsByTagName( tag )[0] || elem.appendChild( elem.ownerDocument.createElement( tag ) );
}

function cloneCopyEvent( src, dest ) {

	if ( dest.nodeType !== 1 || !jQuery.hasData( src ) ) {
		return;
	}

	var type, i, l,
		oldData = jQuery._data( src ),
		curData = jQuery._data( dest, oldData ),
		events = oldData.events;

	if ( events ) {
		delete curData.handle;
		curData.events = {};

		for ( type in events ) {
			for ( i = 0, l = events[ type ].length; i < l; i++ ) {
				jQuery.event.add( dest, type, events[ type ][ i ] );
			}
		}
	}

	// make the cloned public data object a copy from the original
	if ( curData.data ) {
		curData.data = jQuery.extend( {}, curData.data );
	}
}

function cloneFixAttributes( src, dest ) {
	var nodeName;

	// We do not need to do anything for non-Elements
	if ( dest.nodeType !== 1 ) {
		return;
	}

	// clearAttributes removes the attributes, which we don't want,
	// but also removes the attachEvent events, which we *do* want
	if ( dest.clearAttributes ) {
		dest.clearAttributes();
	}

	// mergeAttributes, in contrast, only merges back on the
	// original attributes, not the events
	if ( dest.mergeAttributes ) {
		dest.mergeAttributes( src );
	}

	nodeName = dest.nodeName.toLowerCase();

	if ( nodeName === "object" ) {
		// IE6-10 improperly clones children of object elements using classid.
		// IE10 throws NoModificationAllowedError if parent is null, #12132.
		if ( dest.parentNode ) {
			dest.outerHTML = src.outerHTML;
		}

		// This path appears unavoidable for IE9. When cloning an object
		// element in IE9, the outerHTML strategy above is not sufficient.
		// If the src has innerHTML and the destination does not,
		// copy the src.innerHTML into the dest.innerHTML. #10324
		if ( jQuery.support.html5Clone && (src.innerHTML && !jQuery.trim(dest.innerHTML)) ) {
			dest.innerHTML = src.innerHTML;
		}

	} else if ( nodeName === "input" && rcheckableType.test( src.type ) ) {
		// IE6-8 fails to persist the checked state of a cloned checkbox
		// or radio button. Worse, IE6-7 fail to give the cloned element
		// a checked appearance if the defaultChecked value isn't also set

		dest.defaultChecked = dest.checked = src.checked;

		// IE6-7 get confused and end up setting the value of a cloned
		// checkbox/radio button to an empty string instead of "on"
		if ( dest.value !== src.value ) {
			dest.value = src.value;
		}

	// IE6-8 fails to return the selected option to the default selected
	// state when cloning options
	} else if ( nodeName === "option" ) {
		dest.selected = src.defaultSelected;

	// IE6-8 fails to set the defaultValue to the correct value when
	// cloning other types of input fields
	} else if ( nodeName === "input" || nodeName === "textarea" ) {
		dest.defaultValue = src.defaultValue;

	// IE blanks contents when cloning scripts
	} else if ( nodeName === "script" && dest.text !== src.text ) {
		dest.text = src.text;
	}

	// Event data gets referenced instead of copied if the expando
	// gets copied too
	dest.removeAttribute( jQuery.expando );
}

jQuery.buildFragment = function( args, context, scripts ) {
	var fragment, cacheable, cachehit,
		first = args[ 0 ];

	// Set context from what may come in as undefined or a jQuery collection or a node
	// Updated to fix #12266 where accessing context[0] could throw an exception in IE9/10 &
	// also doubles as fix for #8950 where plain objects caused createDocumentFragment exception
	context = context || document;
	context = !context.nodeType && context[0] || context;
	context = context.ownerDocument || context;

	// Only cache "small" (1/2 KB) HTML strings that are associated with the main document
	// Cloning options loses the selected state, so don't cache them
	// IE 6 doesn't like it when you put <object> or <embed> elements in a fragment
	// Also, WebKit does not clone 'checked' attributes on cloneNode, so don't cache
	// Lastly, IE6,7,8 will not correctly reuse cached fragments that were created from unknown elems #10501
	if ( args.length === 1 && typeof first === "string" && first.length < 512 && context === document &&
		first.charAt(0) === "<" && !rnocache.test( first ) &&
		(jQuery.support.checkClone || !rchecked.test( first )) &&
		(jQuery.support.html5Clone || !rnoshimcache.test( first )) ) {

		// Mark cacheable and look for a hit
		cacheable = true;
		fragment = jQuery.fragments[ first ];
		cachehit = fragment !== undefined;
	}

	if ( !fragment ) {
		fragment = context.createDocumentFragment();
		jQuery.clean( args, context, fragment, scripts );

		// Update the cache, but only store false
		// unless this is a second parsing of the same content
		if ( cacheable ) {
			jQuery.fragments[ first ] = cachehit && fragment;
		}
	}

	return { fragment: fragment, cacheable: cacheable };
};

jQuery.fragments = {};

jQuery.each({
	appendTo: "append",
	prependTo: "prepend",
	insertBefore: "before",
	insertAfter: "after",
	replaceAll: "replaceWith"
}, function( name, original ) {
	jQuery.fn[ name ] = function( selector ) {
		var elems,
			i = 0,
			ret = [],
			insert = jQuery( selector ),
			l = insert.length,
			parent = this.length === 1 && this[0].parentNode;

		if ( (parent == null || parent && parent.nodeType === 11 && parent.childNodes.length === 1) && l === 1 ) {
			insert[ original ]( this[0] );
			return this;
		} else {
			for ( ; i < l; i++ ) {
				elems = ( i > 0 ? this.clone(true) : this ).get();
				jQuery( insert[i] )[ original ]( elems );
				ret = ret.concat( elems );
			}

			return this.pushStack( ret, name, insert.selector );
		}
	};
});

function getAll( elem ) {
	if ( typeof elem.getElementsByTagName !== "undefined" ) {
		return elem.getElementsByTagName( "*" );

	} else if ( typeof elem.querySelectorAll !== "undefined" ) {
		return elem.querySelectorAll( "*" );

	} else {
		return [];
	}
}

// Used in clean, fixes the defaultChecked property
function fixDefaultChecked( elem ) {
	if ( rcheckableType.test( elem.type ) ) {
		elem.defaultChecked = elem.checked;
	}
}

jQuery.extend({
	clone: function( elem, dataAndEvents, deepDataAndEvents ) {
		var srcElements,
			destElements,
			i,
			clone;

		if ( jQuery.support.html5Clone || jQuery.isXMLDoc(elem) || !rnoshimcache.test( "<" + elem.nodeName + ">" ) ) {
			clone = elem.cloneNode( true );

		// IE<=8 does not properly clone detached, unknown element nodes
		} else {
			fragmentDiv.innerHTML = elem.outerHTML;
			fragmentDiv.removeChild( clone = fragmentDiv.firstChild );
		}

		if ( (!jQuery.support.noCloneEvent || !jQuery.support.noCloneChecked) &&
				(elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem) ) {
			// IE copies events bound via attachEvent when using cloneNode.
			// Calling detachEvent on the clone will also remove the events
			// from the original. In order to get around this, we use some
			// proprietary methods to clear the events. Thanks to MooTools
			// guys for this hotness.

			cloneFixAttributes( elem, clone );

			// Using Sizzle here is crazy slow, so we use getElementsByTagName instead
			srcElements = getAll( elem );
			destElements = getAll( clone );

			// Weird iteration because IE will replace the length property
			// with an element if you are cloning the body and one of the
			// elements on the page has a name or id of "length"
			for ( i = 0; srcElements[i]; ++i ) {
				// Ensure that the destination node is not null; Fixes #9587
				if ( destElements[i] ) {
					cloneFixAttributes( srcElements[i], destElements[i] );
				}
			}
		}

		// Copy the events from the original to the clone
		if ( dataAndEvents ) {
			cloneCopyEvent( elem, clone );

			if ( deepDataAndEvents ) {
				srcElements = getAll( elem );
				destElements = getAll( clone );

				for ( i = 0; srcElements[i]; ++i ) {
					cloneCopyEvent( srcElements[i], destElements[i] );
				}
			}
		}

		srcElements = destElements = null;

		// Return the cloned set
		return clone;
	},

	clean: function( elems, context, fragment, scripts ) {
		var i, j, elem, tag, wrap, depth, div, hasBody, tbody, len, handleScript, jsTags,
			safe = context === document && safeFragment,
			ret = [];

		// Ensure that context is a document
		if ( !context || typeof context.createDocumentFragment === "undefined" ) {
			context = document;
		}

		// Use the already-created safe fragment if context permits
		for ( i = 0; (elem = elems[i]) != null; i++ ) {
			if ( typeof elem === "number" ) {
				elem += "";
			}

			if ( !elem ) {
				continue;
			}

			// Convert html string into DOM nodes
			if ( typeof elem === "string" ) {
				if ( !rhtml.test( elem ) ) {
					elem = context.createTextNode( elem );
				} else {
					// Ensure a safe container in which to render the html
					safe = safe || createSafeFragment( context );
					div = context.createElement("div");
					safe.appendChild( div );

					// Fix "XHTML"-style tags in all browsers
					elem = elem.replace(rxhtmlTag, "<$1></$2>");

					// Go to html and back, then peel off extra wrappers
					tag = ( rtagName.exec( elem ) || ["", ""] )[1].toLowerCase();
					wrap = wrapMap[ tag ] || wrapMap._default;
					depth = wrap[0];
					div.innerHTML = wrap[1] + elem + wrap[2];

					// Move to the right depth
					while ( depth-- ) {
						div = div.lastChild;
					}

					// Remove IE's autoinserted <tbody> from table fragments
					if ( !jQuery.support.tbody ) {

						// String was a <table>, *may* have spurious <tbody>
						hasBody = rtbody.test(elem);
							tbody = tag === "table" && !hasBody ?
								div.firstChild && div.firstChild.childNodes :

								// String was a bare <thead> or <tfoot>
								wrap[1] === "<table>" && !hasBody ?
									div.childNodes :
									[];

						for ( j = tbody.length - 1; j >= 0 ; --j ) {
							if ( jQuery.nodeName( tbody[ j ], "tbody" ) && !tbody[ j ].childNodes.length ) {
								tbody[ j ].parentNode.removeChild( tbody[ j ] );
							}
						}
					}

					// IE completely kills leading whitespace when innerHTML is used
					if ( !jQuery.support.leadingWhitespace && rleadingWhitespace.test( elem ) ) {
						div.insertBefore( context.createTextNode( rleadingWhitespace.exec(elem)[0] ), div.firstChild );
					}

					elem = div.childNodes;

					// Take out of fragment container (we need a fresh div each time)
					div.parentNode.removeChild( div );
				}
			}

			if ( elem.nodeType ) {
				ret.push( elem );
			} else {
				jQuery.merge( ret, elem );
			}
		}

		// Fix #11356: Clear elements from safeFragment
		if ( div ) {
			elem = div = safe = null;
		}

		// Reset defaultChecked for any radios and checkboxes
		// about to be appended to the DOM in IE 6/7 (#8060)
		if ( !jQuery.support.appendChecked ) {
			for ( i = 0; (elem = ret[i]) != null; i++ ) {
				if ( jQuery.nodeName( elem, "input" ) ) {
					fixDefaultChecked( elem );
				} else if ( typeof elem.getElementsByTagName !== "undefined" ) {
					jQuery.grep( elem.getElementsByTagName("input"), fixDefaultChecked );
				}
			}
		}

		// Append elements to a provided document fragment
		if ( fragment ) {
			// Special handling of each script element
			handleScript = function( elem ) {
				// Check if we consider it executable
				if ( !elem.type || rscriptType.test( elem.type ) ) {
					// Detach the script and store it in the scripts array (if provided) or the fragment
					// Return truthy to indicate that it has been handled
					return scripts ?
						scripts.push( elem.parentNode ? elem.parentNode.removeChild( elem ) : elem ) :
						fragment.appendChild( elem );
				}
			};

			for ( i = 0; (elem = ret[i]) != null; i++ ) {
				// Check if we're done after handling an executable script
				if ( !( jQuery.nodeName( elem, "script" ) && handleScript( elem ) ) ) {
					// Append to fragment and handle embedded scripts
					fragment.appendChild( elem );
					if ( typeof elem.getElementsByTagName !== "undefined" ) {
						// handleScript alters the DOM, so use jQuery.merge to ensure snapshot iteration
						jsTags = jQuery.grep( jQuery.merge( [], elem.getElementsByTagName("script") ), handleScript );

						// Splice the scripts into ret after their former ancestor and advance our index beyond them
						ret.splice.apply( ret, [i + 1, 0].concat( jsTags ) );
						i += jsTags.length;
					}
				}
			}
		}

		return ret;
	},

	cleanData: function( elems, /* internal */ acceptData ) {
		var data, id, elem, type,
			i = 0,
			internalKey = jQuery.expando,
			cache = jQuery.cache,
			deleteExpando = jQuery.support.deleteExpando,
			special = jQuery.event.special;

		for ( ; (elem = elems[i]) != null; i++ ) {

			if ( acceptData || jQuery.acceptData( elem ) ) {

				id = elem[ internalKey ];
				data = id && cache[ id ];

				if ( data ) {
					if ( data.events ) {
						for ( type in data.events ) {
							if ( special[ type ] ) {
								jQuery.event.remove( elem, type );

							// This is a shortcut to avoid jQuery.event.remove's overhead
							} else {
								jQuery.removeEvent( elem, type, data.handle );
							}
						}
					}

					// Remove cache only if it was not already removed by jQuery.event.remove
					if ( cache[ id ] ) {

						delete cache[ id ];

						// IE does not allow us to delete expando properties from nodes,
						// nor does it have a removeAttribute function on Document nodes;
						// we must handle all of these cases
						if ( deleteExpando ) {
							delete elem[ internalKey ];

						} else if ( elem.removeAttribute ) {
							elem.removeAttribute( internalKey );

						} else {
							elem[ internalKey ] = null;
						}

						jQuery.deletedIds.push( id );
					}
				}
			}
		}
	}
});
// Limit scope pollution from any deprecated API
(function() {

var matched, browser;

// Use of jQuery.browser is frowned upon.
// More details: http://api.jquery.com/jQuery.browser
// jQuery.uaMatch maintained for back-compat
jQuery.uaMatch = function( ua ) {
	ua = ua.toLowerCase();

	var match = /(chrome)[ \/]([\w.]+)/.exec( ua ) ||
		/(webkit)[ \/]([\w.]+)/.exec( ua ) ||
		/(opera)(?:.*version|)[ \/]([\w.]+)/.exec( ua ) ||
		/(msie) ([\w.]+)/.exec( ua ) ||
		ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec( ua ) ||
		[];

	return {
		browser: match[ 1 ] || "",
		version: match[ 2 ] || "0"
	};
};

matched = jQuery.uaMatch( navigator.userAgent );
browser = {};

if ( matched.browser ) {
	browser[ matched.browser ] = true;
	browser.version = matched.version;
}

// Chrome is Webkit, but Webkit is also Safari.
if ( browser.chrome ) {
	browser.webkit = true;
} else if ( browser.webkit ) {
	browser.safari = true;
}

jQuery.browser = browser;

jQuery.sub = function() {
	function jQuerySub( selector, context ) {
		return new jQuerySub.fn.init( selector, context );
	}
	jQuery.extend( true, jQuerySub, this );
	jQuerySub.superclass = this;
	jQuerySub.fn = jQuerySub.prototype = this();
	jQuerySub.fn.constructor = jQuerySub;
	jQuerySub.sub = this.sub;
	jQuerySub.fn.init = function init( selector, context ) {
		if ( context && context instanceof jQuery && !(context instanceof jQuerySub) ) {
			context = jQuerySub( context );
		}

		return jQuery.fn.init.call( this, selector, context, rootjQuerySub );
	};
	jQuerySub.fn.init.prototype = jQuerySub.fn;
	var rootjQuerySub = jQuerySub(document);
	return jQuerySub;
};

})();
var curCSS, iframe, iframeDoc,
	ralpha = /alpha\([^)]*\)/i,
	ropacity = /opacity=([^)]*)/,
	rposition = /^(top|right|bottom|left)$/,
	// swappable if display is none or starts with table except "table", "table-cell", or "table-caption"
	// see here for display values: https://developer.mozilla.org/en-US/docs/CSS/display
	rdisplayswap = /^(none|table(?!-c[ea]).+)/,
	rmargin = /^margin/,
	rnumsplit = new RegExp( "^(" + core_pnum + ")(.*)$", "i" ),
	rnumnonpx = new RegExp( "^(" + core_pnum + ")(?!px)[a-z%]+$", "i" ),
	rrelNum = new RegExp( "^([-+])=(" + core_pnum + ")", "i" ),
	elemdisplay = { BODY: "block" },

	cssShow = { position: "absolute", visibility: "hidden", display: "block" },
	cssNormalTransform = {
		letterSpacing: 0,
		fontWeight: 400
	},

	cssExpand = [ "Top", "Right", "Bottom", "Left" ],
	cssPrefixes = [ "Webkit", "O", "Moz", "ms" ],

	eventsToggle = jQuery.fn.toggle;

// return a css property mapped to a potentially vendor prefixed property
function vendorPropName( style, name ) {

	// shortcut for names that are not vendor prefixed
	if ( name in style ) {
		return name;
	}

	// check for vendor prefixed names
	var capName = name.charAt(0).toUpperCase() + name.slice(1),
		origName = name,
		i = cssPrefixes.length;

	while ( i-- ) {
		name = cssPrefixes[ i ] + capName;
		if ( name in style ) {
			return name;
		}
	}

	return origName;
}

function isHidden( elem, el ) {
	elem = el || elem;
	return jQuery.css( elem, "display" ) === "none" || !jQuery.contains( elem.ownerDocument, elem );
}

function showHide( elements, show ) {
	var elem, display,
		values = [],
		index = 0,
		length = elements.length;

	for ( ; index < length; index++ ) {
		elem = elements[ index ];
		if ( !elem.style ) {
			continue;
		}
		values[ index ] = jQuery._data( elem, "olddisplay" );
		if ( show ) {
			// Reset the inline display of this element to learn if it is
			// being hidden by cascaded rules or not
			if ( !values[ index ] && elem.style.display === "none" ) {
				elem.style.display = "";
			}

			// Set elements which have been overridden with display: none
			// in a stylesheet to whatever the default browser style is
			// for such an element
			if ( elem.style.display === "" && isHidden( elem ) ) {
				values[ index ] = jQuery._data( elem, "olddisplay", css_defaultDisplay(elem.nodeName) );
			}
		} else {
			display = curCSS( elem, "display" );

			if ( !values[ index ] && display !== "none" ) {
				jQuery._data( elem, "olddisplay", display );
			}
		}
	}

	// Set the display of most of the elements in a second loop
	// to avoid the constant reflow
	for ( index = 0; index < length; index++ ) {
		elem = elements[ index ];
		if ( !elem.style ) {
			continue;
		}
		if ( !show || elem.style.display === "none" || elem.style.display === "" ) {
			elem.style.display = show ? values[ index ] || "" : "none";
		}
	}

	return elements;
}

jQuery.fn.extend({
	css: function( name, value ) {
		return jQuery.access( this, function( elem, name, value ) {
			return value !== undefined ?
				jQuery.style( elem, name, value ) :
				jQuery.css( elem, name );
		}, name, value, arguments.length > 1 );
	},
	show: function() {
		return showHide( this, true );
	},
	hide: function() {
		return showHide( this );
	},
	toggle: function( state, fn2 ) {
		var bool = typeof state === "boolean";

		if ( jQuery.isFunction( state ) && jQuery.isFunction( fn2 ) ) {
			return eventsToggle.apply( this, arguments );
		}

		return this.each(function() {
			if ( bool ? state : isHidden( this ) ) {
				jQuery( this ).show();
			} else {
				jQuery( this ).hide();
			}
		});
	}
});

jQuery.extend({
	// Add in style property hooks for overriding the default
	// behavior of getting and setting a style property
	cssHooks: {
		opacity: {
			get: function( elem, computed ) {
				if ( computed ) {
					// We should always get a number back from opacity
					var ret = curCSS( elem, "opacity" );
					return ret === "" ? "1" : ret;

				}
			}
		}
	},

	// Exclude the following css properties to add px
	cssNumber: {
		"fillOpacity": true,
		"fontWeight": true,
		"lineHeight": true,
		"opacity": true,
		"orphans": true,
		"widows": true,
		"zIndex": true,
		"zoom": true
	},

	// Add in properties whose names you wish to fix before
	// setting or getting the value
	cssProps: {
		// normalize float css property
		"float": jQuery.support.cssFloat ? "cssFloat" : "styleFloat"
	},

	// Get and set the style property on a DOM Node
	style: function( elem, name, value, extra ) {
		// Don't set styles on text and comment nodes
		if ( !elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style ) {
			return;
		}

		// Make sure that we're working with the right name
		var ret, type, hooks,
			origName = jQuery.camelCase( name ),
			style = elem.style;

		name = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( style, origName ) );

		// gets hook for the prefixed version
		// followed by the unprefixed version
		hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];

		// Check if we're setting a value
		if ( value !== undefined ) {
			type = typeof value;

			// convert relative number strings (+= or -=) to relative numbers. #7345
			if ( type === "string" && (ret = rrelNum.exec( value )) ) {
				value = ( ret[1] + 1 ) * ret[2] + parseFloat( jQuery.css( elem, name ) );
				// Fixes bug #9237
				type = "number";
			}

			// Make sure that NaN and null values aren't set. See: #7116
			if ( value == null || type === "number" && isNaN( value ) ) {
				return;
			}

			// If a number was passed in, add 'px' to the (except for certain CSS properties)
			if ( type === "number" && !jQuery.cssNumber[ origName ] ) {
				value += "px";
			}

			// If a hook was provided, use that value, otherwise just set the specified value
			if ( !hooks || !("set" in hooks) || (value = hooks.set( elem, value, extra )) !== undefined ) {
				// Wrapped to prevent IE from throwing errors when 'invalid' values are provided
				// Fixes bug #5509
				try {
					style[ name ] = value;
				} catch(e) {}
			}

		} else {
			// If a hook was provided get the non-computed value from there
			if ( hooks && "get" in hooks && (ret = hooks.get( elem, false, extra )) !== undefined ) {
				return ret;
			}

			// Otherwise just get the value from the style object
			return style[ name ];
		}
	},

	css: function( elem, name, numeric, extra ) {
		var val, num, hooks,
			origName = jQuery.camelCase( name );

		// Make sure that we're working with the right name
		name = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( elem.style, origName ) );

		// gets hook for the prefixed version
		// followed by the unprefixed version
		hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];

		// If a hook was provided get the computed value from there
		if ( hooks && "get" in hooks ) {
			val = hooks.get( elem, true, extra );
		}

		// Otherwise, if a way to get the computed value exists, use that
		if ( val === undefined ) {
			val = curCSS( elem, name );
		}

		//convert "normal" to computed value
		if ( val === "normal" && name in cssNormalTransform ) {
			val = cssNormalTransform[ name ];
		}

		// Return, converting to number if forced or a qualifier was provided and val looks numeric
		if ( numeric || extra !== undefined ) {
			num = parseFloat( val );
			return numeric || jQuery.isNumeric( num ) ? num || 0 : val;
		}
		return val;
	},

	// A method for quickly swapping in/out CSS properties to get correct calculations
	swap: function( elem, options, callback ) {
		var ret, name,
			old = {};

		// Remember the old values, and insert the new ones
		for ( name in options ) {
			old[ name ] = elem.style[ name ];
			elem.style[ name ] = options[ name ];
		}

		ret = callback.call( elem );

		// Revert the old values
		for ( name in options ) {
			elem.style[ name ] = old[ name ];
		}

		return ret;
	}
});

// NOTE: To any future maintainer, we've window.getComputedStyle
// because jsdom on node.js will break without it.
if ( window.getComputedStyle ) {
	curCSS = function( elem, name ) {
		var ret, width, minWidth, maxWidth,
			computed = window.getComputedStyle( elem, null ),
			style = elem.style;

		if ( computed ) {

			// getPropertyValue is only needed for .css('filter') in IE9, see #12537
			ret = computed.getPropertyValue( name ) || computed[ name ];

			if ( ret === "" && !jQuery.contains( elem.ownerDocument, elem ) ) {
				ret = jQuery.style( elem, name );
			}

			// A tribute to the "awesome hack by Dean Edwards"
			// Chrome < 17 and Safari 5.0 uses "computed value" instead of "used value" for margin-right
			// Safari 5.1.7 (at least) returns percentage for a larger set of values, but width seems to be reliably pixels
			// this is against the CSSOM draft spec: http://dev.w3.org/csswg/cssom/#resolved-values
			if ( rnumnonpx.test( ret ) && rmargin.test( name ) ) {
				width = style.width;
				minWidth = style.minWidth;
				maxWidth = style.maxWidth;

				style.minWidth = style.maxWidth = style.width = ret;
				ret = computed.width;

				style.width = width;
				style.minWidth = minWidth;
				style.maxWidth = maxWidth;
			}
		}

		return ret;
	};
} else if ( document.documentElement.currentStyle ) {
	curCSS = function( elem, name ) {
		var left, rsLeft,
			ret = elem.currentStyle && elem.currentStyle[ name ],
			style = elem.style;

		// Avoid setting ret to empty string here
		// so we don't default to auto
		if ( ret == null && style && style[ name ] ) {
			ret = style[ name ];
		}

		// From the awesome hack by Dean Edwards
		// http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291

		// If we're not dealing with a regular pixel number
		// but a number that has a weird ending, we need to convert it to pixels
		// but not position css attributes, as those are proportional to the parent element instead
		// and we can't measure the parent instead because it might trigger a "stacking dolls" problem
		if ( rnumnonpx.test( ret ) && !rposition.test( name ) ) {

			// Remember the original values
			left = style.left;
			rsLeft = elem.runtimeStyle && elem.runtimeStyle.left;

			// Put in the new values to get a computed value out
			if ( rsLeft ) {
				elem.runtimeStyle.left = elem.currentStyle.left;
			}
			style.left = name === "fontSize" ? "1em" : ret;
			ret = style.pixelLeft + "px";

			// Revert the changed values
			style.left = left;
			if ( rsLeft ) {
				elem.runtimeStyle.left = rsLeft;
			}
		}

		return ret === "" ? "auto" : ret;
	};
}

function setPositiveNumber( elem, value, subtract ) {
	var matches = rnumsplit.exec( value );
	return matches ?
			Math.max( 0, matches[ 1 ] - ( subtract || 0 ) ) + ( matches[ 2 ] || "px" ) :
			value;
}

function augmentWidthOrHeight( elem, name, extra, isBorderBox ) {
	var i = extra === ( isBorderBox ? "border" : "content" ) ?
		// If we already have the right measurement, avoid augmentation
		4 :
		// Otherwise initialize for horizontal or vertical properties
		name === "width" ? 1 : 0,

		val = 0;

	for ( ; i < 4; i += 2 ) {
		// both box models exclude margin, so add it if we want it
		if ( extra === "margin" ) {
			// we use jQuery.css instead of curCSS here
			// because of the reliableMarginRight CSS hook!
			val += jQuery.css( elem, extra + cssExpand[ i ], true );
		}

		// From this point on we use curCSS for maximum performance (relevant in animations)
		if ( isBorderBox ) {
			// border-box includes padding, so remove it if we want content
			if ( extra === "content" ) {
				val -= parseFloat( curCSS( elem, "padding" + cssExpand[ i ] ) ) || 0;
			}

			// at this point, extra isn't border nor margin, so remove border
			if ( extra !== "margin" ) {
				val -= parseFloat( curCSS( elem, "border" + cssExpand[ i ] + "Width" ) ) || 0;
			}
		} else {
			// at this point, extra isn't content, so add padding
			val += parseFloat( curCSS( elem, "padding" + cssExpand[ i ] ) ) || 0;

			// at this point, extra isn't content nor padding, so add border
			if ( extra !== "padding" ) {
				val += parseFloat( curCSS( elem, "border" + cssExpand[ i ] + "Width" ) ) || 0;
			}
		}
	}

	return val;
}

function getWidthOrHeight( elem, name, extra ) {

	// Start with offset property, which is equivalent to the border-box value
	var val = name === "width" ? elem.offsetWidth : elem.offsetHeight,
		valueIsBorderBox = true,
		isBorderBox = jQuery.support.boxSizing && jQuery.css( elem, "boxSizing" ) === "border-box";

	// some non-html elements return undefined for offsetWidth, so check for null/undefined
	// svg - https://bugzilla.mozilla.org/show_bug.cgi?id=649285
	// MathML - https://bugzilla.mozilla.org/show_bug.cgi?id=491668
	if ( val <= 0 || val == null ) {
		// Fall back to computed then uncomputed css if necessary
		val = curCSS( elem, name );
		if ( val < 0 || val == null ) {
			val = elem.style[ name ];
		}

		// Computed unit is not pixels. Stop here and return.
		if ( rnumnonpx.test(val) ) {
			return val;
		}

		// we need the check for style in case a browser which returns unreliable values
		// for getComputedStyle silently falls back to the reliable elem.style
		valueIsBorderBox = isBorderBox && ( jQuery.support.boxSizingReliable || val === elem.style[ name ] );

		// Normalize "", auto, and prepare for extra
		val = parseFloat( val ) || 0;
	}

	// use the active box-sizing model to add/subtract irrelevant styles
	return ( val +
		augmentWidthOrHeight(
			elem,
			name,
			extra || ( isBorderBox ? "border" : "content" ),
			valueIsBorderBox
		)
	) + "px";
}


// Try to determine the default display value of an element
function css_defaultDisplay( nodeName ) {
	if ( elemdisplay[ nodeName ] ) {
		return elemdisplay[ nodeName ];
	}

	var elem = jQuery( "<" + nodeName + ">" ).appendTo( document.body ),
		display = elem.css("display");
	elem.remove();

	// If the simple way fails,
	// get element's real default display by attaching it to a temp iframe
	if ( display === "none" || display === "" ) {
		// Use the already-created iframe if possible
		iframe = document.body.appendChild(
			iframe || jQuery.extend( document.createElement("iframe"), {
				frameBorder: 0,
				width: 0,
				height: 0
			})
		);

		// Create a cacheable copy of the iframe document on first call.
		// IE and Opera will allow us to reuse the iframeDoc without re-writing the fake HTML
		// document to it; WebKit & Firefox won't allow reusing the iframe document.
		if ( !iframeDoc || !iframe.createElement ) {
			iframeDoc = ( iframe.contentWindow || iframe.contentDocument ).document;
			iframeDoc.write("<!doctype html><html><body>");
			iframeDoc.close();
		}

		elem = iframeDoc.body.appendChild( iframeDoc.createElement(nodeName) );

		display = curCSS( elem, "display" );
		document.body.removeChild( iframe );
	}

	// Store the correct default display
	elemdisplay[ nodeName ] = display;

	return display;
}

jQuery.each([ "height", "width" ], function( i, name ) {
	jQuery.cssHooks[ name ] = {
		get: function( elem, computed, extra ) {
			if ( computed ) {
				// certain elements can have dimension info if we invisibly show them
				// however, it must have a current display style that would benefit from this
				if ( elem.offsetWidth === 0 && rdisplayswap.test( curCSS( elem, "display" ) ) ) {
					return jQuery.swap( elem, cssShow, function() {
						return getWidthOrHeight( elem, name, extra );
					});
				} else {
					return getWidthOrHeight( elem, name, extra );
				}
			}
		},

		set: function( elem, value, extra ) {
			return setPositiveNumber( elem, value, extra ?
				augmentWidthOrHeight(
					elem,
					name,
					extra,
					jQuery.support.boxSizing && jQuery.css( elem, "boxSizing" ) === "border-box"
				) : 0
			);
		}
	};
});

if ( !jQuery.support.opacity ) {
	jQuery.cssHooks.opacity = {
		get: function( elem, computed ) {
			// IE uses filters for opacity
			return ropacity.test( (computed && elem.currentStyle ? elem.currentStyle.filter : elem.style.filter) || "" ) ?
				( 0.01 * parseFloat( RegExp.$1 ) ) + "" :
				computed ? "1" : "";
		},

		set: function( elem, value ) {
			var style = elem.style,
				currentStyle = elem.currentStyle,
				opacity = jQuery.isNumeric( value ) ? "alpha(opacity=" + value * 100 + ")" : "",
				filter = currentStyle && currentStyle.filter || style.filter || "";

			// IE has trouble with opacity if it does not have layout
			// Force it by setting the zoom level
			style.zoom = 1;

			// if setting opacity to 1, and no other filters exist - attempt to remove filter attribute #6652
			if ( value >= 1 && jQuery.trim( filter.replace( ralpha, "" ) ) === "" &&
				style.removeAttribute ) {

				// Setting style.filter to null, "" & " " still leave "filter:" in the cssText
				// if "filter:" is present at all, clearType is disabled, we want to avoid this
				// style.removeAttribute is IE Only, but so apparently is this code path...
				style.removeAttribute( "filter" );

				// if there there is no filter style applied in a css rule, we are done
				if ( currentStyle && !currentStyle.filter ) {
					return;
				}
			}

			// otherwise, set new filter values
			style.filter = ralpha.test( filter ) ?
				filter.replace( ralpha, opacity ) :
				filter + " " + opacity;
		}
	};
}

// These hooks cannot be added until DOM ready because the support test
// for it is not run until after DOM ready
jQuery(function() {
	if ( !jQuery.support.reliableMarginRight ) {
		jQuery.cssHooks.marginRight = {
			get: function( elem, computed ) {
				// WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
				// Work around by temporarily setting element display to inline-block
				return jQuery.swap( elem, { "display": "inline-block" }, function() {
					if ( computed ) {
						return curCSS( elem, "marginRight" );
					}
				});
			}
		};
	}

	// Webkit bug: https://bugs.webkit.org/show_bug.cgi?id=29084
	// getComputedStyle returns percent when specified for top/left/bottom/right
	// rather than make the css module depend on the offset module, we just check for it here
	if ( !jQuery.support.pixelPosition && jQuery.fn.position ) {
		jQuery.each( [ "top", "left" ], function( i, prop ) {
			jQuery.cssHooks[ prop ] = {
				get: function( elem, computed ) {
					if ( computed ) {
						var ret = curCSS( elem, prop );
						// if curCSS returns percentage, fallback to offset
						return rnumnonpx.test( ret ) ? jQuery( elem ).position()[ prop ] + "px" : ret;
					}
				}
			};
		});
	}

});

if ( jQuery.expr && jQuery.expr.filters ) {
	jQuery.expr.filters.hidden = function( elem ) {
		return ( elem.offsetWidth === 0 && elem.offsetHeight === 0 ) || (!jQuery.support.reliableHiddenOffsets && ((elem.style && elem.style.display) || curCSS( elem, "display" )) === "none");
	};

	jQuery.expr.filters.visible = function( elem ) {
		return !jQuery.expr.filters.hidden( elem );
	};
}

// These hooks are used by animate to expand properties
jQuery.each({
	margin: "",
	padding: "",
	border: "Width"
}, function( prefix, suffix ) {
	jQuery.cssHooks[ prefix + suffix ] = {
		expand: function( value ) {
			var i,

				// assumes a single number if not a string
				parts = typeof value === "string" ? value.split(" ") : [ value ],
				expanded = {};

			for ( i = 0; i < 4; i++ ) {
				expanded[ prefix + cssExpand[ i ] + suffix ] =
					parts[ i ] || parts[ i - 2 ] || parts[ 0 ];
			}

			return expanded;
		}
	};

	if ( !rmargin.test( prefix ) ) {
		jQuery.cssHooks[ prefix + suffix ].set = setPositiveNumber;
	}
});
var r20 = /%20/g,
	rbracket = /\[\]$/,
	rCRLF = /\r?\n/g,
	rinput = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
	rselectTextarea = /^(?:select|textarea)/i;

jQuery.fn.extend({
	serialize: function() {
		return jQuery.param( this.serializeArray() );
	},
	serializeArray: function() {
		return this.map(function(){
			return this.elements ? jQuery.makeArray( this.elements ) : this;
		})
		.filter(function(){
			return this.name && !this.disabled &&
				( this.checked || rselectTextarea.test( this.nodeName ) ||
					rinput.test( this.type ) );
		})
		.map(function( i, elem ){
			var val = jQuery( this ).val();

			return val == null ?
				null :
				jQuery.isArray( val ) ?
					jQuery.map( val, function( val, i ){
						return { name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
					}) :
					{ name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
		}).get();
	}
});

//Serialize an array of form elements or a set of
//key/values into a query string
jQuery.param = function( a, traditional ) {
	var prefix,
		s = [],
		add = function( key, value ) {
			// If value is a function, invoke it and return its value
			value = jQuery.isFunction( value ) ? value() : ( value == null ? "" : value );
			s[ s.length ] = encodeURIComponent( key ) + "=" + encodeURIComponent( value );
		};

	// Set traditional to true for jQuery <= 1.3.2 behavior.
	if ( traditional === undefined ) {
		traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional;
	}

	// If an array was passed in, assume that it is an array of form elements.
	if ( jQuery.isArray( a ) || ( a.jquery && !jQuery.isPlainObject( a ) ) ) {
		// Serialize the form elements
		jQuery.each( a, function() {
			add( this.name, this.value );
		});

	} else {
		// If traditional, encode the "old" way (the way 1.3.2 or older
		// did it), otherwise encode params recursively.
		for ( prefix in a ) {
			buildParams( prefix, a[ prefix ], traditional, add );
		}
	}

	// Return the resulting serialization
	return s.join( "&" ).replace( r20, "+" );
};

function buildParams( prefix, obj, traditional, add ) {
	var name;

	if ( jQuery.isArray( obj ) ) {
		// Serialize array item.
		jQuery.each( obj, function( i, v ) {
			if ( traditional || rbracket.test( prefix ) ) {
				// Treat each array item as a scalar.
				add( prefix, v );

			} else {
				// If array item is non-scalar (array or object), encode its
				// numeric index to resolve deserialization ambiguity issues.
				// Note that rack (as of 1.0.0) can't currently deserialize
				// nested arrays properly, and attempting to do so may cause
				// a server error. Possible fixes are to modify rack's
				// deserialization algorithm or to provide an option or flag
				// to force array serialization to be shallow.
				buildParams( prefix + "[" + ( typeof v === "object" ? i : "" ) + "]", v, traditional, add );
			}
		});

	} else if ( !traditional && jQuery.type( obj ) === "object" ) {
		// Serialize object item.
		for ( name in obj ) {
			buildParams( prefix + "[" + name + "]", obj[ name ], traditional, add );
		}

	} else {
		// Serialize scalar item.
		add( prefix, obj );
	}
}
var
	// Document location
	ajaxLocParts,
	ajaxLocation,

	rhash = /#.*$/,
	rheaders = /^(.*?):[ \t]*([^\r\n]*)\r?$/mg, // IE leaves an \r character at EOL
	// #7653, #8125, #8152: local protocol detection
	rlocalProtocol = /^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,
	rnoContent = /^(?:GET|HEAD)$/,
	rprotocol = /^\/\//,
	rquery = /\?/,
	rscript = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
	rts = /([?&])_=[^&]*/,
	rurl = /^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,

	// Keep a copy of the old load method
	_load = jQuery.fn.load,

	/* Prefilters
	 * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)
	 * 2) These are called:
	 *    - BEFORE asking for a transport
	 *    - AFTER param serialization (s.data is a string if s.processData is true)
	 * 3) key is the dataType
	 * 4) the catchall symbol "*" can be used
	 * 5) execution will start with transport dataType and THEN continue down to "*" if needed
	 */
	prefilters = {},

	/* Transports bindings
	 * 1) key is the dataType
	 * 2) the catchall symbol "*" can be used
	 * 3) selection will start with transport dataType and THEN go to "*" if needed
	 */
	transports = {},

	// Avoid comment-prolog char sequence (#10098); must appease lint and evade compression
	allTypes = ["*/"] + ["*"];

// #8138, IE may throw an exception when accessing
// a field from window.location if document.domain has been set
try {
	ajaxLocation = location.href;
} catch( e ) {
	// Use the href attribute of an A element
	// since IE will modify it given document.location
	ajaxLocation = document.createElement( "a" );
	ajaxLocation.href = "";
	ajaxLocation = ajaxLocation.href;
}

// Segment location into parts
ajaxLocParts = rurl.exec( ajaxLocation.toLowerCase() ) || [];

// Base "constructor" for jQuery.ajaxPrefilter and jQuery.ajaxTransport
function addToPrefiltersOrTransports( structure ) {

	// dataTypeExpression is optional and defaults to "*"
	return function( dataTypeExpression, func ) {

		if ( typeof dataTypeExpression !== "string" ) {
			func = dataTypeExpression;
			dataTypeExpression = "*";
		}

		var dataType, list, placeBefore,
			dataTypes = dataTypeExpression.toLowerCase().split( core_rspace ),
			i = 0,
			length = dataTypes.length;

		if ( jQuery.isFunction( func ) ) {
			// For each dataType in the dataTypeExpression
			for ( ; i < length; i++ ) {
				dataType = dataTypes[ i ];
				// We control if we're asked to add before
				// any existing element
				placeBefore = /^\+/.test( dataType );
				if ( placeBefore ) {
					dataType = dataType.substr( 1 ) || "*";
				}
				list = structure[ dataType ] = structure[ dataType ] || [];
				// then we add to the structure accordingly
				list[ placeBefore ? "unshift" : "push" ]( func );
			}
		}
	};
}

// Base inspection function for prefilters and transports
function inspectPrefiltersOrTransports( structure, options, originalOptions, jqXHR,
		dataType /* internal */, inspected /* internal */ ) {

	dataType = dataType || options.dataTypes[ 0 ];
	inspected = inspected || {};

	inspected[ dataType ] = true;

	var selection,
		list = structure[ dataType ],
		i = 0,
		length = list ? list.length : 0,
		executeOnly = ( structure === prefilters );

	for ( ; i < length && ( executeOnly || !selection ); i++ ) {
		selection = list[ i ]( options, originalOptions, jqXHR );
		// If we got redirected to another dataType
		// we try there if executing only and not done already
		if ( typeof selection === "string" ) {
			if ( !executeOnly || inspected[ selection ] ) {
				selection = undefined;
			} else {
				options.dataTypes.unshift( selection );
				selection = inspectPrefiltersOrTransports(
						structure, options, originalOptions, jqXHR, selection, inspected );
			}
		}
	}
	// If we're only executing or nothing was selected
	// we try the catchall dataType if not done already
	if ( ( executeOnly || !selection ) && !inspected[ "*" ] ) {
		selection = inspectPrefiltersOrTransports(
				structure, options, originalOptions, jqXHR, "*", inspected );
	}
	// unnecessary when only executing (prefilters)
	// but it'll be ignored by the caller in that case
	return selection;
}

// A special extend for ajax options
// that takes "flat" options (not to be deep extended)
// Fixes #9887
function ajaxExtend( target, src ) {
	var key, deep,
		flatOptions = jQuery.ajaxSettings.flatOptions || {};
	for ( key in src ) {
		if ( src[ key ] !== undefined ) {
			( flatOptions[ key ] ? target : ( deep || ( deep = {} ) ) )[ key ] = src[ key ];
		}
	}
	if ( deep ) {
		jQuery.extend( true, target, deep );
	}
}

jQuery.fn.load = function( url, params, callback ) {
	if ( typeof url !== "string" && _load ) {
		return _load.apply( this, arguments );
	}

	// Don't do a request if no elements are being requested
	if ( !this.length ) {
		return this;
	}

	var selector, type, response,
		self = this,
		off = url.indexOf(" ");

	if ( off >= 0 ) {
		selector = url.slice( off, url.length );
		url = url.slice( 0, off );
	}

	// If it's a function
	if ( jQuery.isFunction( params ) ) {

		// We assume that it's the callback
		callback = params;
		params = undefined;

	// Otherwise, build a param string
	} else if ( params && typeof params === "object" ) {
		type = "POST";
	}

	// Request the remote document
	jQuery.ajax({
		url: url,

		// if "type" variable is undefined, then "GET" method will be used
		type: type,
		dataType: "html",
		data: params,
		complete: function( jqXHR, status ) {
			if ( callback ) {
				self.each( callback, response || [ jqXHR.responseText, status, jqXHR ] );
			}
		}
	}).done(function( responseText ) {

		// Save response for use in complete callback
		response = arguments;

		// See if a selector was specified
		self.html( selector ?

			// Create a dummy div to hold the results
			jQuery("<div>")

				// inject the contents of the document in, removing the scripts
				// to avoid any 'Permission Denied' errors in IE
				.append( responseText.replace( rscript, "" ) )

				// Locate the specified elements
				.find( selector ) :

			// If not, just inject the full result
			responseText );

	});

	return this;
};

// Attach a bunch of functions for handling common AJAX events
jQuery.each( "ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split( " " ), function( i, o ){
	jQuery.fn[ o ] = function( f ){
		return this.on( o, f );
	};
});

jQuery.each( [ "get", "post" ], function( i, method ) {
	jQuery[ method ] = function( url, data, callback, type ) {
		// shift arguments if data argument was omitted
		if ( jQuery.isFunction( data ) ) {
			type = type || callback;
			callback = data;
			data = undefined;
		}

		return jQuery.ajax({
			type: method,
			url: url,
			data: data,
			success: callback,
			dataType: type
		});
	};
});

jQuery.extend({

	getScript: function( url, callback ) {
		return jQuery.get( url, undefined, callback, "script" );
	},

	getJSON: function( url, data, callback ) {
		return jQuery.get( url, data, callback, "json" );
	},

	// Creates a full fledged settings object into target
	// with both ajaxSettings and settings fields.
	// If target is omitted, writes into ajaxSettings.
	ajaxSetup: function( target, settings ) {
		if ( settings ) {
			// Building a settings object
			ajaxExtend( target, jQuery.ajaxSettings );
		} else {
			// Extending ajaxSettings
			settings = target;
			target = jQuery.ajaxSettings;
		}
		ajaxExtend( target, settings );
		return target;
	},

	ajaxSettings: {
		url: ajaxLocation,
		isLocal: rlocalProtocol.test( ajaxLocParts[ 1 ] ),
		global: true,
		type: "GET",
		contentType: "application/x-www-form-urlencoded; charset=UTF-8",
		processData: true,
		async: true,
		/*
		timeout: 0,
		data: null,
		dataType: null,
		username: null,
		password: null,
		cache: null,
		throws: false,
		traditional: false,
		headers: {},
		*/

		accepts: {
			xml: "application/xml, text/xml",
			html: "text/html",
			text: "text/plain",
			json: "application/json, text/javascript",
			"*": allTypes
		},

		contents: {
			xml: /xml/,
			html: /html/,
			json: /json/
		},

		responseFields: {
			xml: "responseXML",
			text: "responseText"
		},

		// List of data converters
		// 1) key format is "source_type destination_type" (a single space in-between)
		// 2) the catchall symbol "*" can be used for source_type
		converters: {

			// Convert anything to text
			"* text": window.String,

			// Text to html (true = no transformation)
			"text html": true,

			// Evaluate text as a json expression
			"text json": jQuery.parseJSON,

			// Parse text as xml
			"text xml": jQuery.parseXML
		},

		// For options that shouldn't be deep extended:
		// you can add your own custom options here if
		// and when you create one that shouldn't be
		// deep extended (see ajaxExtend)
		flatOptions: {
			context: true,
			url: true
		}
	},

	ajaxPrefilter: addToPrefiltersOrTransports( prefilters ),
	ajaxTransport: addToPrefiltersOrTransports( transports ),

	// Main method
	ajax: function( url, options ) {

		// If url is an object, simulate pre-1.5 signature
		if ( typeof url === "object" ) {
			options = url;
			url = undefined;
		}

		// Force options to be an object
		options = options || {};

		var // ifModified key
			ifModifiedKey,
			// Response headers
			responseHeadersString,
			responseHeaders,
			// transport
			transport,
			// timeout handle
			timeoutTimer,
			// Cross-domain detection vars
			parts,
			// To know if global events are to be dispatched
			fireGlobals,
			// Loop variable
			i,
			// Create the final options object
			s = jQuery.ajaxSetup( {}, options ),
			// Callbacks context
			callbackContext = s.context || s,
			// Context for global events
			// It's the callbackContext if one was provided in the options
			// and if it's a DOM node or a jQuery collection
			globalEventContext = callbackContext !== s &&
				( callbackContext.nodeType || callbackContext instanceof jQuery ) ?
						jQuery( callbackContext ) : jQuery.event,
			// Deferreds
			deferred = jQuery.Deferred(),
			completeDeferred = jQuery.Callbacks( "once memory" ),
			// Status-dependent callbacks
			statusCode = s.statusCode || {},
			// Headers (they are sent all at once)
			requestHeaders = {},
			requestHeadersNames = {},
			// The jqXHR state
			state = 0,
			// Default abort message
			strAbort = "canceled",
			// Fake xhr
			jqXHR = {

				readyState: 0,

				// Caches the header
				setRequestHeader: function( name, value ) {
					if ( !state ) {
						var lname = name.toLowerCase();
						name = requestHeadersNames[ lname ] = requestHeadersNames[ lname ] || name;
						requestHeaders[ name ] = value;
					}
					return this;
				},

				// Raw string
				getAllResponseHeaders: function() {
					return state === 2 ? responseHeadersString : null;
				},

				// Builds headers hashtable if needed
				getResponseHeader: function( key ) {
					var match;
					if ( state === 2 ) {
						if ( !responseHeaders ) {
							responseHeaders = {};
							while( ( match = rheaders.exec( responseHeadersString ) ) ) {
								responseHeaders[ match[1].toLowerCase() ] = match[ 2 ];
							}
						}
						match = responseHeaders[ key.toLowerCase() ];
					}
					return match === undefined ? null : match;
				},

				// Overrides response content-type header
				overrideMimeType: function( type ) {
					if ( !state ) {
						s.mimeType = type;
					}
					return this;
				},

				// Cancel the request
				abort: function( statusText ) {
					statusText = statusText || strAbort;
					if ( transport ) {
						transport.abort( statusText );
					}
					done( 0, statusText );
					return this;
				}
			};

		// Callback for when everything is done
		// It is defined here because jslint complains if it is declared
		// at the end of the function (which would be more logical and readable)
		function done( status, nativeStatusText, responses, headers ) {
			var isSuccess, success, error, response, modified,
				statusText = nativeStatusText;

			// Called once
			if ( state === 2 ) {
				return;
			}

			// State is "done" now
			state = 2;

			// Clear timeout if it exists
			if ( timeoutTimer ) {
				clearTimeout( timeoutTimer );
			}

			// Dereference transport for early garbage collection
			// (no matter how long the jqXHR object will be used)
			transport = undefined;

			// Cache response headers
			responseHeadersString = headers || "";

			// Set readyState
			jqXHR.readyState = status > 0 ? 4 : 0;

			// Get response data
			if ( responses ) {
				response = ajaxHandleResponses( s, jqXHR, responses );
			}

			// If successful, handle type chaining
			if ( status >= 200 && status < 300 || status === 304 ) {

				// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
				if ( s.ifModified ) {

					modified = jqXHR.getResponseHeader("Last-Modified");
					if ( modified ) {
						jQuery.lastModified[ ifModifiedKey ] = modified;
					}
					modified = jqXHR.getResponseHeader("Etag");
					if ( modified ) {
						jQuery.etag[ ifModifiedKey ] = modified;
					}
				}

				// If not modified
				if ( status === 304 ) {

					statusText = "notmodified";
					isSuccess = true;

				// If we have data
				} else {

					isSuccess = ajaxConvert( s, response );
					statusText = isSuccess.state;
					success = isSuccess.data;
					error = isSuccess.error;
					isSuccess = !error;
				}
			} else {
				// We extract error from statusText
				// then normalize statusText and status for non-aborts
				error = statusText;
				if ( !statusText || status ) {
					statusText = "error";
					if ( status < 0 ) {
						status = 0;
					}
				}
			}

			// Set data for the fake xhr object
			jqXHR.status = status;
			jqXHR.statusText = ( nativeStatusText || statusText ) + "";

			// Success/Error
			if ( isSuccess ) {
				deferred.resolveWith( callbackContext, [ success, statusText, jqXHR ] );
			} else {
				deferred.rejectWith( callbackContext, [ jqXHR, statusText, error ] );
			}

			// Status-dependent callbacks
			jqXHR.statusCode( statusCode );
			statusCode = undefined;

			if ( fireGlobals ) {
				globalEventContext.trigger( "ajax" + ( isSuccess ? "Success" : "Error" ),
						[ jqXHR, s, isSuccess ? success : error ] );
			}

			// Complete
			completeDeferred.fireWith( callbackContext, [ jqXHR, statusText ] );

			if ( fireGlobals ) {
				globalEventContext.trigger( "ajaxComplete", [ jqXHR, s ] );
				// Handle the global AJAX counter
				if ( !( --jQuery.active ) ) {
					jQuery.event.trigger( "ajaxStop" );
				}
			}
		}

		// Attach deferreds
		deferred.promise( jqXHR );
		jqXHR.success = jqXHR.done;
		jqXHR.error = jqXHR.fail;
		jqXHR.complete = completeDeferred.add;

		// Status-dependent callbacks
		jqXHR.statusCode = function( map ) {
			if ( map ) {
				var tmp;
				if ( state < 2 ) {
					for ( tmp in map ) {
						statusCode[ tmp ] = [ statusCode[tmp], map[tmp] ];
					}
				} else {
					tmp = map[ jqXHR.status ];
					jqXHR.always( tmp );
				}
			}
			return this;
		};

		// Remove hash character (#7531: and string promotion)
		// Add protocol if not provided (#5866: IE7 issue with protocol-less urls)
		// We also use the url parameter if available
		s.url = ( ( url || s.url ) + "" ).replace( rhash, "" ).replace( rprotocol, ajaxLocParts[ 1 ] + "//" );

		// Extract dataTypes list
		s.dataTypes = jQuery.trim( s.dataType || "*" ).toLowerCase().split( core_rspace );

		// A cross-domain request is in order when we have a protocol:host:port mismatch
		if ( s.crossDomain == null ) {
			parts = rurl.exec( s.url.toLowerCase() );
			s.crossDomain = !!( parts &&
				( parts[ 1 ] !== ajaxLocParts[ 1 ] || parts[ 2 ] !== ajaxLocParts[ 2 ] ||
					( parts[ 3 ] || ( parts[ 1 ] === "http:" ? 80 : 443 ) ) !=
						( ajaxLocParts[ 3 ] || ( ajaxLocParts[ 1 ] === "http:" ? 80 : 443 ) ) )
			);
		}

		// Convert data if not already a string
		if ( s.data && s.processData && typeof s.data !== "string" ) {
			s.data = jQuery.param( s.data, s.traditional );
		}

		// Apply prefilters
		inspectPrefiltersOrTransports( prefilters, s, options, jqXHR );

		// If request was aborted inside a prefilter, stop there
		if ( state === 2 ) {
			return jqXHR;
		}

		// We can fire global events as of now if asked to
		fireGlobals = s.global;

		// Uppercase the type
		s.type = s.type.toUpperCase();

		// Determine if request has content
		s.hasContent = !rnoContent.test( s.type );

		// Watch for a new set of requests
		if ( fireGlobals && jQuery.active++ === 0 ) {
			jQuery.event.trigger( "ajaxStart" );
		}

		// More options handling for requests with no content
		if ( !s.hasContent ) {

			// If data is available, append data to url
			if ( s.data ) {
				s.url += ( rquery.test( s.url ) ? "&" : "?" ) + s.data;
				// #9682: remove data so that it's not used in an eventual retry
				delete s.data;
			}

			// Get ifModifiedKey before adding the anti-cache parameter
			ifModifiedKey = s.url;

			// Add anti-cache in url if needed
			if ( s.cache === false ) {

				var ts = jQuery.now(),
					// try replacing _= if it is there
					ret = s.url.replace( rts, "$1_=" + ts );

				// if nothing was replaced, add timestamp to the end
				s.url = ret + ( ( ret === s.url ) ? ( rquery.test( s.url ) ? "&" : "?" ) + "_=" + ts : "" );
			}
		}

		// Set the correct header, if data is being sent
		if ( s.data && s.hasContent && s.contentType !== false || options.contentType ) {
			jqXHR.setRequestHeader( "Content-Type", s.contentType );
		}

		// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
		if ( s.ifModified ) {
			ifModifiedKey = ifModifiedKey || s.url;
			if ( jQuery.lastModified[ ifModifiedKey ] ) {
				jqXHR.setRequestHeader( "If-Modified-Since", jQuery.lastModified[ ifModifiedKey ] );
			}
			if ( jQuery.etag[ ifModifiedKey ] ) {
				jqXHR.setRequestHeader( "If-None-Match", jQuery.etag[ ifModifiedKey ] );
			}
		}

		// Set the Accepts header for the server, depending on the dataType
		jqXHR.setRequestHeader(
			"Accept",
			s.dataTypes[ 0 ] && s.accepts[ s.dataTypes[0] ] ?
				s.accepts[ s.dataTypes[0] ] + ( s.dataTypes[ 0 ] !== "*" ? ", " + allTypes + "; q=0.01" : "" ) :
				s.accepts[ "*" ]
		);

		// Check for headers option
		for ( i in s.headers ) {
			jqXHR.setRequestHeader( i, s.headers[ i ] );
		}

		// Allow custom headers/mimetypes and early abort
		if ( s.beforeSend && ( s.beforeSend.call( callbackContext, jqXHR, s ) === false || state === 2 ) ) {
				// Abort if not done already and return
				return jqXHR.abort();

		}

		// aborting is no longer a cancellation
		strAbort = "abort";

		// Install callbacks on deferreds
		for ( i in { success: 1, error: 1, complete: 1 } ) {
			jqXHR[ i ]( s[ i ] );
		}

		// Get transport
		transport = inspectPrefiltersOrTransports( transports, s, options, jqXHR );

		// If no transport, we auto-abort
		if ( !transport ) {
			done( -1, "No Transport" );
		} else {
			jqXHR.readyState = 1;
			// Send global event
			if ( fireGlobals ) {
				globalEventContext.trigger( "ajaxSend", [ jqXHR, s ] );
			}
			// Timeout
			if ( s.async && s.timeout > 0 ) {
				timeoutTimer = setTimeout( function(){
					jqXHR.abort( "timeout" );
				}, s.timeout );
			}

			try {
				state = 1;
				transport.send( requestHeaders, done );
			} catch (e) {
				// Propagate exception as error if not done
				if ( state < 2 ) {
					done( -1, e );
				// Simply rethrow otherwise
				} else {
					throw e;
				}
			}
		}

		return jqXHR;
	},

	// Counter for holding the number of active queries
	active: 0,

	// Last-Modified header cache for next request
	lastModified: {},
	etag: {}

});

/* Handles responses to an ajax request:
 * - sets all responseXXX fields accordingly
 * - finds the right dataType (mediates between content-type and expected dataType)
 * - returns the corresponding response
 */
function ajaxHandleResponses( s, jqXHR, responses ) {

	var ct, type, finalDataType, firstDataType,
		contents = s.contents,
		dataTypes = s.dataTypes,
		responseFields = s.responseFields;

	// Fill responseXXX fields
	for ( type in responseFields ) {
		if ( type in responses ) {
			jqXHR[ responseFields[type] ] = responses[ type ];
		}
	}

	// Remove auto dataType and get content-type in the process
	while( dataTypes[ 0 ] === "*" ) {
		dataTypes.shift();
		if ( ct === undefined ) {
			ct = s.mimeType || jqXHR.getResponseHeader( "content-type" );
		}
	}

	// Check if we're dealing with a known content-type
	if ( ct ) {
		for ( type in contents ) {
			if ( contents[ type ] && contents[ type ].test( ct ) ) {
				dataTypes.unshift( type );
				break;
			}
		}
	}

	// Check to see if we have a response for the expected dataType
	if ( dataTypes[ 0 ] in responses ) {
		finalDataType = dataTypes[ 0 ];
	} else {
		// Try convertible dataTypes
		for ( type in responses ) {
			if ( !dataTypes[ 0 ] || s.converters[ type + " " + dataTypes[0] ] ) {
				finalDataType = type;
				break;
			}
			if ( !firstDataType ) {
				firstDataType = type;
			}
		}
		// Or just use first one
		finalDataType = finalDataType || firstDataType;
	}

	// If we found a dataType
	// We add the dataType to the list if needed
	// and return the corresponding response
	if ( finalDataType ) {
		if ( finalDataType !== dataTypes[ 0 ] ) {
			dataTypes.unshift( finalDataType );
		}
		return responses[ finalDataType ];
	}
}

// Chain conversions given the request and the original response
function ajaxConvert( s, response ) {

	var conv, conv2, current, tmp,
		// Work with a copy of dataTypes in case we need to modify it for conversion
		dataTypes = s.dataTypes.slice(),
		prev = dataTypes[ 0 ],
		converters = {},
		i = 0;

	// Apply the dataFilter if provided
	if ( s.dataFilter ) {
		response = s.dataFilter( response, s.dataType );
	}

	// Create converters map with lowercased keys
	if ( dataTypes[ 1 ] ) {
		for ( conv in s.converters ) {
			converters[ conv.toLowerCase() ] = s.converters[ conv ];
		}
	}

	// Convert to each sequential dataType, tolerating list modification
	for ( ; (current = dataTypes[++i]); ) {

		// There's only work to do if current dataType is non-auto
		if ( current !== "*" ) {

			// Convert response if prev dataType is non-auto and differs from current
			if ( prev !== "*" && prev !== current ) {

				// Seek a direct converter
				conv = converters[ prev + " " + current ] || converters[ "* " + current ];

				// If none found, seek a pair
				if ( !conv ) {
					for ( conv2 in converters ) {

						// If conv2 outputs current
						tmp = conv2.split(" ");
						if ( tmp[ 1 ] === current ) {

							// If prev can be converted to accepted input
							conv = converters[ prev + " " + tmp[ 0 ] ] ||
								converters[ "* " + tmp[ 0 ] ];
							if ( conv ) {
								// Condense equivalence converters
								if ( conv === true ) {
									conv = converters[ conv2 ];

								// Otherwise, insert the intermediate dataType
								} else if ( converters[ conv2 ] !== true ) {
									current = tmp[ 0 ];
									dataTypes.splice( i--, 0, current );
								}

								break;
							}
						}
					}
				}

				// Apply converter (if not an equivalence)
				if ( conv !== true ) {

					// Unless errors are allowed to bubble, catch and return them
					if ( conv && s["throws"] ) {
						response = conv( response );
					} else {
						try {
							response = conv( response );
						} catch ( e ) {
							return { state: "parsererror", error: conv ? e : "No conversion from " + prev + " to " + current };
						}
					}
				}
			}

			// Update prev for next iteration
			prev = current;
		}
	}

	return { state: "success", data: response };
}
var oldCallbacks = [],
	rquestion = /\?/,
	rjsonp = /(=)\?(?=&|$)|\?\?/,
	nonce = jQuery.now();

// Default jsonp settings
jQuery.ajaxSetup({
	jsonp: "callback",
	jsonpCallback: function() {
		var callback = oldCallbacks.pop() || ( jQuery.expando + "_" + ( nonce++ ) );
		this[ callback ] = true;
		return callback;
	}
});

// Detect, normalize options and install callbacks for jsonp requests
jQuery.ajaxPrefilter( "json jsonp", function( s, originalSettings, jqXHR ) {

	var callbackName, overwritten, responseContainer,
		data = s.data,
		url = s.url,
		hasCallback = s.jsonp !== false,
		replaceInUrl = hasCallback && rjsonp.test( url ),
		replaceInData = hasCallback && !replaceInUrl && typeof data === "string" &&
			!( s.contentType || "" ).indexOf("application/x-www-form-urlencoded") &&
			rjsonp.test( data );

	// Handle iff the expected data type is "jsonp" or we have a parameter to set
	if ( s.dataTypes[ 0 ] === "jsonp" || replaceInUrl || replaceInData ) {

		// Get callback name, remembering preexisting value associated with it
		callbackName = s.jsonpCallback = jQuery.isFunction( s.jsonpCallback ) ?
			s.jsonpCallback() :
			s.jsonpCallback;
		overwritten = window[ callbackName ];

		// Insert callback into url or form data
		if ( replaceInUrl ) {
			s.url = url.replace( rjsonp, "$1" + callbackName );
		} else if ( replaceInData ) {
			s.data = data.replace( rjsonp, "$1" + callbackName );
		} else if ( hasCallback ) {
			s.url += ( rquestion.test( url ) ? "&" : "?" ) + s.jsonp + "=" + callbackName;
		}

		// Use data converter to retrieve json after script execution
		s.converters["script json"] = function() {
			if ( !responseContainer ) {
				jQuery.error( callbackName + " was not called" );
			}
			return responseContainer[ 0 ];
		};

		// force json dataType
		s.dataTypes[ 0 ] = "json";

		// Install callback
		window[ callbackName ] = function() {
			responseContainer = arguments;
		};

		// Clean-up function (fires after converters)
		jqXHR.always(function() {
			// Restore preexisting value
			window[ callbackName ] = overwritten;

			// Save back as free
			if ( s[ callbackName ] ) {
				// make sure that re-using the options doesn't screw things around
				s.jsonpCallback = originalSettings.jsonpCallback;

				// save the callback name for future use
				oldCallbacks.push( callbackName );
			}

			// Call if it was a function and we have a response
			if ( responseContainer && jQuery.isFunction( overwritten ) ) {
				overwritten( responseContainer[ 0 ] );
			}

			responseContainer = overwritten = undefined;
		});

		// Delegate to script
		return "script";
	}
});
// Install script dataType
jQuery.ajaxSetup({
	accepts: {
		script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
	},
	contents: {
		script: /javascript|ecmascript/
	},
	converters: {
		"text script": function( text ) {
			jQuery.globalEval( text );
			return text;
		}
	}
});

// Handle cache's special case and global
jQuery.ajaxPrefilter( "script", function( s ) {
	if ( s.cache === undefined ) {
		s.cache = false;
	}
	if ( s.crossDomain ) {
		s.type = "GET";
		s.global = false;
	}
});

// Bind script tag hack transport
jQuery.ajaxTransport( "script", function(s) {

	// This transport only deals with cross domain requests
	if ( s.crossDomain ) {

		var script,
			head = document.head || document.getElementsByTagName( "head" )[0] || document.documentElement;

		return {

			send: function( _, callback ) {

				script = document.createElement( "script" );

				script.async = "async";

				if ( s.scriptCharset ) {
					script.charset = s.scriptCharset;
				}

				script.src = s.url;

				// Attach handlers for all browsers
				script.onload = script.onreadystatechange = function( _, isAbort ) {

					if ( isAbort || !script.readyState || /loaded|complete/.test( script.readyState ) ) {

						// Handle memory leak in IE
						script.onload = script.onreadystatechange = null;

						// Remove the script
						if ( head && script.parentNode ) {
							head.removeChild( script );
						}

						// Dereference the script
						script = undefined;

						// Callback if not abort
						if ( !isAbort ) {
							callback( 200, "success" );
						}
					}
				};
				// Use insertBefore instead of appendChild  to circumvent an IE6 bug.
				// This arises when a base node is used (#2709 and #4378).
				head.insertBefore( script, head.firstChild );
			},

			abort: function() {
				if ( script ) {
					script.onload( 0, 1 );
				}
			}
		};
	}
});
var xhrCallbacks,
	// #5280: Internet Explorer will keep connections alive if we don't abort on unload
	xhrOnUnloadAbort = window.ActiveXObject ? function() {
		// Abort all pending requests
		for ( var key in xhrCallbacks ) {
			xhrCallbacks[ key ]( 0, 1 );
		}
	} : false,
	xhrId = 0;

// Functions to create xhrs
function createStandardXHR() {
	try {
		return new window.XMLHttpRequest();
	} catch( e ) {}
}

function createActiveXHR() {
	try {
		return new window.ActiveXObject( "Microsoft.XMLHTTP" );
	} catch( e ) {}
}

// Create the request object
// (This is still attached to ajaxSettings for backward compatibility)
jQuery.ajaxSettings.xhr = window.ActiveXObject ?
	/* Microsoft failed to properly
	 * implement the XMLHttpRequest in IE7 (can't request local files),
	 * so we use the ActiveXObject when it is available
	 * Additionally XMLHttpRequest can be disabled in IE7/IE8 so
	 * we need a fallback.
	 */
	function() {
		return !this.isLocal && createStandardXHR() || createActiveXHR();
	} :
	// For all other browsers, use the standard XMLHttpRequest object
	createStandardXHR;

// Determine support properties
(function( xhr ) {
	jQuery.extend( jQuery.support, {
		ajax: !!xhr,
		cors: !!xhr && ( "withCredentials" in xhr )
	});
})( jQuery.ajaxSettings.xhr() );

// Create transport if the browser can provide an xhr
if ( jQuery.support.ajax ) {

	jQuery.ajaxTransport(function( s ) {
		// Cross domain only allowed if supported through XMLHttpRequest
		if ( !s.crossDomain || jQuery.support.cors ) {

			var callback;

			return {
				send: function( headers, complete ) {

					// Get a new xhr
					var handle, i,
						xhr = s.xhr();

					// Open the socket
					// Passing null username, generates a login popup on Opera (#2865)
					if ( s.username ) {
						xhr.open( s.type, s.url, s.async, s.username, s.password );
					} else {
						xhr.open( s.type, s.url, s.async );
					}

					// Apply custom fields if provided
					if ( s.xhrFields ) {
						for ( i in s.xhrFields ) {
							xhr[ i ] = s.xhrFields[ i ];
						}
					}

					// Override mime type if needed
					if ( s.mimeType && xhr.overrideMimeType ) {
						xhr.overrideMimeType( s.mimeType );
					}

					// X-Requested-With header
					// For cross-domain requests, seeing as conditions for a preflight are
					// akin to a jigsaw puzzle, we simply never set it to be sure.
					// (it can always be set on a per-request basis or even using ajaxSetup)
					// For same-domain requests, won't change header if already provided.
					if ( !s.crossDomain && !headers["X-Requested-With"] ) {
						headers[ "X-Requested-With" ] = "XMLHttpRequest";
					}

					// Need an extra try/catch for cross domain requests in Firefox 3
					try {
						for ( i in headers ) {
							xhr.setRequestHeader( i, headers[ i ] );
						}
					} catch( _ ) {}

					// Do send the request
					// This may raise an exception which is actually
					// handled in jQuery.ajax (so no try/catch here)
					xhr.send( ( s.hasContent && s.data ) || null );

					// Listener
					callback = function( _, isAbort ) {

						var status,
							statusText,
							responseHeaders,
							responses,
							xml;

						// Firefox throws exceptions when accessing properties
						// of an xhr when a network error occurred
						// http://helpful.knobs-dials.com/index.php/Component_returned_failure_code:_0x80040111_(NS_ERROR_NOT_AVAILABLE)
						try {

							// Was never called and is aborted or complete
							if ( callback && ( isAbort || xhr.readyState === 4 ) ) {

								// Only called once
								callback = undefined;

								// Do not keep as active anymore
								if ( handle ) {
									xhr.onreadystatechange = jQuery.noop;
									if ( xhrOnUnloadAbort ) {
										delete xhrCallbacks[ handle ];
									}
								}

								// If it's an abort
								if ( isAbort ) {
									// Abort it manually if needed
									if ( xhr.readyState !== 4 ) {
										xhr.abort();
									}
								} else {
									status = xhr.status;
									responseHeaders = xhr.getAllResponseHeaders();
									responses = {};
									xml = xhr.responseXML;

									// Construct response list
									if ( xml && xml.documentElement /* #4958 */ ) {
										responses.xml = xml;
									}

									// When requesting binary data, IE6-9 will throw an exception
									// on any attempt to access responseText (#11426)
									try {
										responses.text = xhr.responseText;
									} catch( e ) {
									}

									// Firefox throws an exception when accessing
									// statusText for faulty cross-domain requests
									try {
										statusText = xhr.statusText;
									} catch( e ) {
										// We normalize with Webkit giving an empty statusText
										statusText = "";
									}

									// Filter status for non standard behaviors

									// If the request is local and we have data: assume a success
									// (success with no data won't get notified, that's the best we
									// can do given current implementations)
									if ( !status && s.isLocal && !s.crossDomain ) {
										status = responses.text ? 200 : 404;
									// IE - #1450: sometimes returns 1223 when it should be 204
									} else if ( status === 1223 ) {
										status = 204;
									}
								}
							}
						} catch( firefoxAccessException ) {
							if ( !isAbort ) {
								complete( -1, firefoxAccessException );
							}
						}

						// Call complete if needed
						if ( responses ) {
							complete( status, statusText, responses, responseHeaders );
						}
					};

					if ( !s.async ) {
						// if we're in sync mode we fire the callback
						callback();
					} else if ( xhr.readyState === 4 ) {
						// (IE6 & IE7) if it's in cache and has been
						// retrieved directly we need to fire the callback
						setTimeout( callback, 0 );
					} else {
						handle = ++xhrId;
						if ( xhrOnUnloadAbort ) {
							// Create the active xhrs callbacks list if needed
							// and attach the unload handler
							if ( !xhrCallbacks ) {
								xhrCallbacks = {};
								jQuery( window ).unload( xhrOnUnloadAbort );
							}
							// Add to list of active xhrs callbacks
							xhrCallbacks[ handle ] = callback;
						}
						xhr.onreadystatechange = callback;
					}
				},

				abort: function() {
					if ( callback ) {
						callback(0,1);
					}
				}
			};
		}
	});
}
var fxNow, timerId,
	rfxtypes = /^(?:toggle|show|hide)$/,
	rfxnum = new RegExp( "^(?:([-+])=|)(" + core_pnum + ")([a-z%]*)$", "i" ),
	rrun = /queueHooks$/,
	animationPrefilters = [ defaultPrefilter ],
	tweeners = {
		"*": [function( prop, value ) {
			var end, unit,
				tween = this.createTween( prop, value ),
				parts = rfxnum.exec( value ),
				target = tween.cur(),
				start = +target || 0,
				scale = 1,
				maxIterations = 20;

			if ( parts ) {
				end = +parts[2];
				unit = parts[3] || ( jQuery.cssNumber[ prop ] ? "" : "px" );

				// We need to compute starting value
				if ( unit !== "px" && start ) {
					// Iteratively approximate from a nonzero starting point
					// Prefer the current property, because this process will be trivial if it uses the same units
					// Fallback to end or a simple constant
					start = jQuery.css( tween.elem, prop, true ) || end || 1;

					do {
						// If previous iteration zeroed out, double until we get *something*
						// Use a string for doubling factor so we don't accidentally see scale as unchanged below
						scale = scale || ".5";

						// Adjust and apply
						start = start / scale;
						jQuery.style( tween.elem, prop, start + unit );

					// Update scale, tolerating zero or NaN from tween.cur()
					// And breaking the loop if scale is unchanged or perfect, or if we've just had enough
					} while ( scale !== (scale = tween.cur() / target) && scale !== 1 && --maxIterations );
				}

				tween.unit = unit;
				tween.start = start;
				// If a +=/-= token was provided, we're doing a relative animation
				tween.end = parts[1] ? start + ( parts[1] + 1 ) * end : end;
			}
			return tween;
		}]
	};

// Animations created synchronously will run synchronously
function createFxNow() {
	setTimeout(function() {
		fxNow = undefined;
	}, 0 );
	return ( fxNow = jQuery.now() );
}

function createTweens( animation, props ) {
	jQuery.each( props, function( prop, value ) {
		var collection = ( tweeners[ prop ] || [] ).concat( tweeners[ "*" ] ),
			index = 0,
			length = collection.length;
		for ( ; index < length; index++ ) {
			if ( collection[ index ].call( animation, prop, value ) ) {

				// we're done with this property
				return;
			}
		}
	});
}

function Animation( elem, properties, options ) {
	var result,
		index = 0,
		tweenerIndex = 0,
		length = animationPrefilters.length,
		deferred = jQuery.Deferred().always( function() {
			// don't match elem in the :animated selector
			delete tick.elem;
		}),
		tick = function() {
			var currentTime = fxNow || createFxNow(),
				remaining = Math.max( 0, animation.startTime + animation.duration - currentTime ),
				// archaic crash bug won't allow us to use 1 - ( 0.5 || 0 ) (#12497)
				temp = remaining / animation.duration || 0,
				percent = 1 - temp,
				index = 0,
				length = animation.tweens.length;

			for ( ; index < length ; index++ ) {
				animation.tweens[ index ].run( percent );
			}

			deferred.notifyWith( elem, [ animation, percent, remaining ]);

			if ( percent < 1 && length ) {
				return remaining;
			} else {
				deferred.resolveWith( elem, [ animation ] );
				return false;
			}
		},
		animation = deferred.promise({
			elem: elem,
			props: jQuery.extend( {}, properties ),
			opts: jQuery.extend( true, { specialEasing: {} }, options ),
			originalProperties: properties,
			originalOptions: options,
			startTime: fxNow || createFxNow(),
			duration: options.duration,
			tweens: [],
			createTween: function( prop, end, easing ) {
				var tween = jQuery.Tween( elem, animation.opts, prop, end,
						animation.opts.specialEasing[ prop ] || animation.opts.easing );
				animation.tweens.push( tween );
				return tween;
			},
			stop: function( gotoEnd ) {
				var index = 0,
					// if we are going to the end, we want to run all the tweens
					// otherwise we skip this part
					length = gotoEnd ? animation.tweens.length : 0;

				for ( ; index < length ; index++ ) {
					animation.tweens[ index ].run( 1 );
				}

				// resolve when we played the last frame
				// otherwise, reject
				if ( gotoEnd ) {
					deferred.resolveWith( elem, [ animation, gotoEnd ] );
				} else {
					deferred.rejectWith( elem, [ animation, gotoEnd ] );
				}
				return this;
			}
		}),
		props = animation.props;

	propFilter( props, animation.opts.specialEasing );

	for ( ; index < length ; index++ ) {
		result = animationPrefilters[ index ].call( animation, elem, props, animation.opts );
		if ( result ) {
			return result;
		}
	}

	createTweens( animation, props );

	if ( jQuery.isFunction( animation.opts.start ) ) {
		animation.opts.start.call( elem, animation );
	}

	jQuery.fx.timer(
		jQuery.extend( tick, {
			anim: animation,
			queue: animation.opts.queue,
			elem: elem
		})
	);

	// attach callbacks from options
	return animation.progress( animation.opts.progress )
		.done( animation.opts.done, animation.opts.complete )
		.fail( animation.opts.fail )
		.always( animation.opts.always );
}

function propFilter( props, specialEasing ) {
	var index, name, easing, value, hooks;

	// camelCase, specialEasing and expand cssHook pass
	for ( index in props ) {
		name = jQuery.camelCase( index );
		easing = specialEasing[ name ];
		value = props[ index ];
		if ( jQuery.isArray( value ) ) {
			easing = value[ 1 ];
			value = props[ index ] = value[ 0 ];
		}

		if ( index !== name ) {
			props[ name ] = value;
			delete props[ index ];
		}

		hooks = jQuery.cssHooks[ name ];
		if ( hooks && "expand" in hooks ) {
			value = hooks.expand( value );
			delete props[ name ];

			// not quite $.extend, this wont overwrite keys already present.
			// also - reusing 'index' from above because we have the correct "name"
			for ( index in value ) {
				if ( !( index in props ) ) {
					props[ index ] = value[ index ];
					specialEasing[ index ] = easing;
				}
			}
		} else {
			specialEasing[ name ] = easing;
		}
	}
}

jQuery.Animation = jQuery.extend( Animation, {

	tweener: function( props, callback ) {
		if ( jQuery.isFunction( props ) ) {
			callback = props;
			props = [ "*" ];
		} else {
			props = props.split(" ");
		}

		var prop,
			index = 0,
			length = props.length;

		for ( ; index < length ; index++ ) {
			prop = props[ index ];
			tweeners[ prop ] = tweeners[ prop ] || [];
			tweeners[ prop ].unshift( callback );
		}
	},

	prefilter: function( callback, prepend ) {
		if ( prepend ) {
			animationPrefilters.unshift( callback );
		} else {
			animationPrefilters.push( callback );
		}
	}
});

function defaultPrefilter( elem, props, opts ) {
	var index, prop, value, length, dataShow, toggle, tween, hooks, oldfire,
		anim = this,
		style = elem.style,
		orig = {},
		handled = [],
		hidden = elem.nodeType && isHidden( elem );

	// handle queue: false promises
	if ( !opts.queue ) {
		hooks = jQuery._queueHooks( elem, "fx" );
		if ( hooks.unqueued == null ) {
			hooks.unqueued = 0;
			oldfire = hooks.empty.fire;
			hooks.empty.fire = function() {
				if ( !hooks.unqueued ) {
					oldfire();
				}
			};
		}
		hooks.unqueued++;

		anim.always(function() {
			// doing this makes sure that the complete handler will be called
			// before this completes
			anim.always(function() {
				hooks.unqueued--;
				if ( !jQuery.queue( elem, "fx" ).length ) {
					hooks.empty.fire();
				}
			});
		});
	}

	// height/width overflow pass
	if ( elem.nodeType === 1 && ( "height" in props || "width" in props ) ) {
		// Make sure that nothing sneaks out
		// Record all 3 overflow attributes because IE does not
		// change the overflow attribute when overflowX and
		// overflowY are set to the same value
		opts.overflow = [ style.overflow, style.overflowX, style.overflowY ];

		// Set display property to inline-block for height/width
		// animations on inline elements that are having width/height animated
		if ( jQuery.css( elem, "display" ) === "inline" &&
				jQuery.css( elem, "float" ) === "none" ) {

			// inline-level elements accept inline-block;
			// block-level elements need to be inline with layout
			if ( !jQuery.support.inlineBlockNeedsLayout || css_defaultDisplay( elem.nodeName ) === "inline" ) {
				style.display = "inline-block";

			} else {
				style.zoom = 1;
			}
		}
	}

	if ( opts.overflow ) {
		style.overflow = "hidden";
		if ( !jQuery.support.shrinkWrapBlocks ) {
			anim.done(function() {
				style.overflow = opts.overflow[ 0 ];
				style.overflowX = opts.overflow[ 1 ];
				style.overflowY = opts.overflow[ 2 ];
			});
		}
	}


	// show/hide pass
	for ( index in props ) {
		value = props[ index ];
		if ( rfxtypes.exec( value ) ) {
			delete props[ index ];
			toggle = toggle || value === "toggle";
			if ( value === ( hidden ? "hide" : "show" ) ) {
				continue;
			}
			handled.push( index );
		}
	}

	length = handled.length;
	if ( length ) {
		dataShow = jQuery._data( elem, "fxshow" ) || jQuery._data( elem, "fxshow", {} );
		if ( "hidden" in dataShow ) {
			hidden = dataShow.hidden;
		}

		// store state if its toggle - enables .stop().toggle() to "reverse"
		if ( toggle ) {
			dataShow.hidden = !hidden;
		}
		if ( hidden ) {
			jQuery( elem ).show();
		} else {
			anim.done(function() {
				jQuery( elem ).hide();
			});
		}
		anim.done(function() {
			var prop;
			jQuery.removeData( elem, "fxshow", true );
			for ( prop in orig ) {
				jQuery.style( elem, prop, orig[ prop ] );
			}
		});
		for ( index = 0 ; index < length ; index++ ) {
			prop = handled[ index ];
			tween = anim.createTween( prop, hidden ? dataShow[ prop ] : 0 );
			orig[ prop ] = dataShow[ prop ] || jQuery.style( elem, prop );

			if ( !( prop in dataShow ) ) {
				dataShow[ prop ] = tween.start;
				if ( hidden ) {
					tween.end = tween.start;
					tween.start = prop === "width" || prop === "height" ? 1 : 0;
				}
			}
		}
	}
}

function Tween( elem, options, prop, end, easing ) {
	return new Tween.prototype.init( elem, options, prop, end, easing );
}
jQuery.Tween = Tween;

Tween.prototype = {
	constructor: Tween,
	init: function( elem, options, prop, end, easing, unit ) {
		this.elem = elem;
		this.prop = prop;
		this.easing = easing || "swing";
		this.options = options;
		this.start = this.now = this.cur();
		this.end = end;
		this.unit = unit || ( jQuery.cssNumber[ prop ] ? "" : "px" );
	},
	cur: function() {
		var hooks = Tween.propHooks[ this.prop ];

		return hooks && hooks.get ?
			hooks.get( this ) :
			Tween.propHooks._default.get( this );
	},
	run: function( percent ) {
		var eased,
			hooks = Tween.propHooks[ this.prop ];

		if ( this.options.duration ) {
			this.pos = eased = jQuery.easing[ this.easing ](
				percent, this.options.duration * percent, 0, 1, this.options.duration
			);
		} else {
			this.pos = eased = percent;
		}
		this.now = ( this.end - this.start ) * eased + this.start;

		if ( this.options.step ) {
			this.options.step.call( this.elem, this.now, this );
		}

		if ( hooks && hooks.set ) {
			hooks.set( this );
		} else {
			Tween.propHooks._default.set( this );
		}
		return this;
	}
};

Tween.prototype.init.prototype = Tween.prototype;

Tween.propHooks = {
	_default: {
		get: function( tween ) {
			var result;

			if ( tween.elem[ tween.prop ] != null &&
				(!tween.elem.style || tween.elem.style[ tween.prop ] == null) ) {
				return tween.elem[ tween.prop ];
			}

			// passing any value as a 4th parameter to .css will automatically
			// attempt a parseFloat and fallback to a string if the parse fails
			// so, simple values such as "10px" are parsed to Float.
			// complex values such as "rotate(1rad)" are returned as is.
			result = jQuery.css( tween.elem, tween.prop, false, "" );
			// Empty strings, null, undefined and "auto" are converted to 0.
			return !result || result === "auto" ? 0 : result;
		},
		set: function( tween ) {
			// use step hook for back compat - use cssHook if its there - use .style if its
			// available and use plain properties where available
			if ( jQuery.fx.step[ tween.prop ] ) {
				jQuery.fx.step[ tween.prop ]( tween );
			} else if ( tween.elem.style && ( tween.elem.style[ jQuery.cssProps[ tween.prop ] ] != null || jQuery.cssHooks[ tween.prop ] ) ) {
				jQuery.style( tween.elem, tween.prop, tween.now + tween.unit );
			} else {
				tween.elem[ tween.prop ] = tween.now;
			}
		}
	}
};

// Remove in 2.0 - this supports IE8's panic based approach
// to setting things on disconnected nodes

Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {
	set: function( tween ) {
		if ( tween.elem.nodeType && tween.elem.parentNode ) {
			tween.elem[ tween.prop ] = tween.now;
		}
	}
};

jQuery.each([ "toggle", "show", "hide" ], function( i, name ) {
	var cssFn = jQuery.fn[ name ];
	jQuery.fn[ name ] = function( speed, easing, callback ) {
		return speed == null || typeof speed === "boolean" ||
			// special check for .toggle( handler, handler, ... )
			( !i && jQuery.isFunction( speed ) && jQuery.isFunction( easing ) ) ?
			cssFn.apply( this, arguments ) :
			this.animate( genFx( name, true ), speed, easing, callback );
	};
});

jQuery.fn.extend({
	fadeTo: function( speed, to, easing, callback ) {

		// show any hidden elements after setting opacity to 0
		return this.filter( isHidden ).css( "opacity", 0 ).show()

			// animate to the value specified
			.end().animate({ opacity: to }, speed, easing, callback );
	},
	animate: function( prop, speed, easing, callback ) {
		var empty = jQuery.isEmptyObject( prop ),
			optall = jQuery.speed( speed, easing, callback ),
			doAnimation = function() {
				// Operate on a copy of prop so per-property easing won't be lost
				var anim = Animation( this, jQuery.extend( {}, prop ), optall );

				// Empty animations resolve immediately
				if ( empty ) {
					anim.stop( true );
				}
			};

		return empty || optall.queue === false ?
			this.each( doAnimation ) :
			this.queue( optall.queue, doAnimation );
	},
	stop: function( type, clearQueue, gotoEnd ) {
		var stopQueue = function( hooks ) {
			var stop = hooks.stop;
			delete hooks.stop;
			stop( gotoEnd );
		};

		if ( typeof type !== "string" ) {
			gotoEnd = clearQueue;
			clearQueue = type;
			type = undefined;
		}
		if ( clearQueue && type !== false ) {
			this.queue( type || "fx", [] );
		}

		return this.each(function() {
			var dequeue = true,
				index = type != null && type + "queueHooks",
				timers = jQuery.timers,
				data = jQuery._data( this );

			if ( index ) {
				if ( data[ index ] && data[ index ].stop ) {
					stopQueue( data[ index ] );
				}
			} else {
				for ( index in data ) {
					if ( data[ index ] && data[ index ].stop && rrun.test( index ) ) {
						stopQueue( data[ index ] );
					}
				}
			}

			for ( index = timers.length; index--; ) {
				if ( timers[ index ].elem === this && (type == null || timers[ index ].queue === type) ) {
					timers[ index ].anim.stop( gotoEnd );
					dequeue = false;
					timers.splice( index, 1 );
				}
			}

			// start the next in the queue if the last step wasn't forced
			// timers currently will call their complete callbacks, which will dequeue
			// but only if they were gotoEnd
			if ( dequeue || !gotoEnd ) {
				jQuery.dequeue( this, type );
			}
		});
	}
});

// Generate parameters to create a standard animation
function genFx( type, includeWidth ) {
	var which,
		attrs = { height: type },
		i = 0;

	// if we include width, step value is 1 to do all cssExpand values,
	// if we don't include width, step value is 2 to skip over Left and Right
	includeWidth = includeWidth? 1 : 0;
	for( ; i < 4 ; i += 2 - includeWidth ) {
		which = cssExpand[ i ];
		attrs[ "margin" + which ] = attrs[ "padding" + which ] = type;
	}

	if ( includeWidth ) {
		attrs.opacity = attrs.width = type;
	}

	return attrs;
}

// Generate shortcuts for custom animations
jQuery.each({
	slideDown: genFx("show"),
	slideUp: genFx("hide"),
	slideToggle: genFx("toggle"),
	fadeIn: { opacity: "show" },
	fadeOut: { opacity: "hide" },
	fadeToggle: { opacity: "toggle" }
}, function( name, props ) {
	jQuery.fn[ name ] = function( speed, easing, callback ) {
		return this.animate( props, speed, easing, callback );
	};
});

jQuery.speed = function( speed, easing, fn ) {
	var opt = speed && typeof speed === "object" ? jQuery.extend( {}, speed ) : {
		complete: fn || !fn && easing ||
			jQuery.isFunction( speed ) && speed,
		duration: speed,
		easing: fn && easing || easing && !jQuery.isFunction( easing ) && easing
	};

	opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration :
		opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;

	// normalize opt.queue - true/undefined/null -> "fx"
	if ( opt.queue == null || opt.queue === true ) {
		opt.queue = "fx";
	}

	// Queueing
	opt.old = opt.complete;

	opt.complete = function() {
		if ( jQuery.isFunction( opt.old ) ) {
			opt.old.call( this );
		}

		if ( opt.queue ) {
			jQuery.dequeue( this, opt.queue );
		}
	};

	return opt;
};

jQuery.easing = {
	linear: function( p ) {
		return p;
	},
	swing: function( p ) {
		return 0.5 - Math.cos( p*Math.PI ) / 2;
	}
};

jQuery.timers = [];
jQuery.fx = Tween.prototype.init;
jQuery.fx.tick = function() {
	var timer,
		timers = jQuery.timers,
		i = 0;

	fxNow = jQuery.now();

	for ( ; i < timers.length; i++ ) {
		timer = timers[ i ];
		// Checks the timer has not already been removed
		if ( !timer() && timers[ i ] === timer ) {
			timers.splice( i--, 1 );
		}
	}

	if ( !timers.length ) {
		jQuery.fx.stop();
	}
	fxNow = undefined;
};

jQuery.fx.timer = function( timer ) {
	if ( timer() && jQuery.timers.push( timer ) && !timerId ) {
		timerId = setInterval( jQuery.fx.tick, jQuery.fx.interval );
	}
};

jQuery.fx.interval = 13;

jQuery.fx.stop = function() {
	clearInterval( timerId );
	timerId = null;
};

jQuery.fx.speeds = {
	slow: 600,
	fast: 200,
	// Default speed
	_default: 400
};

// Back Compat <1.8 extension point
jQuery.fx.step = {};

if ( jQuery.expr && jQuery.expr.filters ) {
	jQuery.expr.filters.animated = function( elem ) {
		return jQuery.grep(jQuery.timers, function( fn ) {
			return elem === fn.elem;
		}).length;
	};
}
var rroot = /^(?:body|html)$/i;

jQuery.fn.offset = function( options ) {
	if ( arguments.length ) {
		return options === undefined ?
			this :
			this.each(function( i ) {
				jQuery.offset.setOffset( this, options, i );
			});
	}

	var docElem, body, win, clientTop, clientLeft, scrollTop, scrollLeft,
		box = { top: 0, left: 0 },
		elem = this[ 0 ],
		doc = elem && elem.ownerDocument;

	if ( !doc ) {
		return;
	}

	if ( (body = doc.body) === elem ) {
		return jQuery.offset.bodyOffset( elem );
	}

	docElem = doc.documentElement;

	// Make sure it's not a disconnected DOM node
	if ( !jQuery.contains( docElem, elem ) ) {
		return box;
	}

	// If we don't have gBCR, just use 0,0 rather than error
	// BlackBerry 5, iOS 3 (original iPhone)
	if ( typeof elem.getBoundingClientRect !== "undefined" ) {
		box = elem.getBoundingClientRect();
	}
	win = getWindow( doc );
	clientTop  = docElem.clientTop  || body.clientTop  || 0;
	clientLeft = docElem.clientLeft || body.clientLeft || 0;
	scrollTop  = win.pageYOffset || docElem.scrollTop;
	scrollLeft = win.pageXOffset || docElem.scrollLeft;
	return {
		top: box.top  + scrollTop  - clientTop,
		left: box.left + scrollLeft - clientLeft
	};
};

jQuery.offset = {

	bodyOffset: function( body ) {
		var top = body.offsetTop,
			left = body.offsetLeft;

		if ( jQuery.support.doesNotIncludeMarginInBodyOffset ) {
			top  += parseFloat( jQuery.css(body, "marginTop") ) || 0;
			left += parseFloat( jQuery.css(body, "marginLeft") ) || 0;
		}

		return { top: top, left: left };
	},

	setOffset: function( elem, options, i ) {
		var position = jQuery.css( elem, "position" );

		// set position first, in-case top/left are set even on static elem
		if ( position === "static" ) {
			elem.style.position = "relative";
		}

		var curElem = jQuery( elem ),
			curOffset = curElem.offset(),
			curCSSTop = jQuery.css( elem, "top" ),
			curCSSLeft = jQuery.css( elem, "left" ),
			calculatePosition = ( position === "absolute" || position === "fixed" ) && jQuery.inArray("auto", [curCSSTop, curCSSLeft]) > -1,
			props = {}, curPosition = {}, curTop, curLeft;

		// need to be able to calculate position if either top or left is auto and position is either absolute or fixed
		if ( calculatePosition ) {
			curPosition = curElem.position();
			curTop = curPosition.top;
			curLeft = curPosition.left;
		} else {
			curTop = parseFloat( curCSSTop ) || 0;
			curLeft = parseFloat( curCSSLeft ) || 0;
		}

		if ( jQuery.isFunction( options ) ) {
			options = options.call( elem, i, curOffset );
		}

		if ( options.top != null ) {
			props.top = ( options.top - curOffset.top ) + curTop;
		}
		if ( options.left != null ) {
			props.left = ( options.left - curOffset.left ) + curLeft;
		}

		if ( "using" in options ) {
			options.using.call( elem, props );
		} else {
			curElem.css( props );
		}
	}
};


jQuery.fn.extend({

	position: function() {
		if ( !this[0] ) {
			return;
		}

		var elem = this[0],

		// Get *real* offsetParent
		offsetParent = this.offsetParent(),

		// Get correct offsets
		offset       = this.offset(),
		parentOffset = rroot.test(offsetParent[0].nodeName) ? { top: 0, left: 0 } : offsetParent.offset();

		// Subtract element margins
		// note: when an element has margin: auto the offsetLeft and marginLeft
		// are the same in Safari causing offset.left to incorrectly be 0
		offset.top  -= parseFloat( jQuery.css(elem, "marginTop") ) || 0;
		offset.left -= parseFloat( jQuery.css(elem, "marginLeft") ) || 0;

		// Add offsetParent borders
		parentOffset.top  += parseFloat( jQuery.css(offsetParent[0], "borderTopWidth") ) || 0;
		parentOffset.left += parseFloat( jQuery.css(offsetParent[0], "borderLeftWidth") ) || 0;

		// Subtract the two offsets
		return {
			top:  offset.top  - parentOffset.top,
			left: offset.left - parentOffset.left
		};
	},

	offsetParent: function() {
		return this.map(function() {
			var offsetParent = this.offsetParent || document.body;
			while ( offsetParent && (!rroot.test(offsetParent.nodeName) && jQuery.css(offsetParent, "position") === "static") ) {
				offsetParent = offsetParent.offsetParent;
			}
			return offsetParent || document.body;
		});
	}
});


// Create scrollLeft and scrollTop methods
jQuery.each( {scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function( method, prop ) {
	var top = /Y/.test( prop );

	jQuery.fn[ method ] = function( val ) {
		return jQuery.access( this, function( elem, method, val ) {
			var win = getWindow( elem );

			if ( val === undefined ) {
				return win ? (prop in win) ? win[ prop ] :
					win.document.documentElement[ method ] :
					elem[ method ];
			}

			if ( win ) {
				win.scrollTo(
					!top ? val : jQuery( win ).scrollLeft(),
					 top ? val : jQuery( win ).scrollTop()
				);

			} else {
				elem[ method ] = val;
			}
		}, method, val, arguments.length, null );
	};
});

function getWindow( elem ) {
	return jQuery.isWindow( elem ) ?
		elem :
		elem.nodeType === 9 ?
			elem.defaultView || elem.parentWindow :
			false;
}
// Create innerHeight, innerWidth, height, width, outerHeight and outerWidth methods
jQuery.each( { Height: "height", Width: "width" }, function( name, type ) {
	jQuery.each( { padding: "inner" + name, content: type, "": "outer" + name }, function( defaultExtra, funcName ) {
		// margin is only for outerHeight, outerWidth
		jQuery.fn[ funcName ] = function( margin, value ) {
			var chainable = arguments.length && ( defaultExtra || typeof margin !== "boolean" ),
				extra = defaultExtra || ( margin === true || value === true ? "margin" : "border" );

			return jQuery.access( this, function( elem, type, value ) {
				var doc;

				if ( jQuery.isWindow( elem ) ) {
					// As of 5/8/2012 this will yield incorrect results for Mobile Safari, but there
					// isn't a whole lot we can do. See pull request at this URL for discussion:
					// https://github.com/jquery/jquery/pull/764
					return elem.document.documentElement[ "client" + name ];
				}

				// Get document width or height
				if ( elem.nodeType === 9 ) {
					doc = elem.documentElement;

					// Either scroll[Width/Height] or offset[Width/Height] or client[Width/Height], whichever is greatest
					// unfortunately, this causes bug #3838 in IE6/8 only, but there is currently no good, small way to fix it.
					return Math.max(
						elem.body[ "scroll" + name ], doc[ "scroll" + name ],
						elem.body[ "offset" + name ], doc[ "offset" + name ],
						doc[ "client" + name ]
					);
				}

				return value === undefined ?
					// Get width or height on the element, requesting but not forcing parseFloat
					jQuery.css( elem, type, value, extra ) :

					// Set width or height on the element
					jQuery.style( elem, type, value, extra );
			}, type, chainable ? margin : undefined, chainable, null );
		};
	});
});
// Expose jQuery to the global object
window.jQuery = window.$ = jQuery;

// Expose jQuery as an AMD module, but only for AMD loaders that
// understand the issues with loading multiple versions of jQuery
// in a page that all might call define(). The loader will indicate
// they have special allowances for multiple jQuery versions by
// specifying define.amd.jQuery = true. Register as a named module,
// since jQuery can be concatenated with other files that may use define,
// but not use a proper concatenation script that understands anonymous
// AMD modules. A named AMD is safest and most robust way to register.
// Lowercase jquery is used because AMD module names are derived from
// file names, and jQuery is normally delivered in a lowercase file name.
// Do this after creating the global so that if an AMD module wants to call
// noConflict to hide this version of jQuery, it will work.
if ( typeof define === "function" ) {
	define( "vendor.asset.jquery/jquery", [], function () { return jQuery; } );
}

})( window );
/*jshint white:true, evil:false, onevar:false, undef:true, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/

/*
 * cookie.js
 *
 * Util for handling cookies on the client.
 */
define("dj.responsive.resources/cookieutils", [], function () {
  var defSeparator = "||",
    defaultGroup = "DJCOOKIE",
    groups = {},
    _cookieDomain, _doEncode = true;

  var _getDomain = function () {
      if (typeof this._cookieDomain === "string") {
        return this._cookieDomain;
      }
      var aDomain = window.location.hostname.split('.');
      var aDomainLen = aDomain.length;
      this._cookieDomain = (aDomainLen > 2) ? '.' + aDomain[aDomainLen - 2] + '.' + aDomain[aDomainLen - 1] : window.location.hostname;
      return this._cookieDomain;
    };

  var cookieObjToStr = function (obj) {
      if (typeof obj !== "object") {
        return;
      }
      var out = [];

      for (var o in obj) {
        if (obj.hasOwnProperty(o)) {
          out[out.length] = (o + "=" + obj[o]);
        }
      }
      out = out.join(defSeparator);

      return out;
    };

  var cookieStrToObj = function (str) {
      if (typeof str !== "string") {
        return;
      }
      var obj = {};

      var aStr = str.split(defSeparator);

      for (var i = 0, len = aStr.length; i < len; i += 1) {
        var spl = aStr[i].split("=");
        var name = spl.shift();
        obj[name] = spl.join("=");
      }

      return (obj !== {}) ? obj : null;
    };

  var _createCookieString = function (name, value, encodeValue, options) {
      var text = encodeURIComponent(name) + "=" + (encodeValue ? encodeURIComponent(value) : value);
      if (typeof options !== "object") {
        return text;
      }

      if (options.expires instanceof Date) {
        text += "; expires=" + options.expires.toGMTString();
      }
      if ((typeof options.path === "string") && options.path !== "") {
        text += "; path=" + options.path;
      }
      if ((typeof options.domain === "string") && options.domain !== "") {
        text += "; domain=" + options.domain;
      }
      if (options.secure === true) {
        text += "; secure";
      }

      return text;
    };

  var cookie = {
    init: function (options) {
      var config = {};
      // var config = {
      //   FooterView: FooterView,
      //   $: $
      // };
      //var footWidget = new Footer(config);
      //footWidget.render();
    },
    setCookie: function (name, value, days, group, doEncode) {
      // redirect to setGroupCookie as this is a group cookie
      if ((arguments.length > 3) && ((typeof group === "string") || (typeof group === "boolean") && (group !== false))) {
        return this.setGroupCookie(group, name, value, days);
      }

      var exp = null;
      if (days) {
        exp = new Date();
        exp.setTime(exp.getTime() + (days * 24 * 60 * 60 * 1000));
      }

      doEncode = ((typeof doEncode === "boolean") ? doEncode : _doEncode);
      document.cookie = _createCookieString(name, value, doEncode, {
        expires: exp,
        path: '/',
        domain: _getDomain()
      });
    },
    getCookie: function (name, group, doDecode) {
      // redirect to getGroupCookie as this is a group cookie
      if (arguments.length > 1) {
        return this.getGroupCookie(group, name);
      }
      doDecode = ((typeof doDecode === "boolean") ? doDecode : _doEncode); // feature
      var nameEQ = (doDecode ? encodeURIComponent(name) : name) + "=";
      var ca = document.cookie.split(';');

      for (var i = 0, len = ca.length; i < len; i += 1) {
        var c = ca[i].replace(/^\s+|\s+$/g, ""); // trim;
        if (c.indexOf(nameEQ) === 0) {
          var val = c.substring(nameEQ.length, c.length);
          return (doDecode ? decodeURIComponent(val) : val);
        }
      }

      return null;
    },
    deleteCookie: function (name, group) {
      if (arguments.length > 1) {
        return this.deleteGroupCookie(group, name);
      }
      this.setCookie(name, '', -1);
    },
    setGroupCookie: function (group, name, value, days) {
      var isSession = (typeof days) === "undefined" || (!days);
      var isDelete = (days === -1); // Delete a subcookie
      var isGroupDelete = false; // Delete the entire group
      var date = new Date();

      if (days && !isSession) {
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      }

      var grp = (typeof group !== "boolean") ? group : defaultGroup;
      groups[grp] = groups[grp] || cookieStrToObj(this.getCookie(grp)) || {};
      groups[grp][name] = value;

      if (isDelete) {
        delete groups[grp][name];

        // Count the number of objects in the gropup
        var vcntr = 0;
        for (var val in groups[grp]) {
          if (groups[grp].hasOwnProperty(val)) {
            vcntr += 1;
          }
        }

        // If there is only one object, and it is the expiration date, remove the exp-date
        if (vcntr > 0) {
          if (!isSession) {
            date.setTime(date.getTime() + (365 * 24 * 60 * 60 * 1000));
          }
        } else {
          groups[grp] = {};
          isGroupDelete = true;
        }
      }

      name = grp;
      value = cookieObjToStr(groups[grp]);

      var cookieInfo = {
        path: '/',
        domain: _getDomain()
      };
      if (!isSession) {
        cookieInfo.expires = ((isGroupDelete) ? (new Date(-1)) : date);
      }
      document.cookie = _createCookieString(name, value, _doEncode, cookieInfo);
    },
    getGroupCookie: function (group, name) {
      var grp = (typeof group !== "boolean") ? group : defaultGroup;
      var grpEq = (encodeURIComponent(grp) + "=");
      var nameEq = (name + "=");

      var ca = document.cookie.split(";");
      var cookie = null;
      var oCookie = null;
      var cookieValue = null;
      var cookieName = null;

      for (var i = 0, len = ca.length; i < len; i += 1) {
        cookie = ca[i].replace(/^\s+|\s+$/g, ""); // trim
        if (cookie.indexOf(grpEq) === 0) {
          cookieValue = cookie.split(grpEq)[1];
          oCookie = cookieStrToObj(decodeURIComponent(cookieValue));
          cookieName = oCookie[name];
          return (typeof cookieName !== "undefined") ? cookieName : null;
        }
      }

      return null;
    },
    deleteGroupCookie: function (group, name) {
      this.setGroupCookie(group, name, " ", -1);
    }
  };

  return cookie;
});
// Underscore.js 1.3.3
// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Underscore is freely distributable under the MIT license.
// Portions of Underscore are inspired or borrowed from Prototype,
// Oliver Steele's Functional, and John Resig's Micro-Templating.
// For all details and documentation:
// http://documentcloud.github.com/underscore
(function(){function r(a,c,d){if(a===c)return 0!==a||1/a==1/c;if(null==a||null==c)return a===c;a._chain&&(a=a._wrapped);c._chain&&(c=c._wrapped);if(a.isEqual&&b.isFunction(a.isEqual))return a.isEqual(c);if(c.isEqual&&b.isFunction(c.isEqual))return c.isEqual(a);var e=l.call(a);if(e!=l.call(c))return!1;switch(e){case "[object String]":return a==""+c;case "[object Number]":return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case "[object Date]":case "[object Boolean]":return+a==+c;case "[object RegExp]":return a.source==
c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return!1;for(var f=d.length;f--;)if(d[f]==a)return!0;d.push(a);var f=0,g=!0;if("[object Array]"==e){if(f=a.length,g=f==c.length)for(;f--&&(g=f in a==f in c&&r(a[f],c[f],d)););}else{if("constructor"in a!="constructor"in c||a.constructor!=c.constructor)return!1;for(var h in a)if(b.has(a,h)&&(f++,!(g=b.has(c,h)&&r(a[h],c[h],d))))break;if(g){for(h in c)if(b.has(c,h)&&!f--)break;
g=!f}}d.pop();return g}var s=this,I=s._,o={},k=Array.prototype,p=Object.prototype,i=k.slice,J=k.unshift,l=p.toString,K=p.hasOwnProperty,y=k.forEach,z=k.map,A=k.reduce,B=k.reduceRight,C=k.filter,D=k.every,E=k.some,q=k.indexOf,F=k.lastIndexOf,p=Array.isArray,L=Object.keys,t=Function.prototype.bind,b=function(a){return new m(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=b),exports._=b):s._=b;b.VERSION="1.3.3";var j=b.each=b.forEach=function(a,
c,d){if(a!=null)if(y&&a.forEach===y)a.forEach(c,d);else if(a.length===+a.length)for(var e=0,f=a.length;e<f;e++){if(e in a&&c.call(d,a[e],e,a)===o)break}else for(e in a)if(b.has(a,e)&&c.call(d,a[e],e,a)===o)break};b.map=b.collect=function(a,c,b){var e=[];if(a==null)return e;if(z&&a.map===z)return a.map(c,b);j(a,function(a,g,h){e[e.length]=c.call(b,a,g,h)});if(a.length===+a.length)e.length=a.length;return e};b.reduce=b.foldl=b.inject=function(a,c,d,e){var f=arguments.length>2;a==null&&(a=[]);if(A&&
a.reduce===A){e&&(c=b.bind(c,e));return f?a.reduce(c,d):a.reduce(c)}j(a,function(a,b,i){if(f)d=c.call(e,d,a,b,i);else{d=a;f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};b.reduceRight=b.foldr=function(a,c,d,e){var f=arguments.length>2;a==null&&(a=[]);if(B&&a.reduceRight===B){e&&(c=b.bind(c,e));return f?a.reduceRight(c,d):a.reduceRight(c)}var g=b.toArray(a).reverse();e&&!f&&(c=b.bind(c,e));return f?b.reduce(g,c,d,e):b.reduce(g,c)};b.find=b.detect=function(a,
c,b){var e;G(a,function(a,g,h){if(c.call(b,a,g,h)){e=a;return true}});return e};b.filter=b.select=function(a,c,b){var e=[];if(a==null)return e;if(C&&a.filter===C)return a.filter(c,b);j(a,function(a,g,h){c.call(b,a,g,h)&&(e[e.length]=a)});return e};b.reject=function(a,c,b){var e=[];if(a==null)return e;j(a,function(a,g,h){c.call(b,a,g,h)||(e[e.length]=a)});return e};b.every=b.all=function(a,c,b){var e=true;if(a==null)return e;if(D&&a.every===D)return a.every(c,b);j(a,function(a,g,h){if(!(e=e&&c.call(b,
a,g,h)))return o});return!!e};var G=b.some=b.any=function(a,c,d){c||(c=b.identity);var e=false;if(a==null)return e;if(E&&a.some===E)return a.some(c,d);j(a,function(a,b,h){if(e||(e=c.call(d,a,b,h)))return o});return!!e};b.include=b.contains=function(a,c){var b=false;if(a==null)return b;if(q&&a.indexOf===q)return a.indexOf(c)!=-1;return b=G(a,function(a){return a===c})};b.invoke=function(a,c){var d=i.call(arguments,2);return b.map(a,function(a){return(b.isFunction(c)?c||a:a[c]).apply(a,d)})};b.pluck=
function(a,c){return b.map(a,function(a){return a[c]})};b.max=function(a,c,d){if(!c&&b.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!c&&b.isEmpty(a))return-Infinity;var e={computed:-Infinity};j(a,function(a,b,h){b=c?c.call(d,a,b,h):a;b>=e.computed&&(e={value:a,computed:b})});return e.value};b.min=function(a,c,d){if(!c&&b.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!c&&b.isEmpty(a))return Infinity;var e={computed:Infinity};j(a,function(a,b,h){b=c?c.call(d,a,b,h):a;b<e.computed&&
(e={value:a,computed:b})});return e.value};b.shuffle=function(a){var b=[],d;j(a,function(a,f){d=Math.floor(Math.random()*(f+1));b[f]=b[d];b[d]=a});return b};b.sortBy=function(a,c,d){var e=b.isFunction(c)?c:function(a){return a[c]};return b.pluck(b.map(a,function(a,b,c){return{value:a,criteria:e.call(d,a,b,c)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c===void 0?1:d===void 0?-1:c<d?-1:c>d?1:0}),"value")};b.groupBy=function(a,c){var d={},e=b.isFunction(c)?c:function(a){return a[c]};
j(a,function(a,b){var c=e(a,b);(d[c]||(d[c]=[])).push(a)});return d};b.sortedIndex=function(a,c,d){d||(d=b.identity);for(var e=0,f=a.length;e<f;){var g=e+f>>1;d(a[g])<d(c)?e=g+1:f=g}return e};b.toArray=function(a){return!a?[]:b.isArray(a)||b.isArguments(a)?i.call(a):a.toArray&&b.isFunction(a.toArray)?a.toArray():b.values(a)};b.size=function(a){return b.isArray(a)?a.length:b.keys(a).length};b.first=b.head=b.take=function(a,b,d){return b!=null&&!d?i.call(a,0,b):a[0]};b.initial=function(a,b,d){return i.call(a,
0,a.length-(b==null||d?1:b))};b.last=function(a,b,d){return b!=null&&!d?i.call(a,Math.max(a.length-b,0)):a[a.length-1]};b.rest=b.tail=function(a,b,d){return i.call(a,b==null||d?1:b)};b.compact=function(a){return b.filter(a,function(a){return!!a})};b.flatten=function(a,c){return b.reduce(a,function(a,e){if(b.isArray(e))return a.concat(c?e:b.flatten(e));a[a.length]=e;return a},[])};b.without=function(a){return b.difference(a,i.call(arguments,1))};b.uniq=b.unique=function(a,c,d){var d=d?b.map(a,d):a,
e=[];a.length<3&&(c=true);b.reduce(d,function(d,g,h){if(c?b.last(d)!==g||!d.length:!b.include(d,g)){d.push(g);e.push(a[h])}return d},[]);return e};b.union=function(){return b.uniq(b.flatten(arguments,true))};b.intersection=b.intersect=function(a){var c=i.call(arguments,1);return b.filter(b.uniq(a),function(a){return b.every(c,function(c){return b.indexOf(c,a)>=0})})};b.difference=function(a){var c=b.flatten(i.call(arguments,1),true);return b.filter(a,function(a){return!b.include(c,a)})};b.zip=function(){for(var a=
i.call(arguments),c=b.max(b.pluck(a,"length")),d=Array(c),e=0;e<c;e++)d[e]=b.pluck(a,""+e);return d};b.indexOf=function(a,c,d){if(a==null)return-1;var e;if(d){d=b.sortedIndex(a,c);return a[d]===c?d:-1}if(q&&a.indexOf===q)return a.indexOf(c);d=0;for(e=a.length;d<e;d++)if(d in a&&a[d]===c)return d;return-1};b.lastIndexOf=function(a,b){if(a==null)return-1;if(F&&a.lastIndexOf===F)return a.lastIndexOf(b);for(var d=a.length;d--;)if(d in a&&a[d]===b)return d;return-1};b.range=function(a,b,d){if(arguments.length<=
1){b=a||0;a=0}for(var d=arguments[2]||1,e=Math.max(Math.ceil((b-a)/d),0),f=0,g=Array(e);f<e;){g[f++]=a;a=a+d}return g};var H=function(){};b.bind=function(a,c){var d,e;if(a.bind===t&&t)return t.apply(a,i.call(arguments,1));if(!b.isFunction(a))throw new TypeError;e=i.call(arguments,2);return d=function(){if(!(this instanceof d))return a.apply(c,e.concat(i.call(arguments)));H.prototype=a.prototype;var b=new H,g=a.apply(b,e.concat(i.call(arguments)));return Object(g)===g?g:b}};b.bindAll=function(a){var c=
i.call(arguments,1);c.length==0&&(c=b.functions(a));j(c,function(c){a[c]=b.bind(a[c],a)});return a};b.memoize=function(a,c){var d={};c||(c=b.identity);return function(){var e=c.apply(this,arguments);return b.has(d,e)?d[e]:d[e]=a.apply(this,arguments)}};b.delay=function(a,b){var d=i.call(arguments,2);return setTimeout(function(){return a.apply(null,d)},b)};b.defer=function(a){return b.delay.apply(b,[a,1].concat(i.call(arguments,1)))};b.throttle=function(a,c){var d,e,f,g,h,i,j=b.debounce(function(){h=
g=false},c);return function(){d=this;e=arguments;f||(f=setTimeout(function(){f=null;h&&a.apply(d,e);j()},c));g?h=true:i=a.apply(d,e);j();g=true;return i}};b.debounce=function(a,b,d){var e;return function(){var f=this,g=arguments;d&&!e&&a.apply(f,g);clearTimeout(e);e=setTimeout(function(){e=null;d||a.apply(f,g)},b)}};b.once=function(a){var b=false,d;return function(){if(b)return d;b=true;return d=a.apply(this,arguments)}};b.wrap=function(a,b){return function(){var d=[a].concat(i.call(arguments,0));
return b.apply(this,d)}};b.compose=function(){var a=arguments;return function(){for(var b=arguments,d=a.length-1;d>=0;d--)b=[a[d].apply(this,b)];return b[0]}};b.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}};b.keys=L||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],d;for(d in a)b.has(a,d)&&(c[c.length]=d);return c};b.values=function(a){return b.map(a,b.identity)};b.functions=b.methods=function(a){var c=[],d;for(d in a)b.isFunction(a[d])&&
c.push(d);return c.sort()};b.extend=function(a){j(i.call(arguments,1),function(b){for(var d in b)a[d]=b[d]});return a};b.pick=function(a){var c={};j(b.flatten(i.call(arguments,1)),function(b){b in a&&(c[b]=a[b])});return c};b.defaults=function(a){j(i.call(arguments,1),function(b){for(var d in b)a[d]==null&&(a[d]=b[d])});return a};b.clone=function(a){return!b.isObject(a)?a:b.isArray(a)?a.slice():b.extend({},a)};b.tap=function(a,b){b(a);return a};b.isEqual=function(a,b){return r(a,b,[])};b.isEmpty=
function(a){if(a==null)return true;if(b.isArray(a)||b.isString(a))return a.length===0;for(var c in a)if(b.has(a,c))return false;return true};b.isElement=function(a){return!!(a&&a.nodeType==1)};b.isArray=p||function(a){return l.call(a)=="[object Array]"};b.isObject=function(a){return a===Object(a)};b.isArguments=function(a){return l.call(a)=="[object Arguments]"};b.isArguments(arguments)||(b.isArguments=function(a){return!(!a||!b.has(a,"callee"))});b.isFunction=function(a){return l.call(a)=="[object Function]"};
b.isString=function(a){return l.call(a)=="[object String]"};b.isNumber=function(a){return l.call(a)=="[object Number]"};b.isFinite=function(a){return b.isNumber(a)&&isFinite(a)};b.isNaN=function(a){return a!==a};b.isBoolean=function(a){return a===true||a===false||l.call(a)=="[object Boolean]"};b.isDate=function(a){return l.call(a)=="[object Date]"};b.isRegExp=function(a){return l.call(a)=="[object RegExp]"};b.isNull=function(a){return a===null};b.isUndefined=function(a){return a===void 0};b.has=function(a,
b){return K.call(a,b)};b.noConflict=function(){s._=I;return this};b.identity=function(a){return a};b.times=function(a,b,d){for(var e=0;e<a;e++)b.call(d,e)};b.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};b.result=function(a,c){if(a==null)return null;var d=a[c];return b.isFunction(d)?d.call(a):d};b.mixin=function(a){j(b.functions(a),function(c){M(c,b[c]=a[c])})};var N=0;b.uniqueId=
function(a){var b=N++;return a?a+b:b};b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var u=/.^/,n={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},v;for(v in n)n[n[v]]=v;var O=/\\|'|\r|\n|\t|\u2028|\u2029/g,P=/\\(\\|'|r|n|t|u2028|u2029)/g,w=function(a){return a.replace(P,function(a,b){return n[b]})};b.template=function(a,c,d){d=b.defaults(d||{},b.templateSettings);a="__p+='"+a.replace(O,function(a){return"\\"+n[a]}).replace(d.escape||
u,function(a,b){return"'+\n_.escape("+w(b)+")+\n'"}).replace(d.interpolate||u,function(a,b){return"'+\n("+w(b)+")+\n'"}).replace(d.evaluate||u,function(a,b){return"';\n"+w(b)+"\n;__p+='"})+"';\n";d.variable||(a="with(obj||{}){\n"+a+"}\n");var a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n",e=new Function(d.variable||"obj","_",a);if(c)return e(c,b);c=function(a){return e.call(this,a,b)};c.source="function("+(d.variable||"obj")+"){\n"+a+"}";return c};
b.chain=function(a){return b(a).chain()};var m=function(a){this._wrapped=a};b.prototype=m.prototype;var x=function(a,c){return c?b(a).chain():a},M=function(a,c){m.prototype[a]=function(){var a=i.call(arguments);J.call(a,this._wrapped);return x(c.apply(b,a),this._chain)}};b.mixin(b);j("pop,push,reverse,shift,sort,splice,unshift".split(","),function(a){var b=k[a];m.prototype[a]=function(){var d=this._wrapped;b.apply(d,arguments);var e=d.length;(a=="shift"||a=="splice")&&e===0&&delete d[0];return x(d,
this._chain)}});j(["concat","join","slice"],function(a){var b=k[a];m.prototype[a]=function(){return x(b.apply(this._wrapped,arguments),this._chain)}});m.prototype.chain=function(){this._chain=true;return this};m.prototype.value=function(){return this._wrapped}}).call(this);
define("vendor.asset.underscore/underscore",[],function(a){return function(){var b=a._;return a._=void 0,b}}(this));
/*global setTimeout, console, define, navigator, screen, window*/

define('article.app/tealium', [
  'vendor.asset.jquery/jquery'
], function ($) {

  var tealium = {

    src:  {
      'local.online.wsj.com' : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/dev/utag.js',
      'www.local.wsj.com' : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/dev/utag.js',
      'online.f.dev.wsj.com' : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/dev/utag.js',
      'www.f.dev.wsj.com' : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/dev/utag.js',
      'online.s.dev.wsj.com' : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/qa/utag.js',
      'www.s.dev.wsj.com' : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/qa/utag.js',
      'online.wsj.com'       : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/prod/utag.js',
      'www.wsj.com'       : 'http://tealium.hs.llnwd.net/o43/utag/wsjdn/wsjarticles/prod/utag.js'
    },
    hasFired: false,
    init: function () {

      var self = this;
      var tealiumLink = this.src[document.domain];

      if (tealiumLink) {

        $.ajaxSetup({ cache: true });

        //script loaded async so utag not in scope until tealium-loaded is fired.
        $.getScript(tealiumLink, function() {
          $(document).trigger('tealium-loaded');
          self.hasFired = true;
        });

        $.ajaxSetup({ cache: false });

      }
      else {
        console.log('no tealium tag for domain: ' + document.domain);
      }
    }
  };

  return tealium;

});

(function () {
  'use strict';

  var context = function ($, Intention) {

    // create a new intention object
    var intent = new Intention();

    function throttle(callback, interval) {
      var lastExec = new Date(), timer = null;
      return function (e) {
        var d = new Date();
        if (d - lastExec < interval) {
          if (timer) {
            window.clearTimeout(timer);
          }
          var callbackWrapper = function (event) {
            return function () {
              callback(event);
            };
          };
          timer = window.setTimeout(callbackWrapper(e), interval);
          return false;
        }
        callback(e);
        lastExec = d;
      };
    }

    function isIE () {
      var myNav = navigator.userAgent.toLowerCase();
      return (myNav.indexOf('msie') === -1) ? false : parseInt(myNav.split('msie')[1]);
    }

    /*
     * CATCHALL AXIS
     * allows easy use of "base" classes
     *
     */
    intent.responsive([{ name: 'base' }]).respond('base');

    /*
     * HORIZONTAL AXIS
     * Used to respond to grid break points
     *
     */

    // For IE8 support
    // we include the following polyfill
    // http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js

    // Note:
    // Because the polyfill does not support listeners
    // and browsers do not agree on including scrollbars in media queries
    // we check what the media query applies
    // by using the outline color of the html tag
    // It is a bit tricky, but an improvement on previous ideas

    var horizontal_axis;

    var htmlElm = $('html');

    horizontal_axis = intent.responsive({
      ID: 'width',
      contexts: [{
        name: 'at16units',
        check: 'rgb(16'
      }, {
        name: 'at12units',
        check: 'rgb(12'
      }, {
        name: 'at8units',
        check: 'rgb(8'
      }, {
        name: 'at4units',
        check: 'rgb(4'
      }],
      matcher: function (test, context) {
        // note IE8 reports rgb(16,0,0) vs rgb(16, 0, 0)
        if(typeof test !== 'string') { return; }
        return test.indexOf(context.check) !== -1;
      },
      measure: function (arg) {
        return (typeof arg === 'string') ? arg : htmlElm.css('outline-color');
      }
    });

    if (isIE() && isIE() < 9) {
      // IE8 has some funky delay if you check the css on html tag
      horizontal_axis.respond();
      setTimeout(function () {
        horizontal_axis.respond();
      }, 1);
    } else {
      horizontal_axis.respond();
    }

    /*
     * ORIENTATION AXIS
     * respond to horizontal and vertical
     *
     */

    var orientation_axis = intent.responsive({
      ID: 'orientation',
      contexts: [{
        name: 'portrait',
        rotation: 0
      }, {
        name: 'landscape',
        rotation: 90
      }],
      matcher: function (measure, ctx) {
        return measure === ctx.rotation;
      },
      measure: function () {
        var test = Math.abs(window.orientation);
        if (test > 0) {
          test = 180 - test;
        }
        return test;
      }
    });

    // initial call
    orientation_axis.respond();

    /*
     * TOUCH AXIS
     * detects touch device
     *
     */

    var interaction_axis = intent.responsive({
      ID: 'interaction',
      contexts: [{
        name: 'touch',
        multitouch: true
      }, {
        name: 'mouse',
        multitouch: false
      }],
      matcher: function (measure, context) {
        return 'ontouchstart' in window === context.multitouch;
      }
    }).respond();

    /*
     * RETINA AXIS
     * Detect hires display
     *
     */

    intent.responsive({
      ID: 'highres',
      contexts: [{ name: 'highres' }],
      matcher: function () {
        return window.devicePixelRatio > 1;
      }
    }).respond();

    // bind events to the window
    $(window)
    .on('resize', throttle(function () {
      orientation_axis.respond();
      horizontal_axis.respond();
    }, 50))
    .on('orientationchange', function () {
      orientation_axis.respond();
      horizontal_axis.respond();
    });

    // var to check if intentions has added dom
    var domIntent = false;

    $(function () {
      // at doc ready grab all of the elements in the doc
      intent.elements(document);
      domIntent = true;
      $(window).trigger('domintent');
    });

    // Adding a convienient and safe way to call a function
    // after intent has added elements
    // this prevents a subtle race condition we were getting
    intent.onInit = function (fn) {
      $(function(){ // also make sure doc is ready
        if (domIntent) {
          fn();
        } else {
          $(window).on("domintent", fn);
        }
      });
    };

    // return the intention object
    // so that it can be extended by other plugins
    return intent;
  };

  (function (root, factory) {
    if (typeof define === 'function' && define.amd) {
      // AMD. Register as an anonymous module.
      define('article.app/context', [
        'vendor.asset.jquery/jquery',
        'vendor.asset.intention/intention'
      ], factory);
    } else {
      // Browser globals
      root.intent = factory(root.jQuery, root.Intention);
    }
  }(this, function ($, Intention) {
    return context($, Intention);
  }));

}.call(this));

/*global define, getp39SegValue, p39_GPT_value_from_xml, googletag, googleAdSlots*/

/*
 * Common Utils that are shared in Google Ad modules
 */
define("dj.module.google_ads/googleadutils", ["vendor.asset.jquery/jquery"], function ($) {

  var googleadutils = {

    getNodeAttributes: function (element) {
      var attributes = {};
      $.each(element.attributes, function (index, attr) {
        var attrName = attr.name;
        attrName = attrName.replace('data-dj-', '');
        attributes[attrName] = attr.value;
      });
      element.nodeAttributes = attributes;
    },

    guaranteeWindowLoad: function (cb) {
      if ($(window).loadEventCalled) {
        setTimeout(cb, 0);
      } else {
        $(window).load(cb);
        $(window).load(function () {
          $(window).loadEventCalled = true;
        });
      }
    },

    getp39SegValue: function () {
      window.p39_seg = p39_GPT_value_from_xml();
      var validatedp39Value = this.validatep39SegValue();
      return validatedp39Value;
    },

    validatep39SegValue: function () {
      if (window.p39_seg !== undefined) {
        return window.p39_seg;
      } else {
        //console.log("waiting for p39..");
        setTimeout(this.validatep39SegValue, 200);
      }
    },

    pushGoogleAd: function (attributes) {
      var p39Value;
      var locHref = window.location.href;
      var adSizeVal = null;

      //Added the below logic to provide DEV the option to pass the adSize through qs parameter
      //Sample qs to be passed -- adSize=300x1050
      if (locHref && locHref.indexOf('adSize') !== -1 && attributes.adwidgetdivid === 'AD_G') {
        var queryString = locHref.substring(locHref.indexOf('?') + 1);
        queryString = queryString ? queryString.split('&') : null;
        adSizeVal = queryString[0] ? queryString[0].replace('adSize=', '') : null;
        adSizeVal = "[[" + adSizeVal.replace("x", ",") + "]]";
        attributes.adsize = adSizeVal;
      }

      var mapping;

      if (locHref && locHref.indexOf("/news/politics") !== -1) {
        mapping = googletag.sizeMapping()
          .addSize([1279, 400], adSizeVal ? adSizeVal : [
            [300, 250],
            [300, 600],
            [300, 1050]
          ])
          .addSize([1023, 400], adSizeVal ? adSizeVal : [
            [300, 250],
            [300, 600],
            [300, 1050]
          ])
          .addSize([767, 400], adSizeVal ? adSizeVal : [
            [300, 250]
          ])
          .addSize([0, 0], adSizeVal ? adSizeVal : [300, 250]).build();
      } else {
        mapping = googletag.sizeMapping()
          .addSize([1279, 400], adSizeVal ? adSizeVal : [
            [300, 250],
            [300, 600],
            [300, 1050]
          ])
          .addSize([1023, 400], adSizeVal ? adSizeVal : [
            [300, 250],
            [300, 600],
            [300, 1050]
          ])
          .addSize([767, 400], adSizeVal ? adSizeVal : [
            [300, 250],
            [300, 600],
            [300, 1050]
          ])
          .addSize([0, 0], adSizeVal ? adSizeVal : [300, 250]).build();
      }
      if (attributes.slotname) {
        if (attributes.showp39Interests === true) {
          p39Value = this.getp39SegValue();
          if (attributes.useCustomAdMapping === true) { //slotname, peer39 and custom ad mapping
            googletag.cmd.push(function () {
              googleAdSlots[attributes.slotname] = googletag.defineSlot("/2/" + attributes.adsite + "/" +
                attributes.adpage, JSON.parse(attributes.adsize), attributes.adwidgetdivid).defineSizeMapping(
                mapping).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("msrc", attributes.admsrcvalue)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("p39", p39Value);
              googletag.display(attributes.adwidgetdivid);
            });
          } else {
            googletag.cmd.push(function () { //slotname and peer39
              googleAdSlots[attributes.slotname] = googletag.defineSlot("/2/" + attributes.adsite + "/" +
                attributes.adpage, JSON.parse(attributes.adsize), attributes.adwidgetdivid).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("msrc", attributes.admsrcvalue)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("p39", p39Value);
              googletag.display(attributes.adwidgetdivid);
            });
          }
        } else {
          if (attributes.useCustomAdMapping === true) { //slotname and custom ad mapping
            googletag.cmd.push(function () {
              googleAdSlots[attributes.slotname] = googletag.defineSlot("/2/" + attributes.adsite + "/" +
                attributes.adpage, JSON.parse(attributes.adsize), attributes.adwidgetdivid).defineSizeMapping(
                mapping).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("msrc", attributes.admsrcvalue);
              googletag.display(attributes.adwidgetdivid);
            });
          } else {
            googletag.cmd.push(function () { //slotname
              googleAdSlots[attributes.slotname] = googletag.defineSlot("/2/" + attributes.adsite + "/" +
                attributes.adpage, JSON.parse(attributes.adsize), attributes.adwidgetdivid).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("msrc", attributes.admsrcvalue);
              googletag.display(attributes.adwidgetdivid);
            });
          }
        }
      } else {
        if (attributes.showp39Interests === true) {
          p39Value = this.getp39SegValue();
          if (attributes.useCustomAdMapping === true) {
            googletag.cmd.push(function () { //No slotname, peer39 and custom ad mapping
              googletag.defineSlot("/2/" + attributes.adsite + "/" + attributes.adpage, JSON.parse(attributes.adsize),
                attributes.adwidgetdivid).defineSizeMapping(mapping).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("msrc", attributes.admsrcvalue)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("p39", p39Value);
              googletag.display(attributes.adwidgetdivid);
            });
          } else {
            googletag.cmd.push(function () { //No slotname and peer39
              googletag.defineSlot("/2/" + attributes.adsite + "/" + attributes.adpage, JSON.parse(attributes.adsize),
                attributes.adwidgetdivid).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("msrc", attributes.admsrcvalue)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("p39", p39Value);
              googletag.display(attributes.adwidgetdivid);
            });
          }
        } else {
          if (attributes.useCustomAdMapping === true) {
            googletag.cmd.push(function () { //No slotname and custom ad mapping
              googletag.defineSlot("/2/" + attributes.adsite + "/" + attributes.adpage, JSON.parse(attributes.adsize),
                attributes.adwidgetdivid).defineSizeMapping(mapping).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("msrc", attributes.admsrcvalue);
              googletag.display(attributes.adwidgetdivid);
            });
          } else {
            googletag.cmd.push(function () { //No slotname
              googletag.defineSlot("/2/" + attributes.adsite + "/" + attributes.adpage, JSON.parse(attributes.adsize),
                attributes.adwidgetdivid).addService(googletag.pubads())
                .setTargeting("metazone", attributes.admetazone)
                .setTargeting("pos", attributes.adpos)
                .setTargeting("topic", attributes.adtopic)
                .setTargeting("author", attributes.adauthor)
                .setTargeting("circ", attributes.adcircvalue)
                .setTargeting("msrc", attributes.admsrcvalue);
              googletag.display(attributes.adwidgetdivid);
            });
          }
        }
      }
    },

    pushGoogleCircAd: function (attributes) {
      googletag.cmd.push(function () {
        googletag.defineSlot("/2/" + attributes.adsite + "/" + attributes.adpage, JSON.parse(attributes.adsize),
          attributes.adwidgetdivid).addService(googletag.pubads())
          .setTargeting("metazone", attributes.admetazone)
          .setTargeting("circ", attributes.adcircvalue)
          .setTargeting("msrc", attributes.admsrcvalue);
        googletag.display(attributes.adwidgetdivid);
      });
    }
  };

  return googleadutils;
});
define("dj.module.google_ads/view/display_ad",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#adActivate}} <div class=\"{{moduleclassoverride}}\"> <div id=\"{{divID}}\" data-dj-adwidgettype=\"googleAd\" data-dj-targetnode=\"{{targetnode}}\" data-dj-adwidgetdivid=\"{{divID}}\" data-dj-adactivate=\"{{adActivate}}\" data-dj-adsize=\"{{moduleAdSize}}\" data-dj-admetazone=\"{{adMetaZone}}\" data-dj-adsite=\"{{adSiteEvaluated}}\" data-dj-adpage=\"{{adPage}}\" data-dj-admsrcvalue=\"{{adMsrcValue}}\" {{#adSlotName}}data-dj-slotname=\"{{adSlotName}}\"{{/adSlotName}} {{#adPos}}data-dj-adpos=\"{{adPos}}\"{{/adPos}} {{#adTopic}}data-dj-adtopic=\"{{adTopic}}\"{{/adTopic}} {{#adAuthor}}data-dj-adauthor=\"{{adAuthor}}\"{{/adAuthor}} data-dj-adcircvalue=\"{{circValue}}\"> </div> </div> {{/adActivate}} ");});define("dj.module.google_ads/view/display_circ_ad",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#showCircAd}} {{#adActivate}} <div id=\"{{divID}}\" data-dj-targetnode=\"{{targetnode}}\" data-dj-adwidgettype=\"googleCircAd\" data-dj-adwidgetdivid=\"{{divID}}\" data-dj-adactivate=\"{{adActivate}}\" data-dj-adsize=\"{{moduleAdSize}}\" data-dj-admetazone=\"{{adMetaZone}}\" data-dj-adsite=\"{{adSiteEvaluated}}\" data-dj-adpage=\"{{adPage}}\" data-dj-showcircad=\"{{showCircAd}}\" data-dj-adcircvalue=\"{{circValue}}\" data-dj-admsrcvalue=\"{{adMsrcValue}}\"> </div> {{/adActivate}} {{/showCircAd}} ");});define("dj.module.google_ads/view/empty",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<!-- empty google ad --> ");});define("dj.module.google_ads/view/placeholder",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#adActivate}} <div id=\"{{divID}}\" data-dj-adwidgettype=\"placeholderGoogleAd\" data-dj-adwidgetdivid=\"{{divID}}\" data-dj-adactivate=\"{{adActivate}}\" data-dj-adsize=\"{{moduleAdSize}}\" data-dj-admetazone=\"{{adMetaZone}}\" data-dj-adsite=\"{{adSiteEvaluated}}\" data-dj-adpage=\"{{adPage}}\" data-dj-admsrcvalue=\"{{adMsrcValue}}\" data-dj-adcircvalue=\"{{circValue}}\"> </div> {{/adActivate}}");});define("dj.module.google_ads/view/pushdown_ad",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#adActivate}} <div class=\"module ad pushDown\"> <div id=\"{{divID}}\" data-dj-adwidgettype=\"googleAd\" data-dj-adwidgetdivid=\"{{divID}}\" data-dj-adactivate=\"{{adActivate}}\" data-dj-adsize=\"{{moduleAdSize}}\" data-dj-admetazone=\"{{adMetaZone}}\" data-dj-adsite=\"{{adSiteEvaluated}}\" data-dj-adpage=\"{{adPage}}\" data-dj-admsrcvalue=\"{{adMsrcValue}}\" {{#adSlotName}}data-dj-slotname=\"{{adSlotName}}\"{{/adSlotName}} {{#adTopic}}data-dj-adtopic=\"{{adTopic}}\"{{/adTopic}} {{#adAuthor}}data-dj-adauthor=\"{{adAuthor}}\"{{/adAuthor}} {{#chartBeatAdId}}data-cb-ad-id=\"{{chartBeatAdId}}\"{{/chartBeatAdId}} data-dj-adcircvalue=\"{{circValue}}\"> </div> </div> {{/adActivate}} ");});define("dj.module.google_ads/view/section_pages_ad",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#adActivate}} <div class=\"module ad\"> <div id=\"{{divID}}\" data-dj-adwidgettype=\"googleAd\" data-dj-adwidgetdivid=\"{{divID}}\" data-dj-adactivate=\"{{adActivate}}\" data-dj-adsize=\"{{moduleAdSize}}\" data-dj-admetazone=\"{{adMetaZone}}\" data-dj-adsite=\"{{adSiteEvaluated}}\" data-dj-adpage=\"{{adPage}}\" data-dj-admsrcvalue=\"{{adMsrcValue}}\" {{#adSlotName}}data-dj-slotname=\"{{adSlotName}}\"{{/adSlotName}} {{#adTopic}}data-dj-adtopic=\"{{adTopic}}\"{{/adTopic}} {{#adAuthor}}data-dj-adauthor=\"{{adAuthor}}\"{{/adAuthor}} data-dj-targetnode=\"{{targetnode}}\" {{#chartBeatAdId}}data-cb-ad-id=\"{{chartBeatAdId}}\"{{/chartBeatAdId}} data-dj-adcircvalue=\"{{circValue}}\"> </div> </div> {{/adActivate}} ");});define("dj.module.google_ads/view/section_pages_adv2",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("{{#adActivate}} <div class=\"module ad\"> <div id=\"{{divID}}\" data-dj-adwidgettype=\"placeholderGoogleAd\" data-dj-adwidgetdivid=\"{{divID}}\" data-dj-adactivate=\"{{adActivate}}\" data-dj-adsize=\"{{moduleAdSize}}\" data-dj-admetazone=\"{{adMetaZone}}\" data-dj-adsite=\"{{adSiteEvaluated}}\" data-dj-adpage=\"{{adPage}}\" data-dj-admsrcvalue=\"{{adMsrcValue}}\" {{#adTopic}}data-dj-adtopic=\"{{adTopic}}\"{{/adTopic}} {{#adAuthor}}data-dj-adauthor=\"{{adAuthor}}\"{{/adAuthor}} {{#chartBeatAdId}}data-cb-ad-id=\"{{chartBeatAdId}}\"{{/chartBeatAdId}} data-dj-adcircvalue=\"{{circValue}}\"> </div> </div> {{/adActivate}} ");});
/*jshint white:true, evil:false, onevar:false, undef:true, bitwise: false, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/**
 * Comment Model - To do move data from view to model
 */
define('resp.module.livefyre/dj/widget/model/LivefyreCommentModel', ['vendor.asset.backbone/backbone', 'vendor.asset.jquery/jquery'], function (Backbone, $) {
  var LivefyreCommentModel = Backbone.Model.extend({

    cfg: {},

    initialize: function (options) {
      $.extend(this.cfg, options);

      this.baseUrl = '/news/commenting/djlivefyre?config=livefyreConfig';

      var $elem = this.cfg.el;

      this.streamInfo = encodeURIComponent($elem.attr('data-streamInfo'));
      this.tags = encodeURIComponent($elem.attr('data-tags'));
      this.articleUrl = encodeURIComponent($elem.attr('data-articleUrl'));
      this.articleId = encodeURIComponent($elem.attr('data-articleId'));
      this.articleTitle = encodeURIComponent($elem.attr('data-articleTitle'));

      this.commentCount = 0;

      this.name = '';
    },

    updateCommentCount: function (count) {

    }


  });
  return LivefyreCommentModel;
});
define("resp.module.livefyre/view/_messaging",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div id=\"livefyre-message\"> <p class=\"user\"> We're having some problems with our commenting system.<br> We'll fix it as soon as possible. Please try again later.</p> <p class=\"admin\"> The admin system is experiencing difficulties. <br>Please try again later.</p> </div>");});define("resp.module.livefyre/view/_onboarding",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"login_overlay\" id=\"getGreyBckgroundCSSDiv\"> <div class=\"onboarding-outer\"> <div class=\"onboarding-wrapper\"> <div class=\"onboarding-header\"> <p>Commenting on WSJ</p> <a class=\"onboarding-cancel\"href=\"#\">Close</a> </div> <div class=\"onboarding-voice\"> <p>A public profile and adherence to our <a href=\"http://online.wsj.com/public/page/commenting-rules.html\" target=\"_blank\">rules</a> and <a href=\"http://online.wsj.com/public/page/subscriber_agreement.html\" target=\"_blank\">terms</a> of use is required. A profile displaying your first and last name has been created for you. It may also include other information that you entered in the past.</p> </div> <div class=\"onboarding-body\"> <div class=\"starting\"> <p>I understand that my real name, my profile, and my commenting history will be publicly displayed.</p> <div class=\"onboarding-checkbox-agreement\"> <input type=\"checkbox\" name=\"commenting\" value=\"iagree\" /> <p class=\"onboarding-agreement\">Click to agree to the terms and continue</p> <ul class=\"cancelFinish\"> <li class=\"onboarding-finish\"> <a href=\"#\"> <div> <p> Confirm </p> </div> </a> </li> </ul> </div> </div> <div class=\"updating\"> <p>Updating profile...</p> </div> <div class=\"ending\"> <p>Your profile is now set to public. To change these settings, visit your <a href=\"/user/profile/myprofile\" target=\"_blank\">profile</a>.</p> <ul class=\"cancelFinish\"> <li class=\"onboarding-done\"> <a href=\"#\"> <div> <p> Finish </p> </div> </a> </li> </ul> </div> <div class=\"canceling\"> <p>You will not be able to comment until you accept the commenting <a href=\"http://online.wsj.com/public/page/subscriber_agreement.html\" target=\"_blank\">terms</a>.</p> </div> <div class=\"erroring\"> <p>There seens to have been an error, please try again later.</p> </div> </div> </div> </div> </div>");});define("resp.module.livefyre/view/comment",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div id=\"js-fyre-ts\"></div> <div id=\"livefyre-comment\" data-isseamless=\"{{isSeamless}}\" data-streaminfo=\"{{streamInfo}}\" data-tags=\"{{tags}}\" data-articleid=\"{{articleId}}\" data-articleurl=\"{{articleUrl}}\" data-articletitle=\"{{articleTitle}}\" data-loginurl=\"{{loginUrl}}\" data-profilevisibility=\"\" data-profileacceptedagreement=\"\"> {{{seoData}}}</div> <div id=\"fyre-archive-more\"><div class=\"fyre-archive-more-container\"><div class=\"fyre-text\">Show More Archives</div></div></div> <div id=\"livefyre-logs\"></div> <script data-template-id=\"_onboarding\" type=\"text/mustache\">{{>_onboarding}}</script> <script data-template-id=\"_messaging\" type=\"text/mustache\">{{>_messaging}}</script>");});define("resp.module.livefyre/view/commentCount",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<span class=\"livefyre-commentcount\" data-lf-article-id=\"{{articleId}}\" data-lf-site-id=\"{{siteId}}\">0 Comments</span>");});define("resp.module.livefyre/view/empty",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("");});
/*jshint white:true, evil:false, onevar:false, undef:true, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/**
 * Comment view
 */
define('resp.module.livefyre/dj/widget/view/LivefyreCommentMobileView', ['resp.module.livefyre/dj/widget/view/LivefyreOnboardingView',
  'resp.module.livefyre/dj/widget/model/LivefyreOnboardingModel',
  'resp.module.livefyre/dj/widget/view/LivefyreConfigureStrings',
  'resp.module.livefyre/dj/widget/util',
  'vendor.asset.jquery/jquery', 'vendor.asset.backbone/backbone'
], function (OnboardingView, OnboardingModel, ConfigureStrings, util, $, Backbone) {
  var LivefyreCommentMobileView = Backbone.View.extend({
    config: {
      "path": "/news/commenting/",
      loadOptions: {
        "strings": ConfigureStrings
      },
      streamOptions: {
        "editorCss": {
          background: 'none repeat scroll 0 0 #FFFFFF !important',
          color: '#404040',
          font: "16px/1.4 Arial, \"Helvetica Neue\", Helvetica, Geneva, sans-serif",
          padding: "6px",
          margin: "0",
          width: "100%",
          height: "100%",
          'max-height': "199px",
          'max-width': "589px",
          "box-sizing": 'border-box',
          "-webkit-box-sizing": 'border-box',
          "-moz-box-sizing": 'border-box',
          "-ms-box-sizing": 'border-box',
          "-o-box-sizing": 'border-box'
        }
      }
    },
    events: function () {
      var events = {};
      events['keyup document'] = 'onKeyUp';
      return events;
    },
    onClickMoreHistory: function () {
      console.log('onClickMoreHistory');
    },
    setliveFyreConfig: function () {
      var self = this;

      var config = {
        ExpoPath: this._cfg.path,
        SkinCssUrl: this._cfg.css,
        LoadOptions: this._cfg.loadOptions,
        StreamOptions: this._cfg.streamOptions,
        LoginHandler: function () {
          // This should call functionality on your site that will open a login modal/dialog for your users to sign in to your site
          LIFP.login();
        },
        MissingNameHandler: function () { // REQUIRED
          // This function will get called if a user attempts to interact with the stream is logged in but their name is missing from their profile
          // Let the user know their name is missing and that they must update their profile before they can comment
        },
        SuspendedUserHandler: function (name) { // REQUIRED
          // This function will get called if a user attempts to interact with the stream and that user is suspended
          // Users can get suspended by moderators if they are suspected of using a fake identity or have a famous name
          // The user should be told they are suspended and that they will either have to change their name or prove
          // to a customer service rep that they are who they say they are before being allowed to comment
          alert('There\'s a problem with your profile. Please contact moderator@wsj.com for more information.');
        },

        FirstTimeCommenterHandler: function (name, acceptTermsCallback) { // REQUIRED
          // If a user hasn't commented before they should be shown a message asking them to read and accept your sites terms of use or commenting policy
          // Use their name to make the message more personal
          // acceptTermsCallback should be called when the user hits accept, the callback will make an ajax call to get the users LF token and log them into
          // the livefyre comment stream, you may optionally pass in your own callback function to acceptTermsCallback
          // it will get called once the ajax request is complete

          var model = new OnboardingModel();
          var options = {};
          options.name = name;
          options.acceptTermsCallback = acceptTermsCallback;
          options.$moduleEl = self.$el.parent();

          this.onboardingView = new OnboardingView({
            el: self.$el.prev(),
            model: model
          }, options);

          this.onboardingView.render();

        },
        FailHandler: function (type) { // REQUIRED
          // This is called if Livefyre's servers error out or take too long to respond
          // Use this the degrade your page gracefully and/or let users know they may need to refresh the page because there was an error
          var model = new FailMessagingModel();
          var options = {};

          options.type = type;

          this.failMessagingView = new FailMessagingView({
            el: self.$el.prev(),
            model: model
          }, options);

          this.failMessagingView.render();

        },
        CommentCountUpdatedHandler: function (count) {

          // This function will get called anytime a comment is added to the page
          // use this to update any elements on the page outside of the stream that contain the count

          self.model.commentCount = count;

        },
        CommentLikedHandler: function (data) { // OPTIONAL
          // This function will get called anytime a user likes a comment in the stream
          // prob can't use this since it doens't trigger when likes are removed.
          // var $el = $('.fyre-comment-article[data-message-id="' + data.targetId + '"]');

        },
        CommentSharedHandler: function (data) { // OPTIONAL
          // data contains 2 boolean properties: 'sharedToTwitter' and 'sharedToFacebook'
          // The intended use of this function is to track shares
        },
        CommentPostedHandler: function () { // OPTIONAL
          // The intended use of this function is to perform tracking when a comment is posted
          self.runUpdate('post');

        },
        ReadyHandler: function () {
          self.model.name = DowJones.LivefyreCommentStream.Name;
          self.setProfileAttributes();
        }
      };
      return config;
    },

    onKeyUp: function (e) {},

    login: {
      loggedState: false,
      checkStatus: function (self) {

        var type = $('meta[name="user.type"]').attr('content');

        switch (type) {
          case 'subscriber':
            self.login.loggedState = true;
            break;
          case 'freeRegister':
            self.login.loggedState = true;
            break;
          case 'nonsubscriber':
            self.login.loggedState = false;
            break;
        }
        //console.log(self.login.loggedState);
        return self.login.loggedState;
      }
    },

    init: {
      streamElement: null,
      updateStart: false,
      loggedIn: function (self, $stream, cb) {

        var ruleHTML,
          profilevisibility;

        ruleHTML = '<p class="comment-rules-note">All comments will display your real name. Read our <a href="http://online.wsj.com/public/page/commenting-rules.html">commenting rules.</a></p>';
        profilevisibility = $stream.data('profilevisibility');
        $('body').addClass(profilevisibility);
        $('.fyre-editor', $stream).eq(0).after(ruleHTML);
        self.init.addLogBanner(self, $stream);

        cb(self, $stream);
      },

      checkAdmin: function (self, $stream) {
        var link,
          poll,
          userType = {
            admin: 'site-admin',
            sub: 'site-user'
          },
          inc = 0,
          resolved;
        $stream = $stream || $('#livefyre-comment');

        poll = setInterval(function () {
          link = $('.fyre-auth', $stream).find('li.fyre-admin-link > a');
          if (link.length > 0) {
            resolved = (link.text() === 'Site admin') ? userType.admin : userType.sub;
            $stream.addClass(resolved);
            clearInterval(poll);
          } else if (inc >= 5000) {
            $stream.addClass(resolved);
            resolved = userType.sub;
            clearInterval(poll);
          }

          inc += 30;

        }, 30);

      },

      addLogBanner: function (self, $stream) {

        var $logBannerEl,
          $html,
          ctaHtml,
          resolved,
          $elData;

        $logBannerEl = $('<div />', {
          "class": "fyre-comments-log-button"
        });
        $elData = $('#livefyre-comment').data();

        ctaHtml = {
          loggedOut: '<p><a href="' + $elData.loginurl + '" class="login-button">Log in to comment</a></p>',
          profileOnboard: '<p><a href="#" class="js-onboard">Set your profile to public to comment</a></p>',
          profilePublic: '',
          seamless: '<p>Your subscription does not allow access to this feature</p>'
        };

        if ($elData.isseamless) {
          resolved = 'seamless';
        } else if (!self.login.loggedState) {
          resolved = 'loggedOut';
        } else if ($elData.profilevisibility === 'public' && $elData.profileacceptedagreement !== '') {
          resolved = 'profilePublic';
        } else {
          resolved = 'profileOnboard';
          self.eventHandlers.onboard.setHeight();
          self.eventHandlers.onboard.clickEvents(self);
        }

        $('.fyre-featured-content-wrapper', $stream).after($logBannerEl);
        $('.fyre-comments-log-button', $stream).html(ctaHtml[resolved]);

      },

      notLoggedIn: function (self, $stream, cb) {
        $('body').addClass('user-loggedout');
        self.init.addLogBanner(self, $stream);

        cb(self, $stream);
      },

      callbacks: function (self, $stream) {
        //console.log('callbacks called');

        self.moderatorCheck(self);
        self.likeButton.badge(self, $stream);
        self.likeButton.egoCheck(self, $stream);
        self.eventHandlers.loadMore(self);

        if (self.login.loggedState) {
          self.eventHandlers.flag.icon(self);
          self.eventHandlers.like(self);
          self.eventHandlers.reply.button(self);
          self.init.checkAdmin(self, $stream);
          self.eventHandlers.editorEditButton(self);
          self.eventHandlers.editorCancelButton(self);
        }

        self.checkStream(self, $stream);

      }
    },

    checkStream: function (self, $stream) {

      $stream.addClass('visibility-visible-important').find('.fyre-comment-article').data('handled', 'yes');

      setInterval(function () {
        var $notHandled, dfd;

        dfd = $.Deferred();
        $notHandled = $('.fyre-comment-article', $stream).filter(function () {
          return ($(this).data('handled') === 'yes') ? false : $(this);
        });

        if (self.updateRunning || $notHandled.length === 0) {
          dfd.reject();
        } else {
          self.runUpdate('check');
          dfd.resolve();
        }

        return dfd.promise();

      }, 1000);
    },

    updateRunning: false,
    runUpdate: function (type) {
      var self = this;

      //console.log('run update called: ' + type);
      self.updateRunning = true;

      var $replyEls,
        $currentArticles,
        $notHandled,
        $mainEditor;

      $mainEditor = $('.fyre-editor', self.init.streamElement).eq(0);
      $currentArticles = $('.fyre-comment-article', self.init.streamElement);
      $notHandled = $currentArticles.filter(function () {
        return ($(this).data('handled') === 'yes') ? false : $(this);
      });
      $replyEls = $('.fyre-comment-reply', $currentArticles);

      $notHandled.each(function () {

        if (type) {
          if (type === 'post') {
            self.eventHandlers.tracking.trigger(self);
            self.eventHandlers.reply.removeReply(self, null, $replyEls);
            $('.reply-to-wrapper', self.init.streamElement).hide();
          }

          self.likeButton.badge(self, $(this));
          self.likeButton.egoCheck(self, $(this));
        }
        $(this).data('handled', 'yes');

      }).promise().done(function () {

        self.moderatorCheck(self);
        self.loader.hidden(self);
        self.updateRunning = false;
      });
    },

    flag: {

      openDrop: function (self, $this) {

        //console.log('flag open called');

        setTimeout(function () {
          var $footerEl = $this.closest('.fyre-comment-footer'),
            $footerChild = $footerEl.children('.fyre-comment-actions'),
            $modalElOrig = $('body > .fyre-modal'),
            $modalElOrigSel = $modalElOrig.find('.fyre-modal-flagas'),
            $cloneModal = $modalElOrig.clone(true, true).removeClass('display-none-important').addClass('inline-modal-flag is-open'),
            $cloneFormContainer = $cloneModal.find('.fyre-modal-container'),
            $cloneForm = $cloneFormContainer.children('form'),
            $cloneFormSelect = $cloneForm.find('.fyre-modal-flagas'),
            thanksHtml = '<div class="flag-thanks-wrapper"><span class="flag-header">Thank You!</span><span class="flag-message">You have reported this comment for review. Your help is helping us host a better conversation.</span></div>',
            i = 0,
            values = $cloneFormSelect.children().map(function () {
              return $(this).val();
            }).get();

          values = values.sort();
          values = values.reverse();

          $cloneFormContainer.append('<ul class="select-list"></ul>').append(thanksHtml);
          for (i; i < values.length; i += 1) {
            values[i] = (values[i] === 'disagree') ? 'Other' : values[i];
            $cloneFormContainer.children('.select-list').append('<li><a href="#" class="select-item" ref=' + values[i] + ' >' + values[i] + '</a></li>');
          }

          // remove all other inline-modals in the widget
          $('.fyre-modal', self.init.streamElement).remove();
          $modalElOrig.addClass('display-none-important visibility-hidden-important');

          self.updateZindex.makeTop(self, $footerEl);
          $this.addClass('is-open').siblings().removeClass('is-open');

          $footerChild.prepend($cloneModal);
          $footerChild.find('.inline-modal-flag').animate({
            'height': 154
          }, 200, function () {
            $(this).addClass('is-open');
          });

          self.eventHandlers.flag.selectClick.on(self);
          //console.log(self.eventHandlers.bodyNode.flagState);
        }, 10);

        self.eventHandlers.bodyNode.flagState = true;

      },

      triggerFlag: function (self, $tar) {
        // console.log('trigger flag called');
        var val,
          $modalElOrig,
          $modalElOrigSel,
          $flagLink,
          $footerEl;

        $footerEl = $tar.closest('.fyre-comment-footer');
        $flagLink = $('.fyre-flag-link', $footerEl);
        $modalElOrig = $('body > .fyre-modal');
        $modalElOrigSel = $modalElOrig.find('.fyre-modal-flagas');
        val = $tar.text();
        val = (val === 'Other') ? 'disagree' : val;

        $modalElOrigSel.val(val);

        $modalElOrig.find('button.goog-buttonset-default').eq(0).trigger('click');
        $modalElOrig.removeClass('display-none-important visibility-hidden-important');

        $flagLink.addClass('is-flagged').off('mouseup.flagLink');

        $('.flag-thanks-wrapper', self.init.streamElement).fadeIn(200, function () {
          setTimeout(function () {
            self.flag.closeDrop(self);
          }, 2000);
        });

      },

      closeDrop: function (self) {
        //console.log('closeDrop');
        var $inlineModal,
          $footerEl,
          $menuEl,
          $modalElOrig;

        $modalElOrig = $('body > .fyre-modal');
        $inlineModal = $('.inline-modal-flag', self.init.streamElement);
        $footerEl = $inlineModal.closest('.fyre-comment-footer');
        $menuEl = $footerEl.children('.fyre-editor').children('.fyre-editor-container').find('.fyre-mention-button');

        $inlineModal.animate({
          'height': 0
        }, 200, function () {
          $(this).remove();
          $footerEl.find('.fyre-flag-link').removeClass('is-open');

          self.eventHandlers.flag.selectClick.off(self);
          self.eventHandlers.bodyNode.flagState = false;

          if (!($menuEl.hasClass('fyre-button-left-open'))) {
            self.updateZindex.removeTop(self, $footerEl);
          }

        });

      }
    },

    updateZindex: {
      makeTop: function (self, $el) {
        if ($el) {
          $el.closest('.fyre-comment-wrapper').addClass('top-z-index').data('top', 'true');
          self.eventHandlers.bodyNode.topState = true;
        }
      },
      removeTop: function (self, $el) {
        if ($el) {
          $el.closest('.fyre-comment-wrapper').removeClass('top-z-index').data('top', '');
          self.eventHandlers.bodyNode.topState = false;
        }
      }
    },

    moderatorCheck: function (self) {
      return $('.fyre-moderator', self.init.streamElement).parent().siblings('.fyre-comment-user').children('.fyre-comment-author').addClass('fyre-comment-author-tag-editor');
    },

    loader: {
      visible: function (self) {
        // show loader
        $('.fyre-stream-content', self.init.streamElement).addClass('visibility-hidden-important');
        $('.fyre-content-loading', self.init.streamElement).addClass('display-block-important');
      },
      hidden: function (self) {
        // hide loader
        $('.fyre-stream-content', self.init.streamElement).removeClass('visibility-hidden-important');
        $('.fyre-content-loading', self.init.streamElement).removeClass('display-block-important');
      }
    },

    likeButton: {

      badge: function (self, $el) {

        $el = $el || $('.fyre-comment-article', self.init.streamElement);

        var dfd = $.Deferred(),
          $likeCountEl,
          threshold = 10,
          $tar;

        $likeCountEl = $('.fyre-comment-like-count', $el).filter(function () {
          var $filterEl = $(this),
            count = parseInt($(this).text(), 10),
            method;

          $(this).data('method', 'removeClass');
          count = (isNaN(count)) ? 0 : count;
          method = (count > threshold && count !== 0) ? 'addClass' : 'removeClass';
          $(this).data('method', method);

          return $(this);

        });

        $likeCountEl.each(function () {
          var method = $(this).data('method');
          $tar = $(this).closest('.fyre-comment-footer').siblings('.fyre-comment-head').eq(0).children('.fyre-comment-username');
          $tar[method]('most-liked');
        }).promise().done(function () {
          dfd.resolve();
        });

        return dfd.promise();
      },

      egoCheck: function (self, $el) {
        $el = $el || self.init.streamElement;
        $('.fyre-comment-user[data-from="' + DowJones.LivefyreCommentStream.Name + '"]', $el).siblings('.fyre-comment-footer').addClass('ego-checked');
      }
    },

    eventHandlers: {
      archiveBtn: {
        build: function (self) {

          var $archiveStreamEl = $('.fyre-archive-stream', self.init.streamElement),
            $archiveShowBtn = $('#fyre-archive-more'),
            $archiveLoadBtn = $('.fyre-stream-more', $archiveStreamEl),
            $cloneBtn = $archiveShowBtn.clone();

          if ($archiveStreamEl.length > 0) {
            $archiveShowBtn.remove();
            $archiveLoadBtn.hide();
            $archiveStreamEl.append($cloneBtn);
            self.eventHandlers.archiveBtn.clickEvent(self, $archiveStreamEl);
          }

        },

        clickEvent: function (self, $archiveStreamEl) {
          var $archiveArticles,
            $cloneShowBtn,
            $archiveLoadBtn;

          $('#livefyre-comment').on('click', '#fyre-archive-more', function (e) {
            $archiveArticles = $('.fyre-comment-article:nth-child(n+3)', $archiveStreamEl);

            $cloneShowBtn = $('#fyre-archive-more');
            $archiveLoadBtn = $('.fyre-stream-more', $archiveStreamEl);

            $archiveArticles.slideDown('slow');
            $cloneShowBtn.remove();
            $archiveLoadBtn.show();

          });
        }
      },

      onboard: {

        tiggerDisplayModal: function () {
          $('.fyre-event-overlay').eq(0).trigger('click');
        },

        triggerKillModal: function () {
          $('.onboarding-done').eq(0).trigger('click');
        },

        setHeight: function () {
          setTimeout(function () {
            var $stream, tarHeight;
            $stream = $('#livefyre-comment');
            tarHeight = ($('.fyre-widget', $stream).height() - 100);

            $('.fyre-event-overlay', $stream).height(tarHeight);

          }, 5000);
        },

        clickEvents: function (self) {
          $('#livefyre-wrapper').on('click', '.js-onboard', function (e) {
            e.preventDefault();
            self.eventHandlers.onboard.tiggerDisplayModal();
          });

          $('body').on('click', '.ending > p > a', function (e) {
            e.preventDefault();
            self.eventHandlers.onboard.triggerKillModal();
          });
        }
      },

      tracking: {
        trigger: function (self) {
          $('body').children('.js-fyre-ts').trigger('click');
        }
      },

      loadMore: function (self) {
        // run events when we load more comments on the page
        $('body').on('click', '.fyre-stream-more-container', function (e) {
          self.loader.visible(self);
          self.runUpdate('load');
        });
      },

      flag: {

        icon: function (self) {
          // flag post click handler

          // $('body').on('mouseup.flagLink', '.fyre-comment-flag-mobile-btn', function (e) {

          //   e.preventDefault();

          //   var $tar = $(e.target),
          //     $mobileDropEl;

          //   if ($tar.hasClass('is-open')) {
          //     $tar.removeClass('is-open');
          //     $mobileDropEl.removeClass('is-open');
          //   } else {
          //     $tar.addClass('is-open');
          //     setTimeout(function () {
          //       $mobileDropEl = $tar.closest('.fyre-widget').children('.fyre-stream-menu-container').children('.fyre-mobile-menu');
          //       $('.fyre-flag-disagree-link', $mobileDropEl).text('Other');
          //     }, 10);
          //   }

          // });

        }

      },

      editorEditButton: function (self) {
        /* Editor Edit Button */
        $('body').on('mouseup', '.fyre-comment-edit', function (e) {
          e.preventDefault();
          var $tar,
            $editorBox,
            $counterEl,
            $footerEl,
            $timeEl;

          $tar = $(e.currentTarget);
          $footerEl = $tar.parents('.fyre-comment-body').siblings('footer');

          $editorBox = $footerEl.find('.fyre-editor');
          $counterEl = $('.counter-wrapper', $editorBox);

          $footerEl.addClass('no-max-height').siblings('.fyre-comment-head').find('.fyre-comment-date').hide();
          $editorBox.removeClass('display-none-important');

        });
      },
      editorCancelButton: function (self) {
        /* Editor Cancel Edit Button */
        $('body').on('mouseup', function (e) {

          var $tar,
            $cancelEl,
            $timeEl;

          $tar = $(e.target);
          $cancelEl = $tar.parents('.fyre-post-button-edit');
          $timeEl = $('.fyre-comment-date', self.init.streamElement);
          if ($tar.text() === 'Edit comment' && $tar.hasClass('fyre-button-right-inner-box')) {
            $('.fyre-comment-footer', self.init.streamElement).removeClass('no-max-height');
            $timeEl.show();
          }

        });
      },
      reply: {

        button: function (self) {
          // reply button click handler
          $('body').on('mouseup.replyClick', '.fyre-comment-reply', function (e) {
            e.preventDefault();
            var $tar,
              $timeEl;

            $tar = $(e.currentTarget);
            $timeEl = $tar.parents('.fyre-comment-footer').siblings('.fyre-comment-head').children('.fyre-comment-date');

            if ($tar.hasClass('fyre-reply-active')) {
              $timeEl.css({
                top: 'auto',
                bottom: '48px'
              });
            } else {

              $timeEl.css({
                top: $timeEl.position().top,
                bottom: 'auto !important'
              });
            }

          });
        },

        buildReply: function (self, $tar, $counterEl, $editorBox) {


        },

        removeReply: function (self, $tar, $replyEls) {
          //console.log('remove called');
          var $els,
            $footerEl,
            $dateEl,
            $siblingEditor,
            $modalElOrig;

          $els = ($tar) ? $tar : $replyEls;
          $footerEl = $els.closest('footer');
          $dateEl = $footerEl.siblings('.fyre-comment-head').children('.fyre-comment-date');
          $siblingEditor = $els.siblings('.fyre-editor');
          $modalElOrig = $('body > .fyre-modal');

        }
      },

      bodyNode: {
        sortState: false,
        flagState: false,
        replyState: false,
        topState: false,
        clickHandler: function (self) {
        }
      },

      sortDrop: {
        clickHandler: function (self, $el) {

        },

        callback: function (self) {
          self.loader.visible(self);
          self.runUpdate('load');
        },
        open: function (self, $el) {
          self.eventHandlers.bodyNode.sortState = true;
          $el.parent().addClass('is-open');
        },
        close: function (self, $el) {
          self.eventHandlers.bodyNode.sortState = false;
          $el.parent().removeClass('is-open');
        }
      },

      like: function (self) {
        // like button click handler
        $('body').on('click', '.fyre-comment-like-btn', function (e) {
          //console.log('like button clicked');
          var $el = $(this).closest('.fyre-comment-article');
          $.when(self.likeButton.badge(self, $el)).done(function () {
            self.runUpdate('check');
          });
          $(this).toggleClass('user-liked');
        });
      }
    },

    setProfileAttributes: function () {

      var self, profileCookie, profileStr, profile, $stream;

      self = this;
      self.init.streamElement = $('#livefyre-comment');
      $stream = self.init.streamElement;
      profileCookie = decodeURIComponent(util.getCookie('prfapp_usrprfle'));

      if (self.login.checkStatus(self)) {
        if (profileCookie.length > 0) {
          profileStr = util.base64Decode(profileCookie);
          //profileStr = window.atob(profileCookie);
          //profileStr = _decodeBase64(profileCookie);
          profile = $.parseJSON(profileStr);
          $stream.data({
            'profilevisibility': profile.visibility,
            'profileacceptedagreement': profile.acceptedAgreement
          });
        } else {
          $stream.data({
            'profilevisibility': 'private',
            'profileacceptedagreement': ''
          });
        }

        self.init.loggedIn(self, $stream, self.init.callbacks);

      } else {
        self.init.notLoggedIn(self, $stream, self.init.callbacks);
      }


    },

    initialize: function (model, options) {
      this._cfg = $.extend({}, this.config);
      window.livefyreConfig = this.setliveFyreConfig();
      var url = this._cfg.path + 'djlivefyre?config=livefyreConfig';

      url += '&streaminfo=' + this.model.streamInfo;

      $.ajax({
        crossDomain: true,
        dataType: "script",
        url: url,
        timeout: 5000,
        success: function () {},
        error: function () {
          // create hidden log for QA
          var message = '<p>errorThrown: ' + errorThrown + '</p>';
          $('#livefyre-logs').html(message);
        }
      });
    }
  });
  return LivefyreCommentMobileView;
});
define("vendor.asset.backbone/backbone", ['vendor.asset.jquery/jquery', 'vendor.asset.underscore/underscore'], function (jQuery, _) {
this.jQuery = jQuery;
this._ = _;
//-----------------------------------------------------------------


//     Backbone.js 0.9.2
//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

(function(){

  // Initial Setup
  // -------------

  // Save a reference to the global object (`window` in the browser, `global`
  // on the server).
  var root = this;

  // Save the previous value of the `Backbone` variable, so that it can be
  // restored later on, if `noConflict` is used.
  var previousBackbone = root.Backbone;

  // Create a local reference to slice/splice.
  var slice = Array.prototype.slice;
  var splice = Array.prototype.splice;

  // The top-level namespace. All public Backbone classes and modules will
  // be attached to this. Exported for both CommonJS and the browser.
  var Backbone;
  if (typeof exports !== 'undefined') {
    Backbone = exports;
  } else {
    Backbone = root.Backbone = {};
  }

  // Current version of the library. Keep in sync with `package.json`.
  Backbone.VERSION = '0.9.2';

  // Require Underscore, if we're on the server, and it's not already present.
  var _ = root._;
  if (!_ && (typeof require !== 'undefined')) _ = require('underscore');

  // For Backbone's purposes, jQuery, Zepto, or Ender owns the `$` variable.
  var $ = root.jQuery || root.Zepto || root.ender;

  // Set the JavaScript library that will be used for DOM manipulation and
  // Ajax calls (a.k.a. the `$` variable). By default Backbone will use: jQuery,
  // Zepto, or Ender; but the `setDomLibrary()` method lets you inject an
  // alternate JavaScript library (or a mock library for testing your views
  // outside of a browser).
  Backbone.setDomLibrary = function(lib) {
    $ = lib;
  };

  // Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable
  // to its previous owner. Returns a reference to this Backbone object.
  Backbone.noConflict = function() {
    root.Backbone = previousBackbone;
    return this;
  };

  // Turn on `emulateHTTP` to support legacy HTTP servers. Setting this option
  // will fake `"PUT"` and `"DELETE"` requests via the `_method` parameter and
  // set a `X-Http-Method-Override` header.
  Backbone.emulateHTTP = false;

  // Turn on `emulateJSON` to support legacy servers that can't deal with direct
  // `application/json` requests ... will encode the body as
  // `application/x-www-form-urlencoded` instead and will send the model in a
  // form param named `model`.
  Backbone.emulateJSON = false;

  // Backbone.Events
  // -----------------

  // Regular expression used to split event strings
  var eventSplitter = /\s+/;

  // A module that can be mixed in to *any object* in order to provide it with
  // custom events. You may bind with `on` or remove with `off` callback functions
  // to an event; trigger`-ing an event fires all callbacks in succession.
  //
  //     var object = {};
  //     _.extend(object, Backbone.Events);
  //     object.on('expand', function(){ alert('expanded'); });
  //     object.trigger('expand');
  //
  var Events = Backbone.Events = {

    // Bind one or more space separated events, `events`, to a `callback`
    // function. Passing `"all"` will bind the callback to all events fired.
    on: function(events, callback, context) {

      var calls, event, node, tail, list;
      if (!callback) return this;
      events = events.split(eventSplitter);
      calls = this._callbacks || (this._callbacks = {});

      // Create an immutable callback list, allowing traversal during
      // modification.  The tail is an empty object that will always be used
      // as the next node.
      while (event = events.shift()) {
        list = calls[event];
        node = list ? list.tail : {};
        node.next = tail = {};
        node.context = context;
        node.callback = callback;
        calls[event] = {tail: tail, next: list ? list.next : node};
      }

      return this;
    },

    // Remove one or many callbacks. If `context` is null, removes all callbacks
    // with that function. If `callback` is null, removes all callbacks for the
    // event. If `events` is null, removes all bound callbacks for all events.
    off: function(events, callback, context) {
      var event, calls, node, tail, cb, ctx;

      // No events, or removing *all* events.
      if (!(calls = this._callbacks)) return;
      if (!(events || callback || context)) {
        delete this._callbacks;
        return this;
      }

      // Loop through the listed events and contexts, splicing them out of the
      // linked list of callbacks if appropriate.
      events = events ? events.split(eventSplitter) : _.keys(calls);
      while (event = events.shift()) {
        node = calls[event];
        delete calls[event];
        if (!node || !(callback || context)) continue;
        // Create a new list, omitting the indicated callbacks.
        tail = node.tail;
        while ((node = node.next) !== tail) {
          cb = node.callback;
          ctx = node.context;
          if ((callback && cb !== callback) || (context && ctx !== context)) {
            this.on(event, cb, ctx);
          }
        }
      }

      return this;
    },

    // Trigger one or many events, firing all bound callbacks. Callbacks are
    // passed the same arguments as `trigger` is, apart from the event name
    // (unless you're listening on `"all"`, which will cause your callback to
    // receive the true name of the event as the first argument).
    trigger: function(events) {
      var event, node, calls, tail, args, all, rest;
      if (!(calls = this._callbacks)) return this;
      all = calls.all;
      events = events.split(eventSplitter);
      rest = slice.call(arguments, 1);

      // For each event, walk through the linked list of callbacks twice,
      // first to trigger the event, then to trigger any `"all"` callbacks.
      while (event = events.shift()) {
        if (node = calls[event]) {
          tail = node.tail;
          while ((node = node.next) !== tail) {
            node.callback.apply(node.context || this, rest);
          }
        }
        if (node = all) {
          tail = node.tail;
          args = [event].concat(rest);
          while ((node = node.next) !== tail) {
            node.callback.apply(node.context || this, args);
          }
        }
      }

      return this;
    }

  };

  // Aliases for backwards compatibility.
  Events.bind   = Events.on;
  Events.unbind = Events.off;

  // Backbone.Model
  // --------------

  // Create a new model, with defined attributes. A client id (`cid`)
  // is automatically generated and assigned for you.
  var Model = Backbone.Model = function(attributes, options) {
    var defaults;
    attributes || (attributes = {});
    if (options && options.parse) attributes = this.parse(attributes);
    if (defaults = getValue(this, 'defaults')) {
      attributes = _.extend({}, defaults, attributes);
    }
    if (options && options.collection) this.collection = options.collection;
    this.attributes = {};
    this._escapedAttributes = {};
    this.cid = _.uniqueId('c');
    this.changed = {};
    this._silent = {};
    this._pending = {};
    this.set(attributes, {silent: true});
    // Reset change tracking.
    this.changed = {};
    this._silent = {};
    this._pending = {};
    this._previousAttributes = _.clone(this.attributes);
    this.initialize.apply(this, arguments);
  };

  // Attach all inheritable methods to the Model prototype.
  _.extend(Model.prototype, Events, {

    // A hash of attributes whose current and previous value differ.
    changed: null,

    // A hash of attributes that have silently changed since the last time
    // `change` was called.  Will become pending attributes on the next call.
    _silent: null,

    // A hash of attributes that have changed since the last `'change'` event
    // began.
    _pending: null,

    // The default name for the JSON `id` attribute is `"id"`. MongoDB and
    // CouchDB users may want to set this to `"_id"`.
    idAttribute: 'id',

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // Return a copy of the model's `attributes` object.
    toJSON: function(options) {
      return _.clone(this.attributes);
    },

    // Get the value of an attribute.
    get: function(attr) {
      return this.attributes[attr];
    },

    // Get the HTML-escaped value of an attribute.
    escape: function(attr) {
      var html;
      if (html = this._escapedAttributes[attr]) return html;
      var val = this.get(attr);
      return this._escapedAttributes[attr] = _.escape(val == null ? '' : '' + val);
    },

    // Returns `true` if the attribute contains a value that is not null
    // or undefined.
    has: function(attr) {
      return this.get(attr) != null;
    },

    // Set a hash of model attributes on the object, firing `"change"` unless
    // you choose to silence it.
    set: function(key, value, options) {
      var attrs, attr, val;

      // Handle both `"key", value` and `{key: value}` -style arguments.
      if (_.isObject(key) || key == null) {
        attrs = key;
        options = value;
      } else {
        attrs = {};
        attrs[key] = value;
      }

      // Extract attributes and options.
      options || (options = {});
      if (!attrs) return this;
      if (attrs instanceof Model) attrs = attrs.attributes;
      if (options.unset) for (attr in attrs) attrs[attr] = void 0;

      // Run validation.
      if (!this._validate(attrs, options)) return false;

      // Check for changes of `id`.
      if (this.idAttribute in attrs) this.id = attrs[this.idAttribute];

      var changes = options.changes = {};
      var now = this.attributes;
      var escaped = this._escapedAttributes;
      var prev = this._previousAttributes || {};

      // For each `set` attribute...
      for (attr in attrs) {
        val = attrs[attr];

        // If the new and current value differ, record the change.
        if (!_.isEqual(now[attr], val) || (options.unset && _.has(now, attr))) {
          delete escaped[attr];
          (options.silent ? this._silent : changes)[attr] = true;
        }

        // Update or delete the current value.
        options.unset ? delete now[attr] : now[attr] = val;

        // If the new and previous value differ, record the change.  If not,
        // then remove changes for this attribute.
        if (!_.isEqual(prev[attr], val) || (_.has(now, attr) != _.has(prev, attr))) {
          this.changed[attr] = val;
          if (!options.silent) this._pending[attr] = true;
        } else {
          delete this.changed[attr];
          delete this._pending[attr];
        }
      }

      // Fire the `"change"` events.
      if (!options.silent) this.change(options);
      return this;
    },

    // Remove an attribute from the model, firing `"change"` unless you choose
    // to silence it. `unset` is a noop if the attribute doesn't exist.
    unset: function(attr, options) {
      (options || (options = {})).unset = true;
      return this.set(attr, null, options);
    },

    // Clear all attributes on the model, firing `"change"` unless you choose
    // to silence it.
    clear: function(options) {
      (options || (options = {})).unset = true;
      return this.set(_.clone(this.attributes), options);
    },

    // Fetch the model from the server. If the server's representation of the
    // model differs from its current attributes, they will be overriden,
    // triggering a `"change"` event.
    fetch: function(options) {
      options = options ? _.clone(options) : {};
      var model = this;
      var success = options.success;
      options.success = function(resp, status, xhr) {
        if (!model.set(model.parse(resp, xhr), options)) return false;
        if (success) success(model, resp);
      };
      options.error = Backbone.wrapError(options.error, model, options);
      return (this.sync || Backbone.sync).call(this, 'read', this, options);
    },

    // Set a hash of model attributes, and sync the model to the server.
    // If the server returns an attributes hash that differs, the model's
    // state will be `set` again.
    save: function(key, value, options) {
      var attrs, current;

      // Handle both `("key", value)` and `({key: value})` -style calls.
      if (_.isObject(key) || key == null) {
        attrs = key;
        options = value;
      } else {
        attrs = {};
        attrs[key] = value;
      }
      options = options ? _.clone(options) : {};

      // If we're "wait"-ing to set changed attributes, validate early.
      if (options.wait) {
        if (!this._validate(attrs, options)) return false;
        current = _.clone(this.attributes);
      }

      // Regular saves `set` attributes before persisting to the server.
      var silentOptions = _.extend({}, options, {silent: true});
      if (attrs && !this.set(attrs, options.wait ? silentOptions : options)) {
        return false;
      }

      // After a successful server-side save, the client is (optionally)
      // updated with the server-side state.
      var model = this;
      var success = options.success;
      options.success = function(resp, status, xhr) {
        var serverAttrs = model.parse(resp, xhr);
        if (options.wait) {
          delete options.wait;
          serverAttrs = _.extend(attrs || {}, serverAttrs);
        }
        if (!model.set(serverAttrs, options)) return false;
        if (success) {
          success(model, resp);
        } else {
          model.trigger('sync', model, resp, options);
        }
      };

      // Finish configuring and sending the Ajax request.
      options.error = Backbone.wrapError(options.error, model, options);
      var method = this.isNew() ? 'create' : 'update';
      var xhr = (this.sync || Backbone.sync).call(this, method, this, options);
      if (options.wait) this.set(current, silentOptions);
      return xhr;
    },

    // Destroy this model on the server if it was already persisted.
    // Optimistically removes the model from its collection, if it has one.
    // If `wait: true` is passed, waits for the server to respond before removal.
    destroy: function(options) {
      options = options ? _.clone(options) : {};
      var model = this;
      var success = options.success;

      var triggerDestroy = function() {
        model.trigger('destroy', model, model.collection, options);
      };

      if (this.isNew()) {
        triggerDestroy();
        return false;
      }

      options.success = function(resp) {
        if (options.wait) triggerDestroy();
        if (success) {
          success(model, resp);
        } else {
          model.trigger('sync', model, resp, options);
        }
      };

      options.error = Backbone.wrapError(options.error, model, options);
      var xhr = (this.sync || Backbone.sync).call(this, 'delete', this, options);
      if (!options.wait) triggerDestroy();
      return xhr;
    },

    // Default URL for the model's representation on the server -- if you're
    // using Backbone's restful methods, override this to change the endpoint
    // that will be called.
    url: function() {
      var base = getValue(this, 'urlRoot') || getValue(this.collection, 'url') || urlError();
      if (this.isNew()) return base;
      return base + (base.charAt(base.length - 1) == '/' ? '' : '/') + encodeURIComponent(this.id);
    },

    // **parse** converts a response into the hash of attributes to be `set` on
    // the model. The default implementation is just to pass the response along.
    parse: function(resp, xhr) {
      return resp;
    },

    // Create a new model with identical attributes to this one.
    clone: function() {
      return new this.constructor(this.attributes);
    },

    // A model is new if it has never been saved to the server, and lacks an id.
    isNew: function() {
      return this.id == null;
    },

    // Call this method to manually fire a `"change"` event for this model and
    // a `"change:attribute"` event for each changed attribute.
    // Calling this will cause all objects observing the model to update.
    change: function(options) {
      options || (options = {});
      var changing = this._changing;
      this._changing = true;

      // Silent changes become pending changes.
      for (var attr in this._silent) this._pending[attr] = true;

      // Silent changes are triggered.
      var changes = _.extend({}, options.changes, this._silent);
      this._silent = {};
      for (var attr in changes) {
        this.trigger('change:' + attr, this, this.get(attr), options);
      }
      if (changing) return this;

      // Continue firing `"change"` events while there are pending changes.
      while (!_.isEmpty(this._pending)) {
        this._pending = {};
        this.trigger('change', this, options);
        // Pending and silent changes still remain.
        for (var attr in this.changed) {
          if (this._pending[attr] || this._silent[attr]) continue;
          delete this.changed[attr];
        }
        this._previousAttributes = _.clone(this.attributes);
      }

      this._changing = false;
      return this;
    },

    // Determine if the model has changed since the last `"change"` event.
    // If you specify an attribute name, determine if that attribute has changed.
    hasChanged: function(attr) {
      if (!arguments.length) return !_.isEmpty(this.changed);
      return _.has(this.changed, attr);
    },

    // Return an object containing all the attributes that have changed, or
    // false if there are no changed attributes. Useful for determining what
    // parts of a view need to be updated and/or what attributes need to be
    // persisted to the server. Unset attributes will be set to undefined.
    // You can also pass an attributes object to diff against the model,
    // determining if there *would be* a change.
    changedAttributes: function(diff) {
      if (!diff) return this.hasChanged() ? _.clone(this.changed) : false;
      var val, changed = false, old = this._previousAttributes;
      for (var attr in diff) {
        if (_.isEqual(old[attr], (val = diff[attr]))) continue;
        (changed || (changed = {}))[attr] = val;
      }
      return changed;
    },

    // Get the previous value of an attribute, recorded at the time the last
    // `"change"` event was fired.
    previous: function(attr) {
      if (!arguments.length || !this._previousAttributes) return null;
      return this._previousAttributes[attr];
    },

    // Get all of the attributes of the model at the time of the previous
    // `"change"` event.
    previousAttributes: function() {
      return _.clone(this._previousAttributes);
    },

    // Check if the model is currently in a valid state. It's only possible to
    // get into an *invalid* state if you're using silent changes.
    isValid: function() {
      return !this.validate(this.attributes);
    },

    // Run validation against the next complete set of model attributes,
    // returning `true` if all is well. If a specific `error` callback has
    // been passed, call that instead of firing the general `"error"` event.
    _validate: function(attrs, options) {
      if (options.silent || !this.validate) return true;
      attrs = _.extend({}, this.attributes, attrs);
      var error = this.validate(attrs, options);
      if (!error) return true;
      if (options && options.error) {
        options.error(this, error, options);
      } else {
        this.trigger('error', this, error, options);
      }
      return false;
    }

  });

  // Backbone.Collection
  // -------------------

  // Provides a standard collection class for our sets of models, ordered
  // or unordered. If a `comparator` is specified, the Collection will maintain
  // its models in sort order, as they're added and removed.
  var Collection = Backbone.Collection = function(models, options) {
    options || (options = {});
    if (options.model) this.model = options.model;
    if (options.comparator) this.comparator = options.comparator;
    this._reset();
    this.initialize.apply(this, arguments);
    if (models) this.reset(models, {silent: true, parse: options.parse});
  };

  // Define the Collection's inheritable methods.
  _.extend(Collection.prototype, Events, {

    // The default model for a collection is just a **Backbone.Model**.
    // This should be overridden in most cases.
    model: Model,

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // The JSON representation of a Collection is an array of the
    // models' attributes.
    toJSON: function(options) {
      return this.map(function(model){ return model.toJSON(options); });
    },

    // Add a model, or list of models to the set. Pass **silent** to avoid
    // firing the `add` event for every new model.
    add: function(models, options) {
      var i, index, length, model, cid, id, cids = {}, ids = {}, dups = [];
      options || (options = {});
      models = _.isArray(models) ? models.slice() : [models];

      // Begin by turning bare objects into model references, and preventing
      // invalid models or duplicate models from being added.
      for (i = 0, length = models.length; i < length; i++) {
        if (!(model = models[i] = this._prepareModel(models[i], options))) {
          throw new Error("Can't add an invalid model to a collection");
        }
        cid = model.cid;
        id = model.id;
        if (cids[cid] || this._byCid[cid] || ((id != null) && (ids[id] || this._byId[id]))) {
          dups.push(i);
          continue;
        }
        cids[cid] = ids[id] = model;
      }

      // Remove duplicates.
      i = dups.length;
      while (i--) {
        models.splice(dups[i], 1);
      }

      // Listen to added models' events, and index models for lookup by
      // `id` and by `cid`.
      for (i = 0, length = models.length; i < length; i++) {
        (model = models[i]).on('all', this._onModelEvent, this);
        this._byCid[model.cid] = model;
        if (model.id != null) this._byId[model.id] = model;
      }

      // Insert models into the collection, re-sorting if needed, and triggering
      // `add` events unless silenced.
      this.length += length;
      index = options.at != null ? options.at : this.models.length;
      splice.apply(this.models, [index, 0].concat(models));
      if (this.comparator) this.sort({silent: true});
      if (options.silent) return this;
      for (i = 0, length = this.models.length; i < length; i++) {
        if (!cids[(model = this.models[i]).cid]) continue;
        options.index = i;
        model.trigger('add', model, this, options);
      }
      return this;
    },

    // Remove a model, or a list of models from the set. Pass silent to avoid
    // firing the `remove` event for every model removed.
    remove: function(models, options) {
      var i, l, index, model;
      options || (options = {});
      models = _.isArray(models) ? models.slice() : [models];
      for (i = 0, l = models.length; i < l; i++) {
        model = this.getByCid(models[i]) || this.get(models[i]);
        if (!model) continue;
        delete this._byId[model.id];
        delete this._byCid[model.cid];
        index = this.indexOf(model);
        this.models.splice(index, 1);
        this.length--;
        if (!options.silent) {
          options.index = index;
          model.trigger('remove', model, this, options);
        }
        this._removeReference(model);
      }
      return this;
    },

    // Add a model to the end of the collection.
    push: function(model, options) {
      model = this._prepareModel(model, options);
      this.add(model, options);
      return model;
    },

    // Remove a model from the end of the collection.
    pop: function(options) {
      var model = this.at(this.length - 1);
      this.remove(model, options);
      return model;
    },

    // Add a model to the beginning of the collection.
    unshift: function(model, options) {
      model = this._prepareModel(model, options);
      this.add(model, _.extend({at: 0}, options));
      return model;
    },

    // Remove a model from the beginning of the collection.
    shift: function(options) {
      var model = this.at(0);
      this.remove(model, options);
      return model;
    },

    // Get a model from the set by id.
    get: function(id) {
      if (id == null) return void 0;
      return this._byId[id.id != null ? id.id : id];
    },

    // Get a model from the set by client id.
    getByCid: function(cid) {
      return cid && this._byCid[cid.cid || cid];
    },

    // Get the model at the given index.
    at: function(index) {
      return this.models[index];
    },

    // Return models with matching attributes. Useful for simple cases of `filter`.
    where: function(attrs) {
      if (_.isEmpty(attrs)) return [];
      return this.filter(function(model) {
        for (var key in attrs) {
          if (attrs[key] !== model.get(key)) return false;
        }
        return true;
      });
    },

    // Force the collection to re-sort itself. You don't need to call this under
    // normal circumstances, as the set will maintain sort order as each item
    // is added.
    sort: function(options) {
      options || (options = {});
      if (!this.comparator) throw new Error('Cannot sort a set without a comparator');
      var boundComparator = _.bind(this.comparator, this);
      if (this.comparator.length == 1) {
        this.models = this.sortBy(boundComparator);
      } else {
        this.models.sort(boundComparator);
      }
      if (!options.silent) this.trigger('reset', this, options);
      return this;
    },

    // Pluck an attribute from each model in the collection.
    pluck: function(attr) {
      return _.map(this.models, function(model){ return model.get(attr); });
    },

    // When you have more items than you want to add or remove individually,
    // you can reset the entire set with a new list of models, without firing
    // any `add` or `remove` events. Fires `reset` when finished.
    reset: function(models, options) {
      models  || (models = []);
      options || (options = {});
      for (var i = 0, l = this.models.length; i < l; i++) {
        this._removeReference(this.models[i]);
      }
      this._reset();
      this.add(models, _.extend({silent: true}, options));
      if (!options.silent) this.trigger('reset', this, options);
      return this;
    },

    // Fetch the default set of models for this collection, resetting the
    // collection when they arrive. If `add: true` is passed, appends the
    // models to the collection instead of resetting.
    fetch: function(options) {
      options = options ? _.clone(options) : {};
      if (options.parse === undefined) options.parse = true;
      var collection = this;
      var success = options.success;
      options.success = function(resp, status, xhr) {
        collection[options.add ? 'add' : 'reset'](collection.parse(resp, xhr), options);
        if (success) success(collection, resp);
      };
      options.error = Backbone.wrapError(options.error, collection, options);
      return (this.sync || Backbone.sync).call(this, 'read', this, options);
    },

    // Create a new instance of a model in this collection. Add the model to the
    // collection immediately, unless `wait: true` is passed, in which case we
    // wait for the server to agree.
    create: function(model, options) {
      var coll = this;
      options = options ? _.clone(options) : {};
      model = this._prepareModel(model, options);
      if (!model) return false;
      if (!options.wait) coll.add(model, options);
      var success = options.success;
      options.success = function(nextModel, resp, xhr) {
        if (options.wait) coll.add(nextModel, options);
        if (success) {
          success(nextModel, resp);
        } else {
          nextModel.trigger('sync', model, resp, options);
        }
      };
      model.save(null, options);
      return model;
    },

    // **parse** converts a response into a list of models to be added to the
    // collection. The default implementation is just to pass it through.
    parse: function(resp, xhr) {
      return resp;
    },

    // Proxy to _'s chain. Can't be proxied the same way the rest of the
    // underscore methods are proxied because it relies on the underscore
    // constructor.
    chain: function () {
      return _(this.models).chain();
    },

    // Reset all internal state. Called when the collection is reset.
    _reset: function(options) {
      this.length = 0;
      this.models = [];
      this._byId  = {};
      this._byCid = {};
    },

    // Prepare a model or hash of attributes to be added to this collection.
    _prepareModel: function(model, options) {
      options || (options = {});
      if (!(model instanceof Model)) {
        var attrs = model;
        options.collection = this;
        model = new this.model(attrs, options);
        if (!model._validate(model.attributes, options)) model = false;
      } else if (!model.collection) {
        model.collection = this;
      }
      return model;
    },

    // Internal method to remove a model's ties to a collection.
    _removeReference: function(model) {
      if (this == model.collection) {
        delete model.collection;
      }
      model.off('all', this._onModelEvent, this);
    },

    // Internal method called every time a model in the set fires an event.
    // Sets need to update their indexes when models change ids. All other
    // events simply proxy through. "add" and "remove" events that originate
    // in other collections are ignored.
    _onModelEvent: function(event, model, collection, options) {
      if ((event == 'add' || event == 'remove') && collection != this) return;
      if (event == 'destroy') {
        this.remove(model, options);
      }
      if (model && event === 'change:' + model.idAttribute) {
        delete this._byId[model.previous(model.idAttribute)];
        this._byId[model.id] = model;
      }
      this.trigger.apply(this, arguments);
    }

  });

  // Underscore methods that we want to implement on the Collection.
  var methods = ['forEach', 'each', 'map', 'reduce', 'reduceRight', 'find',
    'detect', 'filter', 'select', 'reject', 'every', 'all', 'some', 'any',
    'include', 'contains', 'invoke', 'max', 'min', 'sortBy', 'sortedIndex',
    'toArray', 'size', 'first', 'initial', 'rest', 'last', 'without', 'indexOf',
    'shuffle', 'lastIndexOf', 'isEmpty', 'groupBy'];

  // Mix in each Underscore method as a proxy to `Collection#models`.
  _.each(methods, function(method) {
    Collection.prototype[method] = function() {
      return _[method].apply(_, [this.models].concat(_.toArray(arguments)));
    };
  });

  // Backbone.Router
  // -------------------

  // Routers map faux-URLs to actions, and fire events when routes are
  // matched. Creating a new one sets its `routes` hash, if not set statically.
  var Router = Backbone.Router = function(options) {
    options || (options = {});
    if (options.routes) this.routes = options.routes;
    this._bindRoutes();
    this.initialize.apply(this, arguments);
  };

  // Cached regular expressions for matching named param parts and splatted
  // parts of route strings.
  var namedParam    = /:\w+/g;
  var splatParam    = /\*\w+/g;
  var escapeRegExp  = /[-[\]{}()+?.,\\^$|#\s]/g;

  // Set up all inheritable **Backbone.Router** properties and methods.
  _.extend(Router.prototype, Events, {

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // Manually bind a single named route to a callback. For example:
    //
    //     this.route('search/:query/p:num', 'search', function(query, num) {
    //       ...
    //     });
    //
    route: function(route, name, callback) {
      Backbone.history || (Backbone.history = new History);
      if (!_.isRegExp(route)) route = this._routeToRegExp(route);
      if (!callback) callback = this[name];
      Backbone.history.route(route, _.bind(function(fragment) {
        var args = this._extractParameters(route, fragment);
        callback && callback.apply(this, args);
        this.trigger.apply(this, ['route:' + name].concat(args));
        Backbone.history.trigger('route', this, name, args);
      }, this));
      return this;
    },

    // Simple proxy to `Backbone.history` to save a fragment into the history.
    navigate: function(fragment, options) {
      Backbone.history.navigate(fragment, options);
    },

    // Bind all defined routes to `Backbone.history`. We have to reverse the
    // order of the routes here to support behavior where the most general
    // routes can be defined at the bottom of the route map.
    _bindRoutes: function() {
      if (!this.routes) return;
      var routes = [];
      for (var route in this.routes) {
        routes.unshift([route, this.routes[route]]);
      }
      for (var i = 0, l = routes.length; i < l; i++) {
        this.route(routes[i][0], routes[i][1], this[routes[i][1]]);
      }
    },

    // Convert a route string into a regular expression, suitable for matching
    // against the current location hash.
    _routeToRegExp: function(route) {
      route = route.replace(escapeRegExp, '\\$&')
                   .replace(namedParam, '([^\/]+)')
                   .replace(splatParam, '(.*?)');
      return new RegExp('^' + route + '$');
    },

    // Given a route, and a URL fragment that it matches, return the array of
    // extracted parameters.
    _extractParameters: function(route, fragment) {
      return route.exec(fragment).slice(1);
    }

  });

  // Backbone.History
  // ----------------

  // Handles cross-browser history management, based on URL fragments. If the
  // browser does not support `onhashchange`, falls back to polling.
  var History = Backbone.History = function() {
    this.handlers = [];
    _.bindAll(this, 'checkUrl');
  };

  // Cached regex for cleaning leading hashes and slashes .
  var routeStripper = /^[#\/]/;

  // Cached regex for detecting MSIE.
  var isExplorer = /msie [\w.]+/;

  // Has the history handling already been started?
  History.started = false;

  // Set up all inheritable **Backbone.History** properties and methods.
  _.extend(History.prototype, Events, {

    // The default interval to poll for hash changes, if necessary, is
    // twenty times a second.
    interval: 50,

    // Gets the true hash value. Cannot use location.hash directly due to bug
    // in Firefox where location.hash will always be decoded.
    getHash: function(windowOverride) {
      var loc = windowOverride ? windowOverride.location : window.location;
      var match = loc.href.match(/#(.*)$/);
      return match ? match[1] : '';
    },

    // Get the cross-browser normalized URL fragment, either from the URL,
    // the hash, or the override.
    getFragment: function(fragment, forcePushState) {
      if (fragment == null) {
        if (this._hasPushState || forcePushState) {
          fragment = window.location.pathname;
          var search = window.location.search;
          if (search) fragment += search;
        } else {
          fragment = this.getHash();
        }
      }
      if (!fragment.indexOf(this.options.root)) fragment = fragment.substr(this.options.root.length);
      return fragment.replace(routeStripper, '');
    },

    // Start the hash change handling, returning `true` if the current URL matches
    // an existing route, and `false` otherwise.
    start: function(options) {
      if (History.started) throw new Error("Backbone.history has already been started");
      History.started = true;

      // Figure out the initial configuration. Do we need an iframe?
      // Is pushState desired ... is it available?
      this.options          = _.extend({}, {root: '/'}, this.options, options);
      this._wantsHashChange = this.options.hashChange !== false;
      this._wantsPushState  = !!this.options.pushState;
      this._hasPushState    = !!(this.options.pushState && window.history && window.history.pushState);
      var fragment          = this.getFragment();
      var docMode           = document.documentMode;
      var oldIE             = (isExplorer.exec(navigator.userAgent.toLowerCase()) && (!docMode || docMode <= 7));

      if (oldIE) {
        this.iframe = $('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;
        this.navigate(fragment);
      }

      // Depending on whether we're using pushState or hashes, and whether
      // 'onhashchange' is supported, determine how we check the URL state.
      if (this._hasPushState) {
        $(window).bind('popstate', this.checkUrl);
      } else if (this._wantsHashChange && ('onhashchange' in window) && !oldIE) {
        $(window).bind('hashchange', this.checkUrl);
      } else if (this._wantsHashChange) {
        this._checkUrlInterval = setInterval(this.checkUrl, this.interval);
      }

      // Determine if we need to change the base url, for a pushState link
      // opened by a non-pushState browser.
      this.fragment = fragment;
      var loc = window.location;
      var atRoot  = loc.pathname == this.options.root;

      // If we've started off with a route from a `pushState`-enabled browser,
      // but we're currently in a browser that doesn't support it...
      if (this._wantsHashChange && this._wantsPushState && !this._hasPushState && !atRoot) {
        this.fragment = this.getFragment(null, true);
        window.location.replace(this.options.root + '#' + this.fragment);
        // Return immediately as browser will do redirect to new url
        return true;

      // Or if we've started out with a hash-based route, but we're currently
      // in a browser where it could be `pushState`-based instead...
      } else if (this._wantsPushState && this._hasPushState && atRoot && loc.hash) {
        this.fragment = this.getHash().replace(routeStripper, '');
        window.history.replaceState({}, document.title, loc.protocol + '//' + loc.host + this.options.root + this.fragment);
      }

      if (!this.options.silent) {
        return this.loadUrl();
      }
    },

    // Disable Backbone.history, perhaps temporarily. Not useful in a real app,
    // but possibly useful for unit testing Routers.
    stop: function() {
      $(window).unbind('popstate', this.checkUrl).unbind('hashchange', this.checkUrl);
      clearInterval(this._checkUrlInterval);
      History.started = false;
    },

    // Add a route to be tested when the fragment changes. Routes added later
    // may override previous routes.
    route: function(route, callback) {
      this.handlers.unshift({route: route, callback: callback});
    },

    // Checks the current URL to see if it has changed, and if it has,
    // calls `loadUrl`, normalizing across the hidden iframe.
    checkUrl: function(e) {
      var current = this.getFragment();
      if (current == this.fragment && this.iframe) current = this.getFragment(this.getHash(this.iframe));
      if (current == this.fragment) return false;
      if (this.iframe) this.navigate(current);
      this.loadUrl() || this.loadUrl(this.getHash());
    },

    // Attempt to load the current URL fragment. If a route succeeds with a
    // match, returns `true`. If no defined routes matches the fragment,
    // returns `false`.
    loadUrl: function(fragmentOverride) {
      var fragment = this.fragment = this.getFragment(fragmentOverride);
      var matched = _.any(this.handlers, function(handler) {
        if (handler.route.test(fragment)) {
          handler.callback(fragment);
          return true;
        }
      });
      return matched;
    },

    // Save a fragment into the hash history, or replace the URL state if the
    // 'replace' option is passed. You are responsible for properly URL-encoding
    // the fragment in advance.
    //
    // The options object can contain `trigger: true` if you wish to have the
    // route callback be fired (not usually desirable), or `replace: true`, if
    // you wish to modify the current URL without adding an entry to the history.
    navigate: function(fragment, options) {
      if (!History.started) return false;
      if (!options || options === true) options = {trigger: options};
      var frag = (fragment || '').replace(routeStripper, '');
      if (this.fragment == frag) return;

      // If pushState is available, we use it to set the fragment as a real URL.
      if (this._hasPushState) {
        if (frag.indexOf(this.options.root) != 0) frag = this.options.root + frag;
        this.fragment = frag;
        window.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, frag);

      // If hash changes haven't been explicitly disabled, update the hash
      // fragment to store history.
      } else if (this._wantsHashChange) {
        this.fragment = frag;
        this._updateHash(window.location, frag, options.replace);
        if (this.iframe && (frag != this.getFragment(this.getHash(this.iframe)))) {
          // Opening and closing the iframe tricks IE7 and earlier to push a history entry on hash-tag change.
          // When replace is true, we don't want this.
          if(!options.replace) this.iframe.document.open().close();
          this._updateHash(this.iframe.location, frag, options.replace);
        }

      // If you've told us that you explicitly don't want fallback hashchange-
      // based history, then `navigate` becomes a page refresh.
      } else {
        window.location.assign(this.options.root + fragment);
      }
      if (options.trigger) this.loadUrl(fragment);
    },

    // Update the hash location, either replacing the current entry, or adding
    // a new one to the browser history.
    _updateHash: function(location, fragment, replace) {
      if (replace) {
        location.replace(location.toString().replace(/(javascript:|#).*$/, '') + '#' + fragment);
      } else {
        location.hash = fragment;
      }
    }
  });

  // Backbone.View
  // -------------

  // Creating a Backbone.View creates its initial element outside of the DOM,
  // if an existing element is not provided...
  var View = Backbone.View = function(options) {
    this.cid = _.uniqueId('view');
    this._configure(options || {});
    this._ensureElement();
    this.initialize.apply(this, arguments);
    this.delegateEvents();
  };

  // Cached regex to split keys for `delegate`.
  var delegateEventSplitter = /^(\S+)\s*(.*)$/;

  // List of view options to be merged as properties.
  var viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName'];

  // Set up all inheritable **Backbone.View** properties and methods.
  _.extend(View.prototype, Events, {

    // The default `tagName` of a View's element is `"div"`.
    tagName: 'div',

    // jQuery delegate for element lookup, scoped to DOM elements within the
    // current view. This should be prefered to global lookups where possible.
    $: function(selector) {
      return this.$el.find(selector);
    },

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // **render** is the core function that your view should override, in order
    // to populate its element (`this.el`), with the appropriate HTML. The
    // convention is for **render** to always return `this`.
    render: function() {
      return this;
    },

    // Remove this view from the DOM. Note that the view isn't present in the
    // DOM by default, so calling this method may be a no-op.
    remove: function() {
      this.$el.remove();
      return this;
    },

    // For small amounts of DOM Elements, where a full-blown template isn't
    // needed, use **make** to manufacture elements, one at a time.
    //
    //     var el = this.make('li', {'class': 'row'}, this.model.escape('title'));
    //
    make: function(tagName, attributes, content) {
      var el = document.createElement(tagName);
      if (attributes) $(el).attr(attributes);
      if (content) $(el).html(content);
      return el;
    },

    // Change the view's element (`this.el` property), including event
    // re-delegation.
    setElement: function(element, delegate) {
      if (this.$el) this.undelegateEvents();
      this.$el = (element instanceof $) ? element : $(element);
      this.el = this.$el[0];
      if (delegate !== false) this.delegateEvents();
      return this;
    },

    // Set callbacks, where `this.events` is a hash of
    //
    // *{"event selector": "callback"}*
    //
    //     {
    //       'mousedown .title':  'edit',
    //       'click .button':     'save'
    //       'click .open':       function(e) { ... }
    //     }
    //
    // pairs. Callbacks will be bound to the view, with `this` set properly.
    // Uses event delegation for efficiency.
    // Omitting the selector binds the event to `this.el`.
    // This only works for delegate-able events: not `focus`, `blur`, and
    // not `change`, `submit`, and `reset` in Internet Explorer.
    delegateEvents: function(events) {
      if (!(events || (events = getValue(this, 'events')))) return;
      this.undelegateEvents();
      for (var key in events) {
        var method = events[key];
        if (!_.isFunction(method)) method = this[events[key]];
        if (!method) throw new Error('Method "' + events[key] + '" does not exist');
        var match = key.match(delegateEventSplitter);
        var eventName = match[1], selector = match[2];
        method = _.bind(method, this);
        eventName += '.delegateEvents' + this.cid;
        if (selector === '') {
          this.$el.bind(eventName, method);
        } else {
          this.$el.delegate(selector, eventName, method);
        }
      }
    },

    // Clears all callbacks previously bound to the view with `delegateEvents`.
    // You usually don't need to use this, but may wish to if you have multiple
    // Backbone views attached to the same DOM element.
    undelegateEvents: function() {
      this.$el.unbind('.delegateEvents' + this.cid);
    },

    // Performs the initial configuration of a View with a set of options.
    // Keys with special meaning *(model, collection, id, className)*, are
    // attached directly to the view.
    _configure: function(options) {
      if (this.options) options = _.extend({}, this.options, options);
      for (var i = 0, l = viewOptions.length; i < l; i++) {
        var attr = viewOptions[i];
        if (options[attr]) this[attr] = options[attr];
      }
      this.options = options;
    },

    // Ensure that the View has a DOM element to render into.
    // If `this.el` is a string, pass it through `$()`, take the first
    // matching element, and re-assign it to `el`. Otherwise, create
    // an element from the `id`, `className` and `tagName` properties.
    _ensureElement: function() {
      if (!this.el) {
        var attrs = getValue(this, 'attributes') || {};
        if (this.id) attrs.id = this.id;
        if (this.className) attrs['class'] = this.className;
        this.setElement(this.make(this.tagName, attrs), false);
      } else {
        this.setElement(this.el, false);
      }
    }

  });

  // The self-propagating extend function that Backbone classes use.
  var extend = function (protoProps, classProps) {
    var child = inherits(this, protoProps, classProps);
    child.extend = this.extend;
    return child;
  };

  // Set up inheritance for the model, collection, and view.
  Model.extend = Collection.extend = Router.extend = View.extend = extend;

  // Backbone.sync
  // -------------

  // Map from CRUD to HTTP for our default `Backbone.sync` implementation.
  var methodMap = {
    'create': 'POST',
    'update': 'PUT',
    'delete': 'DELETE',
    'read':   'GET'
  };

  // Override this function to change the manner in which Backbone persists
  // models to the server. You will be passed the type of request, and the
  // model in question. By default, makes a RESTful Ajax request
  // to the model's `url()`. Some possible customizations could be:
  //
  // * Use `setTimeout` to batch rapid-fire updates into a single request.
  // * Send up the models as XML instead of JSON.
  // * Persist models via WebSockets instead of Ajax.
  //
  // Turn on `Backbone.emulateHTTP` in order to send `PUT` and `DELETE` requests
  // as `POST`, with a `_method` parameter containing the true HTTP method,
  // as well as all requests with the body as `application/x-www-form-urlencoded`
  // instead of `application/json` with the model in a param named `model`.
  // Useful when interfacing with server-side languages like **PHP** that make
  // it difficult to read the body of `PUT` requests.
  Backbone.sync = function(method, model, options) {
    var type = methodMap[method];

    // Default options, unless specified.
    options || (options = {});

    // Default JSON-request options.
    var params = {type: type, dataType: 'json'};

    // Ensure that we have a URL.
    if (!options.url) {
      params.url = getValue(model, 'url') || urlError();
    }

    // Ensure that we have the appropriate request data.
    if (!options.data && model && (method == 'create' || method == 'update')) {
      params.contentType = 'application/json';
      params.data = JSON.stringify(model.toJSON());
    }

    // For older servers, emulate JSON by encoding the request into an HTML-form.
    if (Backbone.emulateJSON) {
      params.contentType = 'application/x-www-form-urlencoded';
      params.data = params.data ? {model: params.data} : {};
    }

    // For older servers, emulate HTTP by mimicking the HTTP method with `_method`
    // And an `X-HTTP-Method-Override` header.
    if (Backbone.emulateHTTP) {
      if (type === 'PUT' || type === 'DELETE') {
        if (Backbone.emulateJSON) params.data._method = type;
        params.type = 'POST';
        params.beforeSend = function(xhr) {
          xhr.setRequestHeader('X-HTTP-Method-Override', type);
        };
      }
    }

    // Don't process data on a non-GET request.
    if (params.type !== 'GET' && !Backbone.emulateJSON) {
      params.processData = false;
    }

    // Make the request, allowing the user to override any Ajax options.
    return $.ajax(_.extend(params, options));
  };

  // Wrap an optional error callback with a fallback error event.
  Backbone.wrapError = function(onError, originalModel, options) {
    return function(model, resp) {
      resp = model === originalModel ? resp : model;
      if (onError) {
        onError(originalModel, resp, options);
      } else {
        originalModel.trigger('error', originalModel, resp, options);
      }
    };
  };

  // Helpers
  // -------

  // Shared empty constructor function to aid in prototype-chain creation.
  var ctor = function(){};

  // Helper function to correctly set up the prototype chain, for subclasses.
  // Similar to `goog.inherits`, but uses a hash of prototype properties and
  // class properties to be extended.
  var inherits = function(parent, protoProps, staticProps) {
    var child;

    // The constructor function for the new subclass is either defined by you
    // (the "constructor" property in your `extend` definition), or defaulted
    // by us to simply call the parent's constructor.
    if (protoProps && protoProps.hasOwnProperty('constructor')) {
      child = protoProps.constructor;
    } else {
      child = function(){ parent.apply(this, arguments); };
    }

    // Inherit class (static) properties from parent.
    _.extend(child, parent);

    // Set the prototype chain to inherit from `parent`, without calling
    // `parent`'s constructor function.
    ctor.prototype = parent.prototype;
    child.prototype = new ctor();

    // Add prototype properties (instance properties) to the subclass,
    // if supplied.
    if (protoProps) _.extend(child.prototype, protoProps);

    // Add static properties to the constructor function, if supplied.
    if (staticProps) _.extend(child, staticProps);

    // Correctly set child's `prototype.constructor`.
    child.prototype.constructor = child;

    // Set a convenience property in case the parent's prototype is needed later.
    child.__super__ = parent.prototype;

    return child;
  };

  // Helper function to get a value from a Backbone object as a property
  // or as a function.
  var getValue = function(object, prop) {
    if (!(object && object[prop])) return null;
    return _.isFunction(object[prop]) ? object[prop]() : object[prop];
  };

  // Throw an error when a URL is needed, and none is supplied.
  var urlError = function() {
    throw new Error('A "url" property or function must be specified');
  };

}).call(this);




// This is a plugin, constructed from parts of Backbone.js and John Resig's inheritance script.
// (See http://backbonejs.org, http://ejohn.org/blog/simple-javascript-inheritance/)
// No credit goes to me as I did absolutely nothing except patch these two together.
(function(Backbone) {
  Backbone.Model.extend = Backbone.Collection.extend = Backbone.Router.extend = Backbone.View.extend = function(protoProps, classProps) {
    var child = inherits(this, protoProps, classProps);
    child.extend = this.extend;
    return child;
  };
  var unImplementedSuper = function(method){throw "Super does not implement this method: " + method;}; 

  var ctor = function(){}, inherits = function(parent, protoProps, staticProps) {
    var child, _super = parent.prototype, fnTest = /xyz/.test(function(){xyz;}) ? /\b_super\b/ : /.*/;

    // The constructor function for the new subclass is either defined by you
    // (the "constructor" property in your `extend` definition), or defaulted
    // by us to simply call the parent's constructor.
    if (protoProps && protoProps.hasOwnProperty('constructor')) {
      child = protoProps.constructor;
    } else {
      child = function(){ parent.apply(this, arguments); };
    }

    // Inherit class (static) properties from parent.
    _.extend(child, parent);

    // Set the prototype chain to inherit from `parent`, without calling
    // `parent`'s constructor function.
    ctor.prototype = parent.prototype;
    child.prototype = new ctor();

    // Add prototype properties (instance properties) to the subclass,
    // if supplied.
    if (protoProps) {
      _.extend(child.prototype, protoProps);

      // Copy the properties over onto the new prototype
      for (var name in protoProps) {
        // Check if we're overwriting an existing function
        if (typeof protoProps[name] == "function" &&  fnTest.test(protoProps[name])) {
          child.prototype[name] = (function(name, fn) {
            var wrapper = function() {
              var tmp = this._super;

              // Add a new ._super() method that is the same method
              // but on the super-class
              this._super = _super[name] || unImplementedSuper(name);

              // The method only need to be bound temporarily, so we
              // remove it when we're done executing
              var ret;
              try {
                ret = fn.apply(this, arguments);
              } finally {
                this._super = tmp;
              }
              return ret;
            };

            //we must move properties from old function to new
            for (var prop in fn) {
              wrapper[prop] = fn[prop];
              delete fn[prop];
            }

            return wrapper;
          })(name, protoProps[name]);
        }
      }
    }

    // Add static properties to the constructor function, if supplied.
    if (staticProps) _.extend(child, staticProps);

    // Correctly set child's `prototype.constructor`.
    child.prototype.constructor = child;

    // Set a convenience property in case the parent's prototype is needed later.
    child.__super__ = parent.prototype;

    return child;
  };
})(Backbone);


//-----------------------------------------------------------------
return Backbone;
});

/*global setTimeout, console, define, navigator, screen, window, document, unescape*/

//Taken from here; https://github.dowjones.net/djscript/djscript-vendor/blob/master/lib/djcs.js
define('resp.module.livefyre/dj/widget/util', [], function () {
  var util = {
    getCookie: function (a) {
      var i, len;
      if (a === null) {
        return null;
      }
      var b = document.cookie.split(';'),
        a_temp_cookie = '',
        cookie_name = '',
        cookie_value = '',
        b_cookie_found = false;

      for (i = 0, len = b.length; i < len; i++) {

        a_temp_cookie = b[i].split('=');

        cookie_name = a_temp_cookie[0].replace(/^\s+|\s+$/g, '');
        if (cookie_name === a) {
          b_cookie_found = true;

          if (a_temp_cookie.length > 1) {
            if (a_temp_cookie.length == 2) {
              cookie_value = unescape(a_temp_cookie[1].replace(/^\s+|\s+$/g, ''));
            } else {
              //cookie contained =
              cookie_value = unescape(b[i].replace(cookie_name + '=', '').replace(/^\s+|\s+$/g, ''));
            }
          }

          return cookie_value;
        }
        a_temp_cookie = null;
        cookie_name = '';
      }
      if (!b_cookie_found) {
        return null;
      }
    },
    replaceAll: function (a, b, c) {
      var d = a.indexOf(b);
      while (d !== -1) {
        a = a.replace(b, c);
        d = a.indexOf(b);
      }
      return a;
    },
    UTF8Decode: function (a) {
      if (a === null) {
        return null;
      }
      var b = "",
        i = 0,
        c = 0,
        c2 = 0,
        c3 = 0,
        utftext = a;
      while (i < utftext.length) {
        c = utftext.charCodeAt(i);
        if (c < 128) {
          b += String.fromCharCode(c);
          i++;
        } else if ((c > 191) && (c < 224)) {
          c2 = utftext.charCodeAt(i + 1);
          b += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
          i += 2;
        } else {
          c2 = utftext.charCodeAt(i + 1);
          c3 = utftext.charCodeAt(i + 2);
          b += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
          i += 3;
        }
      }
      return this.replaceAll(b, "+", " ");
    },
    base64Decode: function (a) {
      if (a === null) {
        return null;
      }
      var b = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
        output = "",
        chr1, chr2, chr3, enc1, enc2, enc3, enc4, i = 0;
      a = a.replace(/[^A-Za-z0-9\+\/\=]/g, "");
      while (i < a.length) {
        enc1 = b.indexOf(a.charAt(i++));
        enc2 = b.indexOf(a.charAt(i++));
        enc3 = b.indexOf(a.charAt(i++));
        enc4 = b.indexOf(a.charAt(i++));
        chr1 = (enc1 << 2) | (enc2 >> 4);
        chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
        chr3 = ((enc3 & 3) << 6) | enc4;
        output = output + String.fromCharCode(chr1);
        if (enc3 !== 64) {
          output = output + String.fromCharCode(chr2);
        }
        if (enc4 !== 64) {
          output = output + String.fromCharCode(chr3);
        }
      }
      output = this.UTF8Decode(output);

      //some strings are coming back with null terminator, so trim that off
      if (output[output.length - 1] === '\0') {
        output = output.slice(0, -1);
      }

      return output;
    }
  };

  return util;
});
define('resp.module.livefyre/dj/widget/view/LivefyreConfigureStrings', ['vendor.asset.jquery/jquery'], function ($) {

/*

// used to grab all customizable text for livefyre widget on following page:
// https://github.com/Livefyre/livefyre-docs/wiki/Internationalizing-or-Customizing-Text

var totalArr = collectArr();

function collectArr() {
  var $tds,
    key,
    value,
    obj,
    arr = [],
    $filtered,
    $allTables = $('table', '#wiki-body'),
    $allRows = $allTables.find('tbody > tr'),
    $firstTable = $allTables.eq(0),
    $firstTableAllRow = $firstTable.find('tbody > tr'),
    $firstTableFirstRow = $firstTable.find('tbody > tr').eq(0);


  $allRows.each(function (i) {
    $tds = $(this).find('td');
    $filtered = $tds.filter(function () {
      return ($(this).attr('rowspan') === undefined) ? $(this) : false;
    });

    key = $filtered[0].innerText;
    value = $filtered[1].innerText;
    obj = JSON.parse('{"' + key + '":"' + value + '"}');
    arr.push(obj);
  });

  return arr;

}

function flattenArr(totalArr) {

  var flatObj = {},
    prop,
    item
    i = 0,
    totalArrLen = totalArr.length || 0;

  for (i; i < totalArrLen; i += 1) {
    for (prop in totalArr[i]) {
      item = totalArr[i][prop];
      flatObj[prop] = item;
    }
  }

  return flatObj;
}

function jsonifyArr(totalArr) {
  var jsonString = JSON.stringify(totalArr);
  return jsonString;
}

// example obj
console.log(flattenArr(totalArr));
// example json
console.log(jsonifyArr(totalArr));
*/

  var livefyreStringDefaults,
    djStringOverrides,
    strings;

  livefyreStringDefaults = {
    averageRating: "Average User Rating",
    banCancelButton: "Cancel",
    banConfirmation: "Are you sure you want to ban this user?",
    banConfirmationButton: "OK",
    banTitle: "Ban User",
    banUserButton: "Ban User",
    banUserTooltip: "Ban User",
    bodyPlaceholder: "Input placeholder for the review body element",
    bozoButton: "Bozo",
    breakdownHeader: "Rating Breakdown",
    commentCountLabel: "%s comment",
    commentCountLabelPlural: "%s comments",
    commentNotifier: "New comment",
    commentNotifierPlural: "New comments",
    customHtmlDialogTitle: "Add Custom HTML",
    deleteButton: "Delete",
    deleteCommentTooltip: "Delete",
    displayName: "%s",
    displayNameGuest: "%s <em>(guest)</em>",
    editButton: "Edit",
    editProfile: "Edit profile",
    errorAuthError: "You're not authorized to post a comment on this conversation",
    errorCommentsNotAllowed: "Comments are not allowed on this conversation",
    errorDefault: "An error has occurred. Please try again.",
    errorDuplicate: "As much as you liked your comment, you're not allowed to post it twice.",
    errorEditDuplicate: "You must change the body of the comment when you edit it.",
    errorEditNotAllowed: "You're not allowed to edit comments on this conversation.",
    errorEditTimeExceeded: "Sorry, your comment editing period has expired.",
    errorEmpty: "It seems you're attempting to post an empty comment.",
    errorExpired: "Your session has expired. Please reload the page.",
    errorFieldReview: "review",
    errorFlagNotSelected: "*Please select a flag type",
    errorInsufficientPermissions: "Insufficient Permissions",
    errorInvalidChar: "It seems you're attempting to post an invalid character.",
    errorMalformed: "It seems you're attempting to post malformed content.",
    errorMaxChars: "Sorry, your comment is too long. Please edit and try again.",
    errorShowMore: "There was an error loading more comments.",
    featureButton: "Feature",
    featureCommentTooltip: "Feature",
    featuredCommentTooltip: "Unfeature",
    featuredCommentsTag: "Featured",
    featuredCommentsTitlePlural: "Featured Comments",
    flagButton: "Flag Button",
    flagButtonTooltip: "Flag Button's Tooltip",
    flagCancelButton: "Cancel",
    flagConfirmButton: "OK",
    flagDefaultSelectOption: "Select",
    flagDisagree: "Disagree",
    flagDisagreeButton: "Disagree",
    flagEmail: "Email",
    flagEmailPlaceholder: "you@example.com",
    flagNotes: "Notes",
    flagNotesPlaceholder: "Start typing here...",
    flagOffTopic: "Off-Topic",
    flagOffensive: "Offensive",
    flagOffensiveButton: "Offensive",
    flagOfftopicButton: "Off-Topic",
    flagSpam: "Spam",
    flagSpamButton: "Spam",
    flagSubtitle: "Flag as",
    flagSuccessMsg: "Comment has been flagged",
    flagTitle: "Flag",
    follow: "+ Follow",
    helpfulDivider: "|",
    hotThreadsContentNotFoundMsg: "There are not enough threads yet.",
    hovercardViewProfile: "View Full Profile",
    likeButton: "Like",
    listenerCount: "person listening",
    listenerCountPlural: "people listening",
    liveblogFollow: "Follow Liveblog",
    liveblogNotifier: "New post",
    liveblogNotifierPlural: "New posts",
    liveblogPostCountLabel: "post",
    liveblogPostCountLabelPlural: "posts",
    liveblogUnfollow: "Unfollow Liveblog",
    livechatOtherInstruction: "Press command+enter to post",
    livechatPostButtonLabel: "Post",
    livechatPostEditButton: "Edit",
    livechatWindowsInstruction: "`Press control+enter to post<http://d.pr/i/lnGo>`_",
    loadingPermalink: "Loading short url...",
    mentionCancelButton: "Cancel",
    mentionConfirmButton: "OK",
    mentionDefaultText: "I mentioned you in a Livefyre comment!",
    mentionErrorGeneral: "Oops! Something went wrong! Livefyre has been alerted.",
    mentionErrorNoneSelected: "You must have at least one mention enabled.",
    mentionMenuTitle: "Mentions modal title.",
    mentionSubtitleFacebook: "Share Facebook post to:",
    mentionSubtitleTwitter: "Share Tweet to:",
    mentionSuccessMsg: "Mentions have been successfully sent.",
    mentionTitle: "Share Mention",
    moderator: "moderator",
    moderatorEditTimeStamp: "Edited by a Moderator",
    newComment: "New Comment",
    newComments: "New Comments",
    newReplies: "new replies",
    newReply: "new reply",
    ownWasReviewHelpful: "Found helpful.",
    pendingComment: "pending",
    permalinkHeader: "Shared",
    permalinkHeaderDeleted: "This review is no longer visible",
    permalinkYourReview: "Your review",
    postAsButton: "Post comment as",
    postButton: "Post comment",
    postEditButton: "Edit comment",
    postEditCancelButton: "Cancel",
    postReplyAsButton: "Post comment as",
    postReplyButton: "Post comment",
    quickProfileTooltip: "Quick Profile",
    ratingSubpartPlaceholders: "NA",
    ratingSubpartTitles: "NA",
    refresh: "Refresh",
    replyButton: "Reply",
    replyButtonPlural: "Replies",
    replyButtonSingular: "Reply",
    reviewBtn: "Write review",
    reviewStreamTitle: "NA",
    reviewWasHelpful: "Yes",
    reviewWasNotHelpful: "No",
    reviewsClosed: "Reviews Closed",
    shareButton: "Share",
    shareButtonText: "Share",
    shareCommentTooltip: "Share Comment",
    shareDefaultText: "Check out %s's post!",
    shareLabel: "Share on:",
    sharePermalink: "Permalink",
    shareTitle: "Share Comment",
    showMore: "Show More Comments",
    showMoreLiveblog: "Show More Posts",
    showReviewBtn: "Show review",
    signIn: "Sign in",
    signOut: "Sign out",
    siteAdmin: "Site admin",
    sortBackButton: "Back to Hot Threads",
    sortHighestRated: "Highest rating",
    sortHotThreads: "Hot Threads",
    sortLowestRated: "Lowest rating",
    sortMostHelpful: "Most helpful",
    sortNewest: "Newest",
    sortOldest: "Oldest",
    sortSeparator: "|",
    sortTopComments: "Top Comments",
    streamRefreshMsg: "See what's new",
    streamSorting: "Loading text as sort occurs",
    threadBreakoutButton: "Show entire Thread",
    timeDaysAgo: "day ago",
    timeDaysAgoPlural: "days ago",
    timeHoursAgo: "hour ago",
    timeHoursAgoPlural: "hours ago",
    timeJustNow: "just now",
    timeMinutesAgo: "minute ago",
    timeMinutesAgoPlural: "minutes ago",
    titlePlaceholder: "Input placeholder for the review title element",
    topCommentsContentNotFoundMsg: "There are not enough likes yet.",
    unfeaturedButton: "Unfeature",
    unfollow: "- Unfollow",
    unlikeButton: "Unlike",
    wasReviewHelpful: "Helpful?"
  };

  djStringOverrides = {
    archiveHeaderTitle: "Archived Comments",
    follow: "Follow.",
    unfollow: "Unfollow.",
    listenerCount: "person watching.",
    listenerCountPlural: "people watching.",
    replyButton: "",
    likeButton: "",
    unlikeButton: "",
    flagSubtitle: "Report this comment for being:",
    flagNotes: "",
    flagEmail: "",
    flagDisagree: "Other",
    hovercardViewProfile: "View Profile",
    shareButtonText: "Share",
    shareTitle: "Share Comment",
    shareLabel: "Share on",
    sharePermalink: "",
    shareDefaultText: "",
    sortTopComments: "Reader Recommended",
    postAsButton: "Post Comment",
    commentCountLabel: "There is %s comment.",
    commentCountLabelPlural: "There are %s comments.",
    displayName: "You're commenting as %s.",
    // displayName: "You're commenting as <span>%s</span>.", // Temporary hide the span HTML tags
    liveblogNotifier: "new comment",
    liveblogNotifierPlural: "new comments",
    featuredCommentsTitle: "Editor's Pick",
    featuredCommentsTitlePlural: "Editor's Picks",
    permalinkHeaderDeleted: "This comment has been deleted.",
    streamSorting: "Loading..."
  };

  strings = $.extend(livefyreStringDefaults, djStringOverrides);

  return strings;

});

/*jshint white:true, evil:false, onevar:false, undef:true, bitwise: false, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/**
 * Comment Model - To do move data from view to model
 */
define('resp.module.livefyre/dj/widget/model/LivefyreFailMessagingModel', ['vendor.asset.backbone/backbone', 'vendor.asset.jquery/jquery'], function (Backbone, $) {
  var LivefyreFailMessagingModel = Backbone.Model.extend({

    cfg: {},

    initialize: function (options) {
      $.extend(this.cfg, options);
    }
  });
  return LivefyreFailMessagingModel;
});
/*jshint white:true, evil:false, onevar:false, undef:true, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/**
 * Comment view
 */
define('resp.module.livefyre/dj/widget/view/LivefyreFailMessagingView', ['vendor.asset.jquery/jquery', 'vendor.asset.backbone/backbone', 'vendor.asset.hogan/hogan'], function ($, Backbone, hogan) {
  var LivefyreFailMessagingView = Backbone.View.extend({
    config: {
      failtemplate: "script[data-template-id=_messaging]"
    },

    initialize: function (model, options) {
      this.cfg = $.extend({}, this.config, this.cfg, options);
      this.failtemplate = hogan.compile($.trim(this.cfg.$moduleEl.find(this.cfg.template)[0].text));
      this.build();
    },
    build: function () {
      var html = this.failtemplate.render(),
        $el = $('#livefyre-comment').children('.fyre'),
        $logsEl = $('#livefyre-logs');

      // build messaging for users
      $el.prepend(html).children('.fyre-featured-content-wrapper').hide();

      // create hidden log for QA
      $logsEl.html('<p>There were problems with the Livefyre Servers. <a href="http://status.livefyre.com/" target="_blank">Check status</a></p>');
    }
  });

  return LivefyreFailMessagingView;

});

/*jshint white:true, evil:false, onevar:false, undef:true, bitwise: false, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/**
 * Comment Model - To do move data from view to model
 */
define('resp.module.livefyre/dj/widget/model/LivefyreOnboardingModel', ['vendor.asset.backbone/backbone', 'vendor.asset.jquery/jquery'], function (Backbone, $) {
  var LivefyreOnboardingModel = Backbone.Model.extend({

    cfg: {},

    initialize: function (options) {
      $.extend(this.cfg, options);

      var $elem = this.cfg.el;
    }
  });
  return LivefyreOnboardingModel;
});
/*jshint white:true, evil:false, onevar:false, undef:true, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/**
 * Comment view
 */
define('resp.module.livefyre/dj/widget/view/LivefyreOnboardingView', ['vendor.asset.jquery/jquery', 'vendor.asset.backbone/backbone', 'vendor.asset.hogan/hogan'], function ($, Backbone, hogan) {
  var LivefyreOnboardingView = Backbone.View.extend({
    config: {
      template: "script[data-template-id=_onboarding]"
    },
    initEvents: function () {
      var self = this,
        $el = $('#livefyre-comment'),

        _modalKill = function ($el) {
          $('body').removeClass('private');
          $el.data('profilevisibility', 'public').find('.fyre-comments-log-button').empty();
          $('.fyre-comment-user[data-from="' + DowJones.LivefyreCommentStream.Name + '"]', $el).siblings('.fyre-comment-footer').addClass('ego-checked');
          self.destroy($el);
        },

        _hideCopy = function ($el) {
          $('.onboarding-voice', $el).addClass('visibility-hidden-important');
        };

      // cancel button
      $('body').on('click', '.onboarding-cancel', function (e) {
        e.preventDefault();
        var $done = $(e.target).closest('.onboarding-wrapper').find('.ending');
        if ($done.css('display') !== 'block') {
          _hideCopy($el);
          self.cancelOnboarding($el);
        } else {
          _modalKill($el);
        }
      });

      // finish button
      $('body').on('click', '.onboarding-finish', function (e) {
        e.preventDefault();
        var acceptedCheck = $(this).parents('.cancelFinish').siblings('input').is(':checked');
        if (acceptedCheck) {
          if (!this.profileAcceptedAgreement) {
            //console.log('first');
            _hideCopy($el);
            self.firstTime();
          } else if (this.profileVisibility === 'private') {
            //console.log('returning');
            _hideCopy($el);
            self.returning();
          }
        }
      });

      // profile button
      $('body').on('click', '.ending p a', function (e) {
        e.preventDefault();
        var $tar, href;

        $tar = $(e.target);
        href = $tar.attr('href');

        window.open(href);
        _modalKill($el);

      });

      // done button
      $('body').on('click', '.onboarding-done', function (e) {
        e.preventDefault();
        _modalKill($el);
      });

    },

    initialize: function (model, options) {

      this.cfg = $.extend({}, this.config, this.cfg, options);

      this.profileVisibility = $('#livefyre-comment').attr('data-profilevisibility') || '';

      this.profileAcceptedAgreement = $('#livefyre-comment').attr('data-profileacceptedagreement') || null;

      this.template = hogan.compile($.trim(this.cfg.$moduleEl.find(this.cfg.template)[0].text));

      this.initEvents();

      //this.render();

    },

    render: function () {
      var self = this,
        html = this.template.render();
      $('#livefyre-comment').append(html);

    },

    firstTime: function () {
      //console.log('first time');
      $('.onboarding-body .updating', '#livefyre-comment').show().siblings().hide();
      this.acceptFirstTimeOnboarding();
    },

    returning: function () {
      //console.log('returning');
      $('.onboarding-body .updating', '#livefyre-comment').show().siblings().hide();
      this.acceptOnboarding();
    },

    acceptFirstTimeOnboarding: function () {
      var self = this;

      this.joinCommenting(function (err) {
        self.cfg.acceptTermsCallback(function () {
          //console.log('first time terms accepted');
          self.completeModal();
        });
      });
    },

    completeModal: function () {
      var self = this,
        $el = $('#livefyre-comment');

      setTimeout(function () {
        $('.onboarding-body .ending', $el).show().siblings().hide();
        $('.fyre-comments-log-button', $el).empty();
        $('body').removeClass('private');
        self.scrubStream();
      }, 1500);
    },

    acceptOnboarding: function () {
      var self = this;

      this.profilePublic(function (err) {
        self.cfg.acceptTermsCallback(function () {
          //console.log('terms accepted');
          self.completeModal();
        });
      });
    },

    cancelOnboarding: function ($el) {
      var self = this;
      $('.onboarding-body .canceling', '#livefyre-comment').show().siblings().hide();
      self.profilePrivate(function (err) {
        //console.log('canceled');
      });

      setTimeout(function () {
        self.destroy($el);
      }, 1500);
    },

    joinCommenting: function (cb) {

      $.ajax({
        type: 'PUT',
        async: true,
        contentType: "application/json; charset=utf-8",
        url: '/user/profile/svc/profile/joinCommenting',
        success: function (res) {
          cb(null);
        },
        error: function (res) {
          //console.log("err = " + res);
          cb(res);
        }
      });
    },

    profilePrivate: function (cb) {
      var data = {
        "profilePublic": false
      };

      $.ajax({
        type: 'PUT',
        dataType: 'json',
        async: true,
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(data),
        url: '/user/profile/svc/profile/profileSettings',
        success: function (res) {
          cb(null);
        },
        error: function (res) {
          console.log("err = " + res);
          cb(res);
        }
      });
    },

    profilePublic: function (cb) {
      var data = {
        "profilePublic": true
      };

      $.ajax({
        type: 'PUT',
        dataType: 'json',
        async: true,
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(data),
        url: '/user/profile/svc/profile/profileSettings',
        success: function (res) {
          cb(null);
        },
        error: function (res) {
          //console.log("err = " + res);
          cb(res);
        }
      });
    },

    scrubStream: function () {
      var userName = window.DowJones.LivefyreCommentStream.Name;
      if (userName) {
        $('.fyre-comment-user[data-from="' + userName + '"]', '#livefyre-comment').parent().removeClass('fyre-comment-author-tag-profileprivate fyre-tag-author-profilePrivate');
      }
    },

    destroy: function ($el) {
      this.unbind();
      this.undelegateEvents();
      $('body').off('click', '.onboarding-cancel');
      $('body').off('click', '.onboarding-finish');
      $('body').off('click', '.onboarding-done');
      $el.children('.onboarding-wrapper').remove().end().children('.login_overlay').remove();
      this.remove();
    }
  });
  return LivefyreOnboardingView;
});
// Copyright 2006 The Closure Library Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS-IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
// http://docs.closure-library.googlecode.com/git/closure_goog_useragent_useragent.js.source.html
/**
 * @fileoverview Rendering engine detection.
 * @see <a href="http://www.useragentstring.com/">User agent strings</a>
 * For information on the browser brand (such as Safari versus Chrome), see
 * goog.userAgent.product.
 * @see ../demos/useragent.html
 */
// This file was modified updated by Dowjones 2014
define('resp.module.livefyre/dj/widget/googleuseragent', [], function () {

  var goog = {
    global: window,
    userAgent: {},
    string: {
      contains: function (str, val) {
        return str.indexOf(val) !== -1;
      }
    }
  };

  goog.userAgent.ASSUME_IE = false;


  goog.userAgent.ASSUME_GECKO = false;


  goog.userAgent.ASSUME_WEBKIT = false;


  goog.userAgent.ASSUME_MOBILE_WEBKIT = false;


  goog.userAgent.ASSUME_OPERA = false;


  goog.userAgent.ASSUME_ANY_VERSION = false;


  goog.userAgent.BROWSER_KNOWN_ =
    goog.userAgent.ASSUME_IE ||
    goog.userAgent.ASSUME_GECKO ||
    goog.userAgent.ASSUME_MOBILE_WEBKIT ||
    goog.userAgent.ASSUME_WEBKIT ||
    goog.userAgent.ASSUME_OPERA;


  goog.userAgent.getUserAgentString = function () {
    return goog.global.navigator ? goog.global.navigator.userAgent : null;
  };


  goog.userAgent.getNavigator = function () {
    return goog.global.navigator;
  };



  goog.userAgent.init_ = function () {
    goog.userAgent.detectedOpera_ = false;

    goog.userAgent.detectedIe_ = false;

    goog.userAgent.detectedWebkit_ = false;

    goog.userAgent.detectedMobile_ = false;

    goog.userAgent.detectedGecko_ = false;

    var ua;

    if (!goog.userAgent.BROWSER_KNOWN_ &&
      (ua = goog.userAgent.getUserAgentString())) {
      var navigator = goog.userAgent.getNavigator();
      goog.userAgent.detectedOpera_ = ua.indexOf('Opera') === 0;
      goog.userAgent.detectedIe_ = !goog.userAgent.detectedOpera_ &&
        ua.indexOf('MSIE') != -1;
      goog.userAgent.detectedWebkit_ = !goog.userAgent.detectedOpera_ &&
        ua.indexOf('WebKit') != -1;
      // WebKit also gives navigator.product string equal to 'Gecko'.
      goog.userAgent.detectedMobile_ = goog.userAgent.detectedWebkit_ &&
        ua.indexOf('Mobile') != -1;
      goog.userAgent.detectedGecko_ = !goog.userAgent.detectedOpera_ && !goog.userAgent.detectedWebkit_ && navigator.product == 'Gecko';
    }
  };


  if (!goog.userAgent.BROWSER_KNOWN_) {
    goog.userAgent.init_();
  }


  goog.userAgent.OPERA = goog.userAgent.BROWSER_KNOWN_ ?
    goog.userAgent.ASSUME_OPERA : goog.userAgent.detectedOpera_;


  goog.userAgent.IE = goog.userAgent.BROWSER_KNOWN_ ?
    goog.userAgent.ASSUME_IE : goog.userAgent.detectedIe_;


  goog.userAgent.GECKO = goog.userAgent.BROWSER_KNOWN_ ?
    goog.userAgent.ASSUME_GECKO :
    goog.userAgent.detectedGecko_;


  goog.userAgent.WEBKIT = goog.userAgent.BROWSER_KNOWN_ ?
    goog.userAgent.ASSUME_WEBKIT || goog.userAgent.ASSUME_MOBILE_WEBKIT :
    goog.userAgent.detectedWebkit_;


  goog.userAgent.MOBILE = goog.userAgent.ASSUME_MOBILE_WEBKIT ||
    goog.userAgent.detectedMobile_;


  goog.userAgent.SAFARI = goog.userAgent.WEBKIT;


  goog.userAgent.determinePlatform_ = function () {
    var navigator = goog.userAgent.getNavigator();
    return navigator && navigator.platform || '';
  };

  goog.userAgent.PLATFORM = goog.userAgent.determinePlatform_();


  goog.userAgent.ASSUME_MAC = false;


  goog.userAgent.ASSUME_WINDOWS = false;


  goog.userAgent.ASSUME_LINUX = false;


  goog.userAgent.ASSUME_X11 = false;


  goog.userAgent.ASSUME_ANDROID = false;


  goog.userAgent.ASSUME_IPHONE = false;


  goog.userAgent.ASSUME_IPAD = false;


  goog.userAgent.PLATFORM_KNOWN_ =
    goog.userAgent.ASSUME_MAC ||
    goog.userAgent.ASSUME_WINDOWS ||
    goog.userAgent.ASSUME_LINUX ||
    goog.userAgent.ASSUME_X11 ||
    goog.userAgent.ASSUME_ANDROID ||
    goog.userAgent.ASSUME_IPHONE ||
    goog.userAgent.ASSUME_IPAD;


  goog.userAgent.initPlatform_ = function () {

    goog.userAgent.detectedMac_ = goog.string.contains(goog.userAgent.PLATFORM,
      'Mac');

    goog.userAgent.detectedWindows_ = goog.string.contains(
      goog.userAgent.PLATFORM, 'Win');

    goog.userAgent.detectedLinux_ = goog.string.contains(goog.userAgent.PLATFORM,
      'Linux');

    goog.userAgent.detectedX11_ = !! goog.userAgent.getNavigator() &&
      goog.string.contains(goog.userAgent.getNavigator().appVersion || '',
        'X11');

    // Need user agent string for Android/IOS detection
    var ua = goog.userAgent.getUserAgentString();

    goog.userAgent.detectedAndroid_ = !! ua && ua.indexOf('Android') >= 0;

    goog.userAgent.detectedIPhone_ = !! ua && ua.indexOf('iPhone') >= 0;

    goog.userAgent.detectedIPad_ = !! ua && ua.indexOf('iPad') >= 0;
  };


  if (!goog.userAgent.PLATFORM_KNOWN_) {
    goog.userAgent.initPlatform_();
  }

  goog.userAgent.MAC = goog.userAgent.PLATFORM_KNOWN_ ?
    goog.userAgent.ASSUME_MAC : goog.userAgent.detectedMac_;

  goog.userAgent.WINDOWS = goog.userAgent.PLATFORM_KNOWN_ ?
    goog.userAgent.ASSUME_WINDOWS : goog.userAgent.detectedWindows_;

  goog.userAgent.LINUX = goog.userAgent.PLATFORM_KNOWN_ ?
    goog.userAgent.ASSUME_LINUX : goog.userAgent.detectedLinux_;

  goog.userAgent.X11 = goog.userAgent.PLATFORM_KNOWN_ ?
    goog.userAgent.ASSUME_X11 : goog.userAgent.detectedX11_;

  goog.userAgent.ANDROID = goog.userAgent.PLATFORM_KNOWN_ ?
    goog.userAgent.ASSUME_ANDROID : goog.userAgent.detectedAndroid_;

  goog.userAgent.IPHONE = goog.userAgent.PLATFORM_KNOWN_ ?
    goog.userAgent.ASSUME_IPHONE : goog.userAgent.detectedIPhone_;

  goog.userAgent.IPAD = goog.userAgent.PLATFORM_KNOWN_ ?
    goog.userAgent.ASSUME_IPAD : goog.userAgent.detectedIPad_;

  goog.userAgent.determineVersion_ = function () {

    var version = '',
      re;

    if (goog.userAgent.OPERA && goog.global.opera) {
      var operaVersion = goog.global.opera.version;
      version = typeof operaVersion == 'function' ? operaVersion() : operaVersion;
    } else {
      if (goog.userAgent.GECKO) {
        re = /rv\:([^\);]+)(\)|;)/;
      } else if (goog.userAgent.IE) {
        re = /MSIE\s+([^\);]+)(\)|;)/;
      } else if (goog.userAgent.WEBKIT) {
        // WebKit/125.4
        re = /WebKit\/(\S+)/;
      }
      if (re) {
        var arr = re.exec(goog.userAgent.getUserAgentString());
        version = arr ? arr[1] : '';
      }
    }
    if (goog.userAgent.IE) {

      var docMode = goog.userAgent.getDocumentMode_();
      if (docMode > parseFloat(version)) {
        return String(docMode);
      }
    }
    return version;
  };

  goog.userAgent.getDocumentMode_ = function () {
    // NOTE(user): goog.userAgent may be used in context where there is no DOM.
    var doc = goog.global.document;
    return doc ? doc.documentMode : undefined;
  };

  goog.userAgent.VERSION = goog.userAgent.determineVersion_();


  goog.userAgent.compare = function (v1, v2) {
    return goog.string.compareVersions(v1, v2);
  };

  goog.userAgent.isVersionCache_ = {};


  goog.userAgent.isVersion = function (version) {
    return goog.userAgent.ASSUME_ANY_VERSION ||
      goog.userAgent.isVersionCache_[version] ||
      (goog.userAgent.isVersionCache_[version] =
      goog.string.compareVersions(goog.userAgent.VERSION, version) >= 0);
  };

  goog.userAgent.isDocumentMode = function (documentMode) {
    return goog.userAgent.IE && goog.userAgent.DOCUMENT_MODE >= documentMode;
  };


  goog.userAgent.DOCUMENT_MODE = (function () {
    var doc = goog.global.document;
    if (!doc || !goog.userAgent.IE) {
      return undefined;
    }
    var mode = goog.userAgent.getDocumentMode_();
    return mode || (doc.compatMode == 'CSS1Compat' ?
      parseInt(goog.userAgent.VERSION, 10) : 5);
  });

  return goog;

});
define('article.app/content/scripts/slideshow_caption', [
  'vendor.asset.jquery/jquery',
  'article.app/content/scripts/truncation'
], function ($, truncation) {
  var captionClassContainer = {
    getCaptionClass: function () {

      var captionClass = {

        currentCaption: {
          captionObject: '',
          creditElement: '',
          fullCaptionText: '',
          fullCreditText: '',
          fullCaptionHTML: '',
          truncatedCaptionHTML: ''
        },

        truncate: true,

        captioning: {
          initNewCaption: function (captionContainer, expandCaption) {
            captionClass.currentCaption.captionObject = captionContainer.find(
              '.wsj-slideshow-caption:not(".inactive")');

            if (captionClass.currentCaption.captionObject.length &&
              captionClass.currentCaption.captionObject[0] !== 'undefined') {

              captionClass.currentCaption.captionObject.removeClass("hide");
              var captObj = captionClass.currentCaption.captionObject[0];


              if (typeof captObj.childNodes[0] !== 'undefined' && typeof captObj.childNodes[0]
                .textContent !== 'undefined') {
                captionClass.currentCaption.fullCaptionText = captObj.childNodes[0].textContent;
              }

              if (typeof captObj.childNodes[1] !== 'undefined') {
                captionClass.currentCaption.creditElement = captObj.childNodes[1];
                captionClass.currentCaption.fullCreditText = (typeof captObj.childNodes[1].textContent !==
                  'undefined') ? captObj.childNodes[1].textContent : '';
              } else {
                captionClass.currentCaption.creditElement = null;
              }
              //possible ie8 conditional
              captionClass.currentCaption.fullCaptionHTML = (captObj.innerHTML !==
                'undefined') ? captObj.innerHTML : '';

            }
            else {
              // bail if we don't have all components
              captionClass.currentCaption.captionObject.hide();
              return false;
            }

            captionClass.captioning.captionLogic();

            if (captionClass.truncate) {
              captionClass.currentCaption.captionObject.swipe({
                tap: function (event) {
                  if (captionClass.currentCaption.captionObject.hasClass("truncated")) {
                    captionClass.truncate = false;
                    expandCaption(captionContainer);
                    captionClass.currentCaption.captionObject[0].innerHTML = captionClass.currentCaption.fullCaptionHTML;

                    $(".wsj-slideshow-caption").removeClass("hide");
                  }
                }
              });
            }
          },

          captionLogic: function () {
            if (captionClass.truncate) {
              var truncateResponse = truncation.captionTruncator(
                captionClass.currentCaption.captionObject,
                captionClass.currentCaption.fullCaptionText,
                captionClass.currentCaption.creditElement,
                captionClass.currentCaption.fullCreditText,
                40);
              captionClass.currentCaption.truncatedCaptionHTML = truncateResponse.truncatedHtml;

              if (truncateResponse.isTruncated) {
                captionClass.currentCaption.captionObject.addClass("truncated");
              }
              else {
                captionClass.currentCaption.captionObject.removeClass("truncated");
              }
            }
          },

          restoreCaption: function () {
            captionClass.currentCaption.captionObject.addClass("hide");
            if (captionClass.currentCaption.captionObject.length && captionClass.currentCaption
              .captionObject[0]) {
              captionClass.currentCaption.captionObject.removeClass("truncated");
              captionClass.currentCaption.captionObject[0].innerHTML = captionClass.currentCaption
                .fullCaptionHTML;
            }
          }
        }
      };
      return captionClass;
    }
  };

  return captionClassContainer;
});

define('article.app/content/scripts/slideshow-bindings',[
  'vendor.asset.jquery/jquery',
  'article.app/context'
], function ($, intent){

  function focusNoSlide(elem){
    var y = $(window).scrollTop();
    elem.focus();
    $(window).scrollTop(y);
  }

  function decideClickDirection(slideshowWrap, slideshow, slickObj, event) {
    var pageX;
    if (event.changedTouches && event.changedTouches[0]) {
      pageX = event.changedTouches[0].pageX;
    }
    else {
      pageX = event.pageX ? event.pageX : event.clientX;
    }
    var left = pageX - slideshow.offset().left, fraction = left / slideshow.outerWidth(), threshold = 0.4;
    if((slickObj.currentSlide >= slickObj.$slides.length -1) && slideshowWrap.hasClass('stand-alone')){
      threshold = 0.1;
    }  //to check if first or last slide
    if (fraction < threshold) {
      //need nested if
      if (slideshow.slickCurrentSlide() !== 0) {
        return 'prev';
      }
    }
    else
    {
      if (slideshow.slickCurrentSlide() !== slickObj.$slides.length - 1) {
        return 'next';
      }
    }
    return null;
  }

  var bindMod = {
    bindKeyboardAndMouse: function (isCurrentSlideFirst, isCurrentSlideFinal, closeFullScreen, options, slideshowWrap, slideshow, slickObj) {
      slideshowWrap.keydown(function(event){
        if (event.which === 27 && options.isFullScreen) {//keycode for escape
          closeFullScreen();
        } else if(event.which === 37) { //keycode for LEFT ARROW
          bindMod.focusIfSlideShowOnScreen();
        } else if(event.which === 39) { //keycode for RIGHT ARROW
          bindMod.focusIfSlideShowOnScreen();
        }
      });
      slideshowWrap.keyup(function(event) {
        if (event.which === 37 && slickObj.currentSlide > 0) { //keycode for LEFT ARROW
          slideshow.slickPrev();
        } else if (event.which === 39 && (slickObj.currentSlide < slickObj.$slides.length-1)) { //keycode for RIGHT ARROW
          slideshow.slickNext();
        }
      });
      slideshowWrap.on('click', function(event){
        focusNoSlide(event.currentTarget);
      });

      var isSwiping = false; //variable for swipe
      slideshow.swipe({
        allowPageScroll: "vertical",
        tap: function (event) {
          if (isSwiping === false) {
            var direction = decideClickDirection(slideshowWrap, slideshow, slickObj, event);

            if (direction === 'next') {
              slideshow.slickNext();
            } else if (direction === 'prev') {
              slideshow.slickPrev();
            }
          }
          isSwiping = false;
        }
      });

      $('.wsj-slideshow-slide').on('touchstart mousedown', function(e) {
        var horizontalPos = e.pageX ? e.pageX : e.originalEvent.touches[0].pageX;
        if (isCurrentSlideFirst()) {
          $('.wsj-slideshow-slide').on('touchmove mousemove', function(e){
            isSwiping = true;
            if ((e.pageX ? e.pageX : e.originalEvent.touches[0].pageX) > horizontalPos){
              slideshow.slickSetOption('swipe', false);
              slideshow.slickSetOption('draggable', false);
            }
            else
            {
              slideshow.slickSetOption('swipe', true);
              slideshow.slickSetOption('draggable', true);
            }
          });
        }
        else if (isCurrentSlideFinal()) {
          $('.wsj-slideshow-slide').on('touchmove mousemove', function(e){
            isSwiping = true;
            if ((e.pageX ? e.pageX : e.originalEvent.touches[0].pageX) < horizontalPos){
              slideshow.slickSetOption('swipe', false);
              slideshow.slickSetOption('draggable', false);
            }
            else
            {
              slideshow.slickSetOption('swipe', true);
              slideshow.slickSetOption('draggable', true);
            }
          });
        }
      });
      $('.wsj-slideshow-slide').on('touchend mouseup', function(e){
        $('.wsj-slideshow-slide').unbind('touchmove mousemove');
        slideshow.slickSetOption('swipe', true);
        slideshow.slickSetOption('draggable', true);
      });
    },

    //sets focus to the first viewable slide on the screen
    //full screen has higher priority
    //Note *not used* but
    focusIfSlideShowOnScreen: function() {
      var windowHeight = $(window).height(),
        windowTop = $(window).scrollTop(),
        slidesInScreen = [];

      //unfocus each slideshow on screen first
      $(".wsj-slideshow").each( function() {
        var slideTop = $(this).offset().top; // the start position of y pixel
        var slideHeight = $(this).height();

        $(this).blur();

        if (  ( slideTop < (windowHeight + windowTop) ) &&
           ( slideTop > (windowTop - slideHeight) ) )
        {
          slidesInScreen.push({
            slideShow: $(this),
            slideTop: slideTop,
            slideHeight: slideHeight
          });
        }
      });

      var slideToFocus = null;
      var largestDisplayArea = 0;

      //check if any of the slide show is in full screen mode
      //Higher priority than inline mode
      for (var i = 0; i < slidesInScreen.length; i++){
        if (slidesInScreen[i].slideShow.hasClass("wsj-slideshow-fullscreen")) {
          focusNoSlide(slidesInScreen[i].slideShow[0]);
          return;
        }

        var displayArea = 0;

        //if top part of the screen is greater than top of slide show
        if (windowTop > slidesInScreen[i].slideTop){
          displayArea = slidesInScreen[i].slideTop + slidesInScreen[i].slideHeight - windowTop;
        }
        //if bottom part of the screen is graeter than screen height
        else if ( ( windowHeight + windowTop - slidesInScreen[i].slideTop ) <  slidesInScreen[i].slideHeight){
          displayArea = windowHeight + windowTop - slidesInScreen[i].slideTop;
        }
        //then its in the middle of the screen
        else {
          displayArea = slidesInScreen[i].slideHeight;
        }

        if (displayArea > largestDisplayArea) {
          slideToFocus = slidesInScreen[i].slideShow;
          largestDisplayArea = displayArea;
        }
      }

      if (slideToFocus !== null)
      {
        focusNoSlide(slideToFocus);
      }
    }
  };

  return bindMod;
});

/* globals googletag, p39_GPT_value_from_xml */
define('article.app/responsiveAds', [
  'vendor.asset.jquery/jquery',
  'vendor.asset.jquery.inview/jquery.inview',
  'vendor.asset.underscore/underscore',
  'article.app/context',
  'dj.module.google_ads/googleadutils',
  'article.app/circAd'
], function ($, inview, _, intent, googleAdUtils) {


  // private storage for ad objects
  var adStorage = {};

  /*
   * Public Functionality
   */
  var responsiveAds = {

    /*
     * init: sets up the ads from the backend
     *   assumes we are using the ad module from article.app
     *
     */
    init: function(){

      var self = this,
          adElms = $(".wsj-responsive-ad-wrap");

      _.each(adElms, function(ad){
        if (ad.id === "AD_Z") {

          // inFocus ad should start loading only when the user scroll down to the ads in 12-units and 16-units
          $(ad).bind("inview", function (event, visible) {
            if (visible && !/4|8/.test(intent.axes.width.current)) {
              $(ad).unbind("inview");
              self.buildAd($(ad));
              self.displayAd("AD_Z", false);

              // Refresh ad after 20 seconds (per ad specifications)
              setTimeout(function(){
                self.displayAd('AD_Z', true);
              }, 20000);
            }
          });

        } else {
          self.buildAd($(ad));
        }
      });

      // make shure ads display when context shifts
      intent.on("width:", function(){
        self.displayAllAds(false);
      });

      // display all the ads
      intent.onInit(function(){
        googletag.cmd.push(function(){
          self.displayAllAds(false);
        });
      });

    },

    /*
     * buildAd: Sets up the ad slot for use
     *
     * @param {jquery element} adElm
     *   The adElm should be constructed like the
     *   articleAd.mu partial
     *   buildAd assumes the element will have
     *   data-ad-targeting (stringified target option map for googletag)
     *   data-ad-size      (stringified array of size options for googletag)
     *   data-ad-unit-path (the adunit path required for googletag)
     *
     * @param {object} options (optional)
     *   For ads built after page view this allows the supplying all the options
     *
     * @param {object} targeting (optional)
     *   For ads built after page view this allows the adding of more key value pairs for targeting
     *
     * @returns {string} the id for accessing the ad
     *   This is useful if the element doesnt have a unique id and one is created
     *
     */
    buildAd: function(adElm, options, targeting){

      var self = this,
          opt  = adElm.attr('data-ad-options') ? JSON.parse(adElm.attr('data-ad-options')) : {},
          id   = adElm.attr('id');

      // support passing options as argument
      _.extend(opt, options);

      googletag.cmd.push(function(){

        var slot = googletag
                     .defineSlot(opt.adUnitPath, opt.adSize, id)
                     .addService(googletag.pubads())
                     ;

        var adTargeting = _.extend(opt.adTargeting, targeting);

        setTargeting(slot, adTargeting);
        useSizeMap(slot, opt.adSizeMap);

        // anything with a size map
        // needs to be refreshed on context shift
        if(opt.adSizeMap) { opt.autoRefresh = true; }

        var adObj = {
          id:          id,
          slot:        slot,
          adElm:       adElm,
          autoRefresh: opt.autoRefresh
        };

        attachRenderNotification(adObj);
        adStorage[id] = adObj;
      });

      return id;
    },

    /*
     * displayAd: will make the ad visible
     *   display ad can be called safely
     *   because it will ensure that no uneeded ad calls are made
     *
     *   Only needs to be called if a new ad is created after load
     *
     * @param {string} id
     *   the unique id of the ad element
     *   the same that is returned from buildAd
     *
     * @param {bool} refresh
     *   pass refresh as true if you want this call to refresh the ad zone
     *   if it is already displayed
     *
     */
    displayAd: function(id, refresh){
      if(adStorage.hasOwnProperty(id)){
        googletag.cmd.push(function(){
          displayAd(adStorage[id], refresh);
        });
      }
    },

    /*
     * displayAllAds: will display every ad that has been built
     *
     * @param {bool} refresh
     *   pass refresh as true if you want this call to refresh the ad zones
     *   if they are already displayed
     *
     */
    displayAllAds: function(refresh){
      _.each(adStorage, function(adObj){
        googletag.cmd.push(function(){
          displayAd(adObj, refresh);
        });
      });
    },

    /*
     * displayAllAds: creates an interval refresher
     *
     * @returns {function}
     *   calling the refresher increments the refresher
     *   and after the interval is reached the ad will be refreshed
     *
     * @param {string} id
     *   the id of the ad zone to be refreshed
     *
     * @param {int} interval
     *   how often the ad should be refreshed
     *
     */
    getIntervalRefresher: function(id, interval){
      interval = interval || 1;
      var i = 0;

      return function(increment){

        i += increment || 1;
        if (i >= interval) {
          // refresh the ad
          googletag.cmd.push(function(){
            if(adStorage.hasOwnProperty(id)){
              var adObj = adStorage[id];
              displayAd(adObj, true);
            }
          });

          i = 0;
          return true;
        }
      };
    },

    /*
     * Convienient function for logging all ad keys
     *
     */
    getAds: function(cb){
      if(!cb){
        return _.keys(adStorage);
      } else{
        // useful if called immediately
        googletag.cmd.push(function(){
          return cb(_.keys(adStorage));
        });
      }
    }

  };

  /*
   * Private Functionality
   */
  function displayAd(adObj, refresh){

    // TODO:
    // we can ad targeting option
    // slot.setTargeting(key, value);
    // that will help tell which
    // context the ad fires in

    // allow for autoRefresh option
    if(adObj.autoRefresh){
      refresh = true;
    }

    // notify adops what context the ad fires in
    setTargeting(adObj.slot, {
      breakPoint: intent.axes.width.current
    });

    if (shouldntDisplay(adObj.adElm)) {
      // protects us from bad ad calls
      return;
    } else if (!adObj.hasDisplayed) {
      // display() should only be called once
      googletag.display(adObj.id);
      adObj.hasDisplayed = true;
    } else if (refresh) {
      // optionally refresh ads
      googletag.pubads().refresh([adObj.slot]);
    } else{
      return;
    }
  }

  function shouldntDisplay(adElm){

    /*
     * Important:
     * Without this check our ad impressions were firing
     * for any user who added us to Safari Top Sites
     *
     * So we check if this is Safari Top Sites before firing ads
     * (navigator && navigator.loadPurpose && navigator.loadPurpose === 'preview')
     *
     */
    if (navigator && navigator.loadPurpose && navigator.loadPurpose === 'preview') {
      return true;
    }

    // ads should only be displayed if the element is visible

    // NOTE: if we needed to
    // check on screen this could be a place to do that
    // would be nice to mark certain zones as "in view"
    var invisible = adElm.css('visibility') === "hidden",
        hidden = adElm.css('display') === "none";

    return invisible || hidden || adElm.height() === 0;
  }

  function attachRenderNotification(adObj){

    adObj.slot.originalRenderEnded = adObj.slot.renderEnded;

    adObj.slot.renderEnded = function(){

      // TODO: maybe we should have a debug setting
      // so we dont do this work in prod ????
      var targeting = {};

      _.each(adObj.slot.getTargetingKeys(), function(key){
        targeting[key] = adObj.slot.getTargeting(key);
      });

      var adUnit = adObj.slot.getAdUnitPath();


      // trigger on ad container so anyone can listen to a specific ad
      $(adObj.adElm).trigger('wsj-ad-render', [adObj.adElm, adObj.id, targeting, adUnit]);

      adObj.slot1.originalRenderEnded();
    };
  }

  function setTargeting(slot, adTargeting){

    _.each(adTargeting, function(value, key){
      slot.setTargeting(key, value);
    });

    // if pier39 is required
    // the targeting must
    // be augmented
    // TODO: find out about business
    // needs regarding opier 39
    pier39(slot, adTargeting);
  }

  // store for reference
  var p39_seg;

  function pier39(slot, targeting){

    if(targeting.hasOwnProperty("p39")){

      p39_seg = p39_seg || p39_GPT_value_from_xml();
      slot.setTargeting("p39", p39_seg);
    }
  }

  function useSizeMap(slot, adSizeMap){

    // do nothing if there is no size map
    if(!adSizeMap){ return; }

    var breakPoints = {
      at4units:  0,
      at8units:  640,
      at12units: 980,
      at16units: 1300
    };

    var mapping = googletag.sizeMapping();

    _.each(adSizeMap, function(sizes, unit){
      if(breakPoints.hasOwnProperty(unit)){
        mapping.addSize([breakPoints[unit], 0], sizes);
      }
    });

    slot.defineSizeMapping(mapping.build());
  }

  return responsiveAds;
});

define('article.app/content/scripts/explore-more', [
  'article.app/context',
  'vendor.asset.jquery/jquery'
], function(intent, $) {
  var slideshow,
  options,
  captionContainer,
  infoContainer;

  function truncateHeadline(headline, heightVar) {
    if(headline.data('dotdotdot')){
      headline.trigger("update.dot");
    }

    headline.dotdotdot({
      ellipsis: "...",
      fallbackToLetter: true,
      height: heightVar,
      lastCharacter: {
        remove: [' ', ',',';','.','!','?', "\n","\u3000"]
      }
    });
  }

  var exploreModule = {
    // HACK: anything but init!
    initialize: function(slides, opt, capt, info){
      slideshow = slides;
      options = opt;
      captionContainer = capt;
      infoContainer = info;
    },

    treatHeadlines: function(relatedHeadlines, height){
      for(var cnt = 0; cnt < relatedHeadlines.length; cnt++) {
        var headline = relatedHeadlines[cnt];
        var heightVar = height ? height : 46;
        truncateHeadline($(headline), heightVar);
      }
    },

    hideCaptionContainer: function(){
      if(options.isFullScreen){
        captionContainer.animate({height: 0}, 500, function(){
          infoContainer.hide();
        });
      }
    }
  };

  return exploreModule;

});

;(function () {
//-----------------------
// DJ-NOTE: CUSTOM FOOTER
//-----------------------

/*!
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

var Hogan = {};

(function (Hogan, useArrayBuffer) {
  Hogan.Template = function (codeObj, text, compiler, options) {
    codeObj = codeObj || {};
    this.r = codeObj.code || this.r;
    this.c = compiler;
    this.options = options || {};
    this.text = text || '';
    this.partials = codeObj.partials || {};
    this.subs = codeObj.subs || {};
    this.ib();
  }

  Hogan.Template.prototype = {
    // render: replaced by generated code.
    r: function (context, partials, indent) { return ''; },

    // variable escaping
    v: hoganEscape,

    // triple stache
    t: coerceToString,

    render: function render(context, partials, indent) {
      return this.ri([context], partials || {}, indent);
    },

    // render internal -- a hook for overrides that catches partials too
    ri: function (context, partials, indent) {
      return this.r(context, partials, indent);
    },

    // ensurePartial
    ep: function(symbol, partials) {
      var partial = this.partials[symbol];

      // check to see that if we've instantiated this partial before
      var template = partials[partial.name];
      if (partial.instance && partial.base == template) {
        return partial.instance;
      }

      if (typeof template == 'string') {
        if (!this.c) {
          throw new Error("No compiler available.");
        }
        template = this.c.compile(template, this.options);
      }

      if (!template) {
        return null;
      }

      // We use this to check whether the partials dictionary has changed
      this.partials[symbol].base = template;

      if (partial.subs) {
        // Make sure we consider parent template now
        if (this.activeSub === undefined) {
          // Store parent template text in partials.stackText to perform substitutions in child templates correctly
          partials.stackText  = this.text;
        }
        template = createSpecializedPartial(template, partial.subs, partial.partials,
          this.stackSubs, this.stackPartials, partials.stackText || this.text);
      }
      this.partials[symbol].instance = template;

      return template;
    },

    // tries to find a partial in the current scope and render it
    rp: function(symbol, context, partials, indent) {
      var partial = this.ep(symbol, partials);
      if (!partial) {
        return '';
      }

      return partial.ri(context, partials, indent);
    },

    // render a section
    rs: function(context, partials, section) {
      var tail = context[context.length - 1];

      if (!isArray(tail)) {
        section(context, partials, this);
        return;
      }

      for (var i = 0; i < tail.length; i++) {
        context.push(tail[i]);
        section(context, partials, this);
        context.pop();
      }
    },

    // maybe start a section
    s: function(val, ctx, partials, inverted, start, end, tags) {
      var pass;

      if (isArray(val) && val.length === 0) {
        return false;
      }

      if (typeof val == 'function') {
        val = this.ms(val, ctx, partials, inverted, start, end, tags);
      }

      pass = !!val;

      if (!inverted && pass && ctx) {
        ctx.push((typeof val == 'object') ? val : ctx[ctx.length - 1]);
      }

      return pass;
    },

    // find values with dotted names
    d: function(key, ctx, partials, returnFound) {
      var found,
          names = key.split('.'),
          val = this.f(names[0], ctx, partials, returnFound),
          doModelGet = this.options.modelGet,
          cx = null;

      if (key === '.' && isArray(ctx[ctx.length - 2])) {
        val = ctx[ctx.length - 1];
      } else {
        for (var i = 1; i < names.length; i++) {
          found = findInScope(names[i], val, doModelGet);
          if (found != null) {
            cx = val;
            val = found;
          } else {
            val = '';
          }
        }
      }

      if (returnFound && !val) {
        return false;
      }

      if (!returnFound && typeof val == 'function') {
        ctx.push(cx);
        val = this.mv(val, ctx, partials);
        ctx.pop();
      }

      return val;
    },

    // find values with normal names
    f: function(key, ctx, partials, returnFound) {
      var val = false,
          v = null,
          found = false,
          doModelGet = this.options.modelGet;

      for (var i = ctx.length - 1; i >= 0; i--) {
        v = ctx[i];
        val = findInScope(key, v, doModelGet);
        if (val != null) {
          found = true;
          break;
        }
      }

      if (!found) {
        return (returnFound) ? false : "";
      }

      if (!returnFound && typeof val == 'function') {
        val = this.mv(val, ctx, partials);
      }

      return val;
    },

    // higher order templates
    ls: function(func, cx, partials, text, tags) {
      var oldTags = this.options.delimiters;

      this.options.delimiters = tags;
      this.b(this.ct(coerceToString(func.call(cx, text)), cx, partials));
      this.options.delimiters = oldTags;

      return false;
    },

    // compile text
    ct: function(text, cx, partials) {
      if (this.options.disableLambda) {
        throw new Error('Lambda features disabled.');
      }
      return this.c.compile(text, this.options).render(cx, partials);
    },

    // template result buffering
    b: (useArrayBuffer) ? function(s) { this.buf.push(s); } :
                          function(s) { this.buf += s; },

    fl: (useArrayBuffer) ? function() { var r = this.buf.join(''); this.buf = []; return r; } :
                           function() { var r = this.buf; this.buf = ''; return r; },
    // init the buffer
    ib: function () {
      this.buf = (useArrayBuffer) ? [] : '';
    },

    // method replace section
    ms: function(func, ctx, partials, inverted, start, end, tags) {
      var textSource,
          cx = ctx[ctx.length - 1],
          result = func.call(cx);

      if (typeof result == 'function') {
        if (inverted) {
          return true;
        } else {
          textSource = (this.activeSub && this.subsText[this.activeSub]) ? this.subsText[this.activeSub] : this.text;
          return this.ls(result, cx, partials, textSource.substring(start, end), tags);
        }
      }

      return result;
    },

    // method replace variable
    mv: function(func, ctx, partials) {
      var cx = ctx[ctx.length - 1];
      var result = func.call(cx);

      if (typeof result == 'function') {
        return this.ct(coerceToString(result.call(cx)), cx, partials);
      }

      return result;
    },

    sub: function(name, context, partials, indent) {
      var f = this.subs[name];
      if (f) {
        this.activeSub = name;
        f(context, partials, this, indent);
        this.activeSub = false;
      }
    }

  };

  //Find a key in an object
  function findInScope(key, scope, doModelGet) {
    var val, checkVal;

    if (scope && typeof scope == 'object') {

      if (scope[key] != null) {
        val = scope[key];

      // try lookup with get for backbone or similar model data
      } else if (doModelGet && scope.get && typeof scope.get == 'function') {
        val = scope.get(key);
      }
    }

    return val;
  }

  function createSpecializedPartial(instance, subs, partials, stackSubs, stackPartials, childText) {
    function PartialTemplate() {};
    PartialTemplate.prototype = instance;
    function Substitutions() {};
    Substitutions.prototype = instance.subs;
    var key;
    var partial = new PartialTemplate();
    partial.subs = new Substitutions();
    partial.subsText = {};  //hehe. substext.
    partial.ib();

    stackSubs = stackSubs || {};
    partial.stackSubs = stackSubs;
    for (key in subs) {
      if (!stackSubs[key]) stackSubs[key] = subs[key];
      partial.subsText[key] = childText;
    }
    for (key in stackSubs) {
      partial.subs[key] = stackSubs[key];
    }

    stackPartials = stackPartials || {};
    partial.stackPartials = stackPartials;
    for (key in partials) {
      if (!stackPartials[key]) stackPartials[key] = partials[key];
    }
    for (key in stackPartials) {
      partial.partials[key] = stackPartials[key];
    }

    return partial;
  }

  var rAmp = /&/g,
      rLt = /</g,
      rGt = />/g,
      rApos = /\'/g,
      rQuot = /\"/g,
      hChars = /[&<>\"\']/;

  function coerceToString(val) {
    return String((val === null || val === undefined) ? '' : val);
  }

  function hoganEscape(str) {
    str = coerceToString(str);
    return hChars.test(str) ?
      str
        .replace(rAmp, '&amp;')
        .replace(rLt, '&lt;')
        .replace(rGt, '&gt;')
        .replace(rApos, '&#39;')
        .replace(rQuot, '&quot;') :
      str;
  }

  var isArray = Array.isArray || function(a) {
    return Object.prototype.toString.call(a) === '[object Array]';
  };

})(typeof exports !== 'undefined' ? exports : Hogan);



(function (Hogan) {
  // Setup regex  assignments
  // remove whitespace according to Mustache spec
  var rIsWhitespace = /\S/,
      rQuot = /\"/g,
      rNewline =  /\n/g,
      rCr = /\r/g,
      rSlash = /\\/g;

  Hogan.tags = {
    '#': 1, '^': 2, '<': 3, '$': 4,
    '/': 5, '!': 6, '>': 7, '=': 8, '_v': 9,
    '{': 10, '&': 11, '_t': 12
  };

  Hogan.scan = function scan(text, delimiters) {
    var len = text.length,
        IN_TEXT = 0,
        IN_TAG_TYPE = 1,
        IN_TAG = 2,
        state = IN_TEXT,
        tagType = null,
        tag = null,
        buf = '',
        tokens = [],
        seenTag = false,
        i = 0,
        lineStart = 0,
        otag = '{{',
        ctag = '}}';

    function addBuf() {
      if (buf.length > 0) {
        tokens.push({tag: '_t', text: new String(buf)});
        buf = '';
      }
    }

    function lineIsWhitespace() {
      var isAllWhitespace = true;
      for (var j = lineStart; j < tokens.length; j++) {
        isAllWhitespace =
          (Hogan.tags[tokens[j].tag] < Hogan.tags['_v']) ||
          (tokens[j].tag == '_t' && tokens[j].text.match(rIsWhitespace) === null);
        if (!isAllWhitespace) {
          return false;
        }
      }

      return isAllWhitespace;
    }

    function filterLine(haveSeenTag, noNewLine) {
      addBuf();

      if (haveSeenTag && lineIsWhitespace()) {
        for (var j = lineStart, next; j < tokens.length; j++) {
          if (tokens[j].text) {
            if ((next = tokens[j+1]) && next.tag == '>') {
              // set indent to token value
              next.indent = tokens[j].text.toString()
            }
            tokens.splice(j, 1);
          }
        }
      } else if (!noNewLine) {
        tokens.push({tag:'\n'});
      }

      seenTag = false;
      lineStart = tokens.length;
    }

    function changeDelimiters(text, index) {
      var close = '=' + ctag,
          closeIndex = text.indexOf(close, index),
          delimiters = trim(
            text.substring(text.indexOf('=', index) + 1, closeIndex)
          ).split(' ');

      otag = delimiters[0];
      ctag = delimiters[delimiters.length - 1];

      return closeIndex + close.length - 1;
    }

    if (delimiters) {
      delimiters = delimiters.split(' ');
      otag = delimiters[0];
      ctag = delimiters[1];
    }

    for (i = 0; i < len; i++) {
      if (state == IN_TEXT) {
        if (tagChange(otag, text, i)) {
          --i;
          addBuf();
          state = IN_TAG_TYPE;
        } else {
          if (text.charAt(i) == '\n') {
            filterLine(seenTag);
          } else {
            buf += text.charAt(i);
          }
        }
      } else if (state == IN_TAG_TYPE) {
        i += otag.length - 1;
        tag = Hogan.tags[text.charAt(i + 1)];
        tagType = tag ? text.charAt(i + 1) : '_v';
        if (tagType == '=') {
          i = changeDelimiters(text, i);
          state = IN_TEXT;
        } else {
          if (tag) {
            i++;
          }
          state = IN_TAG;
        }
        seenTag = i;
      } else {
        if (tagChange(ctag, text, i)) {
          tokens.push({tag: tagType, n: trim(buf), otag: otag, ctag: ctag,
                       i: (tagType == '/') ? seenTag - otag.length : i + ctag.length});
          buf = '';
          i += ctag.length - 1;
          state = IN_TEXT;
          if (tagType == '{') {
            if (ctag == '}}') {
              i++;
            } else {
              cleanTripleStache(tokens[tokens.length - 1]);
            }
          }
        } else {
          buf += text.charAt(i);
        }
      }
    }

    filterLine(seenTag, true);

    return tokens;
  }

  function cleanTripleStache(token) {
    if (token.n.substr(token.n.length - 1) === '}') {
      token.n = token.n.substring(0, token.n.length - 1);
    }
  }

  function trim(s) {
    if (s.trim) {
      return s.trim();
    }

    return s.replace(/^\s*|\s*$/g, '');
  }

  function tagChange(tag, text, index) {
    if (text.charAt(index) != tag.charAt(0)) {
      return false;
    }

    for (var i = 1, l = tag.length; i < l; i++) {
      if (text.charAt(index + i) != tag.charAt(i)) {
        return false;
      }
    }

    return true;
  }

  // the tags allowed inside super templates
  var allowedInSuper = {'_t': true, '\n': true, '$': true, '/': true};

  function buildTree(tokens, kind, stack, customTags) {
    var instructions = [],
        opener = null,
        tail = null,
        token = null;

    tail = stack[stack.length - 1];

    while (tokens.length > 0) {
      token = tokens.shift();

      if (tail && tail.tag == '<' && !(token.tag in allowedInSuper)) {
        throw new Error('Illegal content in < super tag.');
      }

      if (Hogan.tags[token.tag] <= Hogan.tags['$'] || isOpener(token, customTags)) {
        stack.push(token);
        token.nodes = buildTree(tokens, token.tag, stack, customTags);
      } else if (token.tag == '/') {
        if (stack.length === 0) {
          throw new Error('Closing tag without opener: /' + token.n);
        }
        opener = stack.pop();
        if (token.n != opener.n && !isCloser(token.n, opener.n, customTags)) {
          throw new Error('Nesting error: ' + opener.n + ' vs. ' + token.n);
        }
        opener.end = token.i;
        return instructions;
      } else if (token.tag == '\n') {
        token.last = (tokens.length == 0) || (tokens[0].tag == '\n');
      }

      instructions.push(token);
    }

    if (stack.length > 0) {
      throw new Error('missing closing tag: ' + stack.pop().n);
    }

    return instructions;
  }

  function isOpener(token, tags) {
    for (var i = 0, l = tags.length; i < l; i++) {
      if (tags[i].o == token.n) {
        token.tag = '#';
        return true;
      }
    }
  }

  function isCloser(close, open, tags) {
    for (var i = 0, l = tags.length; i < l; i++) {
      if (tags[i].c == close && tags[i].o == open) {
        return true;
      }
    }
  }

  function stringifySubstitutions(obj) {
    var items = [];
    for (var key in obj) {
      items.push('"' + esc(key) + '": function(c,p,t,i) {' + obj[key] + '}');
    }
    return "{ " + items.join(",") + " }";
  }

  function stringifyPartials(codeObj) {
    var partials = [];
    for (var key in codeObj.partials) {
      partials.push('"' + esc(key) + '":{name:"' + esc(codeObj.partials[key].name) + '", ' + stringifyPartials(codeObj.partials[key]) + "}");
    }
    return "partials: {" + partials.join(",") + "}, subs: " + stringifySubstitutions(codeObj.subs);
  }

  Hogan.stringify = function(codeObj, text, options) {
    return "{code: function (c,p,i) { " + Hogan.wrapMain(codeObj.code) + " }," + stringifyPartials(codeObj) +  "}";
  }

  var serialNo = 0;
  Hogan.generate = function(tree, text, options) {
    serialNo = 0;
    var context = { code: '', subs: {}, partials: {} };
    Hogan.walk(tree, context);

    if (options.asString) {
      return this.stringify(context, text, options);
    }

    return this.makeTemplate(context, text, options);
  }

  Hogan.wrapMain = function(code) {
    return 'var t=this;t.b(i=i||"");' + code + 'return t.fl();';
  }

  Hogan.template = Hogan.Template;

  Hogan.makeTemplate = function(codeObj, text, options) {
    var template = this.makePartials(codeObj);
    template.code = new Function('c', 'p', 'i', this.wrapMain(codeObj.code));
    return new this.template(template, text, this, options);
  }

  Hogan.makePartials = function(codeObj) {
    var key, template = {subs: {}, partials: codeObj.partials, name: codeObj.name};
    for (key in template.partials) {
      template.partials[key] = this.makePartials(template.partials[key]);
    }
    for (key in codeObj.subs) {
      template.subs[key] = new Function('c', 'p', 't', 'i', codeObj.subs[key]);
    }
    return template;
  }

  function esc(s) {
    return s.replace(rSlash, '\\\\')
            .replace(rQuot, '\\\"')
            .replace(rNewline, '\\n')
            .replace(rCr, '\\r');
  }

  function chooseMethod(s) {
    return (~s.indexOf('.')) ? 'd' : 'f';
  }

  function createPartial(node, context) {
    var prefix = "<" + (context.prefix || "");
    var sym = prefix + node.n + serialNo++;
    context.partials[sym] = {name: node.n, partials: {}};
    context.code += 't.b(t.rp("' +  esc(sym) + '",c,p,"' + (node.indent || '') + '"));';
    return sym;
  }

  Hogan.codegen = {
    '#': function(node, context) {
      context.code += 'if(t.s(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,1),' +
                      'c,p,0,' + node.i + ',' + node.end + ',"' + node.otag + " " + node.ctag + '")){' +
                      't.rs(c,p,' + 'function(c,p,t){';
      Hogan.walk(node.nodes, context);
      context.code += '});c.pop();}';
    },

    '^': function(node, context) {
      context.code += 'if(!t.s(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,1),c,p,1,0,0,"")){';
      Hogan.walk(node.nodes, context);
      context.code += '};';
    },

    '>': createPartial,
    '<': function(node, context) {
      var ctx = {partials: {}, code: '', subs: {}, inPartial: true};
      Hogan.walk(node.nodes, ctx);
      var template = context.partials[createPartial(node, context)];
      template.subs = ctx.subs;
      template.partials = ctx.partials;
    },

    '$': function(node, context) {
      var ctx = {subs: {}, code: '', partials: context.partials, prefix: node.n};
      Hogan.walk(node.nodes, ctx);
      context.subs[node.n] = ctx.code;
      if (!context.inPartial) {
        context.code += 't.sub("' + esc(node.n) + '",c,p,i);';
      }
    },

    '\n': function(node, context) {
      context.code += write('"\\n"' + (node.last ? '' : ' + i'));
    },

    '_v': function(node, context) {
      context.code += 't.b(t.v(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,0)));';
    },

    '_t': function(node, context) {
      context.code += write('"' + esc(node.text) + '"');
    },

    '{': tripleStache,

    '&': tripleStache
  }

  function tripleStache(node, context) {
    context.code += 't.b(t.t(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,0)));';
  }

  function write(s) {
    return 't.b(' + s + ');';
  }

  Hogan.walk = function(nodelist, context) {
    var func;
    for (var i = 0, l = nodelist.length; i < l; i++) {
      func = Hogan.codegen[nodelist[i].tag];
      func && func(nodelist[i], context);
    }
    return context;
  }

  Hogan.parse = function(tokens, text, options) {
    options = options || {};
    return buildTree(tokens, '', [], options.sectionTags || []);
  }

  Hogan.cache = {};

  Hogan.cacheKey = function(text, options) {
    return [text, !!options.asString, !!options.disableLambda, options.delimiters, !!options.modelGet].join('||');
  }

  Hogan.compile = function(text, options) {
    options = options || {};
    var key = Hogan.cacheKey(text, options);
    var template = this.cache[key];

    if (template) {
      return template;
    }

    template = this.generate(this.parse(this.scan(text, options.delimiters), text, options), text, options);
    return this.cache[key] = template;
  }
})(typeof exports !== 'undefined' ? exports : Hogan);

//-----------------------
if (typeof define === 'function' && define.amd) {
  define('vendor.asset.hogan/hogan', [], function () {
    return Hogan;
  });
}
}());

/*global setTimeout, console, define, navigator, screen, window, FB, Recaptcha, twttr, IN, gapi*/
/*
 * Common Utils that are shared in wsj article redesign pages
 */
define("dj.responsive.resources/commonutils", ['vendor.asset.jquery/jquery'], function ($) {

  var commonutils = {
    init: function (options) {
      var config = {};
    },

    region2Locale: {
      'na,us': 'en_US',
      'na,br': 'pt_BR',
      'na,lat': 'es_LA',
      'asia,jp': 'ja_JP',
      'germany': 'de_DE',
      'europe,tr': 'tr_TR'
    },

    region2Lang_gplus: {
      'na,us': 'en-US',
      'na,lat': 'es-419',
      'na,br': 'pt-PT',
      'asia,jp': 'Ja',
      'germany': 'de',
      'europe,tr': 'tr'
    },

    region2Twitter: {
      'wsj': {
        'na,us': 'WSJ',
        'na,br': 'WSJ',
        'na,lat': 'WSJ',
        'asia,jp': 'WSJJapan',
        'europe,tr': 'TurkiyeWSJ',
        'germany': 'WSJDeutschland'
      },
      'barrons': {
        'na,us': 'barronsonline'
      }
    },

    getRegion: function (type) {
      var region = $('meta[name=page\\.region]').attr('content') || 'na,us',
        site = $('meta[name=page\\.site]').attr('content') || 'wsj',
        lang = $('meta[name=language]').attr('content') || 'en',
        regionCode = 'en_US';
      switch (type) {
      case 'lang':
        regionCode = lang;
        break;
      case 'locale':
        regionCode = this.region2Locale[region] || 'en_US';
        break;
      case 'gplus':
        regionCode = this.region2Locale[region] || 'en-US';
        break;
      case 'twitter':
        var mapSite = this.region2Twitter[site] || this.region2Twitter.wsj;
        regionCode = mapSite[region] || mapSite['na,us'];
        break;
      default:
        regionCode = 'en_US';
      }
      return regionCode;
    },

    loadCaptchaScript: function (divId) {
      var _self = this;
      var langCode = this.getRegion('lang');
      if ($('#' + divId).length !== 0) {
        $.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js", function () {
          Recaptcha.create("6LdsXtkSAAAAAO_SUY_Il1uV_TsP-37nbN2bMsik", divId, {
            tabindex: 4,
            theme: "clean",
            lang: langCode
          });
        });
      }
    },

    getShortURL: function (cb) {
      var bitlyReqUrl = "http://api.bit.ly/v3/shorten?login=wsjblogs&apiKey=R_4dd2ea29f00a2b806151d12d7807286b&format=json&longUrl=" + $(location).attr('href').split("?")[0].split("#")[0] + "&callback=?";
      $.getJSON(bitlyReqUrl, function (res) {
        if (res.status_code !== 200) {
          return cb($(location).attr('href').split("?")[0].split("#")[0]);
        }
        cb(res.data.url);
      });
    },

    addslashes: function (str) {
      return (str + '').replace(/[\\"']/g, '\\$&').replace(/\u0000/g, '\\0');
    },

    loadDJChatScript: function () {
      $.getScript('https://chat.wsj.com/wsj-traySetup.js');
    },

    loadWSJNewsAlertScript: function () {
      var dataEnv = $('html').attr('data-env');
      if (dataEnv === 'sat') {
        $.getScript('https://dev-barker.djrd.wsj.com/simpleHubSetup.js');
      } else if (dataEnv === 'prod') {
        $.getScript('https://chat.wsj.com/simpleHubSetup.js');
      }
    },

    loadJIRAScript: function () {
      if ($(location).attr('href').indexOf('#printMode') === -1) {
        $.getScript("https://issues.dowjones.net/s/en_US-k8x3kt-418945332/853/14/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=417beac3");
      }
    },

    loadSocialScripts: function (socialNetworkName) {
      var _self = this;
      switch (socialNetworkName) {
      case 'facebook':
        //Facebook
        this.langCode = this.getRegion('locale');
        if ($(".fb-like").length > 0 || $(".fb-share-button").length > 0) {
          if (typeof (FB) !== 'undefined') {
            //FB.init({ status: true, cookie: true, xfbml: true });
            FB.XFBML.parse();
          } else {
            $.getScript("http://connect.facebook.net/" + _self.langCode + "/all.js#xfbml=1", function () {
              FB.init({
                appId: '368513495882',
                status: true,
                cookie: true,
                xfbml: true
              });
            });
          }
        }
        break;

      case 'twitter':
        //Twitter
        if ($(".twitter-share-button").length > 0 || $(".twitter-follow-button").length > 0) {
          if (typeof (twttr) !== 'undefined' && twttr.widgets && twttr.widgets.load) {
            twttr.widgets.load();
          } else {
            $.getScript('http://platform.twitter.com/widgets.js');
          }
        }
        break;

      case 'linkedin':
        //Linked-in
        this.langCode = this.getRegion('locale');
        if (typeof (IN) !== 'undefined') {
          IN.parse();
        } else {
          $.getScript("http://platform.linkedin.com/in.js?async=true", function () {
            IN.init({
              lang: _self.langCode
            });
          });
        }
        break;

      case 'googleplus':
        //Google - Note that the google button will not show if you are opening the page from disk - it needs to be http(s)
        this.langCode = this.getRegion('gplus');
        if (typeof (gapi) !== 'undefined') {
          $(".g-plusone").each(function () {
            //gapi.plusone.render($(this).get(0));
            gapi.plusone.go();
          });
        } else {
          window.___gcfg = {
            lang: _self.langCode
          };
          $.getScript('https://apis.google.com/js/plusone.js');
        }
        break;

      case 'mixi':
        //Mixi
        $.getScript('http://static.mixi.jp/js/share.js');
        break;

      case 'hatena':
        //Hatena
        $.getScript('http://b.st-hatena.com/js/bookmark_button.js');
        break;
      }
    }
  };

  return commonutils;
});


/*
 * Article Ads
 *
 * This script
 * handles the circ ad behavior on the snippet page
 *
 */

define('article.app/circAd', [
  'vendor.asset.jquery/jquery',
  'article.app/context',
  "article.app/responsiveAds",
], function ($, intent, responsiveAds) {

  var circAd = {
    init: function(){

      var body = $('#article_body'),
          ad = $('#AD_C'),
          parent = $('.main-circ-ad');

      ad.on('wsj-ad-render', function() {

        var ad_iframe = ad.find('iframe');

        ad_iframe.on("load", function(){

          var ad_head = ad_iframe.contents().find('head'),
              ad_container = ad_iframe.contents().find('#google_image_div, #ad_wrapper'), // desktop and mobile have different wrappers
              ad_image = ad_iframe.contents().find("img"),
              ad_image_width = ad_image.attr('width'),
              ad_image_height = ad_image.attr('height'),
              ad_image_ratio = 100*(ad_image_height/ad_image_width),
              stretch = {width: "100%", height: "auto"};

          ad_container.css(stretch);
          ad_image.css(stretch);
          parent.css('padding-bottom', ad_image_ratio + '%');
        });

      });
    }
  };

  return circAd;
});

/**
 * author Remy Sharp
 * url http://remysharp.com/2009/01/26/element-in-view-event-plugin/
 * fork https://github.com/zuk/jquery.inview
 */
define('vendor.asset.jquery.inview/jquery.inview', ['vendor.asset.jquery/jquery'], function (jQuery) {

$ = this.jQuery;

(function($) { 

    'use strict';
   
    function getScrollTop() {
        return window.pageYOffset ||
            document.documentElement.scrollTop ||
            document.body.scrollTop;
    }

    function getViewportHeight() {
        var height = window.innerHeight; // Safari, Opera
        // if this is correct then return it. iPad has compat Mode, so will
        // go into check clientHeight (which has the wrong value).
        if (height) {
            return height;
        }
        var mode = document.compatMode;

        if ((mode || !$.support.boxModel)) { // IE, Gecko
            height = (mode === 'CSS1Compat') ?
                document.documentElement.clientHeight : // Standards
                document.body.clientHeight; // Quirks
        }

        return height;
    }

    function offsetTop(debug) {
        // Manually calculate offset rather than using jQuery's offset
        // This works-around iOS < 4 on iPad giving incorrect value
        // cf http://bugs.jquery.com/ticket/6446#comment:9
        var curtop = 0;
        for (var obj = debug; obj; obj = obj.offsetParent) {
            curtop += obj.offsetTop;
        }
        return curtop;
    }

    function checkInView() {
        var viewportTop = getScrollTop(),
            viewportBottom = viewportTop + getViewportHeight(),
            elems = [];

        // naughty, but this is how it knows which elements to check for
        $.each($.cache, function() {
            if (this.events && this.events.inview) {
                elems.push(this.handle.elem);
            }
        });

        $(elems).each(function() {
            var $el = $(this),
                elTop = offsetTop(this),
                elHeight = $el.height(),
                elBottom = elTop + elHeight,
                wasInView = $el.data('inview') || false,
                offset = $el.data('offset') || 0,
                inView = elTop > viewportTop && elBottom < viewportBottom,
                isBottomVisible = elBottom + offset > viewportTop && elTop < viewportTop,
                isTopVisible = elTop - offset < viewportBottom && elBottom > viewportBottom,
                inViewWithOffset = inView || isBottomVisible || isTopVisible ||
                    (elTop < viewportTop && elBottom > viewportBottom);

            if (inViewWithOffset) {
                var visPart = (isTopVisible) ? 'top' : (isBottomVisible) ? 'bottom' : 'both';
                if (!wasInView || wasInView !== visPart) {
                    $el.data('inview', visPart);
                    $el.trigger('inview', [true, visPart]);
                }
            } else if (!inView && wasInView) {
                $el.data('inview', false);
                $el.trigger('inview', [false]);
            }
        });
    }

    function createFunctionLimitedToOneExecutionPerDelay(fn, delay) {
        var shouldRun = false;
        var timer = null;

        function runOncePerDelay() {
            if (timer !== null) {
                shouldRun = true;
                return;
            }
            shouldRun = false;
            fn();
            timer = setTimeout(function() {
                timer = null;
                if (shouldRun) {
                    runOncePerDelay();
                }
            }, delay);
        }

        return runOncePerDelay;
    }

    // ready.inview kicks the event to pick up any elements already in view.
    // note however, this only works if the plugin is included after the elements are bound to 'inview'
    var runner = createFunctionLimitedToOneExecutionPerDelay(checkInView, 100);
    $(window).on('checkInView.inview click.inview ready.inview scroll.inview resize.inview', runner);

})(jQuery);
return jQuery;
});
define('article.app/textSize', [
  'vendor.asset.jquery/jquery',
  'dj.responsive.resources/commonutils'
], function ($, utils) {

  var textSize = {

      init: function () {
        var options = $('#text-size .option'),
            article = $('#article-contents');

        $.each(options, function(idx, elm){
          var option = $(elm);

          option.on('touchstart mousedown', function () {
              option.addClass('selected').siblings().removeClass('selected');
              if (option.hasClass('regular')) {
                article.removeClass('medium-text large-text');
              } else if (option.hasClass('medium')) {
                article.removeClass('large-text').addClass('medium-text');
              } else if (option.hasClass('large')) {
                article.removeClass('medium-text').addClass('large-text');
              }
              $(window).trigger('wsj-text-resize');
            }
          );

        });

      } //end of init

    };

  return textSize;

});

define('article.app/sharetools', [
  'vendor.asset.jquery/jquery',
  'dj.responsive.resources/commonutils',
  'article.app/jquerySharrre'
], function ($,utils) {


var sharetools = {

    init: function () {

      var pinterestTool = $('.article_tools .pinterest');
      pinterestTool.sharrre({
        share: {
          pinterest: true
        },
        buttons: {
          media: pinterestTool.attr('data-emailimgsrc'),
          description: pinterestTool.attr('data-text')
        },
        template: '<a href="#"><span>{total}</span></a>',
        enableCounter: false,
        enableHover: false,
        click: function(api, options) {
          api.simulateClick();
          api.openPopup('pinterest');
        }
      });
      var twitterTool = $('.article_tools .twitter');


      twitterTool.sharrre({
        share: {
          twitter: true
        },

        template: '<span>{total}</span>',
        enableHover: false,
        enableCounter:false,
        shareTotal:twitterTool.attr('data-total'),
        url:twitterTool.attr('data-url'),
        click: function (api, options) {
          api.simulateClick();
          api.openPopup('twitter');
        }
      });

      var facebookTool = $('.article_tools .facebook');
      facebookTool.sharrre({
        enableCounter:false,
        shareTotal:facebookTool.attr('data-total'),
        share: {
          facebook: true
        },
        template: '<a href="#"><span>{total}</span></a>',
        enableHover: false,
        click: function (api, options) {
          api.simulateClick();
          api.openPopup('facebook');
        }
      });

      var googleTool = $('.article_tools .google, .scrim-overlay.mobile .google');
      googleTool.sharrre({

        enableCounter:false,
        shareTotal:googleTool.attr('data-total'),
        share: {
          googlePlus: true
        },

        template: '<a href="#"><span>{total}</span></a>',
        enableHover: false,
        click: function (api, options) {
          api.simulateClick();
          api.openPopup('googlePlus');
        }
      });

      var linkedinTool = $('.article_tools .linked, .scrim-overlay.mobile .linked');
      linkedinTool.sharrre({
        enableCounter:false,
        shareTotal:linkedinTool.attr('data-total'),
        share: {
          linkedin: true
        },
        template: '<a href="#"><span>{total}</span></a>',
        enableHover: false,
        click: function (api, options) {
          api.simulateClick();
          api.openPopup('linkedin');
        }
      });

      $('.article_tools .print').click(function(){

        // TODO: is there way we can get this ad when the user
        // prints without the button
        $(".print-ad").remove();
        var printAd = $('<img class="print-ad" src="http://ad.doubleclick.net/N2/ad/interactive.wsj.com/printview;sz=728x90;ord=[timestamp]?"/>');
        $('.print-header').prepend(printAd);


        /*
         * use setTimeout as a fallback in case the print ad fails to load
         */
        var printCalled = false;
        printAd.on("load", function(){
          if (!printCalled) {
            printCalled = true;
            window.print();
          }
        });
        setTimeout(function() {
          if (!printCalled) {
            printCalled = true;
            $('.print-ad').remove();
            window.print();
          }
        }, 500);
      });

      $('.article_tools .email').click(function () {
        var headline = $(this).attr('data-headline'),
            url = $(this).attr('data-url'),
            ts = $(this).attr('data-timestamp').replace('Updated ',''),
            imgsrc = $(this).attr('data-emailimgsrc'),
            imgMarkup = "";

        if (imgsrc) {
          imgMarkup = '<img src="' + imgsrc + '" class="scrim-email-image">';
        } else {
          imgMarkup = "";
        }

        //scrim_email_this scrimWSJ_module loginModule
        var markup = '<div class="scrim-email">' +
                     '<h2 class="scrim-header">Email this Article</h2>' +
                     '<div class="scrim-email-info clearFix">' +
                     imgMarkup +
                     '<h3 class="scrim-email-headline">' + headline + '</h3>' +
                     '<h4 class="scrim-email-timestamp">' + ts + '</h4>' +
                     '</div>' +
                     '<span class="scrim-email-text">Share Using Your Email or Copy Permalink</span>' +
                     '<a target="_blank" href="mailto:?subject=' + encodeURIComponent(headline) + '&body=Here is something from WSJ.com that might interest you:%0D%0A%0D%0A' +encodeURIComponent(headline) + '%0D%0A' + url + '" class="scrim-email-link client">Click to Email Article</a>' +
                     '<span class="scrim-email-link copy">' + url + '</span>'+
                     '<ul class="scrim-email-button-list">' +
                     '<a href="mailto:?subject=' + encodeURIComponent(headline) + '&body=Here%20is%20something%20from%20WSJ.com%20that%20might%20interest%20you:%0D%0A%0D%0A' +encodeURIComponent(headline) + '%0D%0A' + url + '" class="scrim-email-link"><li class="icon email">Click to Email</li></a>' +
                     '<div class="scrim-email-link"><li class="icon share">Copy this link:<br><span>' + url + '</span></li></div>' +
                     '</ul>' +
                     '<div class="scrim-email-ad-container">' +
                     '<a href="http://ad.doubleclick.net/N2/jump/interactive.wsj.com/emailscrim;sz=300x250;ord=[timestamp]?" class="scrim-email-ad"> <img src="http://ad.doubleclick.net/N2/ad/interactive.wsj.com/emailscrim;sz=300x250;ord=[timestamp]?" width="300" height="250" /> </a>'+
                     '</div>' +
                     '</div>';

        var body = $('body');

        if(!body.hasClass('at4units')) {
          body.append('<div class="scrim-overlay"><div class="scrim-outer"><div class="scrim"><div class="scrim-close-container"><a href="#" class="scrim-close">CANCEL</a></div>'+ markup +'</div></div></div>');
        }

        $('.scrim').on("click", function(e){
          e.stopPropagation();
        });

        $('.scrim-close, .scrim-overlay').on("click", function(e){
      		e.preventDefault();
          $('.scrim-overlay').remove();
      	});



      });

    },

    mobileShare: function () {

      var googleTool = $('.scrim .google');
      googleTool.sharrre({

        enableCounter:false,
        shareTotal:googleTool.attr('data-total'),
        share: {
          googlePlus: true
        },

        template: '<a href="#"><span>{total}</span></a>',
        enableHover: false,
        click: function (api, options) {
          api.simulateClick();
          api.openPopup('googlePlus');
        }
      });

      var linkedinTool = $('.scrim .linked');
      linkedinTool.sharrre({
        enableCounter:false,
        shareTotal:linkedinTool.attr('data-total'),
        share: {
          linkedin: true
        },
        template: '<a href="#"><span>{total}</span></a>',
        enableHover: false,
        click: function (api, options) {
          api.simulateClick();
          api.openPopup('linkedin');
        }
      });

    }

  };

  return sharetools;

});

/*! intention.js v0.9.9 
* http://intentionjs.com/ 
* 
* intention.js 
* 
* Copyright 2008, 2013
* Dowjones and other contributors. 
* Released under the MIT license. 
**/ !function(a,b){"use strict";"function"==typeof define&&define.amd?define('vendor.asset.intention/intention', ['vendor.asset.jquery/jquery', 'vendor.asset.underscore/underscore'],b):a.Intention=b(a.jQuery,a._)}(this,function(a,b){"use strict";var c=function(c){var d=b.extend(this,c,{_listeners:{},contexts:[],elms:a(),axes:{},priority:[]});return d};return c.prototype={responsive:function d(a,c){var e,f="abcdefghijklmnopqrstuvwxyz0123456789",g=f.length,h="";for(e=0;5>e;e++)h+=f[Math.floor(Math.random()*g)];var i={matcher:function(a,b){return a===b.name},measure:b.identity,ID:h};if(b.isObject(c)===!1&&(c={}),b.isArray(a)&&b.isArray(a[0].contexts))return b.each(a,function(a){d.apply(this,a)},this),void 0;b.isArray(a)===!1&&b.isObject(a)?c=a:c.contexts=a,c=b.extend({},i,c),this.on("_"+c.ID+":",b.bind(function(a){this.axes=this._contextualize(c.ID,a.context,this.axes),this._respond(this.axes,this.elms)},this));var j={ID:c.ID,current:null,contexts:c.contexts,respond:b.bind(this._responder(c.ID,c.contexts,c.matcher,c.measure),this)};return this.axes[c.ID]=j,this.axes.__keys__=this.priority,this.priority.unshift(c.ID),j},elements:function(c){return c||(c=document),a("[data-intent],[intent],[data-in],[in]",c).each(b.bind(function(b,c){this.add(a(c))},this)),this},add:function(c,d){var e;return d||(d={}),c.each(b.bind(function(c,f){var g=!1;this.elms.each(function(a,b){return f===b.elm?(g=!0,!1):!0}),g===!1&&(e=this._fillSpec(b.extend(d,this._attrsToSpec(f.attributes,this.axes))),this._makeChanges(a(f),e,this.axes),this.elms.push({elm:f,spec:e}))},this)),this},remove:function(a){var b=this.elms;return a.each(function(a,c){b.each(function(a,d){return c===d.elm?(b.splice(a,1),!1):!0})}),this},is:function(a){var c=this.axes;return b.some(c.__keys__,function(b){return a===c[b].current})},current:function(a){return this.axes.hasOwnProperty(a)?this.axes[a].current:!1},on:function(a,b){var c=a.split(" "),d=0;for(d;d<c.length;d++)void 0===this._listeners[c[d]]&&(this._listeners[c[d]]=[]),this._listeners[c[d]].push(b);return this},off:function(a,c){if(b.isArray(this._listeners[a])){var d=this._listeners[a],e=0;for(e;e<d.length;e++)if(d[e]===c){d.splice(e,1);break}}return this},_responder:function(a,c,d,e){var f;return function(){var g=e.apply(this,arguments);return b.every(c,function(c){return d(g,c)?void 0===f||c.name!==f.name?(f=c,this._emitter({_type:"_"+a+":",context:f.name},f,this)._emitter({_type:a+":",context:f.name},f,this)._emitter(b.extend({},{_type:a+":"+f.name},f),f,this)._emitter(b.extend({},{_type:f.name},f),f,this),!1):!1:!0},this),this}},_emitter:function(a){if("string"==typeof a&&(a={_type:a}),a.target||(a.target=this),!a._type)throw new Error(a._type+" is not a supported event.");if(b.isArray(this._listeners[a._type])){var c,d=this._listeners[a._type];for(c=0;c<d.length;c++)d[c].apply(this,arguments)}return this},_fillSpec:function(a){var c=function(c){b.each(a,function(a,d){b.each(a,function(a,b){c(a,b,d)})})},d={};return c(function(a){b.isObject(a)&&b.each(a,function(a,b){d[b]=""})}),c(function(c,e,f){b.isObject(c)&&(a[f][e]=b.extend({},d,c))}),a},_assocAxis:function(a,c){var d=!1;return b.every(c.__keys__,function(e){return d===!1?(b.every(c[e].contexts,function(b){return b.name===a?(d=e,!1):!0}),!0):!1}),d},_makeSpec:function(a,b,c,d,e){var f;return void 0!==e[a]?(f=e[a],void 0===f[b]&&(f[b]={})):(f={},f[b]={},e[a]=f),f[b][c]=d,e},_attrsToSpec:function(a,c){var d={},e=new RegExp("^(data-)?(in|intent)-(([a-zA-Z0-9][a-zA-Z0-9]*:)?([a-zA-Z0-9]*))-([A-Za-z:-]+)"),f=new RegExp("^(data-)?(in|intent)-([a-zA-Z0-9][_a-zA-Z0-9]*)$");return b.each(a,function(a){var g,h=a.name.match(e);if(null!==h){if(h=h.slice(-3),g=h[0],void 0===h[0]||""===h[0]){if(h[0]=this._assocAxis(h[1],c),h[0]===!1)return}else h[0]=h[0].replace(/:$/,"");h.push(a.value),h.push(d),d=this._makeSpec.apply(this,h)}else f.test(a.name)&&"*"===a.value&&(g=a.name.match(f)[3],b.each(c[g].contexts,function(a){this._makeSpec(g,a.name,"class",a.name,d)},this))},this),d},_contextSpec:function(a,b){return b.hasOwnProperty(a.axis)&&b[a.axis].hasOwnProperty(a.ctx)?b[a.axis][a.ctx]:{}},_resolveSpecs:function(c,d){var e={},f=["append","prepend","before","after"];return b.each(c,function(c){b.each(this._contextSpec(c,d),function(c,d){"class"===d?(e[d]||(e[d]=[]),e[d]=b.union(e[d],c.split(" "))):void 0!==e.move&&""!==e.move.value||-1===a.inArray(d,f)?(void 0===e[d]||""===e[d])&&(e[d]=c):e.move={value:c,placement:d}},this)},this),e},_currentContexts:function(a){var c=[];return b.each(a.__keys__,function(b){return null!==a[b].current?(c.push({ctx:a[b].current,axis:b}),void 0):void 0}),c},_removeClasses:function(a,c){var d=[];return b.each(c.__keys__,function(e){var f=c[e];b.each(f.contexts,function(c){if(c.name!==f.current){var e,g=this._contextSpec({axis:f.ID,ctx:c.name},a);void 0!==g&&void 0!==g["class"]&&(e=g["class"].split(" "),void 0!==e&&(d=b.union(d,e)))}},this)},this),d},_contextConfig:function(a,b){return this._resolveSpecs(this._currentContexts(b),a,b)},_makeChanges:function(c,d,e){if(b.isEmpty(e)===!1){var f=this._contextConfig(d,e);b.each(f,function(f,g){if("move"===g)(d.__placement__!==f.placement||d.__move__!==f.value)&&(a(f.value)[f.placement](c),d.__placement__=f.placement,d.__move__=f.value);else if("class"===g){var h=c.attr("class")||"";h=b.union(f,b.difference(h.split(" "),this._removeClasses(d,e))),c.attr("class",h.join(" "))}else c.attr(g,f)},this)}return c},_respond:function(c,d){d.each(b.bind(function(b,d){var e=a(d.elm);this._makeChanges(e,d.spec,c),e.trigger("intent",this)},this))},_contextualize:function(a,b,c){return c[a].current=b,c},_axis_test_pattern:new RegExp("^_[a-zA-Z0-9]"),_axis_match_pattern:new RegExp("^_([a-zA-Z0-9][_a-zA-Z0-9]*)"),_trim_pattern:new RegExp("^s+|s+$","g")},c});
/*!
 *  Sharrre.com - Make your sharing widget!
 *  Version: beta 1.3.5
 *  Author: Julien Hany
 *  License: MIT http://en.wikipedia.org/wiki/MIT_License or GPLv2 http://en.wikipedia.org/wiki/GNU_General_Public_License
 */

// "djadj" noted below


define('article.app/jquerySharrre', [
  'vendor.asset.jquery/jquery'
], function (jQuery){

  (function ( $, window, document, undefined ) {

    /* Defaults
       ================================================== */
    var pluginName = 'sharrre',
    defaults = {
      className: 'sharrre',
      share: {
        googlePlus: false,
        facebook: false,
        twitter: false,
        digg: false,
        delicious: false,
        stumbleupon: false,
        linkedin: false,
        pinterest: false
      },
      shareTotal: 0,
      template: '',
      title: '',
      url: document.location.href,
      text: document.title,
      urlCurl: 'sharrre.php',  //PHP script for google plus...
      count: {}, //counter by social network
      total: 0,  //total of sharing
      shorterTotal: true, //show total by k or M when number is to big
      enableHover: true, //disable if you want to personalize hover event with callback
      enableCounter: true, //disable if you just want use buttons
      enableTracking: false, //tracking with google analitycs
      hover: function(){}, //personalize hover event with this callback function
      hide: function(){}, //personalize hide event with this callback function
      click: function(){}, //personalize click event with this callback function
      render: function(){}, //personalize render event with this callback function
      buttons: {  //settings for buttons
        googlePlus : {  //http://www.google.com/webmasters/+1/button/
          url: '',  //if you need to personnalize button url
          urlCount: false,  //if you want to use personnalize button url on global counter
          size: 'medium',
          lang: 'en-US',
          annotation: ''
        },
        facebook: { //http://developers.facebook.com/docs/reference/plugins/like/
          url: '',  //if you need to personalize url button
          urlCount: false,  //if you want to use personnalize button url on global counter
          action: 'like',
          layout: 'button_count',
          width: '',
          send: 'false',
          faces: 'false',
          colorscheme: '',
          font: '',
          lang: 'en_US'
        },
        twitter: {  //http://twitter.com/about/resources/tweetbutton
          url: '',  //if you need to personalize url button
          urlCount: false,  //if you want to use personnalize button url on global counter
          count: 'horizontal',
          hashtags: '',
          //note DJ-custom here:
          via: 'WSJ',
          related: '',
          lang: 'en'
        },
        digg: { //http://about.digg.com/downloads/button/smart
          url: '',  //if you need to personalize url button
          urlCount: false,  //if you want to use personnalize button url on global counter
          type: 'DiggCompact'
        },
        delicious: {
          url: '',  //if you need to personalize url button
          urlCount: false,  //if you want to use personnalize button url on global counter
          size: 'medium' //medium or tall
        },
        stumbleupon: {  //http://www.stumbleupon.com/badges/
          url: '',  //if you need to personalize url button
          urlCount: false,  //if you want to use personnalize button url on global counter
          layout: '1'
        },
        linkedin: {  //http://developer.linkedin.com/plugins/share-button
          url: '',  //if you need to personalize url button
          urlCount: false,  //if you want to use personnalize button url on global counter
          counter: ''
        },
        pinterest: { //http://pinterest.com/about/goodies/
          url: '',  //if you need to personalize url button
          media: '',
          description: '',
          layout: 'horizontal'
        },
        tumblr: {
          url: ''
        },
        email: {
          url: ''
        }
      }
    },
    /* Json URL to get count number
       ================================================== */
    urlJson = {
      googlePlus: "",

      //new FQL method by Sire
      facebook: "https://graph.facebook.com/fql?q=SELECT%20url,%20normalized_url,%20share_count,%20like_count,%20comment_count,%20total_count,commentsbox_count,%20comments_fbid,%20click_count%20FROM%20link_stat%20WHERE%20url=%27{url}%27&callback=?",
      //old method facebook: "http://graph.facebook.com/?id={url}&callback=?",
      //facebook : "http://api.ak.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={url}&format=json"

      twitter: "http://cdn.api.twitter.com/1/urls/count.json?url={url}&callback=?",
      digg: "http://services.digg.com/2.0/story.getInfo?links={url}&type=javascript&callback=?",
      delicious: 'http://feeds.delicious.com/v2/json/urlinfo/data?url={url}&callback=?',
      //stumbleupon: "http://www.stumbleupon.com/services/1.01/badge.getinfo?url={url}&format=jsonp&callback=?",
      stumbleupon: "",
      linkedin: "http://www.linkedin.com/countserv/count/share?format=jsonp&url={url}&callback=?",
      pinterest: "http://api.pinterest.com/v1/urls/count.json?url={url}&callback=?"
    },
    /* Load share buttons asynchronously
       ================================================== */
    loadButton = {
      googlePlus : function(self){
        var sett = self.options.buttons.googlePlus;
        //$(self.element).find('.buttons').append('<div class="button googleplus"><g:plusone size="'+self.options.buttons.googlePlus.size+'" href="'+self.options.url+'"></g:plusone></div>');
        $(self.element).find('.buttons').append('<div class="button googleplus"><div class="g-plusone" data-size="'+sett.size+'" data-href="'+(sett.url !== '' ? sett.url : self.options.url)+'" data-annotation="'+sett.annotation+'"></div></div>');
        window.___gcfg = {
          lang: self.options.buttons.googlePlus.lang
        };
        var loading = 0;
        if(typeof gapi === 'undefined' && loading == 0){
          loading = 1;
          (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = '//apis.google.com/js/plusone.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
          })();
        }
        else{
          gapi.plusone.go();
        }
      },
      facebook : function(self){
        var sett = self.options.buttons.facebook;
        $(self.element).find('.buttons').append('<div class="button facebook"><div id="fb-root"></div><div class="fb-like" data-href="'+(sett.url !== '' ? sett.url : self.options.url)+'" data-send="'+sett.send+'" data-layout="'+sett.layout+'" data-width="'+sett.width+'" data-show-faces="'+sett.faces+'" data-action="'+sett.action+'" data-colorscheme="'+sett.colorscheme+'" data-font="'+sett.font+'" data-via="'+sett.via+'"></div></div>');
        var loading = 0;
        if(typeof FB === 'undefined' && loading == 0){
          loading = 1;
          (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = '//connect.facebook.net/'+sett.lang+'/all.js#xfbml=1';
            fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));
        }
        else{
          FB.XFBML.parse();
        }
      },
      twitter : function(self){
        var sett = self.options.buttons.twitter;
        $(self.element).find('.buttons').append('<div class="button twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-url="'+(sett.url !== '' ? sett.url : self.options.url)+'" data-count="'+sett.count+'" data-text="'+self.options.text+'" data-via="'+sett.via+'" data-hashtags="'+sett.hashtags+'" data-related="'+sett.related+'" data-lang="'+sett.lang+'">Tweet</a></div>');
        var loading = 0;
        if(typeof twttr === 'undefined' && loading == 0){
          loading = 1;
          (function() {
            var twitterScriptTag = document.createElement('script');
            twitterScriptTag.type = 'text/javascript';
            twitterScriptTag.async = true;
            twitterScriptTag.src = '//platform.twitter.com/widgets.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(twitterScriptTag, s);
          })();
        }
        else{
          $.ajax({ url: '//platform.twitter.com/widgets.js', dataType: 'script', cache:true}); //http://stackoverflow.com/q/6536108
        }
      },
      digg : function(self){
        var sett = self.options.buttons.digg;
        $(self.element).find('.buttons').append('<div class="button digg"><a class="DiggThisButton '+sett.type+'" rel="nofollow external" href="http://digg.com/submit?url='+encodeURIComponent((sett.url !== '' ? sett.url : self.options.url))+'"></a></div>');
        var loading = 0;
        if(typeof __DBW === 'undefined' && loading == 0){
          loading = 1;
          (function() {
            var s = document.createElement('SCRIPT'), s1 = document.getElementsByTagName('SCRIPT')[0];
            s.type = 'text/javascript';
            s.async = true;
            s.src = '//widgets.digg.com/buttons.js';
            s1.parentNode.insertBefore(s, s1);
          })();
        }
      },
      delicious : function(self){
        if(self.options.buttons.delicious.size == 'tall'){//tall
          var css = 'width:50px;',
          cssCount = 'height:35px;width:50px;font-size:15px;line-height:35px;',
          cssShare = 'height:18px;line-height:18px;margin-top:3px;';
        }
        else{//medium
          var css = 'width:93px;',
          cssCount = 'float:right;padding:0 3px;height:20px;width:26px;line-height:20px;',
          cssShare = 'float:left;height:20px;line-height:20px;';
        }
        var count = self.shorterTotal(self.options.count.delicious);
        if(typeof count === "undefined"){
          count = 0;
        }
        $(self.element).find('.buttons').append(
          '<div class="button delicious"><div style="'+css+'font:12px Arial,Helvetica,sans-serif;cursor:pointer;color:#666666;display:inline-block;float:none;height:20px;line-height:normal;margin:0;padding:0;text-indent:0;vertical-align:baseline;">'+
            '<div style="'+cssCount+'background-color:#fff;margin-bottom:5px;overflow:hidden;text-align:center;border:1px solid #ccc;border-radius:3px;">'+count+'</div>'+
            '<div style="'+cssShare+'display:block;padding:0;text-align:center;text-decoration:none;width:50px;background-color:#7EACEE;border:1px solid #40679C;border-radius:3px;color:#fff;">'+
            '<img src="http://www.delicious.com/static/img/delicious.small.gif" height="10" width="10" alt="Delicious" /> Add</div></div></div>');

        $(self.element).find('.delicious').on('click', function(){
          self.openPopup('delicious');
        });
      },
      stumbleupon : function(self){
        var sett = self.options.buttons.stumbleupon;
        $(self.element).find('.buttons').append('<div class="button stumbleupon"><su:badge layout="'+sett.layout+'" location="'+(sett.url !== '' ? sett.url : self.options.url)+'"></su:badge></div>');
        var loading = 0;
        if(typeof STMBLPN === 'undefined' && loading == 0){
          loading = 1;
          (function() {
            var li = document.createElement('script');li.type = 'text/javascript';li.async = true;
            li.src = '//platform.stumbleupon.com/1/widgets.js';
            var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(li, s);
          })();
          s = window.setTimeout(function(){
            if(typeof STMBLPN !== 'undefined'){
              STMBLPN.processWidgets();
              clearInterval(s);
            }
          },500);
        }
        else{
          STMBLPN.processWidgets();
        }
      },
      linkedin : function(self){
        var sett = self.options.buttons.linkedin;
        $(self.element).find('.buttons').append('<div class="button linkedin"><script type="in/share" data-url="'+(sett.url !== '' ? sett.url : self.options.url)+'" data-counter="'+sett.counter+'"></script></div>');
        var loading = 0;
        if(typeof window.IN === 'undefined' && loading == 0){
          loading = 1;
          (function() {
            var li = document.createElement('script');li.type = 'text/javascript';li.async = true;
            li.src = '//platform.linkedin.com/in.js';
            var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(li, s);
          })();
        }
        else{
          window.IN.init();
        }
      },
      pinterest : function(self){
        var sett = self.options.buttons.pinterest;
        $(self.element).find('.buttons').append('<div class="button pinterest"><a href="http://pinterest.com/pin/create/button/?url='+(sett.url !== '' ? sett.url : self.options.url)+'&media='+sett.media+'&description='+sett.description+'" class="pin-it-button" count-layout="'+sett.layout+'">Pin It</a></div>');

        (function() {
          var li = document.createElement('script');li.type = 'text/javascript';li.async = true;
          li.src = '//assets.pinterest.com/js/pinit.js';
          var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(li, s);
        })();
      }
    },
    /* Tracking for Google Analytics
       ================================================== */
    tracking = {
      googlePlus: function(){},
      facebook: function(){
        //console.log('facebook');
        fb = window.setInterval(function(){
          if (typeof FB !== 'undefined') {
            FB.Event.subscribe('edge.create', function(targetUrl) {
              _gaq.push(['_trackSocial', 'facebook', 'like', targetUrl]);
            });
            FB.Event.subscribe('edge.remove', function(targetUrl) {
              _gaq.push(['_trackSocial', 'facebook', 'unlike', targetUrl]);
            });
            FB.Event.subscribe('message.send', function(targetUrl) {
              _gaq.push(['_trackSocial', 'facebook', 'send', targetUrl]);
            });
            //console.log('ok');
            clearInterval(fb);
          }
        },1000);
      },
      twitter: function(){
        //console.log('twitter');
        tw = window.setInterval(function(){
          if (typeof twttr !== 'undefined') {
            twttr.events.bind('tweet', function(event) {
              if (event) {
                _gaq.push(['_trackSocial', 'twitter', 'tweet']);
              }
            });
            //console.log('ok');
            clearInterval(tw);
          }
        },1000);
      },
      digg: function(){
        //if somenone find a solution, mail me !
        /*$(this.element).find('.digg').on('click', function(){
          _gaq.push(['_trackSocial', 'digg', 'add']);
          });*/
      },
      delicious: function(){},
      stumbleupon: function(){},
      linkedin: function(){
        function LinkedInShare() {
          _gaq.push(['_trackSocial', 'linkedin', 'share']);
        }
      },
      pinterest: function(){
        //if somenone find a solution, mail me !
      }
    },
    /* Popup for each social network
       ================================================== */
    popup = {
      googlePlus: function (opt) {
        //djadj here:
        window.open("https://plus.google.com/share?hl=" + opt.buttons.googlePlus.lang + "&url=" + encodeURIComponent((opt.buttons.googlePlus.url !== '' ? opt.buttons.googlePlus.url : opt.url)), "", "toolbar=0, status=0, width=550, height=700");
      },
      facebook: function (opt) {
        //djadj here:
        window.open("http://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent((opt.buttons.facebook.url !== '' ? opt.buttons.facebook.url : opt.url)) + "&t=" + opt.text + "", "", "toolbar=0, status=0, width=550, height=500");
      },
      twitter: function (opt) {
        window.open("https://twitter.com/intent/tweet?text=" + encodeURIComponent(opt.text) + "&url=" + encodeURIComponent((opt.buttons.twitter.url !== '' ? opt.buttons.twitter.url : opt.url)) + (opt.buttons.twitter.via !== '' ? '&via=' + opt.buttons.twitter.via : ''), "", "toolbar=0, status=0, width=550, height=500");
      },
      digg: function (opt) {
        window.open("http://digg.com/tools/diggthis/submit?url=" + encodeURIComponent((opt.buttons.digg.url !== '' ? opt.buttons.digg.url : opt.url)) + "&title=" + opt.text + "&related=true&style=true", "", "toolbar=0, status=0, width=650, height=360");
      },
      delicious: function (opt) {
        window.open('http://www.delicious.com/save?v=5&noui&jump=close&url=' + encodeURIComponent((opt.buttons.delicious.url !== '' ? opt.buttons.delicious.url : opt.url)) + '&title=' + opt.text, 'delicious', 'toolbar=no,width=550,height=550');
      },
      stumbleupon: function (opt) {
        window.open('http://www.stumbleupon.com/badge/?url=' + encodeURIComponent((opt.buttons.stumbleupon.url !== '' ? opt.buttons.stumbleupon.url : opt.url)), 'stumbleupon', 'toolbar=no,width=550,height=550');
      },
      linkedin: function (opt) {
        window.open('https://www.linkedin.com/cws/share?url=' + encodeURIComponent((opt.buttons.linkedin.url !== '' ? opt.buttons.linkedin.url : opt.url)) + '&token=&isFramed=true', 'linkedin', 'toolbar=no,width=550,height=550');
      },
      pinterest: function (opt) {
        window.open('http://pinterest.com/pin/create/button/?url=' + encodeURIComponent((opt.buttons.pinterest.url !== '' ? opt.buttons.pinterest.url : opt.url)) + '&media=' + encodeURIComponent((opt.buttons.media !== '' ? opt.buttons.media : opt.url)) + '&description=' + opt.buttons.description, 'pinterest', 'toolbar=no,width=700,height=300');
      },
      tumblr: function (opt) {
        window.open('http://www.tumblr.com/share?v=3&u=' + encodeURIComponent((opt.buttons.tumblr.url !== '' ? opt.buttons.tumblr.url : opt.url)), 'tumblr', 'toolbar=no,width=550,height=550');
      },
      email: function (opt) {
        window.open('mailto:?body=' + (opt.buttons.email.url !== '' ? opt.buttons.email.url : opt.url) + '&subject=' + opt.text, 'email', 'toolbar=no,width=550,height=550');
      }
    };

    /* Plugin constructor
       ================================================== */
    function Plugin( element, options ) {
      this.element = element;

      this.options = $.extend( true, {}, defaults, options);
      this.options.share = options.share; //simple solution to allow order of buttons

      this._defaults = defaults;
      this._name = pluginName;

      this.init();
    };

    /* Initialization method
       ================================================== */
    Plugin.prototype.init = function () {
      var self = this;
      if(this.options.urlCurl !== ''){
        urlJson.googlePlus = this.options.urlCurl + '?url={url}&type=googlePlus'; // PHP script for GooglePlus...
        urlJson.stumbleupon = this.options.urlCurl + '?url={url}&type=stumbleupon'; // PHP script for Stumbleupon...
      }
      $(this.element).addClass(this.options.className); //add class

      //HTML5 Custom data
      if(typeof $(this.element).data('title') !== 'undefined'){
        this.options.title = $(this.element).attr('data-title');
      }
      if(typeof $(this.element).data('url') !== 'undefined'){
        this.options.url = $(this.element).data('url');
      }
      if(typeof $(this.element).data('text') !== 'undefined'){
        this.options.text = $(this.element).data('text');
      }

      //how many social website have been selected
      $.each(this.options.share, function(name, val) {
        if(val === true){
          self.options.shareTotal ++;
        }
      });

      if(self.options.enableCounter === true){  //if for some reason you don't need counter
        //get count of social share that have been selected
        $.each(this.options.share, function(name, val) {
          if(val === true){
            //self.getSocialJson(name);
            try {
              self.getSocialJson(name);
            } catch(e){
            }
          }
        });
      }
      else if(self.options.template !== ''){  //for personalized button (with template)
        this.options.render(this, this.options);
      }
      else{ // if you want to use official button like example 3 or 5
        this.loadButtons();
      }

      //add hover event
      $(this.element).hover(function(){
        //load social button if enable and 1 time
        if($(this).find('.buttons').length === 0 && self.options.enableHover === true){
          self.loadButtons();
        }
        self.options.hover(self, self.options);
      }, function(){
        self.options.hide(self, self.options);
      });

      //click event
      $(this.element).click(function(){
        self.options.click(self, self.options);
        return false;
      });
    };

    /* loadButtons methode
       ================================================== */
    Plugin.prototype.loadButtons = function () {
      var self = this;
      $(this.element).append('<div class="buttons"></div>');
      $.each(self.options.share, function(name, val) {
        if(val == true){
          loadButton[name](self);
          if(self.options.enableTracking === true){ //add tracking
            tracking[name]();
          }
        }
      });
    };

    /* getSocialJson methode
       ================================================== */
    Plugin.prototype.getSocialJson = function (name) {
      var self = this,
      count = 0,
      url = urlJson[name].replace('{url}', encodeURIComponent(this.options.url));
      if(this.options.buttons[name].urlCount === true && this.options.buttons[name].url !== ''){
        url = urlJson[name].replace('{url}', this.options.buttons[name].url);
      }
      //console.log('name : ' + name + ' - url : '+url); //debug
      if(url != '' && self.options.urlCurl !== ''){  //urlCurl = '' if you don't want to used PHP script but used social button
        $.getJSON(url, function(json){
          if(typeof json.count !== "undefined"){  //GooglePlus, Stumbleupon, Twitter, Pinterest and Digg
            var temp = json.count + '';
            temp = temp.replace('\u00c2\u00a0', '');  //remove google plus special chars
            count += parseInt(temp, 10);
          }
	  //get the FB total count (shares, likes and more)
          else if(json.data && json.data.length > 0 && typeof json.data[0].total_count !== "undefined"){ //Facebook total count
            count += parseInt(json.data[0].total_count, 10);
          }
          else if(typeof json[0] !== "undefined"){  //Delicious
            count += parseInt(json[0].total_posts, 10);
          }
          else if(typeof json[0] !== "undefined"){  //Stumbleupon
          }
          self.options.count[name] = count;
          self.options.total += count;
          self.renderer();
          self.rendererPerso();
          //console.log(json); //debug
        })
          .error(function() {
            self.options.count[name] = 0;
            self.rendererPerso();
          });
      }
      else{
        self.renderer();
        self.options.count[name] = 0;
        self.rendererPerso();
      }
    };

    /* launch render methode
       ================================================== */
    Plugin.prototype.rendererPerso = function () {
      //check if this is the last social website to launch render
      var shareCount = 0;
      for (e in this.options.count) { shareCount++; }
      if(shareCount === this.options.shareTotal){
        this.options.render(this, this.options);
      }
    };

    /* render methode
       ================================================== */
    Plugin.prototype.renderer = function () {
      var total = this.options.total,
      template = this.options.template;
      if(this.options.shorterTotal === true){  //format number like 1.2k or 5M
        total = this.shorterTotal(total);
      }

      if(template !== ''){  //if there is a template
        template = template.replace('{total}', total);
        $(this.element).html(template);
      }
      else{ //template by defaults
        $(this.element).html(
          '<div class="box"><a class="count" href="#">' + total + '</a>' +
            (this.options.title !== '' ? '<a class="share" href="#">' + this.options.title + '</a>' : '') +
            '</div>'
        );
      }
    };

    /* format total numbers like 1.2k or 5M
       ================================================== */
    Plugin.prototype.shorterTotal = function (num) {
      if (num >= 1e6){
        num = (num / 1e6).toFixed(2) + "M"
      } else if (num >= 1e3){
        num = (num / 1e3).toFixed(1) + "k"
      }
      return num;
    };

    /* Methode for open popup
       ================================================== */
    Plugin.prototype.openPopup = function (site) {
      popup[site](this.options);  //open
      if(this.options.enableTracking === true){ //tracking!
        var tracking = {
          googlePlus: {site: 'Google', action: '+1'},
          facebook: {site: 'facebook', action: 'like'},
          twitter: {site: 'twitter', action: 'tweet'},
          digg: {site: 'digg', action: 'add'},
          delicious: {site: 'delicious', action: 'add'},
          stumbleupon: {site: 'stumbleupon', action: 'add'},
          linkedin: {site: 'linkedin', action: 'share'},
          pinterest: {site: 'pinterest', action: 'pin'}
        };
        _gaq.push(['_trackSocial', tracking[site].site, tracking[site].action]);
      }
    };

    /* Methode for add +1 to a counter
       ================================================== */
    Plugin.prototype.simulateClick = function () {
      var html = $(this.element).html();
      $(this.element).html(html.replace(this.options.total, this.options.total+1));
    };

    /* Methode for add +1 to a counter
       ================================================== */
    Plugin.prototype.update = function (url, text) {
      if(url !== ''){
        this.options.url = url;
      }
      if(text !== ''){
        this.options.text = text;
      }
    };

    /* A really lightweight plugin wrapper around the constructor, preventing against multiple instantiations
       ================================================== */
    $.fn[pluginName] = function ( options ) {
      var args = arguments;
      if (options === undefined || typeof options === 'object') {
        return this.each(function () {
          if (!$.data(this, 'plugin_' + pluginName)) {
            $.data(this, 'plugin_' + pluginName, new Plugin( this, options ));
          }
        });
      } else if (typeof options === 'string' && options[0] !== '_' && options !== 'init') {
        return this.each(function () {
          var instance = $.data(this, 'plugin_' + pluginName);
          if (instance instanceof Plugin && typeof instance[options] === 'function') {
            instance[options].apply( instance, Array.prototype.slice.call( args, 1 ) );
          }
        });
      }
    };

  })(jQuery, window, document);

});


/*
 * This file takes care of misc
 * inset related problems
 *
 *
 * fix conflicts
 * between right rail and certain inset shapes
 *
 * in 12 units and 16 units
 * the right rail modules
 * can collide with new insets
 *
 * as a result we need to hack
 * them to 'appear' as other inset sizes
 *
 */

define('article.app/insets',
       ['vendor.asset.jquery/jquery',
         'vendor.asset.underscore/underscore',
         'article.app/context'
       ],
       function ($, _, intent) {
  var insetModule = {
      options: {},
      init: function (options) {
        var self = this;

        // call this initially
        // should not be in document.ready
        // because it didnt work wll when accessing page
        // with back button
        self.fixInsetConflicts();
        self.setBleedSizes();

        intent.onInit(function () {
          self.fixInsetConflicts();
          self.setBleedSizes();
          self.fixImages();
        });

        $(window).on('resize', function(){
          self.fixInsetConflicts();
          self.setBleedSizes();
        });

        intent.on('width:', function () {
          self.fixInsetConflicts();
          self.setBleedSizes();
          self.fixImages();
        });
      },
      fixImages: function () {

        // For now we need to check and correct
        // ratios of images

        var images = $(".image-container.responsive-media"),
            breakPoint = intent.axes.width.current;


        $.each(images, function(idx, img){
          img = $(img);
          var ratio = img.attr("data-layout-ratio");

          if(breakPoint === "at4units"){
            ratio = img.attr("data-mobile-ratio");
          }

          img.css({
            "padding-bottom": ratio
          });

          img.find("img").on("load", function(){
            img.addClass("loaded");
          });

        });
      },
      fixInsetConflicts: function() {
        var self = this,
            insets = self.gatherInsets(),
            conflictModule = $("#ad_and_popular"),
            cuttOff = conflictModule.length ? conflictModule.offset().top + conflictModule.outerHeight() : 0,
            contextCheck = /12|16/.test(intent.axes.width.current);

        _.each(insets, function(inset){

          var originalLayout = inset.attr("data-layout"),
              targetLayout = (originalLayout === "margin") ? "wrap" : "inline";

          if(inset.offset().top < cuttOff && contextCheck){
            inset
              .removeClass(originalLayout)
              .addClass(targetLayout);
          }
          else{
            inset
              .removeClass(targetLayout)
              .addClass(originalLayout);
          }
        });
      },
      gatherInsets: function() {

        // return jquery elms for
        // problematic inset sizes

        var problemSizes = /offset|margin|bleed/;

        return _.filter(_.map($(".media-object"), function(inset){
          return $(inset);
        }), function(inset){
          return problemSizes.test(inset.attr("data-layout"));
        });
      },
      setBleedSizes: _.throttle(function(style){

        // HACK ATTACK: brute force to make the bleed insets
        // work outside the grid

        var articleW = $("#wsj-article-wrap").width(),
            winW = $(window).width(),
            marginLeft = (winW - articleW - 40) / -2,
            width = winW - 40,
            contextCheck = /8/.test(intent.axes.width.current);

        // make this work for 8 units

        $(".bleed-styles").remove();

        if(contextCheck){
          $("head").append("<style class='bleed-styles'>." + intent.axes.width.current + " .media-object.bleed{margin-left:" + marginLeft + "px;width:" + width + "px;}</style>");
        }

      }, 200)
    };

  return insetModule;
});

//TODO: This file needs cleanup/work -- Chaun had to do it last minute. I turned off the appending of the fonts
//on to the iframe's DOM. -- bedella

define('article.app/content/scripts/sponsored-links', [
  'article.app/context',
  'vendor.asset.jquery/jquery'
], function(intent, $) {

  var sponsoredLinkModule = {

    init: function() {

      var sponsoredIframeHead;
      var iframeLoadTriggered = null;

      var css = {
        openStyle:'<style class="sponsoredLinkCss" type="text/css">',
        closeStyle:'</script>',

        width16Unit:'html, body, #query, #ads { width:1260px; }',
        width12Unit:'html, body, #query, #ads { width:940px; }',
        width8Unit:'html, body, #query, #ads { width:620px; }',
        width4Unit:'html, body, #query, #ads { width:100%; }',

        query:'#query { padding-left:1px; border-top:1px solid black !important; border-bottom:1px solid black !important; ' +
        ' margin-bottom: 21px; font-size: 14px; font-family: "Whitney SSm", sans-serif; }',
        adBullet:'#ads li { color:7f7f7f; font-size:20px; line-height:60%; }',
        adFont:'#ads .resTitle b { font-size: 16px; font-family: "Chronicle SSm", serif;' +
        'color:#0080c3; font-weight:400; }',
        adUnderline: '#ads .resTitle a:hover { color:#0080c3; text-decoration:underline; }',

        ad16and12and8Unit:'#ads li { margin-left:22px; margin-right:20px; margin-bottom:0px; width:278px;}' +
        '#ads li .details * { overflow:inherit;}' +
        '#ads li .details { height:32px; }',
        ad4Unit:'#ads li { margin-bottom:15px; width:100%; }',

        //bad alternative solution for ie8
        adMarginRight16Unit: '#ads li:first-child + li + li + li,' +
          ' #ads li:first-child + li + li + li + li + li + li + li { margin-right:0px }',
        adMarginRight12Unit: '#ads li:first-child + li + li,' +
          ' #ads li:first-child + li + li + li + li + li,' +
          ' #ads li:first-child + li + li + li + li + li + li + li + li { margin-right:0px }',
        adMarginRight8Unit: '#ads li:first-child + li,' +
          '#ads li:first-child + li,' +
          '#ads li:first-child + li + li + li,' +
          '#ads li:first-child + li + li + li + li + li,' +
          '#ads li:first-child + li + li + li + li + li + li + li,' +
          '#ads li:first-child + li + li + li + li + li + li + li + li + li { margin-right:0px }',
      };

      $('.sponsored-links .chitikaAdBlock').load(function () {
        if (iframeLoadTriggered === null) {
          iframeLoadTriggered = true;
          iFrameCssLogic();
        }
      });

      function IframeLoaded () {
        if (iframeLoadTriggered === null) {
          if ($('.sponsored-links .chitikaAdBlock').contents().find("#refer_oo_text")[0]) {
            iframeLoadTriggered = false;
            iFrameCssLogic();
            return;
          }
        }
        else {
            return;
        }
        setTimeout(IframeLoaded, 100);
      }

      intent.onInit(function(){
        IframeLoaded();
      });

    // Functions called by this module:
    //TODO: Do we need to be doing this???
      function iFrameCssLogic() {
        sponsoredIframeHead = $('.sponsored-links .chitikaAdBlock').contents().find("head");
        // .append('<link rel="stylesheet" type="text/css" href="//fonts.wsj.net/HCo_Chronicle/font_HCo_Chronicle.css" />')
        // .append('<link rel="stylesheet" type="text/css" href="//fonts.wsj.net/HCo_Whitney/font_HCo_Whitney.css" />');
        initialLoadCss();
        intent.on('at16units', function() {
          removeIfCssExists();
          sponsoredLink16UnitCss();
        });
        intent.on('at12units', function() {
          removeIfCssExists();
          sponsoredLink12UnitCss();
        });
        intent.on('at8units', function() {
          removeIfCssExists();
          sponsoredLink8UnitCss();
        });
        intent.on('at4units', function() {
          removeIfCssExists();
          sponsoredLink4UnitCss();
        });
      }

      function initialLoadCss() {
        var articleBody = $("#article_body");
        if (articleBody.hasClass("at16units")) {
          sponsoredLink16UnitCss();
        }
        else if (articleBody.hasClass("at12units")) {
          sponsoredLink12UnitCss();
        }
        else if (articleBody.hasClass("at8units")) {
          sponsoredLink8UnitCss();
        }
        else if (articleBody.hasClass("at4units")) {
          sponsoredLink4UnitCss();
        }
      }

      function removeIfCssExists() {
        sponsoredIframeHead.children(".sponsoredLinkCss").remove();
      }
      function sponsoredLink16UnitCss() {
        sponsoredIframeHead.append(
          css.openStyle +
          css.width16Unit +
          css.query +
          css.adBullet +
          css.adFont +
          css.adUnderline +
          css.ad16and12and8Unit +
          css.adMarginRight16Unit +
          css.closeStyle);
      }
      function sponsoredLink12UnitCss() {
        sponsoredIframeHead.append(
          css.openStyle +
          css.width12Unit +
          css.query +
          css.adBullet +
          css.adFont +
          css.adUnderline +
          css.ad16and12and8Unit +
          css.adMarginRight12Unit +
          css.closeStyle);
      }
      function sponsoredLink8UnitCss() {
        sponsoredIframeHead.append(
          css.openStyle +
          css.width4Unit +
          css.query +
          css.adBullet +
          css.adFont +
          css.adUnderline +
          css.ad16and12and8Unit +
          css.adMarginRight8Unit +
          css.closeStyle);
      }
      function sponsoredLink4UnitCss() {
        sponsoredIframeHead.append(
          css.openStyle +
          css.width4Unit +
          css.query +
          css.adBullet +
          css.adFont +
          css.adUnderline +
          css.ad4Unit +
          css.closeStyle);
      }
    }
  };

  return {
    init: function() { $(sponsoredLinkModule.init); }
  };

});

/* global FrameMessenger */

define('article.app/embedded-graphics', [
  'vendor.asset.jquery/jquery',
  'article.app/context'
], function ($, intent) {

  //constant constructors
  function declareIggySizeConstant() {
    return {
      at16unit: {
        width: 700,
        height: 369,
        size: '&size=u16'
      },
      at12unitAnd8Unit: {
        width: 540,
        height: 369,
        size: '&size=u12'
      },
      at4unit: {
        width: 300,
        height: 200,
        size: '&size=u4'
      }
    };
  }
  function declareLayoutConstant() {
    return {
      inline: 'inline',
      margin: 'margin',
      wrap: 'wrap',
      offset: 'offset'
    };
  }
  //end of constant constructors

  function changeIggySize(iggies, suggestedIggySize, constIggySizes, constLayoutTypes) {
    for (var i = 0; i < iggies.length; i++) {
      var iggyLayout = iggies[i].iggyContainer.attr("data-layout");

      if (iggyLayout === '' || typeof iggyLayout === 'undefined') {
        if (iggies[i].iggyContainer.hasClass(constLayoutTypes.inline)) {
          iggyLayout = constLayoutTypes.inline;
        }
        else if (iggies[i].iggyContainer.hasClass(constLayoutTypes.margin)) {
          iggyLayout = constLayoutTypes.margin;
        }
        else if (iggies[i].iggyContainer.hasClass(constLayoutTypes.wrap)) {
          iggyLayout = constLayoutTypes.wrap;
        }
        else if (iggies[i].iggyContainer.hasClass(constLayoutTypes.offset)) {
          iggyLayout = constLayoutTypes.offset;
        }
      }

      if ( iggyLayout === constLayoutTypes.inline || iggyLayout === constLayoutTypes.offset ){
        iggies[i].iggy.attr("width", suggestedIggySize.width);
        iggies[i].iggy.attr("height", suggestedIggySize.height);
        iggies[i].iggy.attr("src", iggies[i].iggy.attr("data-src") + suggestedIggySize.size);
      }
      //including margin, wrap, and undefined
      else {
        iggies[i].iggy.attr("width", constIggySizes.at4unit.width);
        iggies[i].iggy.attr("height", constIggySizes.at4unit.height);
        iggies[i].iggy.attr("src", iggies[i].iggy.attr("data-src") + constIggySizes.at4unit.size);
      }
    }
  }

  function iggyInteractiveLogic() {
    var iggies = [];
    var media_objects = $('.media-object');

    media_objects.each( function(index) {
      var media_object = $(this),
          graphic = media_object.find(".iggy");

      if (graphic.length > 0 ) {
        iggies.push({
          iggyContainer: media_object,
          iggy: graphic
        });
      }
    });

    //now take care of iggies if they exist
    if (iggies.length > 0) {
      var constIggySizes = declareIggySizeConstant(),
          constLayoutTypes = declareLayoutConstant();

      intent.onInit(function(){
        var articleBody = $("#article_body"),
            initUnitSize;
        if (articleBody.hasClass("at16units") ) {
          initUnitSize = constIggySizes.at16unit;
        } else if (articleBody.hasClass("at12units") || articleBody.hasClass("at8units")) {
          initUnitSize = constIggySizes.at12unitAnd8Unit;
        } else if (articleBody.hasClass("at4units") ) {
          initUnitSize = constIggySizes.at4unit;
        }

        changeIggySize(iggies, initUnitSize, constIggySizes, constLayoutTypes);

        intent.on('at16units', function() {
          changeIggySize(iggies, constIggySizes.at16unit, constIggySizes, constLayoutTypes );
        });
        intent.on('at12units at8units', function() {
          changeIggySize(iggies, constIggySizes.at12unitAnd8Unit, constIggySizes, constLayoutTypes);
        });
        intent.on('at4units', function() {
          changeIggySize(iggies, constIggySizes.at4unit, constIggySizes, constLayoutTypes);
        });
      });
    }
  }

  var embeddedGraphics = {
    init: function () {
      var graphics = $('.wsj-interactive'),
          frame = FrameMessenger.parent();

      //Code that don't know if used
      frame.setActions( {
        dimension: changeDimensions,
        height: function(frameWindow, height) {
          changeDimensions(frameWindow, {
            width: "100%",
            height: height
          });
        }
      });
      function changeDimensions(frameWindow, data) {
        $.each(graphics, function(i, iframe){
          if(iframe.contentWindow === frameWindow) {
            $(iframe).height(data.height);
            $(iframe).width(data.width);
            return; // break the loop
          }
        });
      }
      //End code don't know if used

      // Notify IFrames
      $.each(graphics, function(i, iframe){
        try {
          if (iframe.contentWindow) {
            frame.act(iframe.contentWindow,'parentReady', 
                      {"height" : $(iframe).height(), "width" : $(iframe).width()}
                      );
          }
        }
        catch(e) {
          // ignore
        }
      });


      iggyInteractiveLogic();
    }
  };

  return embeddedGraphics;

});

define('article.app/stickyScroll', [
  'vendor.asset.jquery/jquery',
  'vendor.asset.underscore/underscore',
  'article.app/context'
], function ($, _, Intent) {

  function isIE () {
    var myNav = navigator.userAgent.toLowerCase();
    return (myNav.indexOf('msie') === -1) ? false : parseInt(myNav.split('msie')[1]);
  }

  function attachTrackData(elm){
    var newNavCompensation = 0;
    if (isNewNav){
      //height of the short new nav
      newNavCompensation = 65;
    }
    var offset = elm.offset(),
        top = offset.top - 15 - newNavCompensation,
        target = elm.children('.sticky_target'),
        targetHeight = target.height(),
        track = $('#' + elm.attr('data-track')),
        trackHeight = track.height(),
        trackEnd = trackHeight + top - targetHeight,
        absoluteTop = trackHeight - targetHeight,
        counter = elm.id;

    items[counter] = {
      top: top,
      target: target,
      trackEnd: trackEnd,
      absoluteTop: absoluteTop
    };
  }

  function setTrackState(item){
    if($('#article_body').hasClass('at12units') || $('#article_body').hasClass('at16units')) {

      var stickyElm = item.target,
          scrollDepth = $(window).scrollTop();

      if (scrollDepth >= item.top && scrollDepth < item.trackEnd) {
        stickyElm.addClass('sticky_fix');
        if (isNewNav) {
          stickyElm.addClass('sticky_fix_newnav');
        }
        stickyElm.css({
          position: '',
          top: ''
        });

      } else if (scrollDepth >= item.trackEnd) {

        stickyElm.css({
          position: 'absolute',
          top: item.absoluteTop
        });

      } else {

        stickyElm.removeClass('sticky_fix');

      }
    }
  }

  function removeStickiness(item){
    var stickyElm = item.target;
    stickyElm.attr('style','').removeClass('sticky_fix').removeClass('sticky_fix_newnav');
  }

  var tracks = [];
  var items = [];
  var isNewNav = false;

  var stickyScroll = {

    init: function () {

      // This breaks ie8
      if (isIE() && isIE() < 9) {
        return;
      }

      // block this code on touch devices
      if(Intent.axes.interaction.current === "touch"){
        $('.ad_col_a').css("height", "auto");
        return;
      }

      if ($('.mega-nav').length > 0) {
        isNewNav = true;
      }

      _.each($('.sticky_item'), function(track, index){
        tracks.push($(track));
        var current = tracks[index];
        current.id = index;
      });

      var attachAllTrackData = function() {
        _.each(tracks, attachTrackData);
      };

      var setAllTrackStates = function() {
        _.each(items, setTrackState);
      };

      var initializeTrackStates = function() {
        attachAllTrackData();
        setAllTrackStates();
      };

      var cancelSticky = function(){
        _.each(items, removeStickiness);
      };

      // as early as possible
      $(initializeTrackStates);
      // after all images and assets loaded
      $(window).on('load', initializeTrackStates);
      // anytime an ad renders
      $(window).on('wsj-ad-render', initializeTrackStates);
      // anytime text resizes
      $(window).on('wsj-text-resize', attachAllTrackData);

      // intention events
      Intent.on('width:at16units', initializeTrackStates);
      Intent.on('width:at12units', initializeTrackStates);

      // when to set classes
      var initializeOnScroll = _.throttle(initializeTrackStates, 1000);
      $(window).on('scroll', setAllTrackStates);
      $(window).on('scroll', initializeOnScroll);

      // when to cancel the stickiness
      Intent.on('width:at8units', cancelSticky);
      Intent.on('width:at4units', cancelSticky);

    }  //end of module init

  };

  return stickyScroll;

});




define('article.app/scrimBuilder', [
  'dj.responsive.resources/commonutils',
  'article.app/context',
  'article.app/sharetools',
  'article.app/textSize',
  'vendor.asset.jquery/jquery'
], function (utils, intent, Share, text, $) {
  var scrimBuilder = {
    init: function () {

      function buildHeader (type, header) {
        var scrimHeader;

        if (type === "author") {
          scrimHeader = '<h2 class="scrim-header author">' + header + '</h2>' +
                        '<h3 class="scrim-subhead">The Wall Street Journal</h3>';
        } else {
          scrimHeader = '<h2 class="scrim-header">' + header + '</h2>';
        }

        return scrimHeader;
      }

      function buildInfo (headline, timestamp, image) {

        var imgMarkup = '';

        if (image) {
          imgMarkup = '<img src="' + image + '" class="scrim-email-image"></div>';
        }

        var info = '<div class="scrim-info clearFix">' +
               '<h3 class="scrim-email-headline">' + headline + '</h3>' +
               '<h4 class="scrim-email-timestamp">' + timestamp + '</h4>';

        info += (imgMarkup !== '') ? imgMarkup : '</div>';

        return info;
      }

      function buildList (list, headline) {

        var scrimList = ['<ul class="scrim-list">'];

        $.each(list, function(idx, item){

          switch (item.type) {
            case "mailto":
              scrimList.push(
                '<a target="_blank" href="mailto:?subject=' + headline + '&amp;body=Here is something from WSJ.com that might interest you:%0D%0A%0D%0A'+headline+'%0D%0A'+item.url+'">' +
                '<li class="icon email">' + item.text + '</li>' +
                '</a>'
              );
              break;
            case "copy":
              scrimList.push(
                '<li class="icon ' + item.icon + '"><p>' + item.text + '</p></li>'
              );
              break;
            case "share":
              scrimList.push(
                '<li class="icon ' + item.icon + ' sharrre">' + item.text + '</li>'
              );
              break;
            case "option":
              scrimList.push(
                '<li class="icon option ' + item['class'] + '">' + item.text + '</li>'
              );
              break;
            case "link":
              scrimList.push(
                '<a target"_blank" href="' + item.url + '">' +
                '<li class="icon ' + item.icon + '">' + item.text + '</li>' +
                '</a>'
              );
              break;
            default:
              break;
          }

        });

        scrimList.push('</ul>');

        return scrimList.join("");
      }

      // Build scrim
      $.each($('.mobile-scrim'), function () {

        var handle = $(this),
            data = JSON.parse(handle.attr('data-scrim')),
            scrimInfo = '',
            scrimList;

        // if email scrim, build scrimInfo,
        // else just build scrimList
        if (data.type === 'email') {
          scrimInfo = buildInfo(data.info.headline, data.info.timestamp, data.info.image);
          scrimList = buildList(data.list, data.info.headline);
        } else {
          scrimList = buildList(data.list);
        }

        // combine scrim elements
        var scrimHeader = buildHeader(data.type, data.header),
            scrimBody = scrimHeader + scrimInfo + scrimList;

        // build scrim
        var scrim = [
          '<div class="scrim-overlay mobile" id="' + data.id + '">',
          '<div class="scrim">',
          scrimBody,
          '<button class="scrim-close">CLOSE</button>',
          '</div>',
          '</div>'
        ].join(" ");

        var scrimElm = $(scrim),
            closeButton = scrimElm.find(".scrim-close");

        // allow users to click in menu without closing menu
        handle.children('menu').on("touchend mouseup touchcancel", function(e) {
          e.stopPropagation();
        });

        // open menu/build scrim
        handle.on("touchend mouseup touchcancel", function(e) {

          e.stopPropagation();

          // if not at 4 units, do not append scrim, open menu if menu exists
          // else, append scrim, do not open menu
          if (!$('body').hasClass('at4units')) {
            if(!$(this).hasClass('open')) {
              $(this).addClass('open').siblings().removeClass('open').closest('.module').addClass('active');
            } else {
              $(this).removeClass('open').closest('.module').removeClass('active');
            }
          } else {

            $('body').append(scrimElm);
            $('.scrim-overlay').animate({opacity:1},200);

            if ($(this).hasClass('text-size')) {
              text.init();
            }

            if ($(this).hasClass('more')) {
              Share.init();
            }

            closeButton.on("touchend mouseup touchcancel", function(e){
              e.stopPropagation();
              scrimElm.animate({opacity:0}, 200, function () {
                scrimElm.detach();
              });
              return false;
            });
          }

          return false;

        });
      });

      // Remove scrim
      $('body').on('touchstart mouseup touchcancel', function() {
        $('.mobile-scrim').removeClass('open').closest('.module').removeClass('active');
      });

      function closeScrims () {
        $('.scrim-overlay').detach();
        $('.mobile-scrim').removeClass('open').closest('.module').removeClass('active');
      }

      intent.on('width:', closeScrims);

    }
  };
  // scrimBuilder.init();
  return scrimBuilder;
});

/* globals jQuery */
/*
 * Article Ads
 *
 * This script is only intended to handle
 * special ad requirements on the full article page
 *
 * It is not needed on the snippet/slideshow/experiential
 */


define('article.app/articleAds', [
  'vendor.asset.jquery/jquery',
  'article.app/context',
  "article.app/responsiveAds",
], function ($, intent, responsiveAds) {

  /**
   *  @method buildBodyAd
   *
   *  finds the pre existing wsj-main-article-ad div and returns its cloned/newly built content
   *
   *  TODO: Combine buildBodyAd, buildBodyRealtorAd, buildBodyRealtorSquareAd into one method
   */
  function buildBodyAd(){
    // creates a new ad based on the right rail ad
    // which we insert into the article body at 4 and 8 units
    var mainAd = $("#wsj-main-article-ad").find(".wsj-responsive-ad-wrap"),
      articleBodyAd;
    if(mainAd[0] && mainAd[0].outerHTML){
      articleBodyAd = $(mainAd[0].cloneNode());
    }
    else {
      return;
    }

    // make the id unique
    articleBodyAd.attr("id", "body-" + articleBodyAd.attr("id"));

    // give it a class for easy styling
    articleBodyAd.addClass("wsj-ad-article-body");

    var adId = responsiveAds.buildAd(articleBodyAd, {
      adSize: [[300,250]] // override the zones size
    }, {
      articleBody: true // ads a note in the ad targeting
    });

    return articleBodyAd;
  }

  /**
   *  @method buildBodyRealtorAd
   *
   *  finds the article_realtor_ad div and returns its cloned/newly built content
   *
   *  TODO: Combine buildBodyAd, buildBodyRealtorAd, buildBodyRealtorSquareAd into one method
   */
  function buildBodyRealtorAd(){
    //Creatre a new realtor Ad based opn the hidden realtor ad
    //Insert into the article body at all units

    var realtor = $(".article_realtor_ad");
    if (!realtor.hasClass("body_ad")) {
      return;
    }
    var realtorAd = realtor.find(".wsj-responsive-ad-wrap"),
        articleBodyRealtorAd;

    if(realtorAd[0] && realtorAd[0].outerHTML){
      articleBodyRealtorAd = $(realtorAd[0].cloneNode());
    }
    else {
      return;
    }

    // make the id unique
    articleBodyRealtorAd.attr("id", "body-" + articleBodyRealtorAd.attr("id"));

    // give it a class for easy styling
    articleBodyRealtorAd.addClass("wsj-ad-article-body-realtor");

    var adId = responsiveAds.buildAd(articleBodyRealtorAd, {
      adSize: [[700,82], [540,82]],
      adSizeMap: {
        "at8units": [[540,82]],
        "at12units": [[540,82]],
        "at16units": [[700,82]]
      }
    }, {
      articleBody: true // ads a note in the ad targeting
    });

    return articleBodyRealtorAd;

  }

  /**
   *  @method buildBodyRealtorAdSquare
   *
   *  finds the article_realtor_square_ad div and returns its cloned/newly built content
   *
   *  TODO: Combine buildBodyAd, buildBodyRealtorAd, buildBodyRealtorSquareAd into one method
   */
  function buildBodyRealtorAdSquare(){
    //Creatre a new realtor Ad based opn the hidden realtor ad
    //Insert into the article body at all units

    var realtor = $(".article_realtor_square_ad");
    if (!realtor.hasClass("body_ad")) {
      return;
    }

    var realtorAd = realtor.find(".wsj-responsive-ad-wrap"),
        articleBodyRealtorAd;
    if(realtorAd[0] && realtorAd[0].outerHTML){
      articleBodyRealtorAd = $(realtorAd[0].cloneNode());
    }
    else {
      return;
    }

    // make the id unique
    articleBodyRealtorAd.attr("id", "body-" + articleBodyRealtorAd.attr("id"));

    // give it a class for easy styling
    articleBodyRealtorAd.addClass("wsj-ad-article-body");

    var adId = responsiveAds.buildAd(articleBodyRealtorAd, {
      adSize: [[300,250]] // override the zones size
    }, {
      articleBody: true // ads a note in the ad targeting
    });

    return articleBodyRealtorAd;

  }


  /**
   *  @method insertAd
   *  @param {Object} bodyAd - the AD to be inserted in the body
   *  @param {Boolean} is12or16Unit
   *  @param {Boolean} isRealtorAd
   *
   *  Insert an AD into the paragraph.
   *  1) main body ad: insert based on 400px worth of paragraph height
   *  2) realtor ad 4 and 8 units: insert based on 200px or at least 2 paragraphs after the main body ad
   *  3) realtor ad 12 and 16 units: insert based on 600px of paragraph height
   *
   */
  function insertAd(bodyAd, is12or16Unit, isRealtorAd) {
    var articleWrap = $("#wsj-article-wrap"),
        paragraphs = articleWrap.children("p"),
        threshold = (is12or16Unit) ? 600 : 400,
        totalHeight = 0;

    var paragraphIndex;
    for (paragraphIndex = 0; paragraphIndex < paragraphs.length; paragraphIndex += 1) {
      totalHeight += $(paragraphs[paragraphIndex]).outerHeight();
      if (totalHeight >= threshold) {
        break;
      }
    }

    //at 12 or 16 units, needs to be after minimum of 5 paragraphs
    if (is12or16Unit && isRealtorAd && paragraphs.length < 5) {
      paragraphIndex = 5;
    }
    //at 4 and 8 units, realtor ads need to be 2 paragraphs after the Main Body Ad
    //or least 200 pixels
    if (!is12or16Unit && isRealtorAd && paragraphIndex + 2 < paragraphs.length) {
      var heightDifference = 0,
          i;

      for (i = paragraphIndex + 1; i < paragraphs.length; i += 1) {
        heightDifference += $(paragraphs[i]).outerHeight();
        if (heightDifference >= 200) {
          break;
        }
      }
      var indexDifference = i - paragraphIndex;
      if (indexDifference < 2) {
        paragraphIndex += 2 ;
      }
      else {
        paragraphIndex += indexDifference;
      }
    }

    //only insert if there are enough paragraphs
    if (paragraphIndex < paragraphs.length) {
      $(paragraphs[paragraphIndex]).after(bodyAd);
    }
    else {
      $(paragraphs[paragraphs.length - 1]).after(bodyAd);
    }
  }


  //***************************************
  //********Setting up ads section*********
  //***************************************
  /**
   *  @method setUpMainBodyAd
   *
   *  Constructor for the main body Ad
   *
   *  TODO: Combine setUpMainBodyAd, setUpRealtorBodyAd, setUpSquareRealtorBodyAd into one method
   */
  function setUpMainBodyAd() {
    // SET UP THE AD IN THE ARTICLE BODY
    var articleBodyAd = buildBodyAd();
    if(!articleBodyAd){
      return;
    }

    var adWrap = $("<div class='hide12 hide16 textAd'><div class='bodyAd'><div class='adSpec'><span>Advertisement</span></div></div></div>").append(articleBodyAd),
        id = articleBodyAd.attr("id");

    function handleBodyAd() {
      if(/4|8/.test(intent.axes.width.current)){
        insertAd(adWrap, false, false);
        responsiveAds.displayAd(id, true);
      }
    }

    intent.onInit(handleBodyAd);
    intent.on("width:", handleBodyAd);
  }

  /**
   *  @method setUpRealtorBodyAd
   *
   *  Constructor for the longer banner form of realtor body ad
   *
   *  TODO: Combine setUpMainBodyAd, setUpRealtorBodyAd, setUpSquareRealtorBodyAd into one method
   */
  function setUpRealtorBodyAd() {
    var realtorBodyAd = buildBodyRealtorAd();
    if(!realtorBodyAd){
      return;
    }

    // Tmp HACK Solution
    $(".article_realtor_ad").remove();

    var adWrap = $("<div class='hide4 textAd'><div class='realtorAd'><div class='adSpec'><span>Advertisement</span></div></div></div>").append(realtorBodyAd),
        id = realtorBodyAd.attr("id");

    function handleRealtorBodyAd() {
      if(/8/.test(intent.axes.width.current)){
        insertAd(adWrap, false, true);
        responsiveAds.displayAd(id, true);
      }
      else if (/12|16/.test(intent.axes.width.current)) {
        insertAd(adWrap, true, true);
        responsiveAds.displayAd(id, true);
      }
    }

    intent.onInit(handleRealtorBodyAd);
    intent.on("width:", handleRealtorBodyAd);
  }

  /**
   *  @method setUpSquareRealtorBodyAd
   *
   *  Constructor for the 300x250 form of realtor body ad
   *
   *  TODO: Combine setUpMainBodyAd, setUpRealtorBodyAd, setUpSquareRealtorBodyAd into one method
   */
  function setUpSquareRealtorBodyAd() {
    var realtorSquareBodyAd = buildBodyRealtorAdSquare();
    if(!realtorSquareBodyAd){
      return;
    }

    // Tmp HACK Solution
    $(".article_realtor_square_ad").remove();

    var adWrap = $("<div class='hide8 hide12 hide16 textAd'><div class='realtorAd'><div class='adSpec realtorAd'><span>Advertisement</span></div></div></div>").append(realtorSquareBodyAd),
        id = realtorSquareBodyAd.attr("id");

    function handleSquareRealtorBodyAd() {
      if(/4/.test(intent.axes.width.current)){
        insertAd(adWrap, false, true);
        responsiveAds.displayAd(id, true);
      }
    }

    intent.onInit(handleSquareRealtorBodyAd);
    intent.on("width:", handleSquareRealtorBodyAd);
  }
  //***************************************
  //*****End of setting up ads section*****
  //***************************************

  var articleAds = {
    init: function(){
      setUpRealtorBodyAd();
      setUpSquareRealtorBodyAd();
      setUpMainBodyAd();
    }
  };

  return articleAds;
});

define('article.app/wsjVideo', [
  'vendor.asset.jquery/jquery',
], function ($) {
    var wsjVideo = {
      init: function () {

      var $jQ111 = jQuery.noConflict();

      // WSJVIDEO //
      jQuery.fn.extend({
          WSJVideo: function (config) {
          "use strict";
          var self = $jQ111(this);
          var containerId = self.attr('id');
          var videoId = self.attr('id')+"_video"; 
          /*
          var callback;
          if(config.callback){
            callback = config.callback;
          }else{
            callback = self.attr('id')+"_video";
          }
          */
          var isAdvert = false;
          var endListener = false;
          var videoTag;
          var dataLoaded;
          var loadedData;
          var trackingMilestones = [false,false,false,false];
          var initTracked = false;
          var contentStartTracked = false;
          var pingMilestone = 0;
          var callback = containerId.replace(/[^a-zA-Z0-9]/g, '');
          var timer;
          var now = new Date();
          var start = new Date();
          var end;
          var second = 1000;
          var minute = second * 60;
          var hour = minute * 60;
          var day = hour * 24;
          var autoString;
          var protocol = "http://";
          var configLoaded = !("playerid" in config);
          var htmlControlsInstance;
          var contentInitialized = false;
          var adsLoaded = false;
          var imaLoaded = false;
          
          // functions //
          var setupThumbnail;
          var loadWSJMediaPlayer;
          var playVideo;
          var timeChange;
          var adComplete;
          var adSkipped;
          var adError;
          var adStarted;
          var complete;
          var initialized;
          var flashInitialized;
          var flashContentStarted;
          var flashStateChange;
          var contentStarted;
          var videoFail;
          var initHTML5;
          var swfObjectStatus, onJavaScriptBridgeCreated, videoProgress;
          var videoComplete, generateEndscreen, onEnded;
          var onPlaying, onPlay, onError, onPause, onBuffering, onCanPlay;
          var onAdStarted, onAdError, onPauseRequested, onResumeRequested, getAdTag, onAdsLoaded, onAdComplete, onNewVideo, onReplayVideo, onLoadedMetadataHtml, requestAd, onSkip, onAdClicked, onResize, onPlayerExitFullscreen; 
          var playVideoFromEndScreen, externalPlayVideo;
          var jsonReceived;
          var externalConfig;
          var fields = 'fields=video128kMP4Url,video174kMP4Url,video264kMP4Url,video464kMP4Url,video664kMP4Url,video1264kMP4Url,hls,adZone,thumbnailList,guid,state,secondsUntilStartTime,author,description,name,linkURL,videoStillURL,duration,videoURL,adCategory,catastrophic,linkShortURL,doctypeID,youtubeID,video320kMP4Url,titletag,rssURL,wsj-section,wsj-subsection,allthingsd-section,allthingsd-subsection,sm-section,sm-subsection,provider,formattedCreationDate,keywords,keywordsOmniture,column,editor,emailURL,emailPartnerID,showName,omnitureProgramName,omnitureVideoFormat,linkRelativeURL,omniturePublishDate&callback=?';
          var cast_api, chromecastReceivers, onReceiverList, cv_activity, statInt, chromecastVideo, currentMediaURL;
          var isInIframe = false;
          var moduleId;
          var chromecastCurrentTime = 0;
          
          // CHROMECAST //
          //var appId = '8D9EB2D1';
          var appId = '40356514'; // Production
          //var appId = chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID;
          var session = null;
          var currentMediaSession = null;
          var castAppName = "WSJ";
          // var castAppName = "testapp";
          var receiverAvailable = false;
          var mediaNamespace = 'urn:x-cast:com.wsj.video';
          
          // IMA3 //
          var adDisplayContainer;
          var adsContainerInit = false;
          
          var defaults = {
            height: $jQ111(this).height(),
            width: $jQ111(this).width(),
            autoplay: true,
            adsEnabled: true,
            shareEnabled: true,
            chainVideos:false,
            disableHtmlControls: false,
            api:"/api-video/",
            clickForSound: false,
            skynetEnable: false,
            skynetServer: "http://skynet-command-prod.elasticbeanstalk.com",
            skynetRecServer: "http://skynet-service-prod.elasticbeanstalk.com/",
            userUri: "http://system.marketwatch.com/user/anonymous/",
            resetOnComplete:false,
            type:"",
            query:"",
            contentType: "article",
            disableEndscreen:false,
            noThumb: false,
            larsId: "91",
            larsAdId: "1259",
            larsChrome: "1272",
            disableSeekBarThumbnails:true,
            allowFullScreen:true,
            adTag:'',
            useHttps:false,
            count:1,
            moduleId:"",
            disablePreroll:false,
            clickForSoundPreroll:false,
            adZone:"",
            collapseable:false,
            disableDVR:null,
            maxBitrateIndex:null,
            enableCaptions:true,
            loaderThumb:false,
            chromecastEnabled:true,
            disableAdSkipping:false,
            playlist:null,
            suggestionsType:"wsj-section",
            suggestionsQuery:"news",
            imaLibrary:"https://s0.2mdn.net/instream/html5/ima3.js",
            site:"",
            directLinks:false,
            relativeLinks:false
          };
          
          var comscoreC3 = "13047035";
          
          var player;
          var settings = $jQ111.extend(defaults, config);
          var playlist;
          var videodata;
          var prerollPlayed = false;
          var isLive = false;

          // ADS //
          var adsManager;
          var adsLoader;
          var videoElement; 

          var adDisplayContianer;
          var adData;
          var selectedReceiver;
          var chainTimer;
          var chainTime = 10;
          var chainKey;
          
          $jQ111(this).css("background-color","#000000");
          
          
          window.onerror = function(){ };
          try{
            if(settings.chromecastEnabled){
              if (chrome.cast && !chrome.cast.isAvailable) {
                setTimeout(initializeCastApi, 1000);
              }
            }
          }catch(e){}
          
          function initializeCastApi() {
            var sessionRequest = new chrome.cast.SessionRequest(appId);
            var apiConfig = new chrome.cast.ApiConfig(sessionRequest,
            sessionListener,
            receiverListener);
            chrome.cast.initialize(apiConfig, chromeOnInitSuccess, chromeOnError); 
          };
          
          function receiverListener(e) {
              if( e === 'available' ) {
              receiverAvailable = true;
            }
              else {
              receiverAvailable = false;
            }
            try{
              $jQ111('#'+videoId).trigger("receiverChanged", [receiverAvailable]);
              if(player)
                player.setReceiverAvailable(receiverAvailable); 
            }catch(e){}
            
          }
          
          function chromeOnInitSuccess() {
          }
          
          function chromeOnError(err) {
          }
          
          function sessionListener(e) {
            session = e;
            if (session.media.length != 0) {
            onMediaDiscovered('onRequestSessionSuccess_', session.media[0]);
            }
            session.addMediaListener(onMediaDiscovered.bind(this, 'addMediaListener'));
            session.addUpdateListener(sessionUpdateListener.bind(this));  
            session.addMessageListener(mediaNamespace, onChromeMessage);
          }
          
          function sessionUpdateListener(isAlive) {
            var message = isAlive ? 'Session Updated' : 'Session Removed';
            message += ': ' + session.sessionId;
            try{
              if (!isAlive) {
                session = null;
                player.chromecastSessionKilled();
              }
            }catch(e){}
          };
          
          function sendMsg() {
            if( !session ) 
              return;
          
            session.sendMessage(mediaNamespace, {data:'MESSAGE!!!', type:'status'}, function(){
                      
            },
            function(castError){});
          }
          
          function onMediaDiscovered(how, mediaSession) {
            currentMediaSession = mediaSession;
            mediaSession.addUpdateListener(onMediaStatusUpdate);
            chromecastCurrentTime = currentMediaSession.currentTime;
          }
          
          function onMediaError(e) {

          }
          
          function onMediaStatusUpdate(isAlive) {
            try{
              if(player && currentMediaSession){
                player.chromecastMessage({type:"progress", position:currentMediaSession.currentTime, duration:currentMediaSession.media.duration});
                player.chromecastMessage({type:"status", status:currentMediaSession.playerState});	
                var percent = currentMediaSession.currentTime / currentMediaSession.media.duration;
                if(currentMediaSession.media.duration > 0){
                  uProgress(percent,currentMediaSession.currentTime , false, true );
                }
              }
            }catch(e){}
            try{
              if(!isAlive || currentMediaSession.playerState == chrome.cast.media.PlayerState.IDLE){
                player.chromecastMediaEnded();
              }
            }catch(e){}
          }
          
          function launchApp() {
            chrome.cast.requestSession(onRequestSessionSuccess, onLaunchError);
          }

          function onRequestSessionSuccess(e) {
            session = e;
            session.addMessageListener(mediaNamespace, onChromeMessage);
            session.addMediaListener(onMediaDiscovered.bind(this, 'addMediaListener'));
              session.addUpdateListener(sessionUpdateListener.bind(this)); 
            try{
              $jQ111.ajax({
                  url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsChrome+"&guid={"+settings.guid+"}",
                  dataType: "jsonp"
            });}catch(e){}
            if(player){
                player.chromecastSessionStarted(e);
            }else{
              $jQ111('#'+videoId).trigger("chromecastSessionStarted", videodata);	
            }
          }
          
          function showChromeCastDisplay(){
            var chromeDisplay = '<div id="chromeDisplay">';
            $jQ111.each(videos, function(key, val) {
            //	thumbshtml += '<li class="video-archive'+exStyle+'" id="video_' + key + '">';
            //	thumbshtml += '<a class="endscreenThumb" rel="' + key + '">';
            //	thumbshtml += '<div class="playlistDescription"><div>'+val.name+'</div></div>';
            //	thumbshtml += '<img src=\"' + val.videoStillURL + '\" alt="' + val.name + '" /></a>';
            //	thumbshtml += "</li>";
            });
            thumbshtml += '</div>';
            //$jQ111('#playlist_'+videoId).css("height", settings.height);
            //$jQ111('#playlist_'+videoId).css("width", settings.width);
            $jQ111('#chromeDisplay').empty();
            $jQ111('#chromeDisplay').append(thumbshtml);
            $jQ111('.endscreenThumb').click(playVideoFromEndScreen);
            
            $jQ111('#playlist_'+videoId).fadeIn("slow");	
          }
          
          function onChromeMessage(event, data){
            var msg = JSON.parse(data);
            if(msg.type == "progress" && currentMediaSession){
                //var pct = parseInt(100 * currentMediaSession.currentTime / currentMediaSession.media.duration);
              player.chromecastMessage({type:"progress", position:currentMediaSession.currentTime, duration:currentMediaSession.media.duration});
            }
          }
          
          function onLaunchError(e) {

          }
          
          window['setReceiver'+callback] = function(idx, id, videoData) {
            if(id == "HomeDevice" && cv_activity != null){
              stopActivity();
            }else{
              selectedReceiver = chromecastReceivers[idx];
              chromecastVideo = videoData;
              for (var i=0;i<chromecastReceivers.length;i = i + 1){ 
                if(chromecastReceivers[i].id == id){
                  selectedReceiver = chromecastReceivers[i];
                  break;
                }
              }
              doLaunch(selectedReceiver, videoData);
            }
          };
          
          window['setChromeCastMedia'+callback] = function(idx, videoData) {
            if (!session) {
              return;
            }
            //currentMediaURL = videoData.hls;
            //currentMediaURL = "http://wsjvod-i.akamaihd-staging.net/i/video/20140129/012914hubamsochi/012914hubamsochi_v2_ec,464,174,264,664,1264,1864,2564,k.mp4.csmil/master.m3u8";
            currentMediaURL = videoData.vod[6];
            if(!currentMediaURL){
              try{
                player.chromecastSessionKilled();
                session.stop();
              }catch(e){}
            }else{
              var mediaInfo = new chrome.cast.media.MediaInfo(currentMediaURL);
              mediaInfo.contentType = 'video/mp4';
              mediaInfo.customData = videoData;
              var request = new chrome.cast.media.LoadRequest(mediaInfo);
              request.autoplay = true;
              session.loadMedia(request, onMediaDiscovered.bind(this, 'loadMedia'),onMediaError);
            }
          };
          
          window['setChromeCastChaining'+callback] = function(idx, videoData) {
            if (!session) {
              return;
            }
            session.sendMessage(mediaNamespace, {data:videoData, type:'chaining'}, function(){
            
            },
            function(castError){

            });
          };
          
          window['setChromeCastChainTime'+callback] = function(idx, time) {
            if (!session) {
              return;
            }
            session.sendMessage(mediaNamespace, {data:time, type:'chainingCount'}, function(){
          
            },
            function(castError){});
          };

          window['setChromeCastSeek'+callback] = function(idx, seekTime) {
            if(currentMediaSession){
              var request = new chrome.cast.media.SeekRequest();
              request.currentTime = seekTime;
              currentMediaSession.seek(request,
              function(e){}, // success 
              function(e){}); // error
            }
          };
          window['setChromeCastPlay'+callback] = function(idx) {
            if(currentMediaSession){
              //var req = new chrome.cast.media.PauseRequest();
              currentMediaSession.play(null,
                    function(e){},
                    function(e){});
            }
          };
          window['setChromeCastPause'+callback] = function(idx) {
            if(currentMediaSession){
              currentMediaSession.pause(null,
                    function(e){},
                    function(e){});
            }
          };
          
          onResize = function(evt){
            $jQ111('#playlist_'+videoId).css("height", "100%");
            $jQ111('#playlist_'+videoId).css("width", "100%");
            $jQ111("#"+videoId).css("height", "100%");
            $jQ111("#"+videoId).css("width", "100%");
            $jQ111(".wsj-videoplayer").css("height", "100%");
            $jQ111(".wsj-videoplayer").css("width", "100%");
            
            $jQ111("#adContainer").width($jQ111("#"+videoId).width());
            $jQ111("#adContainer").height($jQ111("#"+videoId).height() - 32);
            if(adsManager){
              adsManager.resize($jQ111("#"+videoId).width(), $jQ111("#"+videoId).height() - 32,google.ima.ViewMode.NORMAL);
            }
              
            /*
            var h = self.find( ".wsjvideo-video-player" ).height();
            var w = self.find( ".wsjvideo-video-player" ).width();
            if(h > 0){
              $jQ111("#"+videoId).width(w);
              $jQ111("#"+videoId).height(h);
              $jQ111("#adContainer").width(w);
              $jQ111("#adContainer").height(h - 32);
              if(adsManager){
                adsManager.resize(w, h - 32,google.ima.ViewMode.NORMAL);
              }
              $jQ111('#playlist_'+videoId).width(w);
              $jQ111('#playlist_'+videoId).height(h);
            }

            */
            try{
              $jQ111('#playlist_'+videoId).endScreen("update");
            }catch(e){}
          }
          
          $jQ111(document).bind('webkitfullscreenchange', function(e){ 
            onResize();
          });
          
          $jQ111(window).resize(function(){ 
            onResize(); 
          });

          $jQ111(document).on('pause_'+callback,function(e){ 
            adsManager.pause();
            if(videoTag)
              videoTag.pause();
            if(player)
              player.pauseVideo(); 
          });
          
          $jQ111(document).on('resume_'+callback,function(e){ 
            adsManager.pause();
            if(videoTag)
              videoTag.play();
            if(player)
              player.unpauseVideo(); 
          });
          
          $jQ111(document).on('playVideo_'+callback,function(e, data){ 
            externalPlayVideo(data);
          });


          // public methods
          this.getStatus = function(){
            var rtn = {status:"playing"};
            if(player){
              return player.getStatus();
            }else if(videoTag){
              return videoTag.paused;
            }
          }
          
          this.pauseVideo = function(){
            if(adsManager)
              adsManager.pause();
            if(videoTag)
              videoTag.pause();
            if(player)
              player.pauseVideo(); 
          }
          
          this.resumeVideo = function(){
            if(adsManager){
              adsManager.resume();
            }
            if(videoTag)
              videoTag.play();
            if(player)
              player.unpauseVideo(); 	
          }
          
          this.isPlaying = function(){
            var rtn = false;
            if(player){
              return player.isPlaying();
            }else if(videoTag){
              return videoTag.paused;
            }
          }
          
          this.updatePlaylist = function(pls){
            settings.playlist = pls;
          }
          
          this.setMute = function(mute){
            if(player){
              return player.setMute(mute);
            }else if(videoTag){
              videoTag.muted = mute; 
              return true;
            }
          }
          
          this.playVideo = function(videoData){
            externalPlayVideo(videoData);	
          }
          
          function onJsonError(event, jqxhr, exception) {
            self.prepend('<p>We are sorry, we are unable to load this video.<br />'+exception+'</p>');
          }
          
          function getVideoContent() { 
            try{
              if (window!=window.top) { 
                if(window.parent.s !== undefined){
                  return 	window.parent.s;
                }
              }else{
                if(window.s !== undefined){
                  return 	window.s;
                }
              }
              return false;	
            }catch(e){
              return false;	
            }
          } 
          
          function skynetBeacon(){
            try{
              var date = new Date();
              var jData = {userUri: settings.userUri
                     , articleId: settings.guid
                     , eventDateUtc: date.toISOString()
                     , activityType: "read"
              };
              
              $jQ111.ajax({
                url: settings.skynetServer + "/v1/users/" + settings.userUri+settings.guid + "/events",
                type: "GET",
                dataType: 'jsonp',
                data: jData,
                contentType: 'application/json; charset=utf-8'
              });	
            }catch(e){

            }
          }
          
          function setTrackingVars(data){

            var pageValues = getVideoContent();
            var isIframe = (window!=window.top);
            var url = (window.location != window.parent.location) ? document.referrer: document.location.href;
            var pageTitle = (window.location != window.parent.location) ? svid.pageName: document.title;
            var channel = "";
            isLive = false;
            if(data.state){
              if(data.state == "live"){
                isLive = true;	
              }
            }
            try{
              if(window['s']){
                channel = s.channel;
              }else{
                channel = getDomain(url);
              }
            }catch(e){
              channel = getDomain(document.domain);
            }

            var prefix = "wsj";
            svid.linkTrackVars="pageName,events,channel,pageType,eVar3,eVar4,eVar10,eVar11,eVar13,eVar14,eVar15,eVar16,eVar17,eVar18,eVar20,eVar21,eVar26,eVar31,eVar32,eVar67,eVar37,eVar38,eVar39,eVar40,eVar53,eVar54,eVar25,eVar55,eVar61,eVar68,eVar25,eVar29,eVar52,eVar66,eVar69,eVar70,eVar75";

            svid.debugTracking 	= 	true;
            svid.trackLocal 	= 	true;
            svid.server			=	"om.dowjoneson.com"; 
            svid.account = "djglobal,djwsjlive";

            try{
              if (url.indexOf("wsj.com") !== -1) { 
                svid.account = "djglobal,djwsj";
              }
              if(url.indexOf('live.wsj.com')!== -1) {
                svid.account = "djglobal,djwsjlive";
              }
              if(url.indexOf("cwsj.com") !== -1) {
                svid.account = "djglobal,djwsjchina";
              }
              if(url.indexOf("cn.wsj.com") !== -1){
                svid.account = "djglobal,djwsjchina";
              }
              if(url.indexOf("jwsj.com") !== -1) { 
                svid.account = "djglobal,djjapanwsj";
              }
              if (url.indexOf("kr.wsj.com") !== -1) { 
                svid.account = "djglobal,djwsjkorea";
              }
              if (url.indexOf("indo.wsj.com") !== -1) { 
                svid.account = "djglobal,djwsjindonesia";
              }
              if (url.indexOf("marketwatch.com") !== -1) { 
                svid.account = "djglobal,djmarketwatch";
              }
              if (url.indexOf("barrons.com") !== -1) { 
                svid.account = "djglobal,djbarrons";
              }
              if (url.indexOf("wsj.de") !== -1) { 
                svid.account = "djglobal,djwsjgermany";
              }
              if(url.indexOf('allthingsd.com')!== -1){
                svid.account = "djglobal,djatd";
              }
              if(url.indexOf('wsj.com.tr')!== -1){
                svid.account = "djglobal,djwsjturkey";
              }
              if(url.indexOf('efinancialnews.com')!== -1){
                svid.account = "djglobal,djefinancialnews";
              }
            }catch(e){
              svid.account = "djglobal,djwsjlive";
            }

            if(channel === false){
              svid.channel		=	"WSJ"; // WSJ, MarketWatch, Barrons Online
            }else{
              svid.channel		=	channel; 
            }
            svid.pageType		=	""; // 
        
            svid.eVar3		=	""; //user uuid
            svid.eVar4		=	pageTitle; 			// page name of page where video is played.
            svid.eVar10		=	"WSJLive_Video_"+data.name+"_"+data.duration;
            svid.eVar11		=	svid.channel;					// WSJDN site where video is being played
            svid.eVar13		=	"video_"+data.doctypeID; 	// doc type ID from player; in old implementation, this went into c8
            svid.eVar14		=	data.adZone; 				// video ad zone; in old implementation, this went into c13
            svid.eVar15		=	"WSJLive_"+data.author; 	// name of video creator; in old implementation, this went into c21
            
            if(settings.showName){
              svid.eVar16		=	"video_"+settings.showName; 
            }else if(data.omnitureProgramName){
              svid.eVar16		=	data.omnitureProgramName; 
            }else{
              svid.eVar16		=	"video_"+data.column; 
            }
            
            if(channel === false){
              svid.eVar17		=	(!isIframe) ? document.domain : "video embedded offsite"; // if viewed offsite, [subdomain.domain.com]
              svid.eVar18		=	"video embedded offsite"; // page name of page where video is played.
              comscoreC3 = "13047035";
            
            }else{
              
              if (channel == "MarketWatch") { comscoreC3 = "13047034"; }
              else if (channel == "Barrons Online") { comscoreC3 = "13047031"; }
              else if(channel == "AllThingsD"){comscoreC3= "13047033";}
              else if(channel == "SmartMoney"){comscoreC3 = "3005492";}
              else if (channel == "FINS") { comscoreC3 = "13047038"; }
              else {comscoreC3 = "13047035";}
              
              if(channel == "AllThingsD"){
                prefix = "allthingsd";
              }else if(channel == "SmartMoney"){
                prefix = "sm";
              }
              svid.eVar17		=	null; // if viewed offsite, [subdomain.domain.com]
              svid.eVar18		=	channel; // page name of page where video is played.
            }
            
            if(data[prefix+'-section']){
              var ln = "WSJLive_Video_"+data[prefix+'-section'];
              if(data[prefix+'-subsection']){
                ln += "_"+data[prefix+'-subsection'];
              }
              svid.eVar20		=	ln; // describes the tabs where video is viewed on the WSJ Live site; in old implementation, this went into c22/c19
            }else{
              svid.eVar20		=	null; // describes the tabs where video is viewed on the WSJ Live site; in old implementation, this went into c22/c19	
            }
            
            svid.eVar21		=	"video_"+data.guid; // page name of page where video is played.
            
            svid.eVar26		=	"WSJ_free"; // whether user is a wsjdn subscriber; in old implementation, this went into c27
            
            var d = new Date();
            var utc = d.getTime() + (d.getTimezoneOffset() * 60000);
              var easternDate = new Date(utc + (3600000*-5.0)); 
            var weekday = new Array(7);
            weekday[0]="Sunday";
            weekday[1]="Monday";
            weekday[2]="Tuesday";
            weekday[3]="Wednesday";
            weekday[4]="Thursday";
            weekday[5]="Friday";
            weekday[6]="Saturday";
            
            svid.eVar31		=	weekday[easternDate.getDay()]; // current day
            svid.eVar32		=	easternDate.getHours() + ":" + easternDate.getMinutes(); // time
            var keywords = "WSJLive_null";
            if(data.keywords){
              if(data.keywords.length > 0){
                keywords = "WSJLive_";
                var  i;
                for (i=0;i<data.keywords.length;i = i + 1){ 
                  keywords += data.keywords[i] + "|";
                }
                keywords = keywords.substr(0,keywords.length-1);
              }else{
                keywords = "WSJLive_null";
              }
            }
            
            svid.eVar67	= 	keywords;

            if(channel === false){
              svid.eVar37		=	"video embedded offsite"; 
              svid.eVar38		=	"video embedded offsite";
              svid.eVar39		=	"video embedded offsite"; 
              svid.eVar40		=	"video embedded offsite";  
              svid.eVar53		=	"video embedded offsite"; 
              svid.eVar54		= 	"video embedded offsite";
              svid.eVar25		= 	"video embedded offsite";
              svid.eVar55		= 	"video embedded offsite";
              svid.eVar61		= 	"video embedded offsite"; 
              svid.eVar68		= 	"video_emb";
              svid.eVar29		=	"video embedded offsite"; 
              if(isLive){ 
                svid.eVar69="video_live"; 
              }else{ 
                svid.eVar69="video_vod_program"; 
              }
            }else{
              svid.eVar4		=	(pageValues.pageName !== undefined)  ? pageValues.pageName : pageTitle;  // if page pagename is defined, use that.
              svid.eVar29		=	(pageValues.prop26 !== undefined)  ? pageValues.prop26 : "video embedded onsite"; 
              svid.eVar37		=	(pageValues.prop3 !== undefined)  ? pageValues.prop3 : "video embedded onsite"; 
              svid.eVar38		=	(pageValues.prop19 !== undefined)  ? pageValues.prop19 : "video embedded onsite"; 
              svid.eVar39		=	(pageValues.prop4 !== undefined)  ? pageValues.prop4 : "video embedded onsite";
              svid.eVar40		=	(pageValues.prop4 !== undefined)  ? pageValues.prop4 : "video embedded onsite";
              svid.eVar53		=	(pageValues.prop19 !== undefined)  ? pageValues.prop19 : "video embedded onsite";
              svid.eVar25		= 	(pageValues.prop2 !== undefined)  ? pageValues.prop2 : "video embedded onsite";  
              svid.eVar54		= 	(pageValues.prop2 !== undefined)  ? pageValues.prop2 : "video embedded onsite"; 
              svid.eVar55		= 	(pageValues.prop26 !== undefined)  ? pageValues.prop26 : "video embedded onsite"; 
              svid.eVar61		= 	(pageValues.prop21 !== undefined)  ? pageValues.prop21 : "video embedded onsite";
              svid.eVar68		= 	(pageValues.prop19 !== undefined)  ? "video_emb" : "video_emb";
              
              if(isLive){ 
                svid.eVar69="video_live"; 
              }else{ 
                try{
                  if(data.omnitureVideoFormat){
                    svid.eVar69 = data.omnitureVideoFormat;
                  }else{
                    if(data.doctypeID == "31" || data.doctypeID == 31){
                      svid.eVar69 = "video_vod_program";	
                    }else if(data.column.indexOf("clip") != -1){
                      svid.eVar69 = "video_clip";	
                    }else if(data.doctypeID == "471" || data.doctypeID == 471){
                      svid.eVar69 = "video_sponsored";
                    }else{
                      svid.eVar69 = "video_vod_non-program"; 
                    }
                  }
                }catch(err){
                  svid.eVar69 = "video_vod_non-program";	
                }
              }	
            }

            svid.eVar52		=	"Video"; // channel 
            var createdDate;
            
            if(data.omniturePublishDate){
              createdDate = data.omniturePublishDate;
            }else{
              if(data.formattedCreationDate){
                createdDate =	"video_"+data.formattedCreationDate;
              }else{
                var month = ("0" + (easternDate.getMonth() + 1)).slice(-2);
                var date = ("0" + easternDate.getDate()).slice(-2);
                createdDate = "video_"+easternDate.getFullYear()+month+date+"_"+easternDate.getHours()+":"+easternDate.getMinutes();
              }
            }
            
            svid.eVar66		= 	createdDate;
            try{	
              svid.eVar70 	=	(data.column != null)  ? data.column : ""; 
            }catch(e){}
            svid.eVar75		= 	url.split('?')[0];
            
            var trackVarsArray = svid.linkTrackVars.split(",");
            for (var i=0; i<=trackVarsArray.length; i++){
              if(trackVarsArray[i] in settings){
                svid[trackVarsArray[i]] = settings[trackVarsArray[i]];
              }
            }
          }
          
          function showRemaining() {
            var n = new Date();
            var sec = n.getTime() - start.getTime();
            now = new Date(start.valueOf() + sec); 
            var distance = end - now;
            if (distance < 0) {
              clearInterval(timer);
              document.getElementById('countdown').innerHTML = 'Loading...';
              videodata.state = "ready";
              loadWSJMediaPlayer();
              return;
            }
            var hours = Math.floor(distance / hour);
            var minutes = Math.floor((distance % hour) / minute);
            var seconds = Math.floor((distance % minute) / second);
            document.getElementById('countdown').innerHTML = "";
            if(hours > 0){
              document.getElementById('countdown').innerHTML += hours + 'hrs ';
            }
            if(minutes > 0){
              document.getElementById('countdown').innerHTML += minutes + 'mins ';
            }
            document.getElementById('countdown').innerHTML += seconds + 'secs';
          }
        
          function getThumbnail(list, w){
            var rtn = false;
            var i, len;
            for (i=0,len=list.length; i<len; i = i + 1)
            {
              rtn = list[i].url;
              if(list[i].width > w){
                return rtn;
              }
            }
            return rtn;
          }
          
          jsonReceived = function (data, textStatus, jqXHR) {
            try{
              if(data.items.length > 0 && typeof data.items[0].error == 'undefined'){
                dataLoaded = true;
                videodata = data.items[0];
                
                //videodata.videoURL = "http://hdsvod-f.akamaihd-staging.net/z/video/20131105/110513connecticut/110513connecticut_v2_ec,174,264,464,664,1264,1864,2564,k.mp4.csmil/manifest.f4m";
                
                try{
                  if(externalConfig){
                    videodata = $jQ111.extend(videodata, externalConfig); 
                    videodata = swapAdData(videodata);
                  }
                }catch(e){}
                
                if(!settings.disableDVR){
                  if(videodata.disableDVR){
                    settings.disableDVR = videodata.disableDVR;	
                  }
                }
                

                if(settings.adsEnabled){
                  adData = [];
                  adData.site = "video.wsj.com";
                  adData.zone = videodata.adZone;
                  adData.plid = "video_articleembed"; // hardcode for now
                  adData.lnid = videodata['wsj-subsection'];
                  adData.guid = videodata.guid;
                  if(videodata.column != null){
                    var col = videodata.column;
                    col = col.replace(/ /g, "_");
                    col = col.replace(/'/g, '');
                    col = col.toLowerCase();
                    adData.column = col;
                  }else{
                    adData.column = "null";
                  }
                  adData = swapAdData(adData);
                }
              

                if(!settings.thumb){
                  if(videodata.thumbnailList){
                    settings.thumb = getThumbnail(videodata.thumbnailList, settings.width);	
                  }else{
                    settings.thumb = videodata.thumbnailURL;
                  }
                }
                var ua = navigator.userAgent.toLowerCase();
                var isIpad = ua.match(/(ipad|iphone|ipod)/i);
                var isAndroid = ua.match(/(android)/i);
                //if(!settings.autoplay && !isIpad && !isAndroid){
                if(!settings.autoplay && settings.thumb && !settings.noThumb && !isIpad && !isAndroid){ 
                  setupThumbnail();
                }else{
                  loadWSJMediaPlayer();
                }
                /*
                }else{
                  //if(videodata.state == "future" && !settings.autoplay){
                  if(!settings.autoplay){
                    setupThumbnail();
                  }else{
                    if(settings.loaderThumb){
                      self.html('<div id="preThumb_'+videoId+'" style=" height:100%; width:100%; background-size: contain; background-repeat: no-repeat; background-position: 50% 50%;" class="vidThumb"></div>');
                      $jQ111("#preThumb_"+videoId).css("background-image", 'url(' + settings.thumb +')');
                    }
                    loadWSJMediaPlayer();
                  }
                  
                }
                */

              }else{ // no data returned
                self.append('<p style="text-align:center; color:#FFFFFF; font-size:14px;">Sorry, unable to load this video.  Try again later.</p>');
              }
            }catch(error){}
                //initHTML5();
          };
          
          function swapAdData(dat){
            if(settings){	
              if("site" in settings && settings.site != ""){
                dat.site = settings.site;
              }
              if("zone" in settings){
                dat.zone = settings.zone;
              }
              if("plid" in settings){
                dat.plid = settings.plid;
              }
              if("lnid" in settings){
                dat.lnid = settings.lnid;
              }
              if("column" in settings){
                dat.column = settings.column;
              }
              if("lnid" in dat){
                dat.lineupID = dat.lnid;
              }
              if("plid" in dat){
                dat.playerName = dat.plid;
              }
            }
            return dat;
          }
          
          function init(){
            isInIframe = (window!=window.top);
            if(!configLoaded){
              var playerConigUrl = settings.api+"player/config/"+settings.playerid+".json?callback=?";
              //$.getJSON(playerConigUrl, externalConfigLoaded).error(externalConfigError);
              $jQ111.ajax({
                url: playerConigUrl,
                type : 'GET',
                async: false,
                jsonpCallback: 'jsonCallback',
                dataType: 'jsonp',
                complete: externalConfigLoaded,
                error: externalConfigError
              });
            }else{
              if(settings.guid || (settings.type !== "" && settings.query !== "")){
                var call = "";
                var httpParam = "";
                if(settings.useHttps)
                  httpParam = "&https=1";
                if(settings.guid){
                  call = settings.api+'find_all_videos.asp?type=guid&count=1'+httpParam+'&query='+settings.guid+'&'+fields;
                }else if(settings.type !== "" && settings.query !== ""){
                  call = settings.api+'find_all_videos.asp?type='+settings.type+'&count=1'+httpParam+'&query='+settings.query+'&'+fields;
                }
                $jQ111.getJSON(call, jsonReceived).error(onJsonError);
              }else if(settings.source){ // manual source	
                if(settings.thumb && !settings.noThumb){
                  setupThumbnail();
                }else{
                  loadWSJMediaPlayer();
                }	 
              }
            }

            self.trigger({type:"onInitialize"});

          }
          
          function externalConfigLoaded(data) {
            configLoaded = true;
            externalConfig = data.responseJSON;
            try{
              settings = $jQ111.extend(settings, externalConfig);
            }catch(error){}
            init();
          };
          
          function externalConfigError(e){
            configLoaded = true;
            init();
          }
          
          /////////// START //////////////
          init(); // Start the process
          ////////////////////////////////
          
          // Universal tracking //
          
          function uProgress(perc, tm, cfs){
            if(!cfs){
              if(!isAdvert){
                if(perc > 0.01 && !contentStartTracked){
                  contentStartTracked = true;
                  contentStarted();
                }
                
                if( !trackingMilestones[0] && (perc >= 0.25)){

                  trackingMilestones[0] = true;
                  svid.pageName = svid.eVar10;
                  svid.linkTrackEvents = svid.events = "event97";
                  
                  svid.pev2 = "Video_Milestone 1/4";
                  svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
                  
                  COMSCORE.beacon({ c1:1, c2:"6035148", c3:comscoreC3, c5:"020000", c7:document.domain, c8:document.title, c10:"2-4" });
                }
                if( !trackingMilestones[1] && (perc >= 0.5)){ 
                  trackingMilestones[1] = true;
                  svid.linkTrackEvents = svid.events = "event98";
                  svid.pageName = svid.eVar10;
                  svid.pev2 = "Video_Milestone 2/4";
                  svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
                  COMSCORE.beacon({ c1:1, c2:"6035148", c3:comscoreC3, c5:"020000", c7:document.domain, c8:document.title, c10:"3-4" });
                }
                if( !trackingMilestones[2] && (perc >= 0.75)){
                  trackingMilestones[2] = true;
                  
                  svid.linkTrackEvents = svid.events = "event99";
                  svid.pageName = svid.eVar10;
                  svid.pev2 = "Video_Milestone 3/4";
                  svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
                  COMSCORE.beacon({ c1:1, c2:"6035148", c3:comscoreC3, c5:"020000", c7:document.domain, c8:document.title, c10:"4-4" });
                }
                if( !trackingMilestones[3] && (perc >= 0.95)){
                  trackingMilestones[3] = true;
                  
                  svid.linkTrackEvents = svid.events = "event100";
                  svid.pageName = svid.eVar10;
                  svid.pev2 = "Video_Milestone 4/4";
                  svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
                }
              }
              if(Math.floor(tm / 15) > pingMilestone){
                pingMilestone = Math.floor(tm / 15);
                svid.linkTrackEvents = svid.events = 'event67';
                svid.pageName = svid.eVar10;
                svid.pev2 = "Video_Ping";
                svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
              }
              
            }

            try{
              if(isInIframe){
                if($jQ111(window.top)[0].dj.context.page.disablePageRefresh != true)
                  $jQ111(window.top)[0].dj.util.Video.playVideo(settings.moduleId);
              }
            }catch(e){}
            
            self.trigger({type:"onTimeUpdate",percent:perc, time:tm});
          }
          
          playVideo = function(){

          };
          
          setupThumbnail = function(){  
            if(player){
              //swfobject.removeSWF(containerId);
              //$jQ111(this).append('<div id="'+containerId+'"><noscript>Javascript is required to view this video.  Please enable javascript.</noscript></div>');
              //self = $jQ111(this);
            }
            //self.html('<div id="thumbnail_'+videoId+'" class="vidThumb"><div class="videoHint"></div><img style="height:'+settings.height+'px; width:'+settings.width+'px;"   src="'+settings.thumb+'" /></div>');
            self.html('<div id="thumbnail_'+videoId+'" style=" height:100%; width:100%; background-size: contain; background-repeat: no-repeat; background-position: 50% 50%;" class="vidThumb"><div class="videoHint"></div></div>');
            $jQ111("#thumbnail_"+videoId).css("background-image", 'url(' + settings.thumb +')');
            $jQ111("#thumbnail_"+videoId).click(function() {
              $jQ111(this).fadeOut(300,loadWSJMediaPlayer);
              settings.autoplay = true;
            });
          };

          // Flash Events
          
          window['timeChange'+callback] = function(e, timeEvent){
            var percent = timeEvent.time / timeEvent.duration;
            if(timeEvent.duration > 0){
              uProgress(percent, timeEvent.time, timeEvent.cfs );
            }
            self.trigger('onTimeChange', timeEvent);
          };
          
          window['complete'+callback] = function (e){
            self.trigger({type:"videoComplete", guid:settings.guid});
            self.trigger({type:"onVideoComplete", guid:settings.guid});

            if(isInIframe){
              try{
                $jQ111(window.top)[0].dj.util.Video.stopVideo(settings.moduleId);
                
                //$jQ111(window.top).trigger('dj.util.Video.stopVideo',settings.moduleId);
              }catch(e){}
              
            }else{
              self.trigger('dj.util.Video.stopVideo',settings.moduleId);
            }
            if(settings.resetOnComplete){
              setupThumbnail();	
            } 

          };
          
          window['onCompanions'+callback] = function(module, ads) {
            if(typeof ads == "object"){
              ads = $jQ111.map(ads, function(value, index) {return [value];});	
            }
            self.trigger({type:"onCompanions", availableAds:ads});
          };
          
          window['requestPlaylist'+callback] = function (e){
            self.trigger('requestPlaylist');
            var json = jQuery.parseJSON(settings.playlist);
            var result = [];
            var keys = Object.keys(json);
            keys.forEach(function(key){
              result.push(json[key]);
            });
            return result[0];
          };
          window['adComplete'+callback] = function(e){
            self.trigger('adComplete');
            adComplete(e);
          };
          window['adStarted'+callback] = function(e){
            self.trigger('adStarted');
            adStarted(e);
          };
          window['adSkipped'+callback] = function(e){
            self.trigger('adSkipped');
            adSkipped(e);
          };
          window['adError'+callback] = function(e){
            self.trigger('adError');
            adError(e);
          };
          window['newVideo'+callback] = function(e, data){
            self.trigger('newVideo');
            onNewVideo(data);
          }
          window['onReplay'+callback] = function(e, data){
            self.trigger('replay');
            onReplayVideo();
          }
          window['pauseVideo'+callback] = function(e, data){
            self.trigger('pauseVideo');
          }
          window['unPauseVideo'+callback] = function(e, data){
            self.trigger('unPauseVideo');
          }
          window['onMute'+callback] = function(e, data){
            self.trigger('onMute');
          }
          window['onUnMute'+callback] = function(e, data){
            self.trigger('onUnMute');
          }

          onReplayVideo = function(){
            try{
              if(session){
                $jQ111.ajax({
                  url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsChrome+"&guid={"+settings.guid+"}",
                  dataType: "jsonp"
                });
              }
            }catch(e){}	
            
            $jQ111.ajax({
              url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsId+"&guid={"+settings.guid+"}",
              dataType: "jsonp"
            });
            skynetBeacon();
            svid.pageName = svid.eVar10;
            svid.linkTrackEvents = svid.events = "event96";
            svid.pev2 = "Video_Content Started";
            svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
            
            trackingMilestones = [false,false,false,false];
            pingMilestone = 0;
            isAdvert = false;
            initTracked = false;
            flashInitialized();
          };
          onNewVideo = function(videoData){ 
            trackingMilestones = [false,false,false,false];
            pingMilestone = 0;
            isAdvert = false;
            initTracked = false;
            setTrackingVars(videoData);
            try{
              if(session){
                $jQ111.ajax({
                  url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsChrome+"&guid={"+settings.guid+"}",
                  dataType: "jsonp"
                });
              }
            }catch(e){}	
            $jQ111.ajax({
              url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsId+"&guid={"+settings.guid+"}",
              dataType: "jsonp"
            });
            skynetBeacon();
            flashInitialized();
          };
          adComplete = function(e){
            svid.linkTrackEvents = svid.events = "event74";
            svid.pageName = 'WSJLive_Video_Ad';
            svid.pev2 = "Video_Ad Complete";
            svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
            isAdvert = false;
            $jQ111.ajax({
              url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsAdId+"&guid={"+settings.guid+"}",
              dataType: "jsonp"
            });
            videoTag.play();
          };
          adStarted = function(e){
            svid.linkTrackEvents = svid.events = "event73";
            svid.pageName = 'WSJLive_Video_Ad';
            svid.pev2 = "Video_Ad Started";
            svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
            isAdvert = true;
          };
          adSkipped = function(e){
            isAdvert = false;
            $jQ111('#adContainer').hide();
          };
          adError = function(e){
            $jQ111('#adContainer').hide();
            isAdvert = false;
          };
          complete = function(e){

          };
          
          initialized = function(e){			
            skynetBeacon();
            svid.linkTrackEvents = svid.events  = "event36";
            svid.pageName = svid.eVar10;
            svid.pev2 = "Video_Start";
            svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2);
            COMSCORE.beacon({ c1:1, c2:"6035148", c3:comscoreC3, c5:"020000", c7:document.domain, c8:document.title, c10:"1-4" });
          };
          
          // FLASH ONLY EVENTS
          
          flashInitialized = function(){
            initTracked = true;
            initialized();
          };
          
          flashContentStarted = function(e){	 		

          };
          
          flashStateChange= function(e){			
          };
          
          contentStarted = function(){
            try{
              if(session){
                $jQ111.ajax({
                  url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsChrome+"&guid={"+settings.guid+"}",
                  dataType: "jsonp"
                });
              }
            }catch(e){}	
            $jQ111.ajax({
              url: "http://www.marketwatch.com/enf/wsjdn-video.asp?source="+settings.larsId+"&guid={"+settings.guid+"}",
              dataType: "jsonp"
            });
            svid.pageName = svid.eVar10;
            svid.linkTrackEvents = svid.events = "event96";
            svid.pev2 = "Video_Content Started";
            svid.pe = 'lnk_o';  svid.tl(this,'o',svid.pev2); 
          };

          loadWSJMediaPlayer = function() {
            try{ 
              if(navigator.userAgent.toLowerCase().indexOf('chrome') > -1){
                if ( typeof chrome.cast == "undefined") {
                  $jQ111.getScript( "https://www.gstatic.com/cv/js/sender/v1/cast_sender.js" )
                  .done(function( script, textStatus ) {
                    if (chrome.cast && !chrome.cast.isAvailable) {
                      setTimeout(initializeCastApi, 1000);
                    }
                  })
                }
              }
            }catch(e){}
            
            if(videodata.state == "future"){
              var nam = (!videodata.showName) ? videodata.name : videodata.showName;
              end = new Date(now.valueOf() + (videodata.secondsUntilStartTime * 1000));
              self.prepend('<p style=" color:#FFFFFF; line-height:150%; font-family:Verdana, Geneva, sans-serif; position:absolute; top:20px; text-align:center; width:'+settings.width+'px;">'+ nam + ' is scheduled to start at ' + videodata.formattedCreationDate + ' ET <br /><br />This video will play automatically in: <br /><span id="countdown"></span></p>');
              timer = setInterval(showRemaining, 1000);
            }else if(videodata.state == "processing"){
              self.prepend('<p style=" color:#FFFFFF; line-height:150%; font-family:Verdana, Geneva, sans-serif; position:absolute; top:20px; text-align:center; width:'+settings.width+'px;">We are still processing your video. Please try again shortly.</p>');
            }else{
              setTrackingVars(videodata);
              if(isInIframe){
                try{
                  $jQ111(window.top)[0].dj.util.Video.playVideo(settings.moduleId);
                  //$jQ111(window.top).dj.util.Video.playVideo(settings.moduleId);
                }catch(e){}
              }else{
                self.trigger('dj.util.Video.playVideo',settings.moduleId);
              }
              if(detectmob()){
                settings.disableHtmlControls = true;
                initHTML5(); // load html5 player
              }else{ // attempt to load flash player
        
                var parameters = {
                  autoPlay: true,
                  disableSeekBarThumbnails: settings.disableSeekBarThumbnails,
                  clickForSound: settings.clickForSound,
                  disablePreroll: settings.disablePreroll,
                  clickForSoundPreroll: settings.clickForSoundPreroll,
                  //javascriptCallbackFunction: "onJavaScriptBridgeCreated",
                  suppressAds:!settings.adsEnabled,
                  shareenabled: settings.shareEnabled,
                  callback:callback,
                  adZone:settings.adZone,
                  endScreenOverlay: !settings.disableEndscreen,
                  disableDVR: settings.disableDVR,
                  enableCaptions: settings.enableCaptions,
                  chainVideos: settings.chainVideos,
                  adSkippingEnabled: !settings.disableAdSkipping,
                  directLinks: settings.directLinks,
                  relativeLinks: settings.relativeLinks,
                  wmode: settings.wmode
                  //trackingEnabled : false, // prevent flash double tracking from within the player
                }; 
                
                if(settings.adTag != "") {parameters.adTag = settings.adTag;}
                if(settings.source != "") {parameters.source = settings.source;}
                if(settings.maxBitrateIndex) {parameters.maxBitrateIndex = settings.maxBitrateIndex;}
                if(settings.site != "") {parameters.adsite = settings.site;}
                if(settings.lnid != "") {parameters.lnid = settings.lnid;}
                //if(settings.adSkippingEnabled 
                
                trackingMilestones = [false,false,false,false];
                pingMilestone = 0;
                
                var wmodeValue = "direct";
                var wmodeOptions = ["direct", "opaque", "transparent", "window"];
                if (parameters.hasOwnProperty("wmode")) {
                  if (wmodeOptions.indexOf(parameters.wmode) >= 0) {
                    wmodeValue = parameters.wmode;
                  }
                  delete parameters.wmode;
                }
                
                self.append('<div id="'+videoId+'_c" style="width:100%; height:100%;"></div>');
                
                swfobject.embedSWF(
                  settings.api+"player/hds.swf"
                  , videoId+'_c'
                  , "100%"
                  , "100%"
                  , "10.2.0"
                  , ""
                  //, "expressInstall.swf"
                  , parameters
                  , {
                    allowFullScreen: settings.allowFullScreen,
                    allowscriptaccess: "always",
                    wmode: wmodeValue,
                    bgcolor: "000000" 
                  }
                  , {
                    name: "WSJMediaPlayer"
                  },swfObjectStatus
                );
              }
            }
            
          };
          
          swfObjectStatus = function(e) {
            if(!e.success){
              initHTML5();
              self.trigger({type:"onStart", playerType:"html5"});
            }else{
              self.trigger({type:"onStart", playerType:"flash"});
              player = document.getElementById(videoId+'_c');
              //player = swfobject.getObjectById(e.id);
            }
          };
          
          window['setReceiverAvailable'+callback] = function(e) { 
            try{
              launchApp();
            }catch(e){}
          };
        
          window['continueLoadVideo'+callback] = function(e) { 
            $jQ111('#preThumb_'+videoId).fadeOut(300);
          
            trackingMilestones = [false,false,false,false]; 
            pingMilestone = 0;
            flashInitialized();
            try{
              if(!settings.source){ // Not manual 
                if(!player)
                  player = document.getElementById(videoId+'_c');
                var t = videodata;
                player.playVideo(videodata);
              }
            }catch(e){
              if(!player)
                player = document.getElementById(videoId+'_c');
              var t = videodata;
              player.playVideo(videodata);
            }
            try{
              if(player)
                player.setReceiverAvailable(receiverAvailable);
              //if(chromecastReceivers.length > 0)
              //	player.setReceivers(chromecastReceivers);
            }catch(e){}
            self.trigger('continueLoadVideo');
          };
          
          window['onVolumeChanged'+callback] = function(e, vol) { 
            try{
              if( session ) {
                session.setReceiverVolumeLevel(vol,
                  function(e){}, // success 
                  function(e){}); // error
              }
              
              var evt = jQuery.Event( "onVolumeChanged" );
              event.volume = vol;
              self.trigger(evt);

            }catch(e){}
            self.trigger('onVolumeChanged', {volume: vol});
          };
          
          externalPlayVideo = function(videodata){ // external call to play new video

            settings.autoplay = true;
            initTracked = false;
            setTrackingVars(videodata);  
            trackingMilestones = [false,false,false,false];
            pingMilestone = 0;
            $jQ111('#playlist_'+videoId).fadeOut("fast"); 

            if(player){
              flashInitialized();
              self.trigger('ready', ['Custom', 'Event']);
              player.playVideo(videodata);
            }else{
              
              //settings.adTag = 'http://pubads.g.doubleclick.net/gampad/ads?sz=400x300&iu=%2F6062%2Fiab_vast_samples&ciu_szs=300x250%2C728x90&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&correlator=[timestamp]&cust_params=iab_vast_samples%3Dlinear'; // REMOVE
              //settings.adTag = 'http://protoweb.marketwatch.com/api-video/test/vast.xml';
              //settings.adTag = 'http://ad.doubleclick.net/N2/pfadx/video.marketwatch.com/markets_video;frmt=2;plID=video_videocenter;lnID=news;ttID=C3E1E6816115434EBDD11E14B1E9587A;content=short;column=barrons_bounce;view=0;cue=mid;cgm=0;preroll=15;sz=4x4;adCat=null;dcmt=text/xml;dc_sdkv=3.0.137;u_asa=1;osd=2;ord=1400524323125';

              
              if(!settings.suppressAds){
                if(settings.adTag != ""){
                  var adsRequest = {
                    adTagUrl: settings.adTag,
                    adType: "video"
                  };
                  adsLoader.requestAds(adsRequest);
                }else{
                  adsLoader.requestAds(getAdTag(adData));
                }
              }
              if(!videoTag){
                initHTML5(); 
              }else{
                if(isIpad){
                  videoTag.src = videodata.hls;
                }else{
                  if(!videodata.video664kMP4Url){
                    videoTag.src = videodata.video320kMP4Url;
                  }else{
                    videoTag.src = videodata.video664kMP4Url;
                  }
                }
                //videoTag.src = videodata.video128kMP4Url;
                //adsInit("video","adContainer", adData);
                videoTag.play();
              }
            }
          };
          
          initHTML5 = function(){
            //if(settings.adsEnabled){
              /*
              try{ 
                if(typeof google.ima === 'undefined'){
                  $.getScript( settings.imaLibrary )
                    .done(function( script, textStatus ) {
                    initHTML5();
                    })
                    .fail(function( jqxhr, settings, exception ) {
                    initHTML5();
                  });
                  return;
                }
              }catch(e){
                $.getScript( settings.imaLibrary )
                  .done(function( script, textStatus ) {
                  initHTML5();
                  })
                  .fail(function( jqxhr, settings, exception ) {
                  initHTML5();
                });
                return;
              }
              
              var fileref=document.createElement('script');
              fileref.setAttribute("type","text/javascript");
              fileref.setAttribute("src", settings.imaLibrary);
              if (typeof fileref!="undefined")
                document.getElementsByTagName("head")[0].appendChild(fileref);
              
              */

            if(settings.adsEnabled){
              try{ 
                if(typeof google.ima === 'undefined' || !imaLoaded){
                  loadScript(settings.imaLibrary, function(){
                    imaLoaded = true;
                    initHTML5();
                  });
                }
              }catch(e){
                if(!imaLoaded){
                  loadScript(settings.imaLibrary, 
                    function(){ // loaded
                      imaLoaded = true
                      initHTML5();
                    },
                    function(){ // failed
                      imaLoaded = true;
                      initHTML5();
                    }
                  );
                }
              }
              if(!imaLoaded){
                return;
              }
            }
            
            self.addClass("wsj-videoplayer");
            
            if(settings.autoplay && !settings.clickForSound && !settings.adsEnabled){
              autoString = 'autoplay="autoplay"';
            }else{
              autoString = '';
            }

            var ua = navigator.userAgent.toLowerCase();
            var is_firefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;
            var isIpad = ua.match(/(ipad|iphone|ipod)/i);
            var isAndroid = ua.match(/(android)/i);
            var canPlay =  false;
            if ( isIpad || (ua.match(/(android)/i) && parseFloat(ua.slice(ua.indexOf("android")+8)) >= 4.0)){
              settings.disableHtmlControls = true;
              canPlay = true;
            }
            
            self.parent().resize(function(e) {
              onResize();
                  });
            
            window['videoFail'+callback] = function(vid){
              if(!isIpad){
                $jQ111("#"+videoId).hide();
                $jQ111("#wsjvideo-video-controls").hide();
                self.html('<p class="getFlash" >Sorry, your browser does not appear to support HTML5 video playback.<br />You will need the flash plugin installed to view this video.<br /><br /><a href="http://www.adobe.com/go/getflashplayer" target="_blank"  border="0" style="margin:0 auto;"><img style="border:none; margin:0 auto; height:auto; width:auto;" height=41 width=160 src="'+settings.api+'player/css/get-flash-player.png'+'" /></a></p>');
              }
            }
            
            onAdError = function(adErrorEvent) {
              alert("e");
              $jQ111('#'+videoId).trigger("onAdError");
              $jQ111('#'+videoId).trigger("isAdChanged", [false]);
              try{

              }catch(e){}
              
              if(videoTag){

              
                if(isIpad){
                  videoTag.src = videodata.hls;
                }else{
                  if(!videodata.video664kMP4Url){
                    videoTag.src = videodata.video320kMP4Url;
                  }else{
                    videoTag.src = videodata.video664kMP4Url;
                  }
                }
                
                try{
                  videoTag.setAttribute('autoplay', true);
                  videoTag.play();
                }catch(e){}
                
                if(isIpad)
                  $jQ111('#'+videoId).attr('controls',true);
              }
            };
            
            onSkip = function(adEvent) {
              if(adsManager){
                adsManager.skip();
                onAdComplete(adEvent);
              }
              if(isIpad)
                $jQ111('#'+videoId).attr('controls',true);
            };
            
            onAdClicked = function(adEvent) {
              if(adsManager){
                adsManager.pause();
                //adsManager.skip();
                //onAdComplete(adEvent);
              }
              if(isIpad)
                $jQ111('#'+videoId).attr('controls',true);
            };
            
            onAdsLoaded = function(adsLoadedEvent) {
              ////var adsRenderingSettings = new google.ima.AdsRenderingSettings();
              //adsRenderingSettings.loadVideoTimeout = 3;
              //adsManager = adsLoadedEvent.getAdsManager(videoTag, adsRenderingSettings);
              adsManager = adsLoadedEvent.getAdsManager(videoTag); 
              
              adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE, onAdComplete);
              adsManager.addEventListener(google.ima.AdEvent.Type.STARTED, onAdStarted);
              adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, onAdError);
              adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, onPauseRequested);
              adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, onResumeRequested);
              adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED , onSkip);
              adsManager.addEventListener(google.ima.AdEvent.Type.CLICK , onAdClicked);
              
              adsManager.init(settings.width, settings.height - 30, google.ima.ViewMode.NORMAL); 
              
              adsManager.start();
              videoTag.load();
              videoTag.play();
              
              //adsManager.play(videoTag);
              
              try {
                if(settings.autoplay){
                  adsManager.play(videoTag);
                  adsManager.start();
                  prerollPlayed = true;
                }
              } catch (adError) {
                //videoTag.trigger("onAdError");
              }
            
            };
            
            requestAd = function() {
              try{
                if(!imaLoaded)
                  return;
                contentInitialized = true;
                        
                if(!settings.suppressAds && !isAdvert){
        
                  if(!adsContainerInit){
                    adDisplayContainer = new google.ima.AdDisplayContainer(document.getElementById('adContainer'), videoTag);
                    adDisplayContainer.initialize();
                    
                    adsLoader = new google.ima.AdsLoader(adDisplayContainer);
                    
                    adsLoader.addEventListener(
                      google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
                      onAdsLoaded,false);
                    adsLoader.addEventListener(
                      google.ima.AdErrorEvent.Type.AD_ERROR,
                      onAdError,false);	
                    
                    adsContainerInit = true;
                  }
                  
                  var adsRequest = new google.ima.AdsRequest();
                  var tmStamp = new Date();
                  
                  //settings.adTag = 'http://pubads.g.doubleclick.net/gampad/ads?sz=400x300&iu=%2F6062%2Fiab_vast_samples&ciu_szs=300x250%2C728x90&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&correlator='+tmStamp.getTime()+'&cust_params=iab_vast_samples%3Dlinear'; // REMOVE
                  //settings.adTag = 'http://protoweb.marketwatch.com/api-video/test/vast.xml?a=a';
                  //settings.adTag = 'http://ad.doubleclick.net/N2/pfadx/video.marketwatch.com/markets_video;frmt=2;plID=video_videocenter;lnID=news;ttID=C3E1E6816115434EBDD11E14B1E9587A;content=short;column=barrons_bounce;view=0;cue=mid;cgm=0;preroll=15;sz=4x4;adCat=null;dcmt=text/xml;dc_sdkv=3.0.137;u_asa=1;osd=2;ord=1400524323125';
                  //settings.adTag = 'http://protoweb.marketwatch.com/api-video/test/vast2.xml?a=a';
                  if(settings.adTag != ""){
                    var adsRequest = {
                      adTagUrl: settings.adTag,
                      adType: "video"
                    };
                  }else{
                    adsRequest = getAdTag(adData);
                  }
                  adsLoader.requestAds(adsRequest);
                }
              }catch(e){
                onAdError(e);
              }
            }

            onAdComplete = function(adCompleteEvent){
              $jQ111('#adContainer').hide();
              adComplete();

              $jQ111('#'+videoId).trigger("isAdChanged",[false]);
              $jQ111('#'+videoId).trigger("adComplete");
              
              if(isIpad){
                videoTag.src = videodata.hls;
              }else{
                if(!videodata.video664kMP4Url){
                  videoTag.src = videodata.video320kMP4Url;
                }else{
                  videoTag.src = videodata.video664kMP4Url;
                }
              }
              videoTag.play();
              if(isIpad)
                $jQ111('#'+videoId).attr('controls',true);
            };

            
            getAdTag = function(adData){
              var d = new Date();
              var timestamp = d.getTime(); 

              var guid = adData.guid.replace(/[^a-zA-Z 0-9]+/g,'');

              var adsRequest = {
              adTagUrl: "http://ad.doubleclick.net/pfadx/"+adData.site+"/"+adData.zone+";frmt=2;plID="+adData.plid+";lnID="+adData.lnid+";ttID="+guid+";content=short;column="+adData.column+";view=1;cue=mid;cgm=0;ord="+timestamp+";preroll=15;sz=4x4;adCat=null;dcmt=text/xml?",
                adType: "video"
              };
              return adsRequest;
            };
            
            onAdStarted = function(t) {

              try{
                var ad = t.getAd();
                var companionAdsRtn = [];
                if(ad.a.companions.length){
                  for (var i = 0; i < ad.a.companions.length; i++) {
                    companionAdsRtn[i] = {
                      url:ad.a.companions[i].content,
                      clickUrl:"",
                      height:ad.a.companions[i].size.height,
                      width:ad.a.companions[i].size.width,
                      type:"html"
                    };
                  }
                }
                self.trigger({type:"onCompanions", availableAds:companionAdsRtn});
              }catch(e){
                self.trigger({type:"onCompanions", availableAds:[]});
              }
              
              $jQ111('#adContainer').show();
              adStarted();
              videoTag.removeEventListener('ended', onEnded);
              endListener = false;
              isAdvert = true;
              $jQ111('#'+videoId).trigger("isAdChanged", [true]);
              $jQ111('#'+videoId).trigger("adStarted");
              if(isIpad)
                $jQ111('#'+videoId).attr('controls',false);
            }; 
            
            onPauseRequested = function() {
              videoTag.pause();
              
            };
            
            onResumeRequested = function() {
              videoTag.play();
              
            };
            
            onPlaying = function(){
              $jQ111('#playlist_'+videoId).hide();
              $jQ111('#adContainer').hide();
              $jQ111("#buffering_"+videoId).hide();
              if(!prerollPlayed && adsManager){
                //adsManager.play(videoTag);
                prerollPlayed = true;
              }
              if(!initTracked){
                initTracked = true;
                initialized();	
              }
              self.trigger({type:"onPlay"});
            };
            
            onBuffering = function(evt){
              if(window.navigator.userAgent.toLowerCase().match(/(android)/i)){
                $jQ111("#buffering_"+videoId).show();
              }
            }
            
            onPlay = function(){
              $jQ111('#playlist_'+videoId).hide();
              $jQ111('#adContainer').hide();
            };
            
            onError = function(evt){
              var ua = window.navigator.userAgent.toLowerCase();
              var isIpad = ua.match(/(ipad|iphone|ipod)/i);
              var myNav = navigator.userAgent.toLowerCase();
                var isIe = (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : false;
              if((!isIpad && !canPlay) || isIe != false){
                $jQ111("#"+videoId).hide();
                $jQ111("#wsjvideo-video-controls").hide();
                self.html('<p class="getFlash">Sorry, your browser does not appear to support HTML5 video playback.<br />You will need the flash plugin installed to view this video.<br /><br /><a href="http://www.adobe.com/go/getflashplayer" target="_blank"  border="0" style="margin:0 auto;"><img style="border:none; margin:0 auto; height:auto; width:auto;" height=41 width=160 src="'+settings.api+'player/css/get-flash-player.png'+'" /></a></p>');
              }
            };
            
            onPlayerExitFullscreen = function(){
              try{
                
                
              var ua = window.navigator.userAgent.toLowerCase();
              var isIphone = ua.match(/(iphone)/i);

                if(isIphone){
                  //$jQ111('#playlist_'+videoId).css("z-index", 2147483647);
                  //$jQ111('#'+videoId).css("z-index", 2147483646 );
                  //alert("done");
                }
                /*
                if(isIphone && !isAdvert){
                  $jQ111("#thumbnail_"+videoId).unbind("click");
                  $jQ111('#'+videoId).hide();
                  $jQ111('#thumbnail_'+videoId).show();
                  $jQ111("#thumbnail_"+videoId).click(function(evt) {
                    $jQ111("#thumbnail_"+videoId).hide();
                    $jQ111('#'+videoId).show();
                    videoTag.play();
                  });
                }
                */
                
              }catch(e){}
            };
            
            onPause = function(){
              self.trigger({type:"onPause"});
            };
            
            onCanPlay = function(){
              // new //
              videoTag.play();
              
            };
            
            videoProgress = function(evt){
              var p = evt.target.currentTime / evt.target.duration;
              if(ua.match(/(android)/i) && parseFloat(ua.slice(ua.indexOf("android")+8)) >= 4.0){
                if(Math.round(evt.target.currentTime) == Math.floor(evt.target.duration)  && !isAdvert && Math.round(evt.target.currentTime) >= 35){
                  videoComplete(evt);	
                }
              }else{
                if(p > 0.01 && !endListener && !isAdvert && evt.target.duration > 0){
                  
                  //videoTag.addEventListener('ended', videoComplete);
                  //endListener = true;
                }
              }

              uProgress(p, evt.target.currentTime, false);
              $jQ111("#buffering_"+videoId).hide();
            };
            
            onEnded = function(){
              videoComplete();
            }
            
            videoComplete = function(){
              
              if(videoTag.duration > 3){
                if(isInIframe){
                  try{
                    //$jQ111(window.top)[0].dj.util.Video.playVideo(settings.moduleId);
                    $jQ111(window.top)[0].dj.util.Video.stopVideo(settings.moduleId);
                  }catch(e){}
                  
                }else{
                  self.trigger('dj.util.Video.stopVideo',settings.moduleId);
                }
                if(!isAdvert && !settings.disableEndscreen && !settings.resetOnComplete){ 
                  generateEndscreen();	
                }else if(settings.resetOnComplete){
                  setupThumbnail();	
                } 
              
                self.trigger({type:"videoComplete", guid:settings.guid});
                self.trigger({type:"onComplete", guid:settings.guid});
              }
            };
            
            window['liveEnded'+callback] = function(vid){
              videoComplete();
            }
            
            if(!is_firefox){
              if(videodata.state == "live"){
                self.html('<div class="playlist" id="playlist_'+videoId+'"></div><video id="'+videoId+'" poster="'+settings.thumb+'" '+autoString+' controls onerror="liveEnded'+callback+'(this)" ><source src="'+videodata.hls+'" type="video/mp4"><p>Sorry, your browser does not appear to support Http Live Streaming playback.</p></video>');
                //$jQ111("#"+videoId).play();
              }else{
                if(isIpad || isAndroid){
                  self.html('<div id="thumbnail_'+videoId+'" style="height:100%; width:100%; background-size: contain; background-repeat: no-repeat; background-position: 50% 50%;" class="vidThumb"><div class="videoHint"></div></div><div class="playlist" id="playlist_'+videoId+'"></div><video style="-webkit-transform-style: preserve-3d; display:none;" id="'+videoId+'" width="100%" height="100%" controls="controls" onerror="videoFail'+callback+'(this)" onclick=""><source src="'+videodata.video664kMP4Url+'" type="video/mp4""></source><p class="getFlash">Sorry, your browser does not appear to support HTML5 video playback.</p></video><div id="adContainer"></div>');
                  $jQ111("#thumbnail_"+videoId).css("background-image", 'url(' + settings.thumb +')');
                  $jQ111("#thumbnail_"+videoId).click(function(evt) {
                    $jQ111(this).css("z-index", 0);
                    $jQ111(this).hide();
                    $jQ111('#'+videoId).show();
                    if(!settings.adsEnabled){
                      videoTag = document.getElementById(videoId);
                      videoTag.play();
                    }else{
                      requestAd();
                      videoTag = document.getElementById(videoId);
                      videoTag.play();
                    }
                  });
                }else{
                  self.html('<div class="playlist" id="playlist_'+videoId+'"></div><div class="buffering" id="buffering_'+videoId+'"></div><video id="'+videoId+'" width="100%" height="100%" '+autoString+' controls poster="'+settings.thumb+'"><p class="getFlash">Sorry, your browser does not appear to support HTML5 video playback.<br />You will need the flash plugin installed to view this video.<br /><br /><a href="http://www.adobe.com/go/getflashplayer" target="_blank"  border="0" style="margin:0 auto;"><img style="border:none; margin:0 auto;  height:auto; width:auto;" height=41 width=160 src="'+settings.api+'player/css/get-flash-player.png'+'" /></a></p></video><div id="adContainer"></div>');
                  //self.html('<div id="playlist"></div><video style="-webkit-transform-style: preserve-3d" id="'+videoId+'" width="'+settings.width+'" height="'+parseInt(parseFloat(settings.height) - 0).toString()+'" '+autoString+' controls poster="'+settings.thumb+'"><p class="getFlash" style="background-color:#000000; margin: 0 auto; color:#FFFFFF !important; width:'+settings.width+'px; font-family:arial; top:0%; height:100%; position:relative; text-align:center;">Sorry, your browser does not appear to support HTML5 video playback.<br />You will need the flash plugin installed to view this video.<br /><br /><a href="http://www.adobe.com/go/getflashplayer" target="_blank"  border="0" style="margin:0 auto;"><img style="border:none; margin:0 auto;" height=41 width=160 src="'+settings.api+'player/css/get-flash-player.png'+'" /></a></p></video>');
                }
                videoTag = document.getElementById(videoId);
                
                //videoTag.setAttribute('src', videodata.video664kMP4Url);
                //videoTag.load();	

                try{
                  canPlay =  videoTag.canPlayType('video/mp4; codecs="avc1.42E01E"');
                }catch(ignore){}
              }

              if(!settings.disableHtmlControls && $jQ111.fn.wVideo != 'undefined' && canPlay != false){
                htmlControlsInstance = $jQ111("#"+videoId).wVideo()[0]; // SET HTML5 Style
                if(settings.autoplay){
                  videoTag.play();
                }
              }
              if(isIpad || isAndroid){
                
                //$jQ111("#"+videoId).bind("loadedmetadata", function(){
                //	$jQ111("#"+videoId).unbind("loadedmetadata");
                //	requestAd();
                //});
              }else{
                if(settings.adsEnabled){
                  requestAd();
                }
              }
            }

            if(!canPlay || is_firefox){ // if firefox or cannot play, display message.
              $jQ111("#"+videoId).hide();
              self.append('<p class="getFlash" >Sorry, your browser does not appear to support HTML5 video playback.<br />You will need the flash plugin installed to view this video.<br /><br /><a href="http://www.adobe.com/go/getflashplayer" target="_blank"  border="0" style="margin:0 auto;"><img style="border:none; margin:0 auto; height:auto; width:auto;" height=41 width=160 src="'+settings.api+'player/css/get-flash-player.png'+'" /></a></p>');
            }else{
              if(isIpad){
                videoTag.src = videodata.hls;
              }else{
                if(!videodata.video664kMP4Url){
                  videoTag.src = videodata.video320kMP4Url;
                }else{
                  videoTag.src = videodata.video664kMP4Url;
                }
              }
              /// LISTENERS /////
              videoTag.addEventListener('ended', videoComplete);
              videoTag.addEventListener('loadedmetadata', onloadedmetadata);
              
              videoTag.addEventListener('timeupdate', videoProgress);
              videoTag.addEventListener('playing', onPlaying); 
              videoTag.addEventListener('play', onPlay); 
              videoTag.addEventListener('error', onError); 
              videoTag.addEventListener('pause', onPause); 
              videoTag.addEventListener('webkitendfullscreen', onPlayerExitFullscreen, false);
              videoTag.addEventListener('stalled', onBuffering);
              videoTag.addEventListener('waiting', onBuffering);
              videoTag.addEventListener('loadstart', onBuffering);
              videoTag.addEventListener('canplay', onCanPlay);
            }
            
            generateEndscreen = function() { 

              var numThumbs = 30;
              
              var httpParam = "";
              if(settings.useHttps)
                httpParam = "&https=1";
                
              if(settings.playlist !== null){
                if (settings.playlist instanceof Array) {
                  buildList(settings.playlist);
                }else{
                  var tags = $jQ111.parseJSON(settings.playlist);
                  buildList(tags.items)
                }
                
              }else{
                if(settings.skynetEnable){
                  $jQ111.getJSON(settings.skynetRecServer + "/v1/users/" + settings.userUri+settings.guid + "/recommendations?top="+numThumbs, onSkyNet);		
                }else{
                  $jQ111.getJSON(settings.api+'find_all_videos.asp?count='+numThumbs+httpParam+'&type='+settings.suggestionsType+'&query='+settings.suggestionsQuery+'&fields='+fields, onRecommendations);
                }
              }	
              
              function onSkyNet(data){
                var guidStr = data.toString()
                $jQ111.getJSON(settings.api+'find_all_videos.asp?type=guid'+httpParam+'&query='+guidStr+'&'+fields, onRecommendations);		
              }
              
              function buildList(videos){
                //var videos = [];
                //videos = vids;
                // Replay Thumb
                var thumbshtml = '<div id="main-wrap"><div class="endScreen" id="endScreen"><ul class="endScreen-items">';
                thumbshtml += '<li data-thumb="' + videodata.thumbnailList[4].url + '" class="fixed" id="video_-1">';
                thumbshtml += '<a class="endThumb" rel="-1"><div class="hover-content vcenter"><div>';
                thumbshtml += '<p class="endscreen-title" >'+videodata.name+'</p>';
                thumbshtml += '</div></div><div class="footer replay"></div></a></li>';
                // End Replay
                
                var index = 0;
                $jQ111.each(videos, function(key, val) {	

                  thumbshtml += '<li data-thumb="' + val.videoStillURL + '" class="fixed" id="video_' + index + '">';
                  if(settings.directLinks){
                    if(settings.relativeLinks && typeof videodata.linkRelativeURL != 'undefined'){
                      thumbshtml += '<a class="endThumb" href="' + videodata.linkRelativeURL + '">';
                    }else if(!settings.relativeLinks && typeof videodata.linkURL != 'undefined'){
                      thumbshtml += '<a class="endThumb" href="' + videodata.linkURL + '">';
                    }else{ 
                      settings.directLinks = false;
                      thumbshtml += '<a class="endThumb" rel="' + index + '">';
                    }
                  }else{
                    thumbshtml += '<a class="endThumb" rel="' + index + '">';
                  }
                  thumbshtml += '<div class="hover-content vcenter">';
                  thumbshtml += '<div>';
                  thumbshtml += '<p class="endscreen-title" >'+val.name+'</p>';
                  thumbshtml += '</div>';
                  thumbshtml += '</div>';
                    
                  if(index == 0 && settings.chainVideos == true){
                    chainKey = index;
                    thumbshtml += '<div id="timer" class="footer">Up next in 10 seconds</div>';
                    startTimer();
                  }
                    
                  thumbshtml += '</a>';
                  thumbshtml += '</li>';
                  
                  index++;
                });
                thumbshtml += '</div></div></ul>';

                $jQ111('#playlist_'+videoId).empty();
                $jQ111('#playlist_'+videoId).append(thumbshtml);
                
                var h = self.find( ".wsjvideo-video-player" ).height();
                var w = self.find( ".wsjvideo-video-player" ).width();

                $jQ111('#playlist_'+videoId).width(w);
                $jQ111('#playlist_'+videoId).height(h);
                if(!isIpad && !isAndroid){
                  $jQ111('#playlist_'+videoId).endScreen({
                    maxItemHeight: 160,
                    delay: 300,
                    onHoverExclude: "item",
                    breakpoints: "2600,1200,800,640,480",
                    countX_2600: 5,
                    countY_2600: 3,
                    countX_1200: 5,
                    countY_1200: 4,
                    countX_800: 3,
                    countY_800: 3,
                    countX_640: 2,
                    countY_640: 2,
                    countX_480: false
                  });
                }else{
                  //$jQ111('#'+videoId).hide();
                  $jQ111('#playlist_'+videoId).endScreen({
                    onHoverExclude: "item",
                    countX: 2,
                    countY: 2
                  });
                }
                if(!settings.directLinks){
                  $jQ111('.endThumb').click(playVideoFromEndScreen);
                }
                $jQ111('#playlist_'+videoId).fadeIn("slow");
                
                var ua = window.navigator.userAgent.toLowerCase();
                var isIphone = ua.match(/(iphone)/i);
                var isIpad = ua.match(/(ipad|iphone|ipod)/i);
                if(isIpad){
                  alert("hide");
                  $jQ111('#'+videoId).hide();
                }
              }
              
              function onRecommendations(data) {
                var videos = data.items;
                settings.playlist = videos;
                buildList(settings.playlist);
              }

            };
            
            function startTimer(){
              if(chainTimer){
                clearInterval(chainTimer);
              }
              chainTimer = setInterval(chainTick, 1000); 
            }
            
            function chainTick(){
              chainTime -= 1;	
              $jQ111("#timer").html("Up next in "+chainTime+" seconds")
              if (chainTime <= 0){
                clearInterval(chainTimer);
                chainTime = 10;
                playVideoFromEndScreen(chainKey);
                return;
              }
            }
            
            playVideoFromEndScreen = function(index){ // HTML 5 endscreen
              var thumbId;
              if( typeof index == "object"){
                thumbId = $jQ111(this).attr("rel");
              }else{
                thumbId = index;
              }
              settings.autoplay = true;
              initTracked = false;
              
              if(thumbId != -1){
                videodata = settings.playlist[thumbId];
                videodata = swapAdData(videodata);
              }
              
              for(var i = 0; i < settings.playlist.length; i++){
                if(settings.playlist[i].guid == videodata.guid){
                  var tmp = settings.playlist.splice(i,1);
                  settings.playlist.push(tmp[0]);
                  break;
                }
              }
              
              try{
                if(externalConfig)
                  settings = $jQ111.extend(videodata, externalConfig); 
              }catch(e){}
              
              setTrackingVars(videodata);  
              trackingMilestones = [false,false,false,false];
              pingMilestone = 0;
              $jQ111('#playlist_'+videoId).fadeOut("fast"); 
              $jQ111('#'+videoId).show();
              if(!videoTag){
                initHTML5(); 
              }else{
                if(isIpad){
                  videoTag.src = videodata.hls;
                }else{
                  videoTag.src = videodata.video664kMP4Url;
                }
                videoTag.play();
              }
              if(!settings.suppressAds){
                requestAd();
              }	
            };
          };
            return this.each(function() {

              });
          }
      });

      if(typeof console === "undefined") { var console = { log: function (logMsg) { } }; }

      function getUrlVars() {
        'use strict';
          var vars = {};
          var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
          if(value === 'true'){
            value = true;	
          }else if(value === 'false'){
            value = false; 	
          }
              vars[key] = value;
          });
          return vars;
      }

      if ( !Date.prototype.toISOString ) {
        ( function() {

          function pad(number) {
            var r = String(number);
            if ( r.length === 1 ) {
              r = '0' + r;
            }
            return r;
          }

          Date.prototype.toISOString = function() {
            return this.getUTCFullYear()
              + '-' + pad( this.getUTCMonth() + 1 )
              + '-' + pad( this.getUTCDate() )
              + 'T' + pad( this.getUTCHours() )
              + ':' + pad( this.getUTCMinutes() )
              + ':' + pad( this.getUTCSeconds() )
              + '.' + String( (this.getUTCMilliseconds()/1000).toFixed(3) ).slice( 2, 5 )
              + 'Z';
          };

        }() );
      }

      var s_account="djglobal,djwsj"; 
      try{
        var url = (window.location != window.parent.location) ? document.referrer: document.location.href;
        if (url.indexOf("wsj.com") !== -1) { 
          s_account = "djglobal,djwsj";
        }
        if(url.indexOf('live.wsj.com')!== -1) {
          s_account = "djglobal,djwsjlive";
        }
        if(url.indexOf("cwsj.com") !== -1) {
          s_account = "djglobal,djwsjchina";
        }
        if(url.indexOf("cn.wsj.com") !== -1){
          s_account = "djglobal,djwsjchina";
        }
        if(url.indexOf("jwsj.com") !== -1) { 
          s_account = "djglobal,djjapanwsj";
        }
        if (url.indexOf("kr.wsj.com") !== -1) { 
          s_account = "djglobal,djwsjkorea";
        }
        if (url.indexOf("indo.wsj.com") !== -1) { 
          s_account = "djglobal,djwsjindonesia";
        }
        if (url.indexOf("marketwatch.com") !== -1) { 
          s_account = "djglobal,djmarketwatch";
        }
        if (url.indexOf("barrons.com") !== -1) { 
          s_account = "djglobal,djbarrons";
        }
        if (url.indexOf("wsj.de") !== -1) { 
          s_account = "djglobal,djwsjgermany";
        }
        if(url.indexOf('allthingsd.com')!== -1){
          s_account = "djglobal,djatd";
        }
        if(url.indexOf('wsj.com.tr')!== -1){
          s_account = "djglobal,djwsjturkey";
        }
        if(url.indexOf('efinancialnews.com')!== -1){
          s_account = "djglobal,djefinancialnews";
        }
      }catch(e){
        s_account = "djglobal,djwsjlive";
      }

      function getDomain(domain){
        "use strict";
        if(domain.indexOf("cwsj.com") !== -1) {
          return "WSJ China";
        }
        if(domain.indexOf("cn.wsj.com") !== -1){
          return "WSJ China";
        }
        if (domain.indexOf("jwsj.com") !== -1) { 
          return "WSJ Japan";
        } 
        if (domain.indexOf("kr.wsj.com") !== -1) { 
          return "WSJ Korea";
        }
        if (domain.indexOf("indo.wsj.com") !== -1) { 
          return "WSJ Indonesia";
        }
        if (domain.indexOf("wsj.com") !== -1) { 
          return "WSJ";
        }
        if (domain.indexOf("marketwatch.com") !== -1) { 
          return "MarketWatch";
        }
        if (domain.indexOf("barrons.com") !== -1) { 
          return "Barrons Online";
        }
        if (domain.indexOf("wsj.de") !== -1) { 
          return "WSJ Germany";
        }
        if(domain.indexOf('allthingsd.com')!== -1){
          return "AllThingsD";
        }
        if(domain.indexOf('smartmoney.com')!== -1){
          return "SmartMoney";
        }
        if(domain.indexOf('fxtrader')!== -1) {
          return "DJFXTrader";
        }
        if(domain.indexOf('fins.com')!== -1) {
          return "FINS";
        }
        return false;
      }

      function loadScript(url, callback, errorCallback){

          var script = document.createElement("script")
          script.type = "text/javascript";

          if (script.readyState){  //IE
              script.onreadystatechange = function(){
                  if (script.readyState == "loaded" ||
                          script.readyState == "complete"){
                      script.onreadystatechange = null;
                      callback();
                  }
              };
          } else {  //Others
              script.onload = function(){
                  callback();
              };
          script.onerror = function(){
                 errorCallback();
              };
          }

          script.src = url;
          document.getElementsByTagName("head")[0].appendChild(script);
      }

      // MOBILE DETECTION //
      function detectmob() { 
        "use strict";
        if( navigator.userAgent.match(/Android/i)
          || navigator.userAgent.match(/webOS/i)
          || navigator.userAgent.match(/iPhone/i)
          || navigator.userAgent.match(/iPad/i)
          || navigator.userAgent.match(/iPod/i)
          || navigator.userAgent.match(/BlackBerry/i)
          || navigator.userAgent.match(/Windows Phone/i)
        ){
          return true;
        }
        return false;
      }
      // HTML CONTROLS //

      (function(jQuery) {
        // plugin definition
        jQuery.fn.wVideo = function(options) {		
          // build main options before element iteration		
          var defaults = {
            theme: 'simpledark',
            childtheme: ''
          };
          var options = $jQ111.extend(defaults, options);
          // iterate and reformat each matched element
          return this.each(function() {
            var $wVideo = $jQ111(this);
            var fullscreenMode; // The media is in fullscreen mode
            //create html structure
            //main wrapper
            var $video_wrap = $jQ111('<div></div>').addClass('wsjvideo-video-player').addClass(options.theme).addClass(options.childtheme);
            //controls wraper
            var $video_controls = $jQ111('<div class="wsjvideo-video-controls"><a class="wsjvideo-video-play" title="Play/Pause"></a><div class="wsjvideo-video-seek"></div><div class="wsjvideo-video-timer">00:00</div><div class="wsjvideo-volume-box"><div class="wsjvideo-volume-slider"></div><a class="wsjvideo-volume-button" title="Mute/Unmute"></a><a class="wsjvideo-volume-button" title="Mute/Unmute"></a></div><a class="wsjvideo-fullscreen-button" title="fullscreen"></a><a class="wsjvideo-chromecast" title="chromecast"></a></div>');						
            $wVideo.wrap($video_wrap);
            $wVideo.before('<div id="playlist"></div>');
            $wVideo.after($video_controls);
            
            //get new elements
            var $video_container 	= 	$wVideo.parent('.wsjvideo-video-player');
            var $ad_container 		= 	$jQ111('#adContainer');
            var $video_controls 	= 	$jQ111('.wsjvideo-video-controls', $video_container);
            var $wsj_play_btn 		= 	$jQ111('.wsjvideo-video-play', $video_container); 
            var $wsj_video_seek 	= 	$jQ111('.wsjvideo-video-seek', $video_container);
            var $wsj_video_timer 	= 	$jQ111('.wsjvideo-video-timer', $video_container);
            var $wsj_volume 		= 	$jQ111('.wsjvideo-volume-slider', $video_container);
            var $wsj_volume_btn 	= 	$jQ111('.wsjvideo-volume-button', $video_container);
            var $fullscreenBtn 		= 	$jQ111('.wsjvideo-fullscreen-button', $video_container);
            var $chromecastBtn 		= 	$jQ111('.wsjvideo-chromecast', $video_container);
            var $isAdvert 			= 	false;
            var $isInitialized 		= 	false;
            var $video_volume 		= 	1;
            var $video_muted 		= 	false;
            var $chromecastMode 	= 	false;

            $wsj_video_seek.width($video_container.width() - 160);
            $jQ111(window).resize(resizeFullscreenVideo);
            $video_controls.hide();
            
            var cVolume = getCookie("djvideovol");
            if(cVolume != ""){
              $video_volume = cVolume;
              $wVideo.prop('volume',$video_volume );
            }
              
            var cMute = getCookie("djvideomute");
            if(cMute != ""){
              if(cMute == 1){
                $video_muted = true;
                $wsj_volume_btn.addClass('wsjvideo-volume-mute');
              }
            }
            
            console.log(getCookie("djvideovol"));

            $video_controls.hover(
              function(){ 
                //$wVideo.unbind('mouseleave');
                $video_controls.show();
              }
            );
            $ad_container.mouseenter(
              function(){ 
                $video_controls.show(); 
              }
            );
            $wVideo.mouseenter(
              function(){ 
                $video_controls.show(); 
              }
            );
            $ad_container.hover(
              function(){ 
                $video_controls.show(); 
              }
            );
            $video_controls.mouseleave(
              function(){ $video_controls.hide();}
            );
            $ad_container.mouseleave(
              function(){ $video_controls.hide();}
            );
            $wVideo.mouseleave(
              function(){ $video_controls.hide();}
            );
            
            //$wsj_video_seek.width($video_container.width() - 172);
            
            var durationUpdater;
            var initUpdater;
            
            $chromecastBtn.hide();
            $video_controls.hide(); // keep the controls hidden
                  
            var gPlay = function() {
              if($wVideo.prop('paused') == false) {
                $wVideo[0].pause();					
              } else {					
                $wVideo[0].play();				
              }
            };

            $wsj_play_btn.click(gPlay);
            $wVideo.click(gPlay);
            
            $wVideo.bind("isAdChanged", function(evt,isAd){
              
              $isAdvert = isAd;
              try{
              if($isAdvert){
                $jQ111(".videoAdUiProgress").show();	
                $wsj_video_seek.slider("disable", true); 
              }else{
                $wsj_video_seek.slider("enable", true); 
              }
              }catch(e){
                
              }

              setDuration();
              //console.log($wVideo.prop('duration'));
            });
            /*
            $wVideo.on("receiverChanged", function(evt, isAvailable) {
              if(isAvailable){
                $wsj_video_seek.width($video_container.width() - 190);
                $chromecastBtn.show();
              }else{
                $wsj_video_seek.width($video_container.width() - 160);
                $chromecastBtn.hide();
              }
            });
            */
            $wVideo.bind("durationchange", function(evt){
              $wsj_video_seek.slider("option", "max", $wVideo.prop('duration'));
            });
            
            $wVideo.bind("endScreenPlay", function(evt){
              $isInitialized = false;
              setDuration();
            });
            
            $wVideo.bind("onAdError", function(evt){
              $isAdvert = false;
              try{
                $wsj_video_seek.slider("enable", true);
              }catch(err){
                
              }
              this.play();
            });
            
            function setDuration(){
              clearTimeout(durationUpdater);

              if($wVideo.prop('readyState') && $isInitialized) {
                if(!$video_muted){
                  $wVideo.prop('volume', $video_volume);
                }else{
                  $wVideo.prop('volume', 0);
                }

                if($isAdvert){
                  $wsj_video_seek.slider("disable", true);
                }else{
                  $wsj_video_seek.slider("enable", true);
                }
                $wsj_video_seek.slider("option", "max", $wVideo.prop('duration'));			
              } else {
                durationUpdater = setTimeout(setDuration, 150);
              }
            }
            
            $wVideo.bind('play', function() {
              $wsj_play_btn.addClass('wsjvideo-paused-button');
            });
            
            $wVideo.bind('pause', function() {
              $wsj_play_btn.removeClass('wsjvideo-paused-button');
            });
            
            $wVideo.bind('ended', function() {
              $wsj_play_btn.removeClass('wsjvideo-paused-button');
            });
            
            var seeksliding;			
            var createSeek = function() {
              if($wVideo.prop('readyState')) {
                clearTimeout(initUpdater);
                var video_duration = $wVideo.prop('duration');
                $wsj_video_seek.slider({
                  value: 0,
                  step: 0.01,
                  orientation: "horizontal",
                  range: "min",
                  max: video_duration,
                  animate: true,					
                  slide: function(){							
                    seeksliding = true;
                  },
                  stop:function(e,ui){
                    seeksliding = false;						
                    $wVideo.prop("currentTime",ui.value);
                  }
                });
                //$video_controls.show();
                $isInitialized = true;					
              } else {
                initUpdater = setTimeout(createSeek, 150);
              }
            };

            createSeek();
          
            var gTimeFormat=function(seconds){
              var m=Math.floor(seconds/60)<10?"0"+Math.floor(seconds/60):Math.floor(seconds/60);
              var s=Math.floor(seconds-(m*60))<10?"0"+Math.floor(seconds-(m*60)):Math.floor(seconds-(m*60));
              return m+":"+s;
            };
            
            var seekUpdate = function() {
              try{
                var currenttime = $wVideo.prop('currentTime');
                if(!seeksliding) $wsj_video_seek.slider('value', currenttime);
                $wsj_video_timer.text(gTimeFormat(currenttime));
              }catch(e){
                  
              }
            };
            
            $wVideo.bind('timeupdate', seekUpdate);	
            
            
            $wsj_volume.slider({
              value: $video_volume,
              orientation: "vertical",
              range: "min",
              max: 1,
              step: 0.05,
              animate: true,
              slide:function(e,ui){
                  $wVideo.prop('muted',false);
                  $video_volume = ui.value;
                  $wVideo.prop('volume',ui.value);
                  document.cookie = "djvideovol="+ui.value;
                  document.cookie = "djvideomute=0";
                }
            });
            
            var muteVolume = function() {
              if($wVideo.prop('muted')==true) {
                $wVideo.prop('muted', false);
                $video_muted = false;
                $wsj_volume.slider('value', $video_volume);
                document.cookie = "djvideomute=0";
                $wsj_volume_btn.removeClass('wsjvideo-volume-mute');					
              } else {
                $video_muted = true;
                $wVideo.prop('muted', true);
                $wsj_volume.slider('value', '0');
                document.cookie = "djvideomute=1";
                $wsj_volume_btn.addClass('wsjvideo-volume-mute');
              };
            };
            
            var selectReceiver = function() {
              $jQ111("#"+$wVideo.attr('id')).off("chromecastSessionStarted", "**" );
              $jQ111("#"+$wVideo.attr('id')).trigger("setReceiver");
              $jQ111("#"+$wVideo.attr('id')).on("chromecastSessionStarted", onChromeSessionStarted);
            
            }
            
            function onChromeSessionStarted(e, videoData){
              console.log(videoData);	
            }
            
            $jQ111(document).on(screenfull.raw.fullscreenchange, function () {
              var isIE11 = !!navigator.userAgent.match(/Trident.*rv[ :]*11\./);
              if(screenfull.isFullscreen && isIE11)
                $wVideo.attr("controls",true);
              else	
                $wVideo.attr("controls",false);
            });
            
            var goFullscreen = function() {
              screenfull.toggle($wVideo.parent().parent()[0]);
              $wVideo.removeClass('fullscreen-video').attr({
                    'width': '100%',
                    'height': '100%'
                  });
              /*
              if(fullscreenMode) {
                
                if(document.exitFullscreen) {
                  document.exitFullscreen();
                  } else if(document.mozCancelFullScreen) {
                  document.mozCancelFullScreen();
                  } else if(document.webkitExitFullscreen) {
                  document.webkitExitFullscreen();
                  }

                if($wVideo[0].cancelFullScreen) {
                  $wVideo[0].cancelFullScreen();
                } else if($wVideo[0].webkitCancelFullScreen) {
                  $wVideo[0].webkitCancelFullScreen();
                } else if($wVideo[0].mozCancelFullScreen) {
                    $wVideo[0].mozCancelFullScreen();
                } else {
                  // if no fullscreen api support, use full-page mode
                  $('body').css('overflow', 'auto');
                
                  var w = $wVideo.attr('data-width');
                  var h = $wVideo.attr('data-height');
                
                  $wVideo.removeClass('fullscreen-video').attr({
                    'width': w,
                    'height': h
                  });

                  $video_controls.removeClass('fullscreen-controls');
                }
                fullscreenMode = false;
                
              } else {
                
                if(document.requestFullscreen) {
                  document.requestFullscreen();
                } else if(document.webkitRequestFullscreen) {
                  document.webkitRequestFullscreen();
                } else if(document.mozRequestFullScreen) {
                    document.mozRequestFullScreen();
                }
                
                if($wVideo[0].requestFullscreen) {
                  $wVideo[0].requestFullscreen();
                } else if($wVideo[0].webkitRequestFullscreen) {
                  $wVideo[0].webkitRequestFullscreen();
                } else if($wVideo[0].mozRequestFullScreen) {
                    $wVideo[0].mozRequestFullScreen();
                } else {
                  $('body').css('overflow', 'hidden');							
                
                  $wVideo.addClass('fullscreen-video').attr({							
                    width: $(window).width(),
                    height: $(window).height()
                  });
                  try{
                  
                  }catch(e){}
                  $video_controls.addClass('fullscreen-controls');
                }
                
                fullscreenMode = true;
                
              }
              */
              
            };
            
            function getCookie(cname) {
              var name = cname + "=";
              var ca = document.cookie.split(';');
              for(var i=0; i<ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1);
                if (c.indexOf(name) != -1) return c.substring(name.length,c.length);
              }
              return "";
            }
            
            function resizeFullscreenVideo(){
              $wsj_video_seek.width($video_controls.width() - 160);
            }
            
            $fullscreenBtn.click(goFullscreen);
            $wsj_volume_btn.click(muteVolume);
            $chromecastBtn.click(selectReceiver);
            
            $wVideo.removeAttr('controls');
            
          });
        };

        jQuery.fn.wVideo.defaults = {		
        };

      })(jQuery);
      }
    }
    return wsjVideo;
  }
);
  // Fullscreen lib
  (function(){"use strict";var e=typeof module!=="undefined"&&module.exports;var t=typeof Element!=="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element;var n=function(){var e;var t;var n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];var r=0;var i=n.length;var s={};for(;r<i;r++){e=n[r];if(e&&e[1]in document){for(r=0,t=e.length;r<t;r++){s[n[0][r]]=e[r]}return s}}return false}();var r={request:function(e){var r=n.requestFullscreen;e=e||document.documentElement;if(/5\.1[\.\d]* Safari/.test(navigator.userAgent)){e[r]()}else{e[r](t&&Element.ALLOW_KEYBOARD_INPUT)}},exit:function(){document[n.exitFullscreen]()},toggle:function(e){if(this.isFullscreen){this.exit()}else{this.request(e)}},onchange:function(){},onerror:function(){},raw:n};if(!n){if(e){module.exports=false}else{window.screenfull=false}return}Object.defineProperties(r,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:true,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:true,get:function(){return!!document[n.fullscreenEnabled]}}});document.addEventListener(n.fullscreenchange,function(e){r.onchange.call(r,e)});document.addEventListener(n.fullscreenerror,function(e){r.onerror.call(r,e)});if(e){module.exports=r}else{window.screenfull=r}})()
  // TRACKING //
  function udm_(e,t){var n="comScore=",r=document,i=r.cookie,s="",o="indexOf",u="substring",a="length",f=2048,l,c="&ns_",h="&",p,d,v,m,g=window,y=g.encodeURIComponent||escape;if(i[o](n)+1)for(v=0,d=i.split(";"),m=d[a];v<m;v++)p=d[v][o](n),p+1&&(s=h+unescape(d[v][u](p+n[a])));e+=c+"_t="+ +(new Date)+c+"c="+(r.characterSet||r.defaultCharset||"")+"&c8="+y(r.title)+s+"&c7="+y(r.URL)+"&c9="+y(r.referrer),e[a]>f&&e[o](h)>0&&(l=e[u](0,f-8).lastIndexOf(h),e=(e[u](0,l)+c+"cut="+y(e[u](l+1)))[u](0,f)),r.images?(p=new Image,g.ns_p||(ns_p=p),typeof t=="function"&&(p.onload=p.onerror=t),p.src=e):r.write("<","p","><",'img src="',e,'" height="1" width="1" alt="*"',"><","/p",">")}function s_gi(e,t,n){var r="s.version='H.25.4';s.an=s_an;s.logDebug=function(m){var s=this,tcf=new Function('var e;try{console.log(\"'+s.rep(s.rep(s.rep(m,\"\\\\\",\"\\\\"+'\\\\"),"\\n","\\\\n"),"\\"","\\\\\\"")+\'");}catch(e){}\');tcf()};s.cls=function(x,c){var i,y=\'\';if(!c)c=this.an;for(i=0;i<x.length;i++){n=x.substring(i,i+1);if(c.indexOf(n)>=0)y+=n}retur'+"n y};s.fl=function(x,l){return x?(''+x).substring(0,l):x};s.co=function(o){return o};s.num=function(x){x=''+x;for(var p=0;p<x.length;p++)if(('0123456789').indexOf(x.substring(p,p+1))<0)return 0;ret"+"urn 1};s.rep=s_rep;s.sp=s_sp;s.jn=s_jn;s.ape=function(x){var s=this,h='0123456789ABCDEF',f=\"+~!*()'\",i,c=s.charSet,n,l,e,y='';c=c?c.toUpperCase():'';if(x){x=''+x;if(s.em==3){x=encodeURIComponent("+"x);for(i=0;i<f.length;i++) {n=f.substring(i,i+1);if(x.indexOf(n)>=0)x=s.rep(x,n,\"%\"+n.charCodeAt(0).toString(16).toUpperCase())}}else if(c=='AUTO'&&('').charCodeAt){for(i=0;i<x.length;i++){c=x.su"+"bstring(i,i+1);n=x.charCodeAt(i);if(n>127){l=0;e='';while(n||l<4){e=h.substring(n%16,n%16+1)+e;n=(n-n%16)/16;l++}y+='%u'+e}else if(c=='+')y+='%2B';else y+=escape(c)}x=y}else x=s.rep(escape(''+x),'+"+"','%2B');if(c&&c!='AUTO'&&s.em==1&&x.indexOf('%u')<0&&x.indexOf('%U')<0){i=x.indexOf('%');while(i>=0){i++;if(h.substring(8).indexOf(x.substring(i,i+1).toUpperCase())>=0)return x.substring(0,i)+'u00"+"'+x.substring(i);i=x.indexOf('%',i)}}}return x};s.epa=function(x){var s=this,y,tcf;if(x){x=s.rep(''+x,'+',' ');if(s.em==3){tcf=new Function('x','var y,e;try{y=decodeURIComponent(x)}catch(e){y=unesc"+"ape(x)}return y');return tcf(x)}else return unescape(x)}return y};s.pt=function(x,d,f,a){var s=this,t=x,z=0,y,r;while(t){y=t.indexOf(d);y=y<0?t.length:y;t=t.substring(0,y);r=s[f](t,a);if(r)return r"+";z+=y+d.length;t=x.substring(z,x.length);t=z<x.length?t:''}return ''};s.isf=function(t,a){var c=a.indexOf(':');if(c>=0)a=a.substring(0,c);c=a.indexOf('=');if(c>=0)a=a.substring(0,c);if(t.substring("+"0,2)=='s_')t=t.substring(2);return (t!=''&&t==a)};s.fsf=function(t,a){var s=this;if(s.pt(a,',','isf',t))s.fsg+=(s.fsg!=''?',':'')+t;return 0};s.fs=function(x,f){var s=this;s.fsg='';s.pt(x,',','fsf'"+",f);return s.fsg};s.mpc=function(m,a){var s=this,c,l,n,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVisibilityState;if(v&&v=='prerender'){if(!s.mpq){s.mpq=new Array;l=s.sp('webkitvisibilitychange,visi"+"bilitychange',',');for(n=0;n<l.length;n++){s.d.addEventListener(l[n],new Function('var s=s_c_il['+s._in+'],c,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVisibilityState;if(s.mpq&&v==\"visible\"){whil"+"e(s.mpq.length>0){c=s.mpq.shift();s[c.m].apply(s,c.a)}s.mpq=0}'),false)}}c=new Object;c.m=m;c.a=a;s.mpq.push(c);return 1}return 0};s.si=function(){var s=this,i,k,v,c=s_gi+'var s=s_gi(\"'+s.oun+'\")"+";s.sa(\"'+s.un+'\");';for(i=0;i<s.va_g.length;i++){k=s.va_g[i];v=s[k];if(v!=undefined){if(typeof(v)!='number')c+='s.'+k+'=\"'+s_fe(v)+'\";';else c+='s.'+k+'='+v+';'}}c+=\"s.lnk=s.eo=s.linkName=s.li"+"nkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';\";return c};s.c_d='';s.c_gdf=function(t,a){var s=this;if(!s.num(t))return 1;return 0};s.c_gd=function(){var s=this,d=s.wd.location.hostnam"+"e,n=s.fpCookieDomainPeriods,p;if(!n)n=s.cookieDomainPeriods;if(d&&!s.c_d){n=n?parseInt(n):2;n=n>2?n:2;p=d.lastIndexOf('.');if(p>=0){while(p>=0&&n>1){p=d.lastIndexOf('.',p-1);n--}s.c_d=p>0&&s.pt(d,'"+".','c_gdf',0)?d.substring(p):d}}return s.c_d};s.c_r=function(k){var s=this;k=s.ape(k);var c=' '+s.d.cookie,i=c.indexOf(' '+k+'='),e=i<0?i:c.indexOf(';',i),v=i<0?'':s.epa(c.substring(i+2+k.length,e<"+"0?c.length:e));return v!='[[B]]'?v:''};s.c_w=function(k,v,e){var s=this,d=s.c_gd(),l=s.cookieLifetime,t;v=''+v;l=l?(''+l).toUpperCase():'';if(e&&l!='SESSION'&&l!='NONE'){t=(v!=''?parseInt(l?l:0):-6"+"0);if(t){e=new Date;e.setTime(e.getTime()+(t*1000))}}if(k&&l!='NONE'){s.d.cookie=k+'='+s.ape(v!=''?v:'[[B]]')+'; path=/;'+(e&&l!='SESSION'?' expires='+e.toGMTString()+';':'')+(d?' domain='+d+';':''"+");return s.c_r(k)==v}return 0};s.eh=function(o,e,r,f){var s=this,b='s_'+e+'_'+s._in,n=-1,l,i,x;if(!s.ehl)s.ehl=new Array;l=s.ehl;for(i=0;i<l.length&&n<0;i++){if(l[i].o==o&&l[i].e==e)n=i}if(n<0){n=i"+";l[n]=new Object}x=l[n];x.o=o;x.e=e;f=r?x.b:f;if(r||f){x.b=r?0:o[e];x.o[e]=f}if(x.b){x.o[b]=x.b;return b}return 0};s.cet=function(f,a,t,o,b){var s=this,r,tcf;if(s.apv>=5&&(!s.isopera||s.apv>=7)){tc"+"f=new Function('s','f','a','t','var e,r;try{r=s[f](a)}catch(e){r=s[t](e)}return r');r=tcf(s,f,a,t)}else{if(s.ismac&&s.u.indexOf('MSIE 4')>=0)r=s[b](a);else{s.eh(s.wd,'onerror',0,o);r=s[f](a);s.eh(s"+".wd,'onerror',1)}}return r};s.gtfset=function(e){var s=this;return s.tfs};s.gtfsoe=new Function('e','var s=s_c_il['+s._in+'],c;s.eh(window,\"onerror\",1);s.etfs=1;c=s.t();if(c)s.d.write(c);s.etfs=0"+";return true');s.gtfsfb=function(a){return window};s.gtfsf=function(w){var s=this,p=w.parent,l=w.location;s.tfs=w;if(p&&p.location!=l&&p.location.host==l.host){s.tfs=p;return s.gtfsf(s.tfs)}return "+"s.tfs};s.gtfs=function(){var s=this;if(!s.tfs){s.tfs=s.wd;if(!s.etfs)s.tfs=s.cet('gtfsf',s.tfs,'gtfset',s.gtfsoe,'gtfsfb')}return s.tfs};s.mrq=function(u){var s=this,l=s.rl[u],n,r;s.rl[u]=0;if(l)fo"+"r(n=0;n<l.length;n++){r=l[n];s.mr(0,0,r.r,r.t,r.u)}};s.flushBufferedRequests=function(){};s.mr=function(sess,q,rs,ta,u){var s=this,dc=s.dc,t1=s.trackingServer,t2=s.trackingServerSecure,tb=s.trackin"+"gServerBase,p='.sc',ns=s.visitorNamespace,un=s.cls(u?u:(ns?ns:s.fun)),r=new Object,l,imn='s_i_'+(un),im,b,e;if(!rs){if(t1){if(t2&&s.ssl)t1=t2}else{if(!tb)tb='2o7.net';if(dc)dc=(''+dc).toLowerCase()"+";else dc='d1';if(tb=='2o7.net'){if(dc=='d1')dc='112';else if(dc=='d2')dc='122';p=''}t1=un+'.'+dc+'.'+p+tb}rs='http'+(s.ssl?'s':'')+'://'+t1+'/b/ss/'+s.un+'/'+(s.mobile?'5.1':'1')+'/'+s.version+(s.t"+"cn?'T':'')+'/'+sess+'?AQB=1&ndh=1'+(q?q:'')+'&AQE=1';if(s.isie&&!s.ismac)rs=s.fl(rs,2047)}if(s.d.images&&s.apv>=3&&(!s.isopera||s.apv>=7)&&(s.ns6<0||s.apv>=6.1)){if(!s.rc)s.rc=new Object;if(!s.rc[u"+"n]){s.rc[un]=1;if(!s.rl)s.rl=new Object;s.rl[un]=new Array;setTimeout('if(window.s_c_il)window.s_c_il['+s._in+'].mrq(\"'+un+'\")',750)}else{l=s.rl[un];if(l){r.t=ta;r.u=un;r.r=rs;l[l.length]=r;retur"+"n ''}imn+='_'+s.rc[un];s.rc[un]++}if(s.debugTracking){var d='AppMeasurement Debug: '+rs,dl=s.sp(rs,'&'),dln;for(dln=0;dln<dl.length;dln++)d+=\"\\n\\t\"+s.epa(dl[dln]);s.logDebug(d)}im=s.wd[imn];if("+"!im)im=s.wd[imn]=new Image;im.s_l=0;im.onload=new Function('e','this.s_l=1;var wd=window,s;if(wd.s_c_il){s=wd.s_c_il['+s._in+'];s.bcr();s.mrq(\"'+un+'\");s.nrs--;if(!s.nrs)s.m_m(\"rr\")}');if(!s.nr"+"s){s.nrs=1;s.m_m('rs')}else s.nrs++;im.src=rs;if(s.useForcedLinkTracking||s.bcf){if(!s.forcedLinkTrackingTimeout)s.forcedLinkTrackingTimeout=250;setTimeout('if(window.s_c_il)window.s_c_il['+s._in+'"+"].bcr()',s.forcedLinkTrackingTimeout);}else if((s.lnk||s.eo)&&(!ta||ta=='_self'||ta=='_top'||(s.wd.name&&ta==s.wd.name))){b=e=new Date;while(!im.s_l&&e.getTime()-b.getTime()<500)e=new Date}return '"+"'}return '<im'+'g sr'+'c=\"'+rs+'\" width=1 height=1 border=0 alt=\"\">'};s.gg=function(v){var s=this;if(!s.wd['s_'+v])s.wd['s_'+v]='';return s.wd['s_'+v]};s.glf=function(t,a){if(t.substring(0,2)=="+"'s_')t=t.substring(2);var s=this,v=s.gg(t);if(v)s[t]=v};s.gl=function(v){var s=this;if(s.pg)s.pt(v,',','glf',0)};s.rf=function(x){var s=this,y,i,j,h,p,l=0,q,a,b='',c='',t;if(x&&x.length>255){y=''+x"+";i=y.indexOf('?');if(i>0){q=y.substring(i+1);y=y.substring(0,i);h=y.toLowerCase();j=0;if(h.substring(0,7)=='http://')j+=7;else if(h.substring(0,8)=='https://')j+=8;i=h.indexOf(\"/\",j);if(i>0){h=h."+"substring(j,i);p=y.substring(i);y=y.substring(0,i);if(h.indexOf('google')>=0)l=',q,ie,start,search_key,word,kw,cd,';else if(h.indexOf('yahoo.co')>=0)l=',p,ei,';if(l&&q){a=s.sp(q,'&');if(a&&a.length"+">1){for(j=0;j<a.length;j++){t=a[j];i=t.indexOf('=');if(i>0&&l.indexOf(','+t.substring(0,i)+',')>=0)b+=(b?'&':'')+t;else c+=(c?'&':'')+t}if(b&&c)q=b+'&'+c;else c=''}i=253-(q.length-c.length)-y.lengt"+"h;x=y+(i>0?p.substring(0,i):'')+'?'+q}}}}return x};s.s2q=function(k,v,vf,vfp,f){var s=this,qs='',sk,sv,sp,ss,nke,nk,nf,nfl=0,nfn,nfm;if(k==\"contextData\")k=\"c\";if(v){for(sk in v)if((!f||sk.subst"+"ring(0,f.length)==f)&&v[sk]&&(!vf||vf.indexOf(','+(vfp?vfp+'.':'')+sk+',')>=0)&&(!Object||!Object.prototype||!Object.prototype[sk])){nfm=0;if(nfl)for(nfn=0;nfn<nfl.length;nfn++)if(sk.substring(0,nf"+"l[nfn].length)==nfl[nfn])nfm=1;if(!nfm){if(qs=='')qs+='&'+k+'.';sv=v[sk];if(f)sk=sk.substring(f.length);if(sk.length>0){nke=sk.indexOf('.');if(nke>0){nk=sk.substring(0,nke);nf=(f?f:'')+nk+'.';if(!n"+"fl)nfl=new Array;nfl[nfl.length]=nf;qs+=s.s2q(nk,v,vf,vfp,nf)}else{if(typeof(sv)=='boolean'){if(sv)sv='true';else sv='false'}if(sv){if(vfp=='retrieveLightData'&&f.indexOf('.contextData.')<0){sp=sk."+"substring(0,4);ss=sk.substring(4);if(sk=='transactionID')sk='xact';else if(sk=='channel')sk='ch';else if(sk=='campaign')sk='v0';else if(s.num(ss)){if(sp=='prop')sk='c'+ss;else if(sp=='eVar')sk='v'+"+"ss;else if(sp=='list')sk='l'+ss;else if(sp=='hier'){sk='h'+ss;sv=sv.substring(0,255)}}}qs+='&'+s.ape(sk)+'='+s.ape(sv)}}}}}if(qs!='')qs+='&.'+k}return qs};s.hav=function(){var s=this,qs='',l,fv='',"+"fe='',mn,i,e;if(s.lightProfileID){l=s.va_m;fv=s.lightTrackVars;if(fv)fv=','+fv+','+s.vl_mr+','}else{l=s.va_t;if(s.pe||s.linkType){fv=s.linkTrackVars;fe=s.linkTrackEvents;if(s.pe){mn=s.pe.substring("+"0,1).toUpperCase()+s.pe.substring(1);if(s[mn]){fv=s[mn].trackVars;fe=s[mn].trackEvents}}}if(fv)fv=','+fv+','+s.vl_l+','+s.vl_l2;if(fe){fe=','+fe+',';if(fv)fv+=',events,'}if (s.linkTrackEvents2)e=(e?',':'')+"+"s.linkTrackEvents2}for(i=0;i<l.length;i++){var k=l[i],v=s[k],b=k.substring(0,4),x=k.substring(4),n=parseInt(x),q=k;if(!v)if(k=='events'&&e){v=e;e=''}if(v&&(!fv||fv.indexOf(','+k+',')>=0)&&k!='linkName'&&k!="+"'linkType'){if(k=='timestamp')q='ts';else if(k=='dynamicVariablePrefix')q='D';else if(k=='visitorID')q='vid';else if(k=='pageURL'){q='g';if(v.length>255){s.pageURLRest=v.substring(255);v=v.substrin"+"g(0,255);}}else if(k=='pageURLRest')q='-g';else if(k=='referrer'){q='r';v=s.fl(s.rf(v),255)}else if(k=='vmk'||k=='visitorMigrationKey')q='vmt';else if(k=='visitorMigrationServer'){q='vmf';if(s.ssl&"+"&s.visitorMigrationServerSecure)v=''}else if(k=='visitorMigrationServerSecure'){q='vmf';if(!s.ssl&&s.visitorMigrationServer)v=''}else if(k=='charSet'){q='ce';if(v.toUpperCase()=='AUTO')v='ISO8859-1"+"';else if(s.em==2||s.em==3)v='UTF-8'}else if(k=='visitorNamespace')q='ns';else if(k=='cookieDomainPeriods')q='cdp';else if(k=='cookieLifetime')q='cl';else if(k=='variableProvider')q='vvp';else if(k"+"=='currencyCode')q='cc';else if(k=='channel')q='ch';else if(k=='transactionID')q='xact';else if(k=='campaign')q='v0';else if(k=='resolution')q='s';else if(k=='colorDepth')q='c';else if(k=='javascri"+"ptVersion')q='j';else if(k=='javaEnabled')q='v';else if(k=='cookiesEnabled')q='k';else if(k=='browserWidth')q='bw';else if(k=='browserHeight')q='bh';else if(k=='connectionType')q='ct';else if(k=='h"+"omepage')q='hp';else if(k=='plugins')q='p';else if(k=='events'){if(e)v+=(v?',':'')+e;if(fe)v=s.fs(v,fe)}else if(k=='events2')v='';else if(k=='contextData'){qs+=s.s2q('c',s[k],fv,k,0);v=''}else if(k"+"=='lightProfileID')q='mtp';else if(k=='lightStoreForSeconds'){q='mtss';if(!s.lightProfileID)v=''}else if(k=='lightIncrementBy'){q='mti';if(!s.lightProfileID)v=''}else if(k=='retrieveLightProfiles')"+"q='mtsr';else if(k=='deleteLightProfiles')q='mtsd';else if(k=='retrieveLightData'){if(s.retrieveLightProfiles)qs+=s.s2q('mts',s[k],fv,k,0);v=''}else if(s.num(x)){if(b=='prop')q='c'+n;else if(b=='eV"+"ar')q='v'+n;else if(b=='list')q='l'+n;else if(b=='hier'){q='h'+n;v=s.fl(v,255)}}if(v)qs+='&'+s.ape(q)+'='+(k.substring(0,3)!='pev'?s.ape(v):v)}}return qs};s.ltdf=function(t,h){t=t?t.toLowerCase():'"+"';h=h?h.toLowerCase():'';var qi=h.indexOf('?');h=qi>=0?h.substring(0,qi):h;if(t&&h.substring(h.length-(t.length+1))=='.'+t)return 1;return 0};s.ltef=function(t,h){t=t?t.toLowerCase():'';h=h?h.toLow"+"erCase():'';if(t&&h.indexOf(t)>=0)return 1;return 0};s.lt=function(h){var s=this,lft=s.linkDownloadFileTypes,lef=s.linkExternalFilters,lif=s.linkInternalFilters;lif=lif?lif:s.wd.location.hostname;h"+"=h.toLowerCase();if(s.trackDownloadLinks&&lft&&s.pt(lft,',','ltdf',h))return 'd';if(s.trackExternalLinks&&h.indexOf('#')!=0&&h.indexOf('about:')!=0&&h.indexOf('javascript:')!=0&&(lef||lif)&&(!lef||"+"s.pt(lef,',','ltef',h))&&(!lif||!s.pt(lif,',','ltef',h)))return 'e';return ''};s.lc=new Function('e','var s=s_c_il['+s._in+'],b=s.eh(this,\"onclick\");s.lnk=this;s.t();s.lnk=0;if(b)return this[b](e"+");return true');s.bcr=function(){var s=this;if(s.bct&&s.bce)s.bct.dispatchEvent(s.bce);if(s.bcf){if(typeof(s.bcf)=='function')s.bcf();else if(s.bct&&s.bct.href)s.d.location=s.bct.href}s.bct=s.bce=s"+".bcf=0};s.bc=new Function('e','if(e&&e.s_fe)return;var s=s_c_il['+s._in+'],f,tcf,t,n,nrs,a,h;if(s.d&&s.d.all&&s.d.all.cppXYctnr)return;if(!s.bbc)s.useForcedLinkTracking=0;else if(!s.useForcedLinkTr"+'acking){s.b.removeEventListener("click",s.bc,true);s.bbc=s.useForcedLinkTracking=0;return}else s.b.removeEventListener("click",s.bc,false);s.eo=e.srcElement?e.srcElement:e.target;nrs=s.nrs;s.t('+');s.eo=0;if(s.nrs>nrs&&s.useForcedLinkTracking&&e.target){a=e.target;while(a&&a!=s.b&&a.tagName.toUpperCase()!="A"&&a.tagName.toUpperCase()!="AREA")a=a.parentNode;if(a){h=a.href;if(h.indexOf("'+'#")==0||h.indexOf("about:")==0||h.indexOf("javascript:")==0)h=0;t=a.target;if(e.target.dispatchEvent&&h&&(!t||t=="_self"||t=="_top"||(s.wd.name&&t==s.wd.name))){e.stopPropagation();e.stopI'+'mmediatePropagation();e.preventDefault();n=s.d.createEvent("MouseEvents");n.initMouseEvent("click",e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.alt'+"Key,e.shiftKey,e.metaKey,e.button,e.relatedTarget);n.s_fe=1;s.bct=e.target;s.bce=n}}}');s.oh=function(o){var s=this,l=s.wd.location,h=o.href?o.href:'',i,j,k,p;i=h.indexOf(':');j=h.indexOf('?');k=h."+"indexOf('/');if(h&&(i<0||(j>=0&&i>j)||(k>=0&&i>k))){p=o.protocol&&o.protocol.length>1?o.protocol:(l.protocol?l.protocol:'');i=l.pathname.lastIndexOf('/');h=(p?p+'//':'')+(o.host?o.host:(l.host?l.ho"+"st:''))+(h.substring(0,1)!='/'?l.pathname.substring(0,i<0?0:i)+'/':'')+h}return h};s.ot=function(o){var t=o.tagName;if(o.tagUrn||(o.scopeName&&o.scopeName.toUpperCase()!='HTML'))return '';t=t&&t.to"+"UpperCase?t.toUpperCase():'';if(t=='SHAPE')t='';if(t){if((t=='INPUT'||t=='BUTTON')&&o.type&&o.type.toUpperCase)t=o.type.toUpperCase();else if(!t&&o.href)t='A';}return t};s.oid=function(o){var s=thi"+"s,t=s.ot(o),p,c,n='',x=0;if(t&&!o.s_oid){p=o.protocol;c=o.onclick;if(o.href&&(t=='A'||t=='AREA')&&(!c||!p||p.toLowerCase().indexOf('javascript')<0))n=s.oh(o);else if(c){n=s.rep(s.rep(s.rep(s.rep(''"+"+c,\"\\r\",''),\"\\n\",''),\"\\t\",''),' ','');x=2}else if(t=='INPUT'||t=='SUBMIT'){if(o.value)n=o.value;else if(o.innerText)n=o.innerText;else if(o.textContent)n=o.textContent;x=3}else if(o.src&&t"+"=='IMAGE')n=o.src;if(n){o.s_oid=s.fl(n,100);o.s_oidt=x}}return o.s_oid};s.rqf=function(t,un){var s=this,e=t.indexOf('='),u=e>=0?t.substring(0,e):'',q=e>=0?s.epa(t.substring(e+1)):'';if(u&&q&&(','+u"+"+',').indexOf(','+un+',')>=0){if(u!=s.un&&s.un.indexOf(',')>=0)q='&u='+u+q+'&u=0';return q}return ''};s.rq=function(un){if(!un)un=this.un;var s=this,c=un.indexOf(','),v=s.c_r('s_sq'),q='';if(c<0)re"+"turn s.pt(v,'&','rqf',un);return s.pt(un,',','rq',0)};s.sqp=function(t,a){var s=this,e=t.indexOf('='),q=e<0?'':s.epa(t.substring(e+1));s.sqq[q]='';if(e>=0)s.pt(t.substring(0,e),',','sqs',q);return "+"0};s.sqs=function(un,q){var s=this;s.squ[un]=q;return 0};s.sq=function(q){var s=this,k='s_sq',v=s.c_r(k),x,c=0;s.sqq=new Object;s.squ=new Object;s.sqq[q]='';s.pt(v,'&','sqp',0);s.pt(s.un,',','sqs',"+"q);v='';for(x in s.squ)if(x&&(!Object||!Object.prototype||!Object.prototype[x]))s.sqq[s.squ[x]]+=(s.sqq[s.squ[x]]?',':'')+x;for(x in s.sqq)if(x&&(!Object||!Object.prototype||!Object.prototype[x])&&"+"s.sqq[x]&&(x==q||c<2)){v+=(v?'&':'')+s.sqq[x]+'='+s.ape(x);c++}return s.c_w(k,v,0)};s.wdl=new Function('e','var s=s_c_il['+s._in+'],r=true,b=s.eh(s.wd,\"onload\"),i,o,oc;if(b)r=this[b](e);for(i=0;i"+'<s.d.links.length;i++){o=s.d.links[i];oc=o.onclick?""+o.onclick:"";if((oc.indexOf("s_gs(")<0||oc.indexOf(".s_oc(")>=0)&&oc.indexOf(".tl(")<0)s.eh(o,"onclick",0,s.lc);}return r\');s.wds=f'+"unction(){var s=this;if(s.apv>3&&(!s.isie||!s.ismac||s.apv>=5)){if(s.b&&s.b.attachEvent)s.b.attachEvent('onclick',s.bc);else if(s.b&&s.b.addEventListener){if(s.n&&s.n.userAgent.indexOf('WebKit')>=0"+"&&s.d.createEvent){s.bbc=1;s.useForcedLinkTracking=1;s.b.addEventListener('click',s.bc,true)}s.b.addEventListener('click',s.bc,false)}else s.eh(s.wd,'onload',0,s.wdl)}};s.vs=function(x){var s=this,"+"v=s.visitorSampling,g=s.visitorSamplingGroup,k='s_vsn_'+s.un+(g?'_'+g:''),n=s.c_r(k),e=new Date,y=e.getYear();e.setYear(y+10+(y<1900?1900:0));if(v){v*=100;if(!n){if(!s.c_w(k,x,e))return 0;n=x}if(n%"+"10000>v)return 0}return 1};s.dyasmf=function(t,m){if(t&&m&&m.indexOf(t)>=0)return 1;return 0};s.dyasf=function(t,m){var s=this,i=t?t.indexOf('='):-1,n,x;if(i>=0&&m){var n=t.substring(0,i),x=t.subst"+"ring(i+1);if(s.pt(x,',','dyasmf',m))return n}return 0};s.uns=function(){var s=this,x=s.dynamicAccountSelection,l=s.dynamicAccountList,m=s.dynamicAccountMatch,n,i;s.un=s.un.toLowerCase();if(x&&l){if"+"(!m)m=s.wd.location.host;if(!m.toLowerCase)m=''+m;l=l.toLowerCase();m=m.toLowerCase();n=s.pt(l,';','dyasf',m);if(n)s.un=n}i=s.un.indexOf(',');s.fun=i<0?s.un:s.un.substring(0,i)};s.sa=function(un){v"+"ar s=this;if(s.un&&s.mpc('sa',arguments))return;s.un=un;if(!s.oun)s.oun=un;else if((','+s.oun+',').indexOf(','+un+',')<0)s.oun+=','+un;s.uns()};s.m_i=function(n,a){var s=this,m,f=n.substring(0,1),r"+",l,i;if(!s.m_l)s.m_l=new Object;if(!s.m_nl)s.m_nl=new Array;m=s.m_l[n];if(!a&&m&&m._e&&!m._i)s.m_a(n);if(!m){m=new Object,m._c='s_m';m._in=s.wd.s_c_in;m._il=s._il;m._il[m._in]=m;s.wd.s_c_in++;m.s=s"+";m._n=n;m._l=new Array('_c','_in','_il','_i','_e','_d','_dl','s','n','_r','_g','_g1','_t','_t1','_x','_x1','_rs','_rr','_l');s.m_l[n]=m;s.m_nl[s.m_nl.length]=n}else if(m._r&&!m._m){r=m._r;r._m=m;l="+"m._l;for(i=0;i<l.length;i++)if(m[l[i]])r[l[i]]=m[l[i]];r._il[r._in]=r;m=s.m_l[n]=r}if(f==f.toUpperCase())s[n]=m;return m};s.m_a=new Function('n','g','e','if(!g)g=\"m_\"+n;var s=s_c_il['+s._in+'],c="+'s[g+"_c"],m,x,f=0;if(s.mpc("m_a",arguments))return;if(!c)c=s.wd["s_"+g+"_c"];if(c&&s_d)s[g]=new Function("s",s_ft(s_d(c)));x=s[g];if(!x)x=s.wd[\\\'s_\\\'+g];if(!x)x=s.wd[g];m=s.m_i(n,1);if('+'x&&(!m._i||g!="m_"+n)){m._i=f=1;if((""+x).indexOf("function")>=0)x(s);else s.m_m("x",n,x,e)}m=s.m_i(n,1);if(m._dl)m._dl=m._d=0;s.dlt();return f\');s.m_m=function(t,n,d,e){t=\'_\'+t;var s=this,'+"i,x,m,f='_'+t,r=0,u;if(s.m_l&&s.m_nl)for(i=0;i<s.m_nl.length;i++){x=s.m_nl[i];if(!n||x==n){m=s.m_i(x);u=m[t];if(u){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t](d,e);else if(d)u=m[t](d);else u=m"+"[t]()}}if(u)r=1;u=m[t+1];if(u&&!m[f]){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t+1](d,e);else if(d)u=m[t+1](d);else u=m[t+1]()}}m[f]=1;if(u)r=1}}return r};s.m_ll=function(){var s=this,g=s.m_dl"+",i,o;if(g)for(i=0;i<g.length;i++){o=g[i];if(o)s.loadModule(o.n,o.u,o.d,o.l,o.e,1);g[i]=0}};s.loadModule=function(n,u,d,l,e,ln){var s=this,m=0,i,g,o=0,f1,f2,c=s.h?s.h:s.b,b,tcf;if(n){i=n.indexOf(':'"+");if(i>=0){g=n.substring(i+1);n=n.substring(0,i)}else g=\"m_\"+n;m=s.m_i(n)}if((l||(n&&!s.m_a(n,g)))&&u&&s.d&&c&&s.d.createElement){if(d){m._d=1;m._dl=1}if(ln){if(s.ssl)u=s.rep(u,'http:','https:');"+"i='s_s:'+s._in+':'+n+':'+g;b='var s=s_c_il['+s._in+'],o=s.d.getElementById(\"'+i+'\");if(s&&o){if(!o.l&&s.wd.'+g+'){o.l=1;if(o.i)clearTimeout(o.i);o.i=0;s.m_a(\"'+n+'\",\"'+g+'\"'+(e?',\"'+e+'\"':'"+"')+')}';f2=b+'o.c++;if(!s.maxDelay)s.maxDelay=250;if(!o.l&&o.c<(s.maxDelay*2)/100)o.i=setTimeout(o.f2,100)}';f1=new Function('e',b+'}');tcf=new Function('s','c','i','u','f1','f2','var e,o=0;try{o=s"+".d.createElement(\"script\");if(o){o.type=\"text/javascript\";'+(n?'o.id=i;o.defer=true;o.onload=o.onreadystatechange=f1;o.f2=f2;o.l=0;':'')+'o.src=u;c.appendChild(o);'+(n?'o.c=0;o.i=setTimeout(f2,"+"100)':'')+'}}catch(e){o=0}return o');o=tcf(s,c,i,u,f1,f2)}else{o=new Object;o.n=n+':'+g;o.u=u;o.d=d;o.l=l;o.e=e;g=s.m_dl;if(!g)g=s.m_dl=new Array;i=0;while(i<g.length&&g[i])i++;g[i]=o}}else if(n){m"+'=s.m_i(n);m._e=1}return m};s.voa=function(vo,r){var s=this,l=s.va_g,i,k,v,x;for(i=0;i<l.length;i++){k=l[i];v=vo[k];if(v||vo[\'!\'+k]){if(!r&&(k=="contextData"||k=="retrieveLightData")&&s[k])for(x'+" in s[k])if(!v[x])v[x]=s[k][x];s[k]=v}}};s.vob=function(vo){var s=this,l=s.va_g,i,k;for(i=0;i<l.length;i++){k=l[i];vo[k]=s[k];if(!vo[k])vo['!'+k]=1}};s.dlt=new Function('var s=s_c_il['+s._in+'],d=n"+'ew Date,i,vo,f=0;if(s.dll)for(i=0;i<s.dll.length;i++){vo=s.dll[i];if(vo){if(!s.m_m("d")||d.getTime()-vo._t>=s.maxDelay){s.dll[i]=0;s.t(vo)}else f=1}}if(s.dli)clearTimeout(s.dli);s.dli=0;if(f){if('+"!s.dli)s.dli=setTimeout(s.dlt,s.maxDelay)}else s.dll=0');s.dl=function(vo){var s=this,d=new Date;if(!vo)vo=new Object;s.vob(vo);vo._t=d.getTime();if(!s.dll)s.dll=new Array;s.dll[s.dll.length]=vo;if"+"(!s.maxDelay)s.maxDelay=250;s.dlt()};s.gfid=function(){var s=this,d='0123456789ABCDEF',k='s_fid',fid=s.c_r(k),h='',l='',i,j,m=8,n=4,e=new Date,y;if(!fid||fid.indexOf('-')<0){for(i=0;i<16;i++){j=Mat"+"h.floor(Math.random()*m);h+=d.substring(j,j+1);j=Math.floor(Math.random()*n);l+=d.substring(j,j+1);m=n=16}fid=h+'-'+l;}y=e.getYear();e.setYear(y+2+(y<1900?1900:0));if(!s.c_w(k,fid,e))fid=0;return f"+"id};s.applyADMS=function(){var s=this,vb=new Object;if(s.wd.ADMS&&!s.visitorID&&!s.admsc){if(!s.adms)s.adms=ADMS.getDefault();if(!s.admsq){s.visitorID=s.adms.getVisitorID(new Function('v','var s=s_"+"c_il['+s._in+'],l=s.admsq,i;if(v==-1)v=0;if(v)s.visitorID=v;s.admsq=0;if(l){s.admsc=1;for(i=0;i<l.length;i++)s.t(l[i]);s.admsc=0;}'));if(!s.visitorID)s.admsq=new Array}if(s.admsq){s.vob(vb);vb['!vi"+"sitorID']=0;s.admsq.push(vb);return 1}else{if(s.visitorID==-1)s.visitorID=0}}return 0};s.track=s.t=function(vo){var s=this,trk=1,tm=new Date,sed=Math&&Math.random?Math.floor(Math.random()*100000000"+"00000):tm.getTime(),sess='s'+Math.floor(tm.getTime()/10800000)%10+sed,y=tm.getYear(),vt=tm.getDate()+'/'+tm.getMonth()+'/'+(y<1900?y+1900:y)+' '+tm.getHours()+':'+tm.getMinutes()+':'+tm.getSeconds("+")+' '+tm.getDay()+' '+tm.getTimezoneOffset(),tcf,tfs=s.gtfs(),ta=-1,q='',qs='',code='',vb=new Object;if(s.mpc('t',arguments))return;s.gl(s.vl_g);s.uns();s.m_ll();if(!s.td){var tl=tfs.location,a,o,i"+",x='',c='',v='',p='',bw='',bh='',j='1.0',k=s.c_w('s_cc','true',0)?'Y':'N',hp='',ct='',pn=0,ps;if(String&&String.prototype){j='1.1';if(j.match){j='1.2';if(tm.setUTCDate){j='1.3';if(s.isie&&s.ismac&&"+"s.apv>=5)j='1.4';if(pn.toPrecision){j='1.5';a=new Array;if(a.forEach){j='1.6';i=0;o=new Object;tcf=new Function('o','var e,i=0;try{i=new Iterator(o)}catch(e){}return i');i=tcf(o);if(i&&i.next){j='1"+".7';if(a.reduce){j='1.8';if(j.trim){j='1.8.1';if(Date.parse){j='1.8.2';if(Object.create)j='1.8.5'}}}}}}}}}if(s.apv>=4)x=screen.width+'x'+screen.height;if(s.isns||s.isopera){if(s.apv>=3){v=s.n.javaE"+"nabled()?'Y':'N';if(s.apv>=4){c=screen.pixelDepth;bw=s.wd.innerWidth;bh=s.wd.innerHeight}}s.pl=s.n.plugins}else if(s.isie){if(s.apv>=4){v=s.n.javaEnabled()?'Y':'N';c=screen.colorDepth;if(s.apv>=5){"+"bw=s.d.documentElement.offsetWidth;bh=s.d.documentElement.offsetHeight;if(!s.ismac&&s.b){tcf=new Function('s','tl','var e,hp=0;try{s.b.addBehavior(\"#default#homePage\");hp=s.b.isHomePage(tl)?\"Y\""+":\"N\"}catch(e){}return hp');hp=tcf(s,tl);tcf=new Function('s','var e,ct=0;try{s.b.addBehavior(\"#default#clientCaps\");ct=s.b.connectionType}catch(e){}return ct');ct=tcf(s)}}}else r=''}if(s.pl)whi"+"le(pn<s.pl.length&&pn<30){ps=s.fl(s.pl[pn].name,100)+';';if(p.indexOf(ps)<0)p+=ps;pn++}s.resolution=x;s.colorDepth=c;s.javascriptVersion=j;s.javaEnabled=v;s.cookiesEnabled=k;s.browserWidth=bw;s.bro"+"wserHeight=bh;s.connectionType=ct;s.homepage=hp;s.plugins=p;s.td=1}if(vo){s.vob(vb);s.voa(vo)}s.fid=s.gfid();if(s.applyADMS())return '';if((vo&&vo._t)||!s.m_m('d')){if(s.usePlugins)s.doPlugins(s);i"+"f(!s.abort){var l=s.wd.location,r=tfs.document.referrer;if(!s.pageURL)s.pageURL=l.href?l.href:l;if(!s.referrer&&!s._1_referrer){s.referrer=r;s._1_referrer=1}s.m_m('g');if(s.lnk||s.eo){var o=s.eo?s."+"eo:s.lnk,p=s.pageName,w=1,t=s.ot(o),n=s.oid(o),x=o.s_oidt,h,l,i,oc;if(s.eo&&o==s.eo){while(o&&!n&&t!='BODY'){o=o.parentElement?o.parentElement:o.parentNode;if(o){t=s.ot(o);n=s.oid(o);x=o.s_oidt}}if"+"(!n||t=='BODY')o='';if(o){oc=o.onclick?''+o.onclick:'';if((oc.indexOf('s_gs(')>=0&&oc.indexOf('.s_oc(')<0)||oc.indexOf('.tl(')>=0)o=0}}if(o){if(n)ta=o.target;h=s.oh(o);i=h.indexOf('?');h=s.linkLeav"+"eQueryString||i<0?h:h.substring(0,i);l=s.linkName;t=s.linkType?s.linkType.toLowerCase():s.lt(h);if(t&&(h||l)){s.pe='lnk_'+(t=='d'||t=='e'?t:'o');s.pev1=(h?s.ape(h):'');s.pev2=(l?s.ape(l):'')}else t"+"rk=0;if(s.trackInlineStats){if(!p){p=s.pageURL;w=0}t=s.ot(o);i=o.sourceIndex;if(o.dataset&&o.dataset.sObjectId){s.wd.s_objectID=o.dataset.sObjectId;}else if(o.getAttribute&&o.getAttribute('data-s-o"+"bject-id')){s.wd.s_objectID=o.getAttribute('data-s-object-id');}else if(s.useForcedLinkTracking){s.wd.s_objectID='';oc=o.onclick?''+o.onclick:'';if(oc){var ocb=oc.indexOf('s_objectID'),oce,ocq,ocx;"+"if(ocb>=0){ocb+=10;while(ocb<oc.length&&(\"= \\t\\r\\n\").indexOf(oc.charAt(ocb))>=0)ocb++;if(ocb<oc.length){oce=ocb;ocq=ocx=0;while(oce<oc.length&&(oc.charAt(oce)!=';'||ocq)){if(ocq){if(oc.charAt("+"oce)==ocq&&!ocx)ocq=0;else if(oc.charAt(oce)==\"\\\\\")ocx=!ocx;else ocx=0;}else{ocq=oc.charAt(oce);if(ocq!='\"'&&ocq!=\"'\")ocq=0}oce++;}oc=oc.substring(ocb,oce);if(oc){o.s_soid=new Function('s','"+"var e;try{s.wd.s_objectID='+oc+'}catch(e){}');o.s_soid(s)}}}}}if(s.gg('objectID')){n=s.gg('objectID');x=1;i=1}if(p&&n&&t)qs='&pid='+s.ape(s.fl(p,255))+(w?'&pidt='+w:'')+'&oid='+s.ape(s.fl(n,100))+("+"x?'&oidt='+x:'')+'&ot='+s.ape(t)+(i?'&oi='+i:'')}}else trk=0}if(trk||qs){s.sampled=s.vs(sed);if(trk){if(s.sampled)code=s.mr(sess,(vt?'&t='+s.ape(vt):'')+s.hav()+q+(qs?qs:s.rq()),0,ta);qs='';s.m_m('"+"t');if(s.p_r)s.p_r();s.referrer=s.lightProfileID=s.retrieveLightProfiles=s.deleteLightProfiles=''}s.sq(qs)}}}else s.dl(vo);if(vo)s.voa(vb,1);s.abort=0;s.pageURLRest=s.lnk=s.eo=s.linkName=s.linkType"+"=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';if(s.pg)s.wd.s_lnk=s.wd.s_eo=s.wd.s_linkName=s.wd.s_linkType='';return code};s.trackLink=s.tl=function(o,t,n,vo,f){var s=this;s.lnk=o;s.linkType="+"t;s.linkName=n;if(f){s.bct=o;s.bcf=f}s.t(vo)};s.trackLight=function(p,ss,i,vo){var s=this;s.lightProfileID=p;s.lightStoreForSeconds=ss;s.lightIncrementBy=i;s.t(vo)};s.setTagContainer=function(n){va"+"r s=this,l=s.wd.s_c_il,i,t,x,y;s.tcn=n;if(l)for(i=0;i<l.length;i++){t=l[i];if(t&&t._c=='s_l'&&t.tagContainerName==n){s.voa(t);if(t.lmq)for(i=0;i<t.lmq.length;i++){x=t.lmq[i];y='m_'+x.n;if(!s[y]&&!s"+"[y+'_c']){s[y]=t[y];s[y+'_c']=t[y+'_c']}s.loadModule(x.n,x.u,x.d)}if(t.ml)for(x in t.ml)if(s[x]){y=s[x];x=t.ml[x];for(i in x)if(!Object.prototype[i]){if(typeof(x[i])!='function'||(''+x[i]).indexOf("+"'s_c_il')<0)y[i]=x[i]}}if(t.mmq)for(i=0;i<t.mmq.length;i++){x=t.mmq[i];if(s[x.m]){y=s[x.m];if(y[x.f]&&typeof(y[x.f])=='function'){if(x.a)y[x.f].apply(y,x.a);else y[x.f].apply(y)}}}if(t.tq)for(i=0;i"+"<t.tq.length;i++)s.t(t.tq[i]);t.s=s;return}}};s.wd=window;s.ssl=(s.wd.location.protocol.toLowerCase().indexOf('https')>=0);s.d=document;s.b=s.d.body;if(s.d.getElementsByTagName){s.h=s.d.getElements"+"ByTagName('HEAD');if(s.h)s.h=s.h[0]}s.n=navigator;s.u=s.n.userAgent;s.ns6=s.u.indexOf('Netscape6/');var apn=s.n.appName,v=s.n.appVersion,ie=v.indexOf('MSIE '),o=s.u.indexOf('Opera '),i;if(v.indexOf"+"('Opera')>=0||o>0)apn='Opera';s.isie=(apn=='Microsoft Internet Explorer');s.isns=(apn=='Netscape');s.isopera=(apn=='Opera');s.ismac=(s.u.indexOf('Mac')>=0);if(o>0)s.apv=parseFloat(s.u.substring(o+6"+"));else if(ie>0){s.apv=parseInt(i=v.substring(ie+5));if(s.apv>3)s.apv=parseFloat(i)}else if(s.ns6>0)s.apv=parseFloat(s.u.substring(s.ns6+10));else s.apv=parseFloat(v);s.em=0;if(s.em.toPrecision)s.e"+"m=3;else if(String.fromCharCode){i=escape(String.fromCharCode(256)).toUpperCase();s.em=(i=='%C4%80'?2:(i=='%U0100'?1:0))}if(s.oun)s.sa(s.oun);s.sa(un);s.vl_l='timestamp,dynamicVariablePrefix,visito"+"rID,fid,vmk,visitorMigrationKey,visitorMigrationServer,visitorMigrationServerSecure,ppu,charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,pageName,pageURL,referrer,contextData,currencyCod"+"e,lightProfileID,lightStoreForSeconds,lightIncrementBy,retrieveLightProfiles,deleteLightProfiles,retrieveLightData';s.va_l=s.sp(s.vl_l,',');s.vl_mr=s.vl_m='timestamp,charSet,visitorNamespace,cookie"+"DomainPeriods,cookieLifetime,contextData,lightProfileID,lightStoreForSeconds,lightIncrementBy';s.vl_t=s.vl_l+',variableProvider,channel,server,pageType,transactionID,purchaseID,campaign,state,zip,e"+"vents,events2,products,linkName,linkType';var n;for(n=1;n<=75;n++){s.vl_t+=',prop'+n+',eVar'+n;s.vl_m+=',prop'+n+',eVar'+n}for(n=1;n<=5;n++)s.vl_t+=',hier'+n;for(n=1;n<=3;n++)s.vl_t+=',list'+n;s.va"+"_m=s.sp(s.vl_m,',');s.vl_l2=',tnt,pe,pev1,pev2,pev3,resolution,colorDepth,javascriptVersion,javaEnabled,cookiesEnabled,browserWidth,browserHeight,connectionType,homepage,pageURLRest,plugins';s.vl_t"+"+=s.vl_l2;s.va_t=s.sp(s.vl_t,',');s.vl_g=s.vl_t+',trackingServer,trackingServerSecure,trackingServerBase,fpCookieDomainPeriods,disableBufferedRequests,mobile,visitorSampling,visitorSamplingGroup,dy"+"namicAccountSelection,dynamicAccountList,dynamicAccountMatch,trackDownloadLinks,trackExternalLinks,trackInlineStats,linkLeaveQueryString,linkDownloadFileTypes,linkExternalFilters,linkInternalFilter"+"s,linkTrackVars,linkTrackEvents,linkNames,lnk,eo,lightTrackVars,_1_referrer,un';s.va_g=s.sp(s.vl_g,',');s.pg=pg;s.gl(s.vl_g);s.contextData=new Object;s.retrieveLightData=new Object;if(!ss)s.wds();i"+"f(pg){s.wd.s_co=function(o){return o};s.wd.s_gs=function(un){s_gi(un,1,1).t()};s.wd.s_dc=function(un){s_gi(un,1).t()}}",i=window,s=i.s_c_il,o=navigator,u=o.userAgent,a=o.appVersion,f=a.indexOf("MSIE "),l=u.indexOf("Netscape6/"),c,h,p,d,v;if(e){e=e.toLowerCase();if(s)for(p=0;p<2;p++)for(h=0;h<s.length;h++){v=s[h];d=v._c;if((!d||d=="s_c"||p>0&&d=="s_l")&&(v.oun==e||v.fs&&v.sa&&v.fs(v.oun,e))){if(v.sa)v.sa(e);if(d=="s_c")return v}else v=0}}i.s_an="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";i.s_sp=new Function("x","d","var a=new Array,i=0,j;if(x){if(x.split)a=x.split(d);else if(!d)for(i=0;i<x.length;i++)a[a.length]=x.substring(i,i+1);else while(i>=0){j=x.indexOf(d,i);a[a.length]=x.subst"+"ring(i,j<0?x.length:j);i=j;if(i>=0)i+=d.length}}return a");i.s_jn=new Function("a","d","var x='',i,j=a.length;if(a&&j>0){x=a[0];if(j>1){if(a.join)x=a.join(d);else for(i=1;i<j;i++)x+=d+a[i]}}return x");i.s_rep=new Function("x","o","n","return s_jn(s_sp(x,o),n)");i.s_d=new Function("x","var t='`^@$#',l=s_an,l2=new Object,x2,d,b=0,k,i=x.lastIndexOf('~~'),j,v,w;if(i>0){d=x.substring(0,i);x=x.substring(i+2);l=s_sp(l,'');for(i=0;i<62;i++)l2[l[i]]=i;t=s_sp(t,'');d"+"=s_sp(d,'~');i=0;while(i<5){v=0;if(x.indexOf(t[i])>=0) {x2=s_sp(x,t[i]);for(j=1;j<x2.length;j++){k=x2[j].substring(0,1);w=t[i]+k;if(k!=' '){v=1;w=d[b+l2[k]]}x2[j]=w+x2[j].substring(1)}}if(v)x=s_jn("+"x2,'');else{w=t[i]+' ';if(x.indexOf(w)>=0)x=s_rep(x,w,t[i]);i++;b+=62}}}return x");i.s_fe=new Function("c","return s_rep(s_rep(s_rep(c,'\\\\','\\\\\\\\'),'\"','\\\\\"'),\"\\n\",\"\\\\n\")");i.s_fa=new Function("f","var s=f.indexOf('(')+1,e=f.indexOf(')'),a='',c;while(s>=0&&s<e){c=f.substring(s,s+1);if(c==',')a+='\",\"';else if((\"\\n\\r\\t \").indexOf(c)<0)a+=c;s++}return a?'\"'+a+'\"':"+"a");i.s_ft=new Function("c","c+='';var s,e,o,a,d,q,f,h,x;s=c.indexOf('=function(');while(s>=0){s++;d=1;q='';x=0;f=c.substring(s);a=s_fa(f);e=o=c.indexOf('{',s);e++;while(d>0){h=c.substring(e,e+1);if(q){i"+"f(h==q&&!x)q='';if(h=='\\\\')x=x?0:1;else x=0}else{if(h=='\"'||h==\"'\")q=h;if(h=='{')d++;if(h=='}')d--}if(d>0)e++}c=c.substring(0,s)+'new Function('+(a?a+',':'')+'\"'+s_fe(c.substring(o+1,e))+'\")"+"'+c.substring(e+1);s=c.indexOf('=function(')}return c;");r=s_d(r);if(f>0){c=parseInt(h=a.substring(f+5));if(c>3)c=parseFloat(h)}else if(l>0)c=parseFloat(u.substring(l+10));else c=parseFloat(a);if(c<5||a.indexOf("Opera")>=0||u.indexOf("Opera")>=0)r=s_ft(r);if(!v){v=new Object;if(!i.s_c_in){i.s_c_il=new Array;i.s_c_in=0}v._il=i.s_c_il;v._in=i.s_c_in;v._il[v._in]=v;i.s_c_in++}v._c="s_c";(new Function("s","un","pg","ss",r))(v,e,t,n);return v}function s_giqf(){var e=window,t=e.s_giq,n,r,i;if(t)for(n=0;n<t.length;n++){r=t[n];i=s_gi(r.oun);i.sa(r.un);i.setTagContainer(r.tagContainerName)}e.s_giq=0}typeof _comscore=="undefined"&&(_comscore=[]),function(){var e="length",t=self,n=t.encodeURIComponent?encodeURIComponent:escape,r=".scorecardresearch.com",i="//app"+r+"/s2e/invite",s=Math,o="script",u="width",a=/c2=(\d*)&/,f,l=function(t){if(!!t){var i,s=[],o,u=0,a,f,l="";for(var c in t){o=typeof t[c];if(o=="string"||o=="number")s[s[e]]=c+"="+n(t[c]),c=="c2"?l=t[c]:c=="c1"&&(u=1)}if(s[e]<=0||l=="")return;f=t.options||{},f.d=f.d||document;if(typeof f.url_append=="string"){a=f.url_append.replace(/&/,"&").split("&");for(var c=0,p=a[e],v;c<p;c++)v=a[c].split("="),v[e]==2&&(s[s[e]]=v[0]+"="+n(v[1]))}i=["http",f.d.URL.charAt(4)=="s"?"s://sb":"://b",r,"/b?",u?"":"c1=2&",s.join("&").replace(/&$/,"")],udm_(i.join(""),function(){h(this,f)})}},c=function(t){t=t||_comscore;for(var n=0,r=t[e];n<r;n++)l(t[n]);t=_comscore=[]},h=function(e,t){if(!(e.src.indexOf("c1=2")<0||!t.d.createElement))if(t.force_script_extension||e[u]==2&&e.height>s.round(s.random()*100)){var n=t.d.createElement(o),r=t.d.getElementsByTagName(o)[0],f=[t.script_extension_url||i,"?","c2=",e.src.match(a)[1]].join("");r&&(n.src=f,n.async=!0,r.parentNode.insertBefore(n,r))}};c(),(f=t.COMSCORE)?(f.purge=c,f.beacon=l):COMSCORE={purge:c,beacon:l}}();var s_code="",s_objectID;s_giqf();var s_account="djglobal,djwsj";try{var url=window.location!=window.parent.location?document.referrer:document.location.href;if(url.indexOf("wsj.com")!==-1){s_account="djglobal,djwsj"}if(url.indexOf("live.wsj.com")!==-1){s_account="djglobal,djwsjlive"}if(url.indexOf("cwsj.com")!==-1){s_account="djglobal,djwsjchina"}if(url.indexOf("cn.wsj.com")!==-1){s_account="djglobal,djwsjchina"}if(url.indexOf("jwsj.com")!==-1){s_account="djglobal,djjapanwsj"}if(url.indexOf("kr.wsj.com")!==-1){s_account="djglobal,djwsjkorea"}if(url.indexOf("indo.wsj.com")!==-1){s_account="djglobal,djwsjindonesia"}if(url.indexOf("marketwatch.com")!==-1){s_account="djglobal,djmarketwatch"}if(url.indexOf("barrons.com")!==-1){s_account="djglobal,djbarrons"}if(url.indexOf("wsj.de")!==-1){s_account="djglobal,djwsjgermany"}if(url.indexOf("allthingsd.com")!==-1){s_account="djglobal,djatd"}if(url.indexOf("wsj.com.tr")!==-1){s_account="djglobal,djwsjturkey"}if(url.indexOf("efinancialnews.com")!==-1){s_account="djglobal,djefinancialnews"}}catch(e){s_account="djglobal,djwsjlive"}var svid=s_gi(s_account);svid.charSet="ISO-8859-1";svid.currencyCode="USD";svid.trackDownloadLinks=true;svid.trackExternalLinks=false;svid.trackInlineStats=true;svid.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx";svid.linkInternalFilters="javascript:,wsj.com,wallstreetjournal.com,bankrate.com,smartmoney.com,barrons.com,marketgauge.com,marketwatch.com,bigcharts.com,virtualstockexchange.com,hulbertinteractive.com,collegejournal.com,careercast.com,careerjournal.com,careerjournalasia.com,realestatejournal.com,loopnet.com,opinionjournal.com,politicaldiary.com,startupjournal.com,homefair.com,myplan.com,contacts.zoominfo.com,secure.theladders.com,selectrecruiters.com,kennedyinfo.com,allisontaylor.com,wsj.careerdev.org,wsj.resumeedge.com,newhomesource.com,blacksguide.com,rej.informars.com,wsj.miniplan.com,wsj.knowledgestorm.com,entrepreneur.com,toolkit.prnewswire.com,tsnn.com,allthingsd.com,traffic.outbrain.com,fins.com,wallstreetjournal.de";svid.linkLeaveQueryString=false;try{if(window.location.indexOf("https://")==0){svid.ssl=true}}catch(e){}svid.visitorNamespace="dowjones";svid.trackingServer="om.dowjoneson.com";svid.trackingServerSecure="oms.dowjoneson.com"

  // ENDSCREEN //
  //jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t+n;return-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t+n;return r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t*t+n;return-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t*t*t+n;return r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){if(t==0)return n;if(t==i)return n+r;if((t/=i/2)<1)return r/2*Math.pow(2,10*(t-1))+n;return r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){if((t/=i/2)<1)return-r/2*(Math.sqrt(1-t*t)-1)+n;return r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158;var o=0;var u=r;if(t==0)return n;if((t/=i)==1)return n+r;if(!o)o=i*.3;if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158;var o=0;var u=r;if(t==0)return n;if((t/=i)==1)return n+r;if(!o)o=i*.3;if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158;var o=0;var u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;if(!o)o=i*.3*1.5;if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);if(t<1)return-.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n;return u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){if(s==undefined)s=1.70158;return r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){if(s==undefined)s=1.70158;return r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){if(s==undefined)s=1.70158;if((t/=i/2)<1)return r/2*t*t*(((s*=1.525)+1)*t-s)+n;return r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){if((t/=i)<1/2.75){return r*7.5625*t*t+n}else if(t<2/2.75){return r*(7.5625*(t-=1.5/2.75)*t+.75)+n}else if(t<2.5/2.75){return r*(7.5625*(t-=2.25/2.75)*t+.9375)+n}else{return r*(7.5625*(t-=2.625/2.75)*t+.984375)+n}},easeInOutBounce:function(e,t,n,r,i){if(t<i/2)return jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n;return jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}});(function(){function i(e,t,n,r,i,s,o,u){if(i<u*n)return jQuery.easing[e](r,i,s,n*o,n*u);return jQuery.easing[t](r,i-n*u,s+n*o,(1-n)*o,(1-n)*u)}var e,t,n,r=jQuery;e=["Cubic-Back","Cubic-Bounce-0.85","Cubic-Elastic-0.66","Back-Elastic-0.66"];for(var t in e){t=e[t].split("-");n={};n["easeIn"+t[0]+"Out"+t[1]]=function(e,t,n){return function(r,s,o,u,a){return i("easeIn"+e,"easeOut"+t,n||.5,r,s,o,u,a)}}(t[0],t[1],t[2]);r.extend(r.easing,n)}})();(function(e,t,n,r){"use strict";function i(e){this.init(e)}function s(t){this.elem=e(t)}function o(e){var t=this;t.base=e}function u(e){var t=this;t.base=e}var a=n,f=t,l=e(a),c=e(f),h="endScreen",p="endScreen";var d=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)}}(),v=function(){return t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.msCancelAnimationFrame||t.oCancelAnimationFrame||function(e){t.clearTimeout(e)}}(),m=function(){return function(t){function n(){r=o(null,Math.max(0,i),t.from,t.to-t.from,s);if(t.callback)t.callback(r,t.callbackParams,i,s);if(t.change)t.change(r,t.callbackParams,i,s);if(i==s){if(t.complete)t.complete()}else{t.context[t.id]=d(function(){n()})}i=Math.min(s,i+1e3/60)}var r=t.from,i=-t.delay||0,s=!t.duration?1e3:t.duration,o;o=e.easing&&e.easing[t.easing]?e.easing[t.easing]:g.swing;if(t.context[t.id])v(t.context[t.id]);n()}}(),g={swing:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n}},y=function(){var e=t.getComputedStyle(n.documentElement,""),r=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||e.OLink===""&&["","o"])[1],i="WebKit|Moz|MS|O".match(new RegExp("("+r+")","i"))[1];return{dom:i,lowercase:r,css:"-"+r+"-",js:r[0].toUpperCase()+r.substr(1)}}(),b=function(){try{var e,i;e=n.createElement("p");e.style["transform"]="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)";n.body.insertBefore(e,n.body.lastChild);i=t.getComputedStyle(e).getPropertyValue("transform");s(e).remove();if(i!==r){return i!=="none"}else{return false}}catch(s){return false}}(),w=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}();i.prototype={init:function(e){var t=this;t.elem=e;return t},update:function(){var e=this,t=[],n;t.push("translate3d("+e.x()+"px, "+e.y()+"px, "+e.z()+"px)");t.push("rotateX("+e.rotX()+"deg)");t.push("rotateY("+e.rotY()+"deg)");t.push("rotateZ("+e.rotZ()+"deg)");t.push("scale("+e.scale()+")");n={};n[y.css+"transform"]=t.join(" ");n[y.css+"transform-origin"]=e.originX()*100+"% "+e.originY()*100+"%";n["opacity"]=e.opacity();e.elem.css(n);return e},animate:function(t,n,r){var i=this;t=t.split(",");for(var s in t){r=e.extend(true,{},r);r.id=t[s]+"Tween";r.context=i;r.from=i[t[s]]();r.to=n;r.callback=function(e){return function(n){i[t[e]](n);i.update()}}(s);m(r)}return i},stop:function(e){var t=this;e=e.split(",");for(var n in e){v(t[e[n]+"Tween"])}return t},set:function(e,t){var n=this;e=e.split(",");for(var r in e){n[e[r]](t)}return n},x:function(e){var t=this;if(e===r)return t._x||0;t._x=e;return t},y:function(e){var t=this;if(e===r)return t._y||0;t._y=e;return t},z:function(e){var t=this;if(e===r)return t._z||0;t._z=e;return t},rotX:function(e){var t=this;if(e===r)return t._rx||0;t._rx=e;return t},rotY:function(e){var t=this;if(e===r)return t._ry||0;t._ry=e;return t},rotZ:function(e){var t=this;if(e===r)return t._rz||0;t._rz=e;return t},origin:function(e){var t=this;t.originX(e).originY(e);return t},originX:function(e){var t=this;if(e===r)return t._ogx===r?.5:t._ogx;t._ogx=e;return t},originY:function(e){var t=this;if(e===r)return t._ogy===r?.5:t._ogy;t._ogy=e;return t},opacity:function(e){var t=this;if(e===r)return t._op===r?1:t._op;t._op=e;return t},scale:function(e){var t=this;if(e===r)return t._sc===r?1:t._sc;t._sc=e;return t}};var E={items:"."+p+"-items",item:"."+p+"-item",itemWrap:"."+p+"-item-wrap",thumb:"."+p+"-item-thumb"};s.prototype={init:function(t,n){var r=this;if(r.api(t,n))return r;r.options=e.extend(true,{},e.fn[h].options,r.elem.data(),t);r.setup();r.update();r.manager=new o(r);r.manager.start();return r},destroy:function(){var e=this,t,n;e.destroyed=true;e.manager.stop();delete e.manager;n=e.items.length;for(t=0;t<n;t++){e.items[t].destroy();delete e.items[t]}e.elem.data("_"+h+"Instance",null);return e},setup:function(){var e=this,t,n,r;e.items=[];e.domItems=e.elem.find(E.items).children();n=e.domItems.length;for(r=0;r<n;r++){t=new u(e);t.init(e.domItems[r]);e.items.push(t)}return e},getCountResponsive:function(){var e=this,t=e.elem.outerWidth(),n,i,s,o;i=e.options.breakpoints?e.options.breakpoints.split(","):[];s=i.length;n={};for(o=0;o<s;o++){if(t<=i[o]&&e.options["countX_"+i[o]]!==r){n.x=e.options["countX_"+i[o]]}if(t<=i[o]&&e.options["countY_"+i[o]]!==r){n.y=e.options["countY_"+i[o]]}}return n},update:function(){var e=this,t=e.elem.width(),n=e.elem.height(),r,i,s,o,u,a,f,l,c;if(e.destroyed)return;r=e.getCountResponsive();if(r.x){e.xCount=r.x}else if(e.options.countX){e.xCount=e.options.countX}else{i=Math.floor(t/e.options.maxItemWidth);s=Math.ceil(t/e.options.maxItemWidth);e.xCount=t/i>e.options.maxItemWidth?s:i;e.xCount=Math.max(e.options.minCountX||1,e.xCount);if(e.options.maxCountX)e.xCount=Math.min(e.options.maxCountX,e.xCount)}if(r.y){e.yCount=r.y}else if(e.options.countY){e.yCount=e.options.countY}else{o=Math.floor(n/e.options.maxItemHeight);u=Math.ceil(n/e.options.maxItemHeight);e.yCount=n/o>e.options.maxItemHeight?u:o;e.yCount=Math.max(e.options.minCountY||1,e.yCount);if(e.options.maxCountY)e.yCount=Math.min(e.options.maxCountY,e.yCount)}e.itemWidth=Math.ceil(t/e.xCount);e.itemHeight=Math.ceil(n/e.yCount);e.domItems.hide().css("z-index",0);e.elem.css("overflow",e.overflow);e.grid=[];e.rows=[];e.columns=[];l=e.xCount*e.yCount;for(c=0;c<l;c++){a=c%e.xCount;f=Math.floor(c/e.xCount);if(e.items[c]){e.items[c].reset().setPos(a,f).loadThumb().elem.css({width:e.itemWidth,height:e.itemHeight}).show();e.grid.push(e.items[c]);if(!e.rows[f])e.rows[f]=[];e.rows[f].push(e.items[c]);if(!e.columns[a])e.columns[a]=[];e.columns[a].push(e.items[c])}}return e},getItem:function(e,t,n,r,i){var s=this,o,u,a,f,l,c,h,p,d,v;if(s.items.length<=s.grid.length)return;if(s.destroyed)return;c=s.items[e];h=s.items[t];c.reset();h.reset();c.elem.css("z-index",9999);h.elem.css("z-index",9999);d=n.slice(0,1)=="-"?-1:1;p=n.slice(n.length-1);switch(i){case"easeInBackOutElastic":u=.33*r;a=.66*r;f="easeInBack";l="easeOutElastic";break;case"easeInBackOutCubic":u=.33*r;a=.66*r;f="easeInBack";l="easeOutCubic";break;case"easeInCubicOutElastic":u=.33*r;a=.66*r;f="easeInCubic";l="easeOutElastic";break;case"easeInBackOutBack":u=.5*r;a=u;f="easeInBack";l="easeOutBack";break;case"easeInCubicOutCubic":u=.5*r;a=u;f="easeInCubic";l="easeOutCubic";break;case"easeInCubicOutBounce":u=.5*r;a=u;f="easeInCubic";l="easeOutBounce";break;default:u=.5*r;a=u;f=l=i}switch(n){case"rollInX":case"rollInY":case"-rollInX":case"-rollInY":s.swapItems(t,e);h.elem.css("z-index",0);h.setPos(c.px,c.py).loadThumb().elem.css({width:s.itemWidth,height:s.itemHeight}).show();c.css3d["origin"+p](d>0?1:0).animate("opacity",.5,{duration:u,easing:f}).animate("rot"+(p=="Y"?"X":"Y"),-d*(p=="Y"?1:-1)*(-90-180*Math.atan(.5*(p=="Y"?s.itemHeight:s.itemWidth)/s.options.perspective)/Math.PI),{duration:u,easing:f,complete:function(){h.css3d.opacity(.5)["origin"+p](d>0?0:1)["rot"+(p=="Y"?"X":"Y")](-d*(p=="Y"?1:-1)*(90+180*Math.atan(.5*(p=="Y"?s.itemHeight:s.itemWidth)/s.options.perspective)/Math.PI)).update().animate("opacity",1,{duration:a,easing:l}).animate("rot"+(p=="Y"?"X":"Y"),0,{duration:a,easing:l,complete:function(){s.update();c.reset()}})}});h.css3d.opacity(.5)["origin"+p](d>0?0:1)["rot"+(p=="Y"?"X":"Y")](-d*(p=="Y"?1:-1)*(90+180*Math.atan(.5*(p=="Y"?s.itemHeight:s.itemWidth)/s.options.perspective)/Math.PI)).update();break;case"rollOutX":case"rollOutY":case"-rollOutX":case"-rollOutY":s.swapItems(t,e);var m=e+d*(p=="Y"?s.xCount:1);if(m>=0&&(p=="Y"||m%s.xCount!=s.xCount-(d>0?0:1)&&m%s.xCount!=(d>0?0:-1)))s.swapItems(t,m);h.elem.css("z-index",0);var g=false;if(n=="-rollOutY"&&c.py==0||n=="rollOutY"&&c.py==s.yCount-1||n=="-rollOutX"&&c.px==0||n=="rollOutX"&&c.px==s.xCount-1){g=true}h.setPos(c.px,c.py).loadThumb().elem.css({width:s.itemWidth,height:s.itemHeight}).show();c.css3d["origin"+p](d>0?1:0).animate("opacity",.5,{duration:u,easing:f}).animate("rot"+(p=="Y"?"X":"Y"),d*(p=="Y"?1:-1)*(-90+180*Math.atan(.5*(p=="Y"?s.itemHeight:s.itemWidth)/s.options.perspective)/Math.PI),{duration:u,easing:f,complete:function(){if(!g){c.setPos(h.px+(p=="Y"?0:d),h.py+(p=="Y"?d:0)).css3d["origin"+p](d>0?0:1)["rot"+(p=="Y"?"X":"Y")](d*(p=="Y"?1:-1)*(90-180*Math.atan(.5*(p=="Y"?s.itemHeight:s.itemWidth)/s.options.perspective)/Math.PI)).update().animate("opacity",g?0:1,{duration:a,easing:l}).animate("rot"+(p=="Y"?"X":"Y"),0,{duration:a,easing:l,complete:function(){s.update();s.items[t].reset()}})}else{s.update();s.items[t].reset()}}});break;case"slideX":case"slideY":case"-slideX":case"-slideY":p=p.toLowerCase();s.swapItems(t,e);c.elem.css("overflow","hidden");h.elem.css("overflow","hidden");c.css3d.animate(p,-d*(p=="x"?s.itemWidth:s.itemHeight),{duration:u,easing:f,complete:function(){s.update();c.reset()}});h.setPos(c.px,c.py).loadThumb().elem.css({width:s.itemWidth,height:s.itemHeight}).show();h.css3d[p](d*(p=="x"?s.itemWidth:s.itemHeight)).update().animate(p,0,{duration:a,easing:l});break;case"flipX":case"flipY":case"-flipX":case"-flipY":s.swapItems(t,e);c.css3d.animate("rot"+p,-d*90,{duration:u,easing:f,complete:function(){h.setPos(c.px,c.py).loadThumb().elem.css({width:s.itemWidth,height:s.itemHeight}).show();h.css3d["rot"+p](d*90).opacity(.5).update().animate("opacity",1,{duration:a,easing:l}).animate("rot"+p,0,{duration:a,easing:l,complete:function(){s.update();c.reset()}})}});break;case"slideRow":case"-slideRow":p="x";o=c.py;e=s.getIndex(d>0?s.xCount-1:0,o);c=s.items[e];s.swapItems(t,e);for(v=0;v<s.xCount-1;v++){s.swapItems(s.getIndex(d>0?s.xCount-1-v:v,o),s.getIndex(d>0?s.xCount-2-v:v+1,o))}s.overflow=s.elem.css("overflow");s.elem.css("overflow","hidden");s.items[d>0?s.getIndex(0,o):s.getIndex(s.xCount-1,o)].setPos(d>0?0:s.xCount-1,o).loadThumb().elem.css({width:s.itemWidth,height:s.itemHeight}).show();s.items[d>0?s.getIndex(0,o):s.getIndex(s.xCount-1,o)].css3d.x(-d*s.itemWidth).update().animate("x",0,{duration:r,easing:i,change:function(e){for(v=d>0?1:0;v<s.xCount-(d>0?0:1);v++){s.rows[o][v].css3d.x(d*s.itemWidth+e).update()}c.css3d.x(d*s.itemWidth+e).update()},complete:function(){s.update();c.reset()}});break;case"slideColumn":case"-slideColumn":p="y";o=c.px;e=s.getIndex(o,d>0?s.yCount-1:0);c=s.items[e];s.swapItems(t,e);for(v=0;v<s.yCount-1;v++){s.swapItems(s.getIndex(o,d>0?s.yCount-1-v:v),s.getIndex(o,d>0?s.yCount-2-v:v+1))}s.overflow=s.elem.css("overflow");s.elem.css("overflow","hidden");s.items[d>0?s.getIndex(o,0):s.getIndex(o,s.yCount-1)].setPos(o,d>0?0:s.yCount-1).loadThumb().elem.css({width:s.itemWidth,height:s.itemHeight}).show();s.items[d>0?s.getIndex(o,0):s.getIndex(o,s.yCount-1)].css3d.y(-d*s.itemHeight).update().animate("y",0,{duration:r,easing:i,change:function(e){for(v=d>0?1:0;v<s.yCount-(d>0?0:1);v++){s.columns[o][v].css3d.y(d*s.itemHeight+e).update()}c.css3d.y(d*s.itemHeight+e).update()},complete:function(){s.update();c.reset()}});break;case"fade":default:s.swapItems(t,e);c.elem.css("z-index",0);h.setPos(c.px,c.py).loadThumb().elem.css({width:s.itemWidth,height:s.itemHeight}).show();h.css3d.opacity(0).update().animate("opacity",1,{duration:r,easing:i,complete:function(){s.update();c.reset()}});break}return s},getIndex:function(e,t){var n=this;return t*n.xCount+e},swapItems:function(e,t){var n=this,r,i,s;s=n.grid.length;r=n.items[e];i=n.items[t];n.items[e]=i;n.items[t]=r;if(e<s){n.grid[e]=i;n.rows[Math.floor(e/n.xCount)][e%n.xCount]=i;n.columns[e%n.xCount][Math.floor(e/n.xCount)]=i}if(t<s){n.grid[t]=r;n.rows[Math.floor(t/n.xCount)][t%n.xCount]=r;n.columns[t%n.xCount][Math.floor(t/n.xCount)]=r}return n},api:function(t,n){var r=this;if(typeof t==="string"){switch(t){case"update":r.update();break;case"start":r.manager.start();break;case"stop":r.manager.stop();break;case"show":r.manager.getItem(n[0],n[1],n[2],n[3],n[4]);break;case"option":var i={};i[n[0]]=n[1];r.options=e.extend(true,{},r.options,i);r.update();break;case"destroy":r.destroy();break}return true}return false}};o.prototype={start:function(e){var t=this;m({id:"timer",context:t,from:0,to:1,duration:e||t.base.options.delay||1,complete:function(){if(t.destroyed)return;t.getItem();t.start(t.animationDuration+t.base.options.delay)}});return t},stop:function(){var e=this;v(e.timer);return e},pause:function(){var e=this;e.paused=true;return e},resume:function(){var e=this;e.paused=false;return e},getItem:function(e,t,n,i,s){var o=this,u,a,f,l,c,h;if(o.paused)return;if(e===r||e===false)e=Math.floor(Math.random()*o.base.grid.length);if(t===r||t===false)t=Math.floor(Math.random()*(o.base.items.length-o.base.grid.length))+o.base.grid.length;if(e>o.base.grid.length-1)e-=o.base.grid.length-1;u=(o.base.options.animations||"rollInX,rollInY,rollOutX,rollOutY,slideX,slideY,flipX,flipY,slideRow,slideColumn,fade,-rollInX,-rollInY,-rollOutX,-rollOutY,-slideX,-slideY,-flipX,-flipY,-slideRow,-slideColumn,-fade").split(",");a=o.base.options.animationsExcluded?o.base.options.animationsExcluded.split(","):[];h=a.length;for(c=0;c<h;c++){u.splice(u.indexOf(a[c]),1)}n=n||u[Math.floor(Math.random()*u.length)];if(!b&&["rollInX","rollInY","rollOutX","rollOutY","flipX","flipY"].indexOf(n.replace("-",""))){n="fade"}if(o.base.options.onHoverExclude=="item"&&o.base.items[e].elem.hasClass("hover")||o.base.items[e].elem.hasClass(o.base.options.fixedClass)){return o.getItem(e+1,t,n,i,s)}else if(["rollOutX","slideRow","-rollOutX","-slideRow"].indexOf(n)!=-1){l=o.base.items[e].py;h=o.base.rows[l].length;for(c=0;c<h;c++){if(o.base.options.onHoverExclude=="item"&&o.base.rows[l][c].elem.hasClass("hover")||o.base.rows[l][c].elem.hasClass(o.base.options.fixedClass)){return o.getItem(e+o.base.xCount,t,n,i,s)}}}else if(["rollOutY","slideColumn","-rollOutY","-slideColumn"].indexOf(n)!=-1){f=o.base.items[e].px;h=o.base.columns[f].length;for(c=0;c<h;c++){if(o.base.options.onHoverExclude=="item"&&o.base.columns[f][c].elem.hasClass("hover")||o.base.columns[f][c].elem.hasClass(o.base.options.fixedClass)){return o.getItem(e+1,t,n,i,s)}}}o.base.getItem(e,t,n,i||o.base.options[n.replace("-","")+"Duration"]||o.base.options.duration,s||o.base.options[n.replace("-","")+"Easing"]||o.base.options.easing);o.animationDuration=i||o.base.options[n.replace("-","")+"Duration"]||o.base.options.duration;return o}};u.prototype={init:function(t){var n=this;n.elem=e(t);n.elem.wrapInner(e("<div/>").addClass(E.itemWrap.slice(1)));n.content=n.elem.children().eq(0);n.elem.css(y.css+"perspective",n.base.options.perspective);n.css3d=new i(n.content);n.elem.on("mouseenter",{t:n},n.handleMouseOver);n.elem.on("mouseleave",{t:n},n.handleMouseOut);n.elem.on("touchend",{t:n},n.handleTouchEnd);return n},handleMouseOver:function(e){var t=e.data.t;t.elem.addClass("hover").siblings().removeClass("hover");if(t.base.options.onHoverExclude=="all")t.base.manager.pause()},handleMouseOut:function(e){var t=e.data.t;t.elem.removeClass("hover");if(t.base.options.onHoverExclude=="all")t.base.manager.resume()},handleTouchEnd:function(e){var t=e.data.t;if(!t.elem.hasClass("hover")){e.preventDefault();t.handleMouseOver(e);return false}},loadThumb:function(){var t=this,n=t.elem.data("thumb"),r=new Image;if(t.thumbLoaded||!n)return t;t.elem.addClass("loading");t.thumbLoaded=true;r.onload=function(){t.content.append(e("<div/>").addClass(E.thumb.slice(1)).css({"background-image":"url("+n+")","background-position":"center center","background-repeat":"no-repeat","background-size":t.base.options.sizing}).fadeTo(0,0).fadeTo(300,1));t.elem.removeClass("loading")};r.src=n;return t},setPos:function(e,t){var n=this;n.px=e;n.py=t;n.elem.css({left:n.px*n.base.itemWidth,top:n.py*n.base.itemHeight});return n},reset:function(){var e=this;e.elem.css({"z-index":0,overflow:"visible"});e.css3d.stop("x,y,z,rotX,rotY,rotZ,opacity").set("x,y,z,rotX,rotY,rotZ",0).opacity(1).origin(.5).update();return e},destroy:function(){var e=this;e.reset();e.elem.off("mouseenter",e.handleMouseOver);e.elem.off("mouseleave",e.handleMouseOut);e.elem.empty().removeClass("hover").removeAttr("style");return e}};e.extend(e.fn,{endScreen:function(t){var n=Array.prototype.slice.call(arguments,1);return e(this).each(function(){var r=e(this).data("_"+h+"Instance");if(typeof t==="string"&&!r)return;r=r||new s(this);r.init(t,n);e(this).data("_"+h+"Instance",r)})}});e.fn[h].options={animations:false,animationsExcluded:false,delay:500,maxItemWidth:240,maxItemHeight:160,countX:false,countY:false,minCountX:1,minCountY:1,maxCountX:false,maxCountY:false,onHoverExclude:false,sizing:"cover",fixedClass:"fixed",perspective:600,duration:650,easing:"easeInOutCubic",rollInXDuration:false,rollInXEasing:"easeInCubicOutCubic",rollInYDuration:false,rollInYEasing:"easeInCubicOutCubic",rollOutXDuration:false,rollOutXEasing:"easeInCubicOutCubic",rollOutYDuration:false,rollOutYEasing:"easeInCubicOutCubic",flipXDuration:false,flipXEasing:"easeInCubicOutCubic",flipYDuration:false,flipYEasing:"easeInCubicOutCubic",slideXDuration:false,slideXEasing:false,slideYDuration:false,slideYEasing:false,slideRowDuration:false,slideRowEasing:false,slideColumnDuration:false,slideColumnEasing:false,fadeDuration:false,fadeEasing:false,breakpoints:false}})(jQuery,window,document)

  /*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
    is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
  */
  var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();

  /*! jQuery UI - v1.10.0 - 2013-01-27
  * http://jqueryui.com
  * Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.slider.js
  * Copyright (c) 2013 jQuery Foundation and other contributors Licensed MIT */

  (function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.10.0",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})})(jQuery);(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})})(jQuery);(function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);(function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.0",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){var t,n,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this.range=e([]),r.range&&(r.range===!0&&(r.values?r.values.length&&r.values.length!==2?r.values=[r.values[0],r.values[0]]:e.isArray(r.values)&&(r.values=r.values.slice(0)):r.values=[this._valueMin(),this._valueMin()]),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(r.range==="min"||r.range==="max"?" ui-slider-range-"+r.range:""))),n=r.values&&r.values.length||1;for(t=i.length;t<n;t++)o.push(s);this.handles=i.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){r.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){r.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._setOption("disabled",r.disabled),this._on(this.handles,this._handleEvents),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));if(i>n||i===n&&(t===l._lastChangedValue||l.values(t)===c.min))i=n,s=e(this),o=t}),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0)):this.handles.prop("disabled",!1);break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))},_handleEvents:{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})})(jQuery);

/*jshint white:true, evil:false, onevar:false, undef:true, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
define('article.app/video', [
  'vendor.asset.jquery/jquery',
  'article.app/wsjVideo',
  'dj.responsive.resources/commonutils',
  'article.app/context',
  'vendor.asset.underscore/underscore'
], function ($, wsjVideo, utils, intent, _) {
  var M_SIZE_LAYOUTS = ["header", "bleed", "inline", "offset"];

  var video = {
    init: function () {

      $(function() {
        $.each($('.video-container'), function(i, vid) {
          var parameters = {
            autoplay: false,
            guid:$(vid).attr('data-src'),
            adsEnabled:false,
            chainVideos:false,
            resetOnComplete:true,
            wmode:"opaque",
            disableHtmlControls:true,
            api:'http://video-api.wsj.com/api-video/'
          };

          // Use higher bitrate for bleed videos on desktop devices
          if (($(vid).parents('.bleed').length > 0) && (/12|16/.test(intent.axes.width.current))) {
            $.extend(parameters, {maxBitrateIndex: 6});
          }

          // Alternate thumb images
          if ($(vid).attr('data-esplash') || $(vid).attr('data-msplash')) {

            // Have to use grandparent's classes since data-layout not ie8 compatible
            var grandparent = $(vid).parent().parent();

            // Check if video is an M size layout
            var isMLayout = false;
            for (var index = 0; index < M_SIZE_LAYOUTS.length; index++) {
              var layout = M_SIZE_LAYOUTS[index];
              if(grandparent.hasClass(layout)){
                isMLayout = true;
              }
            }

            // Resize image on context switch
            var sizer = _.throttle( function () {
              setVideoSize($(vid), isMLayout);
            }, 200);
            intent.on('width:', sizer);

            // Select the appropriate thumbnail image
            var thumbImage = determineImage($(vid), isMLayout);
            var thumbExt = {
              thumb: thumbImage
            };
            $.extend(parameters, thumbExt);
          }

          // Initialize video player
          $(vid).attr("id","videoplayer" + i);
          $(vid).WSJVideo(parameters);
        });
      });
    }
  };

  /*
   * setVideoSize(vid, layout)
   *  Helper function to resize the video thumbnail when intention
   *  switches contexts
   */
  function setVideoSize(vid, layout) {
    var innerVid = vid.find('div.vidThumb')[0];
    var image = determineImage(vid, layout);
    $(innerVid).css('background-image', 'url(' + image + ')');
  }


  /*
   * determineImage(vid, isMLayout)
   *  Helper function to choose the appropriate thumbnail image for a
   *  video based upon its layout
   *
   *  ESplash served in 4u for all layouts
   *  MSplash served in 8u, 12u, 16u for layouts in M_SIZE_LAYOUTS
   *
   *  Defaults to available image if no additional options are provided
   */
  function determineImage (vid, isMLayout) {
    // Default msplash
    var thumb = $(vid).attr("data-msplash");

    // Check if esplash is needed
    var at4u = $('body').hasClass('at4units');
    if (!thumb || at4u || !isMLayout) {
      thumb = $(vid).attr("data-esplash");
    }

    return thumb;
  }

  return video;
});

(function () {

	/*
	 *
	 * Three kinds of messages
	 *
	 * 1. Get Message - Both ways
	 *		Request for value of attribute. eg. context, width, height etc.
	 *
	 * 2. Attr Message - Both ways
	 *		Reponse to Get Message. Returns value for requested attribute.
	 *
	 * 3. Action Message - Child to Parent
	 *		Request to take some kind of action. eg. adjust height, width etc.
	 *
	 *
	 *
	 * Child Frame public Methods:
	 *
	 * get(attrName, callback)
	 *
	 *		attrName - name of the attribute to get from Parent Frame
	 *      callback(err, attr) - function to be called on response for the req. for atttribute;
	 *
	 * act(action, param)
	 *		action - name of the action to be performed
	 *		param - parameters for the action
	 *
	 *
	 * Parent Frame
	 *
	 * Attributes can be handled by one of the two approaches (But, not both).
	 * Method 1:
	 *		Override getAttribute method to handle attributes
	 *
	 *		getAttribute(attrName)
	 *			This is a sync function that returns the value for the attribute.
	 *			Return null if attrName not supported.
	 *
	 * Method 2:
	 *		Call setAttributes() with an array of name - value pairs.
	 *			The value could be a function that returns the value for an attribute name (the key)
	 *
	 *		setAttributes(arrayOfAttributeValuePairs)
	 *
	 * Actions can be handled by one of the two approaches (But, not both).
	 * Method 1:
	 *		Override performAction method to handle actions
	 *
	 *		performAction(trgtWnd, actionName, actionsParams)
	 *			Perform action on the target window (child frame).
	 *
	 * Method 2:
	 *		Call setActions() with an array of name - value pairs.
	 *			The values are functions that performs the actions (the key)
	 *
	 *		setActions(arrayOfActions)
	 *
	 */

	var FrameMessenger = function () {
		this.attrs = {};
		this.actions = {};

		this._postMsg = function (trgt, msg) {
			trgt.postMessage(JSON.stringify(msg), "*");
		};

		var _version = "0.0.1";
		var _runningID = 1;
		var _callbacks = {};


		this._postErrorMsg = function (trgt, id, error) {
			var msg = {
				id : id,
				type : 'error',
				error : error
			};

			this._postMsg(trgt, msg);
		};

		this._postMsgWithCallback = function (trgt, msg, cb) {
			// Stringfy running id
			var id = _runningID++;
			var msgId = 'msg' + id.toString();
			msg.id = msgId;

			var self = this;
			// attach callback to msg id
			_callbacks[msgId] = function (err, returnMsg) {
				cb(err, returnMsg);
				// Single use only
				delete _callbacks[msgId];
			};

			this._postMsg(trgt, msg);

			setTimeout(function () {
				if (msgId in _callbacks) {
					_callbacks[msgId]("Timedout");
				}
			}, this.opt.timeout);
		};

		this._postVerMsg = function (trgt, callback) {
			var msg = {
				type : 'ver'
			};

			this._postMsgWithCallback(trgt, msg, callback);
		};

		this._postGetMsg = function (trgt, attrName, callback) {
			var msg = {
				type : 'get',
				name : attrName
			};

			this._postMsgWithCallback(trgt, msg, callback);
		};

		this._postAttrMsg = function (trgt, id, attr) {
			var msg = {
				id : id,
				type : 'attr',
				attr : attr
			};

			this._postMsg(trgt, msg);
		};

		this._postActionMsg = function (trgt, name, param) {
			var msg = {
				type : 'action',
				name : name,
				param : param
			};

			this._postMsg(trgt, msg);
		};

		this.myVersion = function () {
			return _version;
		};

		this.handleVer = function (wnd, id) {
			this._postAttrMsg(wnd, id, this.myVersion());
		};

		this.handleGet = function (wnd, id, attrName) {
			if (attrName instanceof Array) {
				var vals = {};
				for (var i = 0; i < attrName.length; i++) {
					var valu = this.getAttribute(attrName);

					if (typeof valu !== "undefined") {
						vals[attrName] = valu;
					}
				}
				this._postAttrMsg(wnd, id, vals);
			}
			else {
				var val = this.getAttribute(attrName);

				if (typeof val !== "undefined") {
					this._postAttrMsg(wnd, id, val);
				}
				else {
					this._postErrorMsg(wnd, id, "Attribute '" + attrName + "' not supported");
				}
			}
		};

		this.handleAttr = function (id, attr) {
			if (_callbacks[id]) {
				_callbacks[id](null, attr);
			}
		};

		this.handleError = function (id, error) {
			if (_callbacks[id]) {
				_callbacks[id](error);
			}
		};

		this.handleAction = function (wnd, name, param) {
			this.performAction(wnd, name, param);
		};

		this._allowOrigin = function (origin) {
			if (this.opt.origin && this.opt.origin !== '*') {
				for (var i = 0; i < this.opt.origin.length; i++) {
					if (origin === this.opt.origin[i]) {
						return true;
					}
				}

				return false;
			}

			return true;
		};

		this._listener = function (event) {
			if (!this._allowOrigin(event.origin)) {
				return;
			}

			try {
				var msg = JSON.parse(event.data);
				if (msg.type) {
					if (msg.type === 'get') {
						this.handleGet(event.source, msg.id, msg.name);
					}
					else if (msg.type === 'attr' && msg.id) {
						this.handleAttr(msg.id, msg.attr);
					}
					else if (msg.type === 'error' && msg.id) {
						this.handleError(msg.id, msg.error);
					}
					else if (msg.type === 'action') {
						this.handleAction(event.source, msg.name, msg.param);
					}
					else if (msg.type === 'ver') {
						this.handleVer(event.source, msg.id);
					}
				}
			}
			catch (e) {	// Probably not ours
				return;
			}

		};



		this._init = function (options) {
			this.opt = {
				origin : '*',
				timeout : 1000	// 1 sec.
			};
			var opt = options || {};

			// Merge options
			for (var attr in opt) {
				this.opt[attr] = opt[attr];
			}

			// Pre process opts
			if (this.opt.origin !== '*' && !(this.opt.origin instanceof Array)) {
				this.opt.origin = [this.opt.origin];
			}

			var self = this;
			// Setup the listener.
			if (window.addEventListener) {
				window.addEventListener("message", function (event) {
					self._listener.apply(self, [event]);
				}, false);
			}
			else {
				window.attachEvent("onmessage", function (event) {
					self._listener.apply(self, [event]);
				});

			}
		};

	};

	FrameMessenger.prototype.getAttribute = function (attr) {
		var val;
		if (attr in this.attrs) {
			val = this.attrs[attr];
			if (typeof val === 'function') {
				val = val.call(this, attr);
			}
		}
		return val;
	};

	FrameMessenger.prototype.performAction = function (trgt, name, param) {
		if (name in this.actions) {
			this.actions[name].apply(window, [trgt, param]);
		}
	};

	FrameMessenger.prototype.setAttributes = function (attrs) {
		this.attrs = attrs;
		return this;
	};

	FrameMessenger.prototype.setActions = function (actions) {
		this.actions = actions;
		return this;
	};

	FrameMessenger.prototype.getVersion = function (wnd, cb) {
		if (wnd.window !== wnd) {	// Child frame communicate to parent
			// insert parent window as first arg
			[].unshift.call(arguments, window.parent);
		}
		this._postVerMsg.apply(this, arguments);
		return this;
	};

	FrameMessenger.prototype.get = function (wnd, attrName, cb) {
		if (wnd.window !== wnd) {	// Child frame communicate to parent
			// insert parent window as first arg
			[].unshift.call(arguments, window.parent);
		}
		this._postGetMsg.apply(this, arguments);
		return this;
	};

	FrameMessenger.prototype.act = function (wnd, action, param) {
		if (wnd.window !== wnd) {	// Child frame communicate to parent
			// insert parent window as first arg
			[].unshift.call(arguments, window.parent);
		}

		this._postActionMsg.apply(this, arguments);
		return this;
	};

	FrameMessenger.parent = function (opt) {
		if (!this.instance) {
			this.instance = new FrameMessenger();

			opt = opt || {};
			this.instance._init(opt);
		}
		return this.instance;
	};

	FrameMessenger.child = function (name, opt) {
		if (!this.instance) {
			this.instance = new FrameMessenger();
			this.instance.name = name;

			opt = opt || {};
			this.instance._init(opt);
		}
		return this.instance;
	};


	// Public access
	window.FrameMessenger = {
		parent: FrameMessenger.parent,
		child: FrameMessenger.child,
		util : {
			isIFramed : function () {
				try {
					return window.self !== window.top;
				}
				catch (e) {	// Some browsers throw error on cross-origin frame access
					return true;
				}
			},

			hasFrames : function () {
				return (document.getElementsByTagName("iframe").length > 0);
			}
		}
	};

	// Using require.js?
	if (typeof define === 'function' && define.amd) {
		define("dj.framemessenger.resources/framemessenger", [], function () {
			return window.FrameMessenger;
		});
	}

}());


define('article.app/content/scripts/article-slideshow', [
  'vendor.asset.jquery/jquery',
  'vendor.asset.hogan/hogan',
  'vendor.asset.underscore/underscore',
  'article.app/context',
  'article.app/content/scripts/explore-more',
  'article.app/responsiveAds',
  'article.app/content/scripts/omnitool',
  'article.app/content/scripts/slideshow-bindings',
  'article.app/content/scripts/slideshow_caption'
], function ($, hogan, _, intent, exploremore, responsiveAds, omnitool, slideshowBindings, slideshowCaption) {

  var isFullBound;//should be attached to options, but not behaving as expected

  /**
   * @class setupSlideshow - builds slideshows passed a jQuery elmement and a set of options.
   * @param {Object<jQuery>} elm - DOM element wrapping slideshow data.
   * @param {Object} - jQuery.slick extension options.
   *
   * */
  function setupSlideshow(elm, options, captionClass) {

    options = $.extend({
      speed: 390,
      startSlide: 0,
      slideToShow: 2,
      isFullScreen: false,
      truncate: true,
      endTruncate: true,
      touchThreshold: 20,
      interactionsPerAd: 3
    }, options);

    // gather relevant dom elements
  var slideshowWrap = $(elm),
        slideshow = slideshowWrap.find('.wsj-slideshow-viewer'),
        captionContainer = slideshowWrap.find('.wsj-slideshow-caption-container'),
        infoContainer = slideshowWrap.find('.wsj-slideshow-info-container'),
        indexElm = slideshowWrap.find('.wsj-slideshow-currentIdx'),
        totalElm = slideshowWrap.find('.wsj-slideshow-total'),
        captionHandle = slideshowWrap.find('.wsj-slideshow-caption-toggle'),
        fullScreenHandle = slideshowWrap.find('.wsj-slideshow-fullscreen-handle'),
        originalDom = swapImageSources(slideshowWrap[0].outerHTML), // swap the image sizes
        homeButton = slideshowWrap.find('.wsj-gohome-button'),
        relatedHeadlines = slideshowWrap.find('.explore-more-wrapper'),
        slideshow_head = slideshowWrap.find('.slideshow_headline'),
        fullScreenSlideshow;

    // allow everyone to share slick object
    var slickObj;
    exploremore.initialize(slideshow, options, captionContainer, infoContainer);

    // build an ad refresher for right rail ad
    var adRefresher =  responsiveAds.getIntervalRefresher("AD_A", 3);

    // configure slideshow
    slideshow.slick({
      accessibility: false,
      speed: options.speed,
      infinite: true,
      slidesToScoll: 1,
      lazyLoad: 'progressive',
      cssEase: 'ease',
      touchThreshold: options.touchThreshold,
      onInit: function (slideshow) {
        // Share slick Obj with everyone
        slickObj = slideshow;
        moveCaptions(slideshow);
        treatExploreMoreHeadlines();
        updateTotal(slideshow);
        updateSlideIndex(slideshow);
        setSizes(slideshow);
        updateCaption(slideshow);
        isFirstSlide(slideshow);
        isLastSlide(slideshow);
        setFirstAndLastSlideCondition(slideshow);
        slideshowBindings.focusIfSlideShowOnScreen();
        if (!options.isFullScreen && captionClass.truncate) {
          captionClass.captioning.initNewCaption(captionContainer, setCaptionHeight);
        }
      },
      onAfterChange: function (slideshow) {
        updateSlideIndex(slideshow);
        //omnitool may need to be refactored out
        omnitool.trackSlides(slideshowWrap, indexElm);
        if (/12|16/.test(intent.axes.width.current)) {
          // refresh ads every third interaction
          // in 12 and 16 units
          adRefresher();
        }

        isFirstSlide(slideshow);
        isLastSlide(slideshow);
        fireSlideActions();
        setFirstAndLastSlideCondition(slideshow);
      },
      onBeforeChange: function (slideshow, currentIdx, nextIdx) {
        fireSlideActions( currentIdx, nextIdx);
        updateCaption(slideshow, currentIdx, nextIdx);
        if (!options.isFullScreen && captionClass.truncate) {
          captionClass.captioning.restoreCaption();
          captionClass.captioning.initNewCaption(captionContainer, setCaptionHeight);
        }
      }
    });

    slideshowBindings.bindKeyboardAndMouse(
      isCurrentSlideFirst,
      isCurrentSlideFinal,
      closeFullScreen,
      options,
      slideshowWrap,
      slideshow,
      slickObj);

    //Once the first image finishes loading, allow the final slide to be visbile
    $(".wsj-slideshow-slide .wsj-slideshow-image-center img").first().on('load', function() {
      $( ".explore-more-slide").css("visibility" , "visible");
    });

    function setFirstAndLastSlideCondition(slideshow){
      if (isCurrentSlideFirst()) {
        slideshowWrap.find(".slick-prev").hide();
        slideshowWrap.find(".slick-next").show();
      }
      else if (isCurrentSlideFinal()) {
        slideshowWrap.find(".slick-prev").show();
        slideshowWrap.find(".slick-next").hide();
      }
      else
      {
        slideshowWrap.find(".slick-prev").show();
        slideshowWrap.find(".slick-next").show();
      }
    }

    function isCurrentSlideFirst() {
      if (slickObj.currentSlide === 0) {
        return true;
      }
      return false;
    }

    function isCurrentSlideFinal() {
      if (slickObj.currentSlide === slickObj.$slides.length -1) {
        return true;
      }
      return false;
    }

    function isFirstSlide(slideshow) {
      if (slideshow.currentSlide === 0) {
        slideshowWrap.addClass("first-slide");
      }
      else {
        slideshowWrap.removeClass("first-slide");
      }
    }

    function isLastSlide(slideshow) {
      if (slideshow.currentSlide === slideshow.$slides.length - 1) {
        slideshowWrap.addClass("last-slide");
      }
      else {
        slideshowWrap.removeClass("last-slide");
        if(!infoContainer.is(":visible")){
          infoContainer.show();
          setCaptionHeight(captionContainer, 500);
        }
      }
    }

    // HACK ATTACK:
    // in full screen supprt starting on specific slide
    if (options.startSlide) {
      jumpToSlide(options.startSlide);
    }

    // look up if captions are on by default
    if (slideshowWrap.hasClass('captions-on')) {
      slideshow.wsjCaptions = true;
    }

    // check if touch is enabled
    if (intent.axes.interaction.current === "touch") {
      slideshowWrap.addClass("touch-enabled");
    }

    // FUNCTIONALITY
    //
    function jumpToSlide(slideNum){
      slideshow.slickSetOption('speed', 0);
      slideshow.slickGoTo(slideNum);
      slideshow.slickSetOption('speed', options.speed);
    }

    function closeCaptions() {
      slideshow.wsjCaptions = false;
      slideshowWrap.removeClass('captions-on');
      //omnitool.trackGeneral("CLOSECAPTION_" + slideshowWrap.attr('id'));
    }

    function openCaptions() {
      slideshow.wsjCaptions = true;
      slideshowWrap.addClass('captions-on');
      //omnitool.trackGeneral("OPENCAPTION_" + slideshowWrap.attr('id'));
    }

    function toggleCaptions() {
      var captionStatus;
      if (slideshow.wsjCaptions) {
        closeCaptions();
        captionStatus = "CLOSECAPTION";
      } else {
        openCaptions();
        captionStatus = "OPENCAPTION";
      }
      //omnitool may need to be refactored out
      omnitool.trackCaptions(slideshowWrap, captionStatus);
    }

    function moveCaptions(slideshow) {
      // just double check that this is empty
      captionContainer.empty();
      _.each(slideshow.$slides, function (slide) {
        // create hook between slide and caption in dom
        var captionElm = $(slide).find('.wsj-slideshow-caption');
        captionElm.addClass('inactive');
        slide.caption = captionElm[0];
        captionContainer.append(captionElm);
      });
    }

    function setCaptionHeight(captionContainer, speed) {
      var max = 0;
      _.each(captionContainer.children(), function (child) {
        var caption = $(child);

        // if this was previously truncated destroy the plugin
        caption.trigger("destroy.dot");
        caption.removeClass("truncated");

        var h = caption.outerHeight();
        max = (h > max) ? h : max;
      });

      if(speed){
        captionContainer.animate({height: max }, speed);

      }else{

        captionContainer.height(max);
      }
    }

     /*
     * Truncation of headlines on the explore more slide. Always truncate for 4
     * unit. Only truncate 8u, 12u, 16u if not fullscreen
     *
     * Magic truncation height values:
     *    4u: 46px
     *    8u: 60px
     *   12u: 60px
     *   16u: 70px
     */
    function treatExploreMoreHeadlines() {
      if (/4/.test(intent.axes.width.current)) {
        exploremore.treatHeadlines(relatedHeadlines, 46);
      } else if (/8|12/.test(intent.axes.width.current) && !options.isFullScreen) {
        exploremore.treatHeadlines(relatedHeadlines, 60);
      } else if (/16/.test(intent.axes.width.current) && !options.isFullScreen) {
        exploremore.treatHeadlines(relatedHeadlines, 70);
      }
    }

    function treatCaptions() {
      if (!options.isFullScreen && captionClass.truncate) {
        if (typeof slickObj.currentSlide !== undefined) {
          captionClass.captioning.captionLogic();
        }
      } else {
        setCaptionHeight(captionContainer);
      }
    }

    function updateCaption(slideshow, currentIdx, nextIdx) {
      var newSlide = nextIdx ? slideshow.$slides[nextIdx] : slideshow.$slides[0],
          currentSlide = currentIdx !== undefined ? slideshow.$slides[currentIdx] : null;

      if (currentSlide) {
        $(currentSlide.caption).addClass('inactive');
      }
      if(newSlide){
        $(newSlide.caption).removeClass('inactive');
      }
    }

    function updateSlideIndex(slideshow) {
      indexElm.text(slideshow.currentSlide + 1);
    }

    function updateTotal(slideshow) {
      totalElm.text(slideshow.$slides.length);
    }

    function decideClickDirection(elm, event) {
      var pageX;
      if (event.changedTouches && event.changedTouches[0]) {
        pageX = event.changedTouches[0].pageX;
      }
      else {
        pageX = event.pageX ? event.pageX : event.clientX;
      }
      var left = pageX - elm.offset().left, fraction = left / elm.outerWidth(), threshold = 0.4;
      if((slickObj.currentSlide >= slickObj.$slides.length -1) && slideshowWrap.hasClass('stand-alone')){
        threshold = 0.1;
      }  //to check if first or last slide
      if (fraction < threshold) {
        //need nested if
        if (slideshow.slickCurrentSlide() !== 0) {
          return 'prev';
        }
      }
      else
      {
        if (slideshow.slickCurrentSlide() !== slickObj.$slides.length - 1) {
          return 'next';
        }
      }
      return null;
    }

    function fireSlideActions( currentIdx, nextIdx) {
      //var exploreMore;
      // these actions can be called by the slides
      // by adding attr "data-slide-action"
      // and specifying a key in slideActions
      var slideActions = {
        exploreMore: function () {
          treatExploreMoreHeadlines();
          exploremore.hideCaptionContainer();
        }
      };
      var targetSlide = slickObj.$slides[nextIdx],
          actionName = $(targetSlide).attr('data-slide-action');
      if (actionName && slideActions[actionName]) {
        slideActions[actionName]( currentIdx, nextIdx);
      }
    }

    function setSizes(slideshowObj) {
      // unclear:
      // uses slideshow from outer scope
      var w = slideshow.width(),
          h = slideshow.height(),
          r = w / h;

      var inactiveSlides = slideshowWrap.find('.slick-cloned');
      _.each(inactiveSlides, function(slide){

        var slideElm = $(slide),
            wrapper = slideElm.find('.wsj-slideshow-image-wrap'),
            img = slideElm.find('.wsj-slideshow-image'),
            imgW = img.attr('data-width'),
            imgH = img.attr('data-height'),
            imgR = imgW / imgH,
            tolerance = 0.01; // helps with slight rendering bugs on mobile

        if (imgR > r - tolerance) {
          wrapper.removeClass('tall');
          if (imgW > w) {
            wrapper.addClass('wide');
          } else {
            wrapper.removeClass('wide'); // wider
          }
        } else {
          wrapper.removeClass('wide');
          if (imgH > h) {
            wrapper.addClass('tall');
          } else {
            wrapper.removeClass('tall'); // taller
          }
        }
      });

      _.each(slideshowObj.$slides, function (slide) {
        var slideElm = $(slide),
            wrapper = slideElm.find('.wsj-slideshow-image-wrap'),
            img = slideElm.find('.wsj-slideshow-image'),
            imgW = img.attr('data-width'),
            imgH = img.attr('data-height'),
            imgR = imgW / imgH,
            tolerance = 0.01; // helps with slight rendering bugs on mobile

        if (imgR > r - tolerance) {
          wrapper.removeClass('tall');
          if (imgW > w) {
            wrapper.addClass('wide');
          } else {
            wrapper.removeClass('wide'); // wider
          }
        } else {
          wrapper.removeClass('wide');
          if (imgH > h) {
            wrapper.addClass('tall');
          } else {
            wrapper.removeClass('tall'); // taller
          }
        }
      });

      if (!slideshow.hasClass('sizes-ready')) {
        slideshow.addClass('sizes-ready');
      }
    }

    function openFullScreen() {
      fullScreenSlideshow = $(originalDom);
      $('body').append(fullScreenSlideshow);
      fullScreenSlideshow.addClass('wsj-slideshow-fullscreen');
      fullScreenSlideshow.hide().fadeIn(400);
      //omnitool may need to be refactored out
      omnitool.trackFull(slideshowWrap, indexElm);
      setupSlideshow(fullScreenSlideshow, {
        startSlide: slideshow.slickCurrentSlide(),
        isFullScreen: true,
        touchThreshold: 20,
        truncate: false,
        inlineJumpToSlide: jumpToSlide
      });
      //focus goes back to inlineSlideshow without setTimeout
      //because fullscreenhandle's click finishes after fullscreen opens
      //
      setTimeout(function() {
        fullScreenSlideshow.click();
      }, 10);
      $( ".explore-more-slide").css("visibility" , "visible");
    }

    function closeFullScreen() {
      slideshowWrap.off('keydown');
      slideshowWrap.fadeOut(400, function () {
        slideshowWrap.remove();
      });
      options.inlineJumpToSlide(slideshow.slickCurrentSlide());
    }

    function toggleFullScreen() {
      if (options.isFullScreen) {
        closeFullScreen();
      } else {
        openFullScreen();
      }
    }

    // EVENT BINDING

    infoContainer.find(".wsj-slideshow-counter").swipe({
      tap: toggleCaptions,
      longTap: toggleCaptions,
      longTapThreshold: 0,
      distance: 30
    });

    fullScreenHandle.swipe({
      tap: toggleFullScreen
    });

    homeButton.click(function(){
      slideshow.slickNext();
      //omnitool may need to be refactored out
      omnitool.trackGeneral("back-to-beginning");
    });

    var isSwiping = false; //variable for swipe
    slideshow.swipe({
      allowPageScroll: "vertical",
      tap: function (event) {
        if (isSwiping === false) {
          var direction = decideClickDirection(slideshow, event);

          if (direction === 'next') {
            slideshow.slickNext();
          } else if (direction === 'prev') {
            slideshow.slickPrev();
          }
        }
        isSwiping = false;
      }
    });

    if (options.isFullScreen) {

      slideshowWrap.find(".wsj-slideshow-caption").on("mousedown", function(e){
        e.stopPropagation();
        return true;
      });
      slideshowWrap.swipe({
        threshold: 50,
        swipeUp: function (event, direction, distance, duration, fingerCount) {
          openCaptions();
        },
        swipeDown: function (event, direction, distance, duration, fingerCount) {
          closeCaptions();
        }
      });
    }

    // hack: prevents the dragging from looking like its downloading the images
    slideshow.find('img').on('dragstart', function (event) {
      event.preventDefault();
    });

    // Size the slide images
    var sizer = _.throttle(function () {
      setSizes(slickObj);
      treatCaptions();
      treatExploreMoreHeadlines();
    }, 200);

    // HACK ATTACK:
    // This depends on weird code in context.js
    intent.onInit(sizer);
    intent.on('width:', sizer);
    $(window).on('resize.wsjSlides', sizer);

  }

  function swapImageSources(htmlString){

    // suppress the small attrs
    htmlString = htmlString.replace(/data\-width[\s]*=/g,"data-width-small=");
    htmlString = htmlString.replace(/data\-height[\s]*=/g,"data-height-small=");
    htmlString = htmlString.replace(/data\-lazy[\s]*=/g,"data-lazy-small=");

    // activate large attrs
    htmlString = htmlString.replace(/data\-lazy\-large[\s]*=/g,"data-lazy=");
    htmlString = htmlString.replace(/data\-width\-large[\s]*=/g,"data-width=");
    htmlString = htmlString.replace(/data\-height\-large[\s]*=/g,"data-height=");

    return htmlString;
  }

  var slideshowModule = {
    init: function () {
      var slideshows = $('.wsj-slideshow');
      //omnitool may need to be refactored out
      omnitool.setupTracking(slideshows);
      // Check if is standalone slide for ad logic
      // hacky way of doing it, and should be refactored in future
      var isStandalone = $('.stand-alone').length;
      var opts = { isStandalone: false };
      if (isStandalone) {
        opts.isStandalone = true;
      }
      intent.onInit(function(){
        $.each(slideshows, function (i, elm) {
          setupSlideshow(elm, opts, slideshowCaption.getCaptionClass());
        });
      });
    }
  };
  return slideshowModule;
});

define('article.app/content/scripts/browser_upgrade_warning', [
  'article.app/context',
  'vendor.asset.jquery/jquery'
], function(intent, $) {

  var browserUpgradeWarning = {
    init: function () {
      // Div containing upgrade message
      var upgradeMessage = $('.ie-flag');

      // Only bind the event if IE8 or less
      if (upgradeMessage) {
        var exitButton = $('.ie-button');
        exitButton.click(function(){
          upgradeMessage.animate({height: 0}, 1000, function() {
            upgradeMessage.hide();
          });
        });
      }
    }
  };

  return browserUpgradeWarning;
});

define('article.app/content/scripts/force-lazy-load',
      ['article.app/context', 'vendor.asset.jquery/jquery'],
      function(intent, $) {

        function isIE () {
          var myNav = navigator.userAgent.toLowerCase();
          return (myNav.indexOf('msie') === -1) ? false : parseInt(myNav.split('msie')[1]);
        }

        return {
          init: function() {
            $(function() {

              // This breaks ie8
              if (isIE() && isIE() < 9) {
                return;
              }
              var slowslides = $('img[data-lazy]');
              var cnt;
              function removeLazyLoad(target) {
                target.removeAttr('data-lazy');
              }
              for (cnt = 0; cnt < slowslides.length; cnt++) {
                var targetImage = $(slowslides[cnt]);
                targetImage.attr('src', targetImage.attr('data-lazy')).removeClass('slick-loading').load(removeLazyLoad(targetImage));
              }
            });
          }
        };
      });

/*jshint white:true, evil:false, onevar:false, undef:true, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:true, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/*global console, define, navigator, screen, window, document*/
define('article.app/livefyrecomments', [
  'vendor.asset.jquery/jquery',
  'article.app/LivefyreCommentWidget',
  'resp.module.livefyre/dj/widget/googleuseragent'
], function ($, LivefyreComments, goog) {

  var livefyrecomments = {

    options: {
      mobile: function () {
        return ((goog.userAgent.MOBILE || goog.userAgent.ANDROID || window.navigator.userAgent.indexOf('IEMobile') !== -1) && goog.userAgent.IPAD) ? true : false;
      },
      ie8: function () {
        return (goog.userAgent.IE && goog.string.contains(goog.userAgent.VERSION, "8.0")) ? true : false;
      }
    },

    renderState: false,

    init: function (options) {
      var self = this,
        $lfEl = $('#livefyre-comment'),
        mobile = self.options.mobile(),
        hash = self.checkHash(),
        ie8 = self.options.ie8(),
        $lfElData = $('#livefyre-wrapper').data();
      if ($lfEl.length > 0) {

        // if (mobile) {
        //   $(function () {
        //     $('head').append($lfElData.mobile);
        //   });
        //   self.mobileWidget.renderWidget(self, options, $lfEl);
        // } else {
          if (ie8) {
            self.countClickEvent(self, options, $lfEl);
            $lfEl.children('.fyre-bootstrap').addClass('visibility-visible-important').show();
          } else {
            $(function () {
              $('head').append($lfElData.desktop);
            });
            if (hash) {
              // load widget if hash is found and parsed
              self.desktopWidget.renderWidget(self, options, $lfEl);
            } else {
              // lazyload widget if hash is found and parsed
              self.desktopWidget.lazyLoad(self, options, $lfEl);
            }
          }
        // }
      }
    },

    countClickEvent: function (self, options, $lfEl, poll, dfd) {
      // set click handler on shartools comments to scroll to widget and render.
      $('body').on('click.renderComments', '.icn-comments', function (e) {
        e.preventDefault();
        var $currOffsetY = $lfEl.offset().top - 10;
        //console.log('scrolling');
        $('html,body').animate({
          scrollTop: $currOffsetY
        }, 600);

        if (!self.renderState && poll && dfd) {
          clearInterval(poll);
          dfd.resolve();
        }
      });

    },

    checkHash: function () {

      var hash = {
        exists: false,
        str: window.location.hash,
        key: '',
        id: null,
        idNum: null
      };

      if (hash.str) {
        hash.key = hash.str.split('=')[0];
        if (hash.key === '#lf_comment' || hash.key === '#lf-content') {
          hash.id = hash.str.split('=')[1];
          hash.idNum = hash.id.replace(':', '');
          if (hash.id.length >= 8 && !(isNaN(hash.idNum))) {
            hash.exists = true;
          }
        }
      }
      return hash.exists;
    },

    desktopWidget: {
      renderWidget: function (self, options, $lfEl) {
        // console.log('rendering desktop');
        self.renderState = true;
        var module = new LivefyreComments(self.options);
        $.extend(self.options, options);
        $('#livefyre-comment').addClass('desktop-widget');
        module.render();
        //console.log('Happening');
      },

      lazyLoad: function (self, options, $lfEl) {
        var $lfElOffsetY = $lfEl.offset().top ,
            scrollPos = 0,
            poll,
            promise = pollScroll(),
            $sharetoolsEl = $('.shareTools', 'section'),
            $commentCountEl = $('.icn-comments', $sharetoolsEl);

        function pollScroll() {
          var dfd = $.Deferred();

          poll = setInterval(function () {
            //console.log('polling');
            if (!self.renderState) {
              scrollPos = $(document).scrollTop();
              if (scrollPos > $lfEl.offset().top - $(window).height() * 3) {
                clearInterval(poll);
                //console.log('resolving');
                $commentCountEl.off('click.renderComments');
                dfd.resolve();
              }
            }
          }, 250);

          self.countClickEvent(self, options, $lfEl, poll, dfd);
          return dfd.promise();
        }

        promise.done(function () {
          self.desktopWidget.renderWidget(self, options, $lfEl);
        });

      }
    },

    mobileWidget: {
      renderWidget: function (self, options, $lfEl) {
        // console.log('mobile');
        var module = new LivefyreComments(self.options);
        self.renderState = true;
        $.extend(self.options, options);
        // put mobile styles on page
        $('#livefyre-comment').addClass('mobile-widget');
        $('body').on('click.renderComments', '.icn-comments', function (e) {
          e.preventDefault();
          var $currOffsetY = $lfEl.offset().top - 10;
          $('html,body').animate({
            scrollTop: $currOffsetY
          }, 600);
        });
        module.render();
      }
    }
  };

  return livefyrecomments.init();

});

/*jshint white:true, evil:false, onevar:false, undef:true, laxcomma:true, forin:true, noarg:true, noempty:true, eqeqeq:true, bitwise:false, undef:false, unused:false, curly:true, devel:true, indent:2, maxerr:50 */
/*global setTimeout, console, define, navigator, screen, window*/
/**
 * Comment view
 */
define('article.app/LivefyreCommentView', [
  'resp.module.livefyre/dj/widget/view/LivefyreOnboardingView',
  'resp.module.livefyre/dj/widget/model/LivefyreOnboardingModel',
  'resp.module.livefyre/dj/widget/view/LivefyreFailMessagingView',
  'resp.module.livefyre/dj/widget/model/LivefyreFailMessagingModel',
  'resp.module.livefyre/dj/widget/view/LivefyreConfigureStrings',
  'resp.module.livefyre/dj/widget/util',
  'vendor.asset.jquery/jquery', 'vendor.asset.backbone/backbone',
  'article.app/content/scripts/omnitool'
], function (OnboardingView, OnboardingModel, FailMessagingView, FailMessagingModel,
             ConfigureStrings, util, $, Backbone, omnitool) {
  var LivefyreCommentView = Backbone.View.extend({
    config: {
      "path": "/news/commenting/",
      loadOptions: {
        "strings": ConfigureStrings
      },
      streamOptions: {
        "editorCss": {
          background: 'none repeat scroll 0 0 #FFFFFF !important',
          color: '#404040',
          font: "16px/1.4 Arial, \"Helvetica Neue\", Helvetica, Geneva, sans-serif",
          padding: "6px",
          margin: "0",
          width: "100%",
          height: "100%",
          'max-height': "199px",
          'max-width': "589px",
          "box-sizing": 'border-box',
          "-webkit-box-sizing": 'border-box',
          "-moz-box-sizing": 'border-box',
          "-ms-box-sizing": 'border-box',
          "-o-box-sizing": 'border-box'
        }
      }
    },
    events: function () {
      var events = {};
      return events;
    },
    onClickMoreHistory: function () {
      console.log('onClickMoreHistory');
    },
    setliveFyreConfig: function () {
      var self = this;

      var config = {
        ExpoPath: this._cfg.path,
        SkinCssUrl: this._cfg.css,
        LoadOptions: this._cfg.loadOptions,
        StreamOptions: this._cfg.streamOptions,
        LoginHandler: function () {
          // This should call functionality on your site that will open a login modal/dialog for your users to sign in to your site
          LIFP.login();
        },

        MissingNameHandler: function () { // REQUIRED
          // This function will get called if a user attempts to interact with the stream is logged in but their name is missing from their profile
          // Let the user know their name is missing and that they must update their profile before they can comment
        },

        SuspendedUserHandler: function (name) { // REQUIRED
          // This function will get called if a user attempts to interact with the stream and that user is suspended
          // Users can get suspended by moderators if they are suspected of using a fake identity or have a famous name
          // The user should be told they are suspended and that they will either have to change their name or prove
          // to a customer service rep that they are who they say they are before being allowed to comment
          alert('There\'s a problem with your profile. Please contact moderator@wsj.com for more information.');
        },

        FirstTimeCommenterHandler: function (name, acceptTermsCallback) { // REQUIRED
          // If a user hasn't commented before they should be shown a message asking them to read and accept your sites terms of use or commenting policy
          // Use their name to make the message more personal
          // acceptTermsCallback should be called when the user hits accept, the callback will make an ajax call to get the users LF token and log them into
          // the livefyre comment stream, you may optionally pass in your own callback function to acceptTermsCallback
          // it will get called once the ajax request is complete

          var model = new OnboardingModel();
          var options = {};
          options.name = name;
          options.acceptTermsCallback = acceptTermsCallback;
          options.$moduleEl = self.$el.parent();

          this.onboardingView = new OnboardingView({
            el: self.$el.prev(),
            model: model
          }, options);

          this.onboardingView.render();

        },

        FailHandler: function (type) { // REQUIRED
          // This is called if Livefyre's servers error out or take too long to respond
          // Use this the degrade your page gracefully and/or let users know they may need to refresh the page because there was an error
          var model = new FailMessagingModel();
          var options = {};

          options.type = type;

          this.failMessagingView = new FailMessagingView({
            el: self.$el.prev(),
            model: model
          }, options);

          this.failMessagingView.render();

        },

        CommentCountUpdatedHandler: function (count) {

          // This function will get called anytime a comment is added to the page
          // use this to update any elements on the page outside of the stream that contain the count
          var txt = "<span class='icn'></span><span class='stI-comment-count'>" + count + '</span>' + (count === 1 ? ' Comment' : ' Comments');
          $('a.icn-comments').attr('href', '#livefyre-comment').html(txt);

          self.model.commentCount = count;

          if (self.init.updateStart) {
            self.runUpdate('update');
          }

          self.init.updateStart = true;

        },
        CommentLikedHandler: function (data) { // OPTIONAL
          // This function will get called anytime a user likes a comment in the stream
          // prob can't use this since it doens't trigger when likes are removed.
        },
        CommentSharedHandler: function (data) { // OPTIONAL
          // data contains 2 boolean properties: 'sharedToTwitter' and 'sharedToFacebook'
          // The intended use of this function is to track shares
          //console.log(data);
          var $link = $('.fyre-share-link', '#livefyre-comment').filter(function () {
            return ($(this).data('sharing') === 'true') ? $(this) : false;
          });
          $link.removeClass('is-open');
          self.eventHandlers.killScroll.off();
        },
        CommentPostedHandler: function () { // OPTIONAL
          // The intended use of this function is to perform tracking when a comment is posted
          self.runUpdate('post');
        },
        ReadyHandler: function () {
          self.model.name = DowJones.LivefyreCommentStream.Name;
          self.setProfileAttributes();
        }
      };

      return config;
    },

    login: {
      loggedState: false,
      checkStatus: function (self) {
        var type = $('meta[name="user.type"]').attr('content');
        switch (type) {
        case 'subscriber':
          self.login.loggedState = true;
          break;
        case 'freeRegister':
          self.login.loggedState = true;
          break;
        case 'nonsubscriber':
          self.login.loggedState = false;
          break;
        }
        return self.login.loggedState;
      }
    },

    init: {
      streamElement: null,
      updateStart: false,
      loggedIn: function (self, $stream, cb) {

        var ruleHTML,
          profilevisibility;

        ruleHTML = '<p class="comment-rules-note">All comments will display your real name. Read our <a href="http://online.wsj.com/public/page/commenting-rules.html" target="_blank">commenting rules.</a></p>';
        profilevisibility = $stream.data('profilevisibility');

        $('body').addClass(profilevisibility);
        $('.fyre-editor', $stream).eq(0).after(ruleHTML);
        self.init.addLogBanner(self, $stream);
        self.charCounter.addCounter(self, $stream);

        cb(self, $stream);
      },

      checkAdmin: function (self, $stream) {
        var link,
          poll,
          userType = {
            admin: 'site-admin',
            sub: 'site-user'
          },
          inc = 0,
          resolved;
        $stream = $stream || $('#livefyre-comment');

        poll = setInterval(function () {
          link = $('.fyre-auth', $stream).find('li.fyre-admin-link > a');
          if (link.length > 0) {
            resolved = (link.text() === 'Site admin') ? userType.admin : userType.sub;
            $stream.addClass(resolved);
            clearInterval(poll);
          } else if (inc >= 5000) {
            $stream.addClass(resolved);
            resolved = userType.sub;
            clearInterval(poll);
          }

          inc += 30;

        }, 30);
      },

      addLogBanner: function (self, $stream) {

        var $logBannerEl,
          $html,
          ctaHtml,
          resolved,
          $elData;

        $logBannerEl = $('<div />', {
          "class": "fyre-comments-log-button"
        });
        $elData = $stream.data();

        ctaHtml = {
          loggedOut: '<p><a href="' + $elData.loginurl + '" class="login-button">Log in to comment</a></p>',
          profileOnboard: '<p><a href="#" class="js-onboard">Set your profile to public to comment</a></p>',
          profilePublic: '',
          seamless: '<p>Your subscription does not allow access to this feature</p>'
        };

        if ($elData.isseamless) {
          resolved = 'seamless';
        } else if (!self.login.loggedState) {
          resolved = 'loggedOut';
        } else if ($elData.profilevisibility === 'public' && $elData.profileacceptedagreement !== '') {
          resolved = 'profilePublic';
        } else {
          resolved = 'profileOnboard';
          self.eventHandlers.onboard.setHeight();
          self.eventHandlers.onboard.clickEvents(self);
        }

        $('.fyre-featured-content-wrapper', $stream).after($logBannerEl);
        $('.fyre-comments-log-button', $stream).html(ctaHtml[resolved]);

      },

      notLoggedIn: function (self, $stream, cb) {
        $('body').addClass('user-loggedout');
        self.init.addLogBanner(self, $stream);

        cb(self, $stream);
      },

      callbacks: function (self, $stream) {

        self.subscribers.addBox(self);
        self.subscribers.subClickHandler(self);
        self.subscribers.expandArticleClickHandler(self);

        self.moderatorCheck(self);
        self.notifier.clickHandler(self);
        self.likeButton.badge(self, $stream);
        self.likeButton.egoCheck(self, $stream);
        self.eventHandlers.sortDrop.clickHandler(self, $stream);
        self.eventHandlers.bodyNode.clickHandler(self);
        self.eventHandlers.loadMore(self);
        self.eventHandlers.mention(self);
        self.eventHandlers.archiveBtn.build(self);

        if (self.login.loggedState) {
          self.eventHandlers.flag.icon(self);
          self.eventHandlers.like(self);
          self.eventHandlers.share(self);
          self.eventHandlers.reply.button(self);
          self.eventHandlers.editBox.events(self);
          self.notifier.clickCommentHandler(self);
          self.init.checkAdmin(self, $stream);
        }

        self.checkStream(self, $stream);

      }
    },

    checkStream: function (self, $stream) {

      $('.fyre-comment-article', $stream).data('handled', 'yes');

      setInterval(function () {
        var $notHandled, dfd;

        dfd = $.Deferred();
        $notHandled = $('.fyre-comment-article', $stream).filter(function () {
          return ($(this).data('handled') === 'yes') ? false : $(this);
        });

        if (self.updateRunning || $notHandled.length === 0) {
          dfd.reject();
        } else {
          //console.log('calling update');
          self.runUpdate('check');
          dfd.resolve();
        }

        return dfd.promise();

      }, 1000);
    },

    updateRunning: false,
    runUpdate: function (type) {
      //console.log('run update called: ' + type);
      var self = this,
        $replyEls,
        $currentArticles,
        $notHandled,
        $mainEditor,
        subCheckBox;

      self.updateRunning = true;

      subCheckBox = self.subscribers.checkboxState;
      $mainEditor = $('.fyre-editor', self.init.streamElement).eq(0);
      $currentArticles = $('.fyre-comment-article', self.init.streamElement);
      $notHandled = $currentArticles.filter(function () {
        return ($(this).data('handled') === 'yes') ? false : $(this);
      });
      $replyEls = $('.fyre-comment-reply', $currentArticles);

      if (type && type === 'cleared') {
        $notHandled = $currentArticles;
      }

      $notHandled.each(function () {

        if (type) {
          // console.log(type);

          if (type === 'update' || type === 'check') {
            if (subCheckBox) {
              self.subscribers.runSubScrub(self, $(this));
            }
            if (type === 'check') {
              $('.fyre-comment-footer', $(this)).removeClass('no-max-height is-editing').siblings('.fyre-comment-head').find('.fyre-comment-date').show();
            }
          } else if (type === 'post') {
            self.eventHandlers.tracking.trigger(self);
            self.charCounter.clearCounter(self);
            self.charCounter.under(self, $mainEditor, $('.fyre-post-button', $mainEditor), $('.counter-wrapper', $mainEditor));
            $('.reply-to-wrapper', self.init.streamElement).hide();
          }

          self.likeButton.badge(self, $(this));
          self.likeButton.egoCheck(self, $(this));
        }

        $(this).data('handled', 'yes');

      }).promise().done(function () {

        if (type === 'post') {
          self.eventHandlers.editBox.closeBox(self, $('.fyre-post-button-edit', self.init.streamElement));
          self.eventHandlers.bodyNode.replyHelper(self, 'body', $replyEls);
        }

        if (type && type === 'load' && subCheckBox) {
          self.subscribers.runSubScrub(self);
        }

        self.likeButton.egoCheck(self);
        self.notifier.checkCount(self);
        self.moderatorCheck(self);
        self.loader.hidden(self);
        self.updateRunning = false;
      });
    },

    flag: {

      openDrop: function (self, $this) {

        //console.log('flag open called');

        setTimeout(function () {

          var $footerEl = $this.closest('.fyre-comment-footer'),
            $footerChild = $footerEl.children('.fyre-comment-actions'),
            $modalElOrig = $('body > .fyre-modal'),
            $modalElOrigSel = $modalElOrig.find('.fyre-modal-flagas'),
            $cloneModal = $modalElOrig.clone(true, true).removeClass('display-none-important').addClass('inline-modal-flag is-open'),
            $cloneFormContainer = $cloneModal.find('.fyre-modal-container'),
            $cloneForm = $cloneFormContainer.children('form'),
            $cloneFormSelect = $cloneForm.find('.fyre-modal-flagas'),
            thanksHtml = '<div class="flag-thanks-wrapper"><span class="flag-header">Thank You!</span><span class="flag-message">You have reported this comment for review. Your help is helping us host a better conversation.</span></div>',
            i = 0,
            values = $cloneFormSelect.children().map(function () {
              return $(this).val();
            }).get();

          values = values.sort();
          values = values.reverse();

          $cloneFormContainer.append('<ul class="select-list"></ul>').append(thanksHtml);
          for (i; i < values.length; i += 1) {
            values[i] = (values[i] === 'disagree') ? 'Other' : values[i];
            $cloneFormContainer.children('.select-list').append('<li><a href="#" class="select-item" ref=' + values[i] + ' >' + values[i] + '</a></li>');
          }

          // remove all other inline-modals in the widget
          $('.fyre-modal', self.init.streamElement).remove();
          $modalElOrig.addClass('display-none-important visibility-hidden-important');

          self.updateZindex.makeTop(self, $footerEl);
          self.eventHandlers.killScroll.off();
          $this.addClass('is-open').siblings().removeClass('is-open');


          $footerChild.prepend($cloneModal);
          $footerEl.css('z-index', '3').find('*').addClass('opacity-visible');
          $footerChild.find('.inline-modal-flag').animate({
            'height': 154
          }, 200, function () {
            $(this).addClass('is-open');
          });

          self.eventHandlers.flag.selectClick.on(self);
          //console.log(self.eventHandlers.bodyNode.flagState);
        }, 10);

        self.eventHandlers.bodyNode.flagState = true;

      },

      triggerFlag: function (self, $tar) {
         console.log('trigger flag called');
        var val,
          $modalElOrig,
          $modalElOrigSel,
          $flagLink,
          $footerEl;

        $footerEl = $tar.closest('.fyre-comment-footer');
        $flagLink = $('.fyre-flag-link', $footerEl);
        $modalElOrig = $('body > .fyre-modal');
        $modalElOrigSel = $modalElOrig.find('.fyre-modal-flagas');
        $thanksEl = $footerEl.find('.flag-thanks-wrapper');
        val = $tar.text();
        val = (val === 'Other') ? 'disagree' : val;

        $modalElOrigSel.val(val);

        $modalElOrig.find('button.goog-buttonset-default').eq(0).trigger('click');
        $modalElOrig.removeClass('display-none-important visibility-hidden-important');

        $flagLink.addClass('is-flagged').off('mouseup.flagLink');

        $thanksEl.addClass('opacity-visible').fadeIn(200, function () {
          setTimeout(function () {
            self.flag.closeDrop(self);
          }, 2000);
        });

      },

      closeDrop: function (self) {
        //console.log('closeDrop');
        var $inlineModal,
          $footerEl,
          $menuEl,
          $modalElOrig;

        $modalElOrig = $('body > .fyre-modal');
        $inlineModal = $('.inline-modal-flag', self.init.streamElement);
        $footerEl = $inlineModal.closest('.fyre-comment-footer');
        $menuEl = $footerEl.children('.fyre-editor').children('.fyre-editor-container').find('.fyre-mention-button');

        $inlineModal.animate({
          'height': 0
        }, 200, function () {
          $(this).remove();

          $footerEl.css('z-index', '2').find('*').removeClass('opacity-visible');
          $footerEl.find('.fyre-flag-link').removeClass('is-open');

          self.eventHandlers.flag.selectClick.off(self);
          self.eventHandlers.bodyNode.flagState = false;

          if (!($menuEl.hasClass('fyre-button-left-open'))) {
            self.updateZindex.removeTop(self, $footerEl);
          }

        });

      }
    },

    updateZindex: {
      makeTop: function (self, $el) {
        if ($el) {
          $el.closest('.fyre-comment-wrapper').addClass('top-z-index').data('top', 'true');
          self.eventHandlers.bodyNode.topState = true;
        }
      },
      removeTop: function (self, $el) {
        if ($el) {
          $el.closest('.fyre-comment-wrapper').removeClass('top-z-index').data('top', '');
          self.eventHandlers.bodyNode.topState = false;
        }
      }
    },

    moderatorCheck: function (self) {
      return $('.fyre-moderator', self.init.streamElement).parent().siblings('.fyre-comment-user').children('.fyre-comment-author').addClass('fyre-comment-author-tag-editor');
    },

    notifier: {
      checkCount: function (self) {
        var method, $el, commentCount;

        $el = $('.fyre-notifier', self.init.streamElement);
        commentCount = $el.find('li').length;
        method = (commentCount > 5) ? 'addClass' : 'removeClass';
        $el[method]('is-scrolling');

        return commentCount;

      },
      addYoursClickHandler: function (self) {
        //console.log('add yous click logged');
        $('body').on('click', '.add-yours-link', function (e) {
          //console.log('add yous clicked');
          e.preventDefault();
          e.stopPropagation();
          var scrollposY = self.init.streamElement.offset().top - 10;

          $('html,body').animate({
            scrollTop: scrollposY
          }, 600);
          self.init.streamElement.focus();

        });
      },

      clickCommentHandler: function (self) {
        $('body').on('mouseup', '.fyre-notifier li', function (e) {
          if (self.subscribers.checkboxState) {
            self.subscribers.removeSubOnly(self);
          }
        });
      },
      clickHandler: function (self) {
        var expanded, addAdded, $addYoursHtml;

        expanded = false;
        addAdded = false;
        $addYoursHtml = $('<a>', {
          'class': 'add-yours-link',
          'href': '#'
        });

        $addYoursHtml.text('Add your comment');

        $('body').on('mouseup.notifier', '.fyre-notifier-base-shadow', function (e) {

          var $tar = $(this),
            $notifierEl = $('.fyre-notifier', $tar),
            $noteContainerEL = $tar.parents('.fyre-notifier-container');

          expanded = !expanded;

          if (expanded) {
            $noteContainerEL.addClass('is-open');
            if (!addAdded) {
              $noteContainerEL.append($addYoursHtml);
              self.notifier.addYoursClickHandler(self);
              addAdded = !addAdded;
            }
          } else {
            $noteContainerEL.removeClass('is-open');
          }

          self.notifier.checkCount(self);

        });
      }
    },
    subscribers: {
      subRunning: false,
      checkboxState: false,
      addBox: function (self) {
        var $contWrap, html;

        $contWrap = $('.fyre-stream-sort', self.init.streamElement).eq(0);
        html = '<div class="sub-only-wrapper"><div class="sub-copy">Subscribers Only</div><div class="sub-check-wrapper"></div></div>';

        $contWrap.append(html);
      },

      subClickHandler: function (self) {
        // check subscribers only click handler
        $('body').on('click', '.sub-check-wrapper', function (e) {
          e.preventDefault();
          e.stopPropagation();

          if (self.subscribers.subRunning) {
            return;
          }

          self.subscribers.subRunning = true;
          self.subscribers.checkboxState = !self.subscribers.checkboxState;
          self.loader.visible(self);

          if (self.subscribers.checkboxState) {
            $(this).addClass('is-checked');
            self.subscribers.addSubOnly(self, $(this));
          } else {
            $(this).removeClass('is-checked');
            self.subscribers.removeSubOnly(self, $(this));
          }

        });
      },

      addSubOnly: function (self, $el) {
        self.init.streamElement.addClass('sub-only');
        self.subscribers.runSubScrub(self);
      },

      removeSubOnly: function (self, $el) {
        var $commentEls = $('.fyre-comment-article', self.init.streamElement);
        self.loader.visible(self);
        self.subscribers.expand(self, $commentEls);
      },

      runSubScrub: function (self, $el) {
        var $article, $filtered, className, $delParents;

        $article = $el ? $el : $('.fyre-comment-article[data-handled!="yes"]', self.init.streamElement);
        $filtered = $article.filter(function (i) {
          className = this.children[0].className;
          return (className.indexOf('fyre-comment-author-tag-subscriber') === -1 && className.indexOf('fyre-comment-author-tag-staff') === -1 && className.indexOf('fyre-comment-author-tag-accountsuspended') === -1);
        });
        $delParents = $('.fyre-comment-deleted', self.init.streamElement).parent();

        if ($filtered.length > 0) {
          $filtered.addClass('is-minified');
        }

        if ($delParents.length > 0) {
          $delParents.addClass('is-minified');
        }

        self.loader.hidden(self);
        self.subscribers.subRunning = false;
      },

      expandArticleClickHandler: function (self) {
        $('body').on('click', '.is-minified > .fyre-comment-wrapper', function (e) {
          e.preventDefault();
          e.stopPropagation();
          self.subscribers.expand(self, $(this).parent());
        });
      },

      expand: function (self, $el) {
        $el.removeClass('is-minified first-child display-none-important');
        if ($el.length > 1) {
          self.init.streamElement.removeClass('sub-only');
          self.loader.hidden(self);
          self.subscribers.subRunning = false;
        }
      }
    },

    loader: {
      visible: function (self) {
        // show loader
        $('.fyre-stream-content', self.init.streamElement).addClass('visibility-hidden-important');
        $('.fyre-content-loading', self.init.streamElement).addClass('display-block-important');
      },
      hidden: function (self) {
        // hide loader
        $('.fyre-stream-content', self.init.streamElement).removeClass('visibility-hidden-important');
        $('.fyre-content-loading', self.init.streamElement).removeClass('display-block-important');
      }
    },

    likeButton: {

      badge: function (self, $el) {

        $el = $el || $('.fyre-comment-article', self.init.streamElement);

        var dfd = $.Deferred(),
          $likeCountEl,
          threshold = 10, // for testing
          $tar;

        $likeCountEl = $('.fyre-comment-like-count', $el).filter(function () {
          var $filterEl = $(this),
            count = parseInt($(this).text(), 10),
            method;

          $(this).data('method', 'removeClass');
          count = (isNaN(count)) ? 0 : count;
          method = (count > threshold && count !== 0) ? 'addClass' : 'removeClass';
          $(this).data('method', method);

          return $(this);

        });

        $likeCountEl.each(function () {
          var method = $(this).data('method');
          $tar = $(this).closest('.fyre-comment-footer').siblings('.fyre-comment-head').eq(0).children('.fyre-comment-username');
          $tar[method]('most-liked');
        }).promise().done(function () {
          dfd.resolve();
        });

        return dfd.promise();
      },

      egoCheck: function (self, $el) {
        var uAuthId = DowJones.LivefyreCommentStream.UserAuthorId;
        // console.log('ego checking');
        $el = $el || self.init.streamElement;
        $('.fyre-comment-user[data-author-id="' + uAuthId + '"]', $el).siblings('.fyre-comment-footer').addClass('ego-checked');
      }
    },

    charCounter: {

      editorType: null,

      addCounter: function (self, $el, bol) {

        bol = bol || false;

        var $toolBar, $postBtn, rightPos, editorId, $editorEl, $cancelBtn, $mulligans, remaining, MAXCHARS, $counter, poll;

        MAXCHARS = 1000;
        $counter = $('<div />', {
          'class': 'counter-wrapper'
        });

        poll = setInterval(function () {

          if ($el.length > 0) {
            editorId = $('.editable', $el).eq(0).attr('id');

            if (editorId) {
              //console.log('counter added');
              $toolBar = $('.fyre-editor-toolbar', $el);
              $postBtn = $('.fyre-post-button', $toolBar);

              if (self.charCounter.editorType === 'iframe') {
                //console.log('self.charCounter.editorType: ' + self.charCounter.editorType);
                $mulligans = $(document.getElementById(editorId).childNodes[1].contentWindow.document).find('body');
              } else {
                //console.log('self.charCounter.editorType: ' + self.charCounter.editorType);
                $mulligans = $('.fyre-editor-editable', $el);
              }

              if ($('.counter-wrapper', $el).length === 0) {
                if (bol) {
                  $cancelBtn = $toolBar.find('.fyre-cancel-button');
                  rightPos = (parseInt($postBtn.width(), 10) + parseInt($cancelBtn.width(), 10)) + 4;
                } else {
                  rightPos = $postBtn.width();
                }

                $counter.css({
                  'right': rightPos
                });

                $postBtn.before($counter);
              }

              remaining = self.charCounter.checkLen($mulligans, MAXCHARS);
              $counter.text(remaining);

              $editorEl = self.charCounter.getEditortype(self, editorId);
              self.charCounter.keyUpHandler(self, MAXCHARS, $editorEl, $el, $postBtn);

              clearInterval(poll);

            }
          }
        }, 200);

      },

      getEditortype: function (self, editorId) {

        var $editableEl, $editorEl;
        //console.log('editorId: ' + editorId);
        $editableEl = $('.fyre-editor-editable', self.init.streamElement).eq(0);
        $editorEl = null;

        if ($('iframe', $editableEl).length !== 0) {
          //console.log('iframe');
          $editorEl = $(document.getElementById(editorId).childNodes[1].contentWindow.document);
          self.charCounter.editorType = 'iframe';
        } else {
          //console.log('div');
          $editorEl = $('#' + editorId);
          self.charCounter.editorType = 'div';
        }

        return $editorEl;

      },

      keyUpHandler: function (self, MAXCHARS, $editorEl, $el, $postBtn) {

        // attach hanlder to editor div
        $editorEl.keyup(function (e) {

          var $currEl = $(e.target),
            remaining = self.charCounter.checkLen($currEl, MAXCHARS),
            $counterEl = $el.find('.counter-wrapper').eq(0),
            test = null,
            code = e.keyCode || e.which;

          $counterEl.text(remaining);
          test = (remaining < 0) ? 'over' : 'under';
          self.charCounter[test](self, $editorEl, $postBtn, $counterEl);

        });

      },

      over: function (self, $editorEl, $postBtn, $counterEl) {

        var $postBlock = $counterEl.parent().find('.post-blocker-wrapper');

        if ($postBlock.length === 0) {
          $postBlock = $('<div>', {
            'class': 'post-blocker-wrapper top-z-index',
            'data-display': 'hidden'
          }).text('Post Too Long').css('width', $postBtn.width()).insertBefore($postBtn);
        }

        $counterEl.addClass('is-error');
        $postBtn.removeClass('fyre-post-button-enabled').addClass('fyre-post-button-disabled');

        if ($postBlock.data('display') === 'hidden') {
          $postBlock.animate({
            height: 31
          }, 200).data('display', 'block');
        }

      },
      under: function (self, $editorEl, $postBtn, $counterEl) {

        var $postBlock = $counterEl.parent().find('.post-blocker-wrapper');

        if ($postBlock.data('display') === 'block') {
          $postBlock.animate({
            height: 0
          }, 200).data('display', 'hidden');
        }
        $postBtn.addClass('fyre-post-button-enabled').removeClass('fyre-post-button-disabled');
        $counterEl.removeClass('is-error');
      },

      checkLen: function ($el, MAXCHARS) {
        var remaining = MAXCHARS - $el.text().length;
        return remaining;
      },

      clearCounter: function (self) {
        // console.log('charCounter.clearCounter called');
        // need a timeout to wait for main editor to reset itself after post.
        setTimeout(function () {

          var MAXCHARS = 1000,
            $mainCounterEl = $('.counter-wrapper', self.init.streamElement).eq(0),
            editorId = $mainCounterEl.parents('.fyre-editor-container').find('.editable').eq(0).attr('id'),
            $mainEditorEl, $mainEditorElContent, remaining;

          if (self.charCounter.editorType === 'iframe') {
            $mainEditorEl = $(document.getElementById(editorId).childNodes[1].contentWindow.document);
            $mainEditorElContent = $mainEditorEl.find('body').children();
          } else {
            $mainEditorEl = $('#' + editorId);
            $mainEditorElContent = $mainEditorEl;
          }

          remaining = self.charCounter.checkLen($mainEditorElContent, MAXCHARS);

          if (remaining < MAXCHARS) {
            $mainCounterEl.text(remaining);
          } else {
            $mainCounterEl.text(MAXCHARS);
          }

          $mainCounterEl.removeClass('is-error');

        }, 50);

      }
    },

    eventHandlers: {
      onboard: {

        tiggerDisplayModal: function () {
          $('.fyre-event-overlay').eq(0).trigger('click');
        },

        triggerKillModal: function () {
          $('.onboarding-done').eq(0).trigger('click');
        },

        setHeight: function () {
          setTimeout(function () {
            var $stream, tarHeight;
            $stream = $('#livefyre-comment');
            tarHeight = ($('.fyre-editor-container', $stream).height());

            $('.fyre-event-overlay', $stream).height(tarHeight);

          }, 1000);
        },

        clickEvents: function (self) {
          $('#livefyre-wrapper').on('click', '.js-onboard', function (e) {
            e.preventDefault();
            self.eventHandlers.onboard.tiggerDisplayModal();
          });

          $('body').on('click', '.ending > p > a', function (e) {
            e.preventDefault();
            self.eventHandlers.onboard.triggerKillModal();
          });
        }
      },

      killScroll: {
        on: function () {
          $('html').addClass('stop-scrolling');
        },
        off: function () {
          $('html').removeClass('stop-scrolling');
        }
      },

      archiveBtn: {
        build: function (self) {

          var $archiveStreamEl,
            $archiveShowBtn,
            $archiveLoadBtn,
            $archiveArticleEls,
            $cloneBtn,
            poll,
            inc;

          $archiveStreamEl = $('.fyre-archive-stream', self.init.streamElement);
          inc = 0;
          poll = setInterval(function () {

            if ($archiveStreamEl.length > 0) {
              $archiveShowBtn = $('#fyre-archive-more');
              $archiveLoadBtn = $('.fyre-stream-more', $archiveStreamEl);
              $archiveArticleEls = $('.fyre-stream-content', $archiveStreamEl).children('.fyre-comment-article');
              $cloneBtn = $archiveShowBtn.clone();

              if ($archiveArticleEls.length > 2) {
                $archiveShowBtn.remove();
                $archiveLoadBtn.hide();
                $archiveStreamEl.append($cloneBtn);
                self.eventHandlers.archiveBtn.clickEvent(self, $archiveStreamEl);
              }
              clearInterval(poll);
            } else {
              inc += 100;
            }

            if (inc >= 3000) {
              clearInterval(poll);
            }
          }, 100);

        },

        clickEvent: function (self, $archiveStreamEl) {
          var $archiveArticles,
            $cloneShowBtn,
            $archiveLoadBtn;

          $('#livefyre-comment').on('click', '#fyre-archive-more', function (e) {
            $archiveArticles = $('.fyre-comment-article:nth-child(n+3)', $archiveStreamEl);

            $cloneShowBtn = $('#fyre-archive-more');
            $archiveLoadBtn = $('.fyre-stream-more', $archiveStreamEl);

            $archiveArticles.slideDown('slow').addClass('show-all');
            $cloneShowBtn.remove();
            $archiveLoadBtn.show();

          });
        }
      },
      tracking: {
        trigger: function (self) {
          $('#js-fyre-ts').trigger('click');
        }
      },

      loadMore: function (self) {
        // run events when we load more comments on the page
        $('body').on('click', '.fyre-stream-more-container', function (e) {
          omnitool.trackGeneral("comment-load-more");
          self.loader.visible(self);
          self.runUpdate('load');
        });
      },

      mention: function (self) {
        $('body').on('click', function (e) {
          var $tar = $(e.target),
            $mentionEl = $tar.parents('.fyre-mention-button');
          if ($mentionEl.hasClass('fyre-button-left-open')) {
            $mentionEl.closest('.fyre-comment-wrapper').css('z-index', '9999999');
          } else {
            $mentionEl.closest('.fyre-comment-wrapper').css('z-index', '');
          }
        });
      },

      share: function (self) {

        var $el = self.init.streamElement;

        $('body').on('click', '.fyre-share-link', function (e) {
          var $modalElOrig = $('body > .fyre-modal'),
            $replyEls = $('.fyre-comment-reply', '#livefyre-comment').filter(function () {
              return ($(this).hasClass('fyre-reply-active')) ? $(this) : false;
            });

          if ($replyEls.length > 0) {
            self.eventHandlers.bodyNode.replyHelper(self, 'body');
            return;
          }

          if (!($(e.target).hasClass('is-open'))) {

            // console.log('share open');
            $(e.target).data('sharing', 'true').addClass('is-open');
            self.eventHandlers.killScroll.on();
            $modalElOrig.removeClass('display-none-important visibility-hidden-important').css('visibility', 'visible');
          } else {
            // console.log('share closed');
            $(e.target).data('sharing', 'false').removeClass('is-open');
            $modalElOrig.removeClass('display-none-important visibility-hidden-important').css('visibility', 'hidden');
            self.eventHandlers.killScroll.off();
          }

        });

        $('body').on('mouseup.closeShare', '.fyre-modal-title-close', function (e) {
          //console.log('share closed');
          var $modalElOrig = $('body > .fyre-modal'),
            $link = $('.fyre-share-link', '#livefyre-comment').filter(function () {
              return ($(this).data('sharing') === 'true') ? $(this) : false;
            });

          $link.removeClass('is-open');
          $modalElOrig.removeClass('display-none-important visibility-hidden-important').css('visibility', 'hidden');
          self.eventHandlers.killScroll.off();
        });

      },

      flag: {

        icon: function (self) {
          // flag post click handler

          $('body').on('mouseup.flagLink', '.fyre-flag-link', function (e) {

            e.preventDefault();

            var $modalElOrig = $('body > .fyre-modal'),
              $replyEls = $('.fyre-comment-reply', '#livefyre-comment').filter(function () {
                return ($(this).hasClass('fyre-reply-active')) ? $(this) : false;
              });

            if ($replyEls.length > 0) {
              //console.log('can not flag');
              self.eventHandlers.bodyNode.replyHelper(self, 'body');
              return;
            }

            if ($(this).hasClass('is-flagged')) {
              $modalElOrig.addClass('display-none-important visibility-hidden-important');
              return;
            } else {
              $modalElOrig.addClass('display-none-important visibility-hidden-important');
            }

            if (self.eventHandlers.bodyNode.flagState) {
              self.flag.closeDrop(self, $(this));
            } else {
              self.flag.openDrop(self, $(this));
            }

          });

        },

        selectClick: {
          on: function (self) {
            $('body').on('click.handleFlagClick', '.select-item', function (e) {
              e.preventDefault();
              self.flag.triggerFlag(self, $(this));
            });
          },

          off: function () {
            $('body').off('click.handleFlagClick');
          }
        }
      },

      editBox: {
        openBox: function (self, $tar) {
          var $editorBox,
            $counterEl,
            $footerEl,
            $timeEl;

          $footerEl = $tar.parents('.fyre-comment-body').siblings('footer');
          $editorBox = $footerEl.find('.fyre-editor');
          $counterEl = $('.counter-wrapper', $editorBox);

          $footerEl.addClass('no-max-height is-editing').siblings('.fyre-comment-head').find('.fyre-comment-date').hide();
          $editorBox.removeClass('display-none-important visibility-hidden-important');

          if ($counterEl.length === 0) {
            self.charCounter.addCounter(self, $editorBox, true);
          }

        },
        closeBox: function (self, $tar) {

          var $articleEl = $tar.closest('article');
          var $wrapperEl = $articleEl.children('.fyre-comment-wrapper');
          var $editorEl = $('.fyre-editor', $wrapperEl);
          var $errorEl;

          $editorEl.hide();

          setTimeout(function () {
            $errorEl = $editorEl.find('.fyre-editor-error');
            if ($errorEl.length > 0) {
              $editorEl.show();
              return;
            } else {
              $articleEl.data('handled', '');
              self.runUpdate('check');
            }
          }, 10);

        },

        events: function (self) {
          /* Editor Edit Button */
          $('body').on('mouseup', '.fyre-comment-edit', function (e) {
            e.preventDefault();
            var $tar;
            $tar = $(e.currentTarget);
            self.eventHandlers.editBox.openBox(self, $tar);
          });

          /* Editor Post Button */
          $('body').on('mouseup', '.fyre-post-button-edit', function (e) {
            alert("mouse up!!");
            e.preventDefault();
            var $tar = $(e.target);
            self.eventHandlers.editBox.closeBox(self, $tar);
          });

          /* Editor Cancel Edit Button */
          $('body').on('mouseup', function (e) {
            e.preventDefault();
            var $tar,
              $cancelEl,
              $timeEl;

            $tar = $(e.target);
            $cancelEl = $tar.parents('.fyre-cancel-button');
            $timeEl = $('.fyre-comment-date', self.init.streamElement);
            if ($tar.text() === 'Cancel' && $tar.hasClass('fyre-button-right-inner-box')) {
              $('.fyre-comment-footer', self.init.streamElement).removeClass('no-max-height is-editing');
              $timeEl.show();
            }

          });
        }
      },

      reply: {

        button: function (self) {
          // reply button click handler

          $('body').on('mouseup.replyClick', '.fyre-comment-reply', function (e) {
            e.preventDefault();
            var $tar,
              $editorBox,
              $counterEl,
              $replyEls;

            $tar = $(this);
            $editorBox = $tar.siblings('.fyre-editor');
            $counterEl = $('.counter-wrapper', $editorBox);

            if ($tar.hasClass('fyre-reply-active')) {
              $tar.data('active', false);
              self.eventHandlers.reply.removeReply(self, $tar);
            } else {
              $tar.data('active', true);
              self.eventHandlers.reply.buildReply(self, $tar, $counterEl, $editorBox);
            }

          });
        },

        buildReply: function (self, $tar, $counterEl, $editorBox) {
          self.eventHandlers.bodyNode.replyState = true;
          //console.log(self.eventHandlers.bodyNode.replyState);
          //console.log('build called');

          var str,
            $div,
            $footerEl,
            $dateEl,
            $siblingEditor,
            $editEl;

          $footerEl = $tar.closest('footer');
          $siblingEditor = $tar.siblings('.fyre-editor');
          $dateEl = $footerEl.siblings('.fyre-comment-head').children('.fyre-comment-date');
          $div = $('<div />', {
            'class': 'reply-to-wrapper'
          });
          str = 'Reply to ' + $tar.closest('footer').siblings('header').children('.fyre-comment-username').text() + ':';
          $editEl = $footerEl.siblings('.fyre-comment-body').find('.fyre-comment-edit');
          $div.text(str).hide();

          _buildAnimate($footerEl, $siblingEditor, $div, $tar, $counterEl, $editorBox, $editEl);

          function _buildAnimate($footerEl, $siblingEditor, $div, $tar, $counterEl, $editorBox, $editEl) {

            $siblingEditor.addClass('visibility-hidden-important');
            $footerEl.addClass('no-bottom-border').animate({
              'height': '+=258'
            }, 200, function () {
              $siblingEditor.removeClass('visibility-hidden-important').addClass('display-block-important').prepend($div).children('.reply-to-wrapper').fadeIn(200);
              // if no counter is present, create one.
              if ($counterEl.length === 0) {
                self.charCounter.addCounter(self, $editorBox, false);
              }

              if ($editEl.length > 0) {
                $editEl.fadeOut(200);
              }

              self.eventHandlers.bodyNode.replyState = true;

            });

            $dateEl.css({
              top: $dateEl.position().top,
              bottom: 'auto !important'
            });

            if ($tar.siblings('.fyre-comment-actions').children('.inline-modal-flag').hasClass('is-open')) {
              self.flag.closeDrop(self);
            }

          }

        },

        removeReply: function (self, $tar, $replyEls) {

          // console.log(self.eventHandlers.bodyNode.replyState);

          var $els,
            $footerEl,
            $dateEl,
            $siblingEditor,
            $modalElOrig,
            $editEl;

          $els = ($tar) ? $tar : $replyEls;
          $footerEl = $els.closest('footer');
          $dateEl = $footerEl.siblings('.fyre-comment-head').children('.fyre-comment-date');
          $siblingEditor = $els.siblings('.fyre-editor');
          $modalElOrig = $('body > .fyre-modal');
          $editEl = $footerEl.siblings('.fyre-comment-body').find('.fyre-comment-edit');

          _removeAnimate($footerEl, $siblingEditor, $els, $editEl);

          function _removeAnimate($footerEl, $siblingEditor, $els, $editEl) {

            $siblingEditor.addClass('visibility-hidden-important').find('.reply-to-wrapper').remove();

            $els.siblings('.fyre-comment-actions, .fyre-comment-like').css({
              'opacity': ''
            });

            $footerEl.removeClass('no-bottom-border').animate({
              'height': '-=258'
            }, 200, function () {
              $editEl.fadeIn(200);
              $siblingEditor.removeClass('display-block-important');
              $('body').trigger('click');
              self.eventHandlers.bodyNode.replyState = false;
            });

            $dateEl.css({
              top: 'auto !important',
              bottom: ''
            });

            if ($els.siblings('.fyre-comment-actions').children('.inline-modal-flag').hasClass('is-open')) {
              self.flag.closeDrop(self);
            }
            if ($modalElOrig.is(':visible')) {
              $modalElOrig.addClass('display-none-important visibility-hidden-important');
            }

          }

        }
      },

      bodyNode: {
        replyHelper: function (self, origin, $els) {
          var $replyEls;

          if (origin === 'editor') {
            setTimeout(function () {
              self.eventHandlers.bodyNode.firedHelper = false;
            }, 20);
            return;
          }

          setTimeout(function () {
            if (origin === 'body') {
              $replyEls = ($els) ? $els : $('.fyre-comment-reply', '#livefyre-comment').filter(function () {
                return ($(this).data('active') === true) ? $(this) : false;
              });
              if ($replyEls.length > 0) {
                self.eventHandlers.reply.removeReply(self, undefined, $replyEls);
                $replyEls.each(function () {
                  $(this).data('active', false);
                });
              }
            }

            self.eventHandlers.bodyNode.firedHelper = false;

          }, 10);

        },
        sortState: false,
        flagState: false,
        replyState: false,
        topState: false,
        clickOrigin: null,
        firedHelper: false,
        clickHandler: function (self) {

          // click event to remove eidtor styles when clicking anywhere besides editor while replying.
          $('body').on('click', '.fyre-comment-footer *', function (e) {

            var $tar = $(e.currentTarget);

            self.eventHandlers.bodyNode.firedHelper = true;
            self.eventHandlers.bodyNode.clickOrigin = $tar.is('.fyre-comment-actions') ? 'body' : 'editor';
            self.eventHandlers.bodyNode.replyHelper(self, self.eventHandlers.bodyNode.clickOrigin);
          });

          $('body').on('click.bodyClicks', function (e) {
            var $sortEL,
              $flagEls,
              $flagSelEls,
              $menuEls,
              $tar;

            $menuEls = $('.fyre-mention-item', self.init.streamElement);
            $sortEL = $('.fyre-stream-sort-options', self.init.streamElement).eq(0).find('a');
            $flagEls = $('.fyre-flag-link', self.init.streamElement);
            $flagSelEls = $('.select-item', self.init.streamElement);
            $tar = $(e.target);

            if (!self.eventHandlers.bodyNode.firedHelper) {
              //console.log('firing helper');
              self.eventHandlers.bodyNode.firedHelper = true;
              self.eventHandlers.bodyNode.clickOrigin = 'body';
              self.eventHandlers.bodyNode.replyHelper(self, self.eventHandlers.bodyNode.clickOrigin);
            }

            // removes is-open class on sort drop down is click outsided options
            if (self.eventHandlers.bodyNode.sortState) {
              if (!($tar.is($sortEL))) {
                self.eventHandlers.sortDrop.close(self, $sortEL);
              } else {
                self.eventHandlers.sortDrop.callback(self, false);
              }
            }

            // if flag is open or mention drawer, place article > .wrapper as to z-index so dropdowns cover divs under
            if (self.eventHandlers.bodyNode.topState) {

              if (!($tar.hasClass('fyre-mention-item') || $tar.hasClass('select-item') || $tar.hasClass('goog-buttonset-default'))) {
                //console.log('not menu and not mention button');
                $('.fyre-comment-wrapper', self.init.streamElement).removeClass('top-z-index').data('top', '');
                self.eventHandlers.bodyNode.topState = false;
              } else if ($tar.parents('.fyre-mention-item').length < 0 || $tar.hasClass('fyre-mention-item')) {
                //console.log('all good. menu item clicked. get rid of topZ');
                $('.fyre-comment-wrapper', self.init.streamElement).removeClass('top-z-index').data('top', '');
                self.eventHandlers.bodyNode.topState = false;
              }
            }

            // closes flag drop if not clicked on select-item
            if (self.eventHandlers.bodyNode.flagState) {
              if (!($tar.is('button.goog-buttonset-default') || $tar.hasClass('select-item') || $tar.hasClass('fyre-flag-link'))) {
                self.flag.closeDrop(self);
              }
            }

          });
        }
      },

      sortDrop: {
        clickHandler: function (self, $el) {
          // sort drop down click handler

          $el = $el || self.init.streamElement;

          $('.fyre-stream-sort-options', $el).eq(0).on('click', 'a', function (e) {
            //console.log('sort drop clicked');
            e.preventDefault();

            if ($(this).hasClass('fyre-stream-sort-top-comments')) {
              $('.fyre-stream-sort-newest', $el).addClass('tweak');
            } else {
              $('.fyre-stream-sort-newest', $el).removeClass('tweak');
            }

            if ($(this).hasClass('fyre-stream-sort-selected')) {
              self.eventHandlers.sortDrop.open(self, $(this));
            } else {
              self.eventHandlers.sortDrop.callback(self, true);
              self.eventHandlers.sortDrop.close(self, $(this));
            }
          });
        },

        callback: function (self, bol) {
          if (bol) {
            setTimeout(self.runUpdate('cleared'), 20);
          } else {
            self.loader.visible(self);
            self.runUpdate('load');
          }
        },
        open: function (self, $el) {
          self.eventHandlers.bodyNode.sortState = true;
          $el.parent().addClass('is-open');
        },
        close: function (self, $el) {
          self.eventHandlers.bodyNode.sortState = false;
          $el.parent().removeClass('is-open');
        }
      },

      like: function (self) {
        // like button click handler
        $('body').on('click', '.fyre-comment-like-btn', function (e) {
          //console.log('like button clicked');
          var $el = $(this).closest('.fyre-comment-article'),
            $replySib = $(e.target).parent().siblings('.fyre-comment-reply');

          if ($replySib.hasClass('fyre-reply-active')) {
            self.eventHandlers.bodyNode.replyHelper(self, 'body');
          }

          if (!self.subscribers.checkboxState) {
            $.when(self.likeButton.badge(self, $el)).done(function () {
              self.runUpdate('check');
            });
          } else {
            self.likeButton.badge(self, $el);
          }
          $(this).toggleClass('user-liked');
        });
      }
    },

    setProfileAttributes: function () {
      var self, profileCookie, profileStr, profile, $stream;

      self = this;
      self.init.streamElement = $('#livefyre-comment');
      $stream = self.init.streamElement;
      profileCookie = decodeURIComponent(util.getCookie('prfapp_usrprfle'));

      if (self.login.checkStatus(self)) {
        if (profileCookie.length > 0) {
          profileStr = util.base64Decode(profileCookie);
          //profileStr = window.atob(profileCookie);
          //profileStr = _decodeBase64(profileCookie);
          profile = $.parseJSON(profileStr);
          $stream.data({
            'profilevisibility': profile.visibility,
            'profileacceptedagreement': profile.acceptedAgreement
          });
        } else {
          $stream.data({
            'profilevisibility': 'private',
            'profileacceptedagreement': ''
          });
        }

        self.init.loggedIn(self, $stream, self.init.callbacks);

      } else {
        self.init.notLoggedIn(self, $stream, self.init.callbacks);
      }

      function _decodeBase64(str) {
        var base64 = {};
        base64.PADCHAR = '=';
        base64.ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

        base64.makeDOMException = function () {
          // sadly in FF,Safari,Chrome you can't make a DOMException
          //var e, tmp;

          try {
            return new DOMException(DOMException.INVALID_CHARACTER_ERR);
          } catch (e) {
            // not available, just passback a duck-typed equiv
            // https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Error
            // https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Error/prototype
            var ex = new Error("DOM Exception 5");

            // ex.number and ex.description is IE-specific.
            ex.code = ex.number = 5;
            ex.name = ex.description = "INVALID_CHARACTER_ERR";

            // Safari/Chrome output format
            ex.toString = function () {
              return 'Error: ' + ex.name + ': ' + ex.message;
            };
            return ex;
          }
        };

        base64.getbyte64 = function (s, i) {
          // This is oddly fast, except on Chrome/V8.
          //  Minimal or no improvement in performance by using a
          //   object with properties mapping chars to value (eg. 'A': 0)
          var idx = base64.ALPHA.indexOf(s.charAt(i));
          if (idx === -1) {
            throw base64.makeDOMException();
          }
          return idx;
        };

        base64.decode = function (s) {
          // convert to string
          s = '' + s;
          var getbyte64 = base64.getbyte64;
          var pads, i, b10;
          var imax = s.length;
          if (imax === 0) {
            return s;
          }

          if (imax % 4 !== 0) {
            throw base64.makeDOMException();
          }

          pads = 0;
          if (s.charAt(imax - 1) === base64.PADCHAR) {
            pads = 1;
            if (s.charAt(imax - 2) === base64.PADCHAR) {
              pads = 2;
            }
            // either way, we want to ignore this last block
            imax -= 4;
          }

          var x = [];
          for (i = 0; i < imax; i += 4) {
            b10 = (getbyte64(s, i) << 18) | (getbyte64(s, i + 1) << 12) |
              (getbyte64(s, i + 2) << 6) | getbyte64(s, i + 3);
            x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 0xff, b10 & 0xff));
          }

          switch (pads) {
          case 1:
            b10 = (getbyte64(s, i) << 18) | (getbyte64(s, i + 1) << 12) | (getbyte64(s, i + 2) << 6);
            x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 0xff));
            break;
          case 2:
            b10 = (getbyte64(s, i) << 18) | (getbyte64(s, i + 1) << 12);
            x.push(String.fromCharCode(b10 >> 16));
            break;
          }
          return x.join('');
        };

        return base64.decode(str);

      }

    },

    initialize: function (model, options) {
      var self = this;

      this._cfg = $.extend({}, this.config);
      window.livefyreConfig = this.setliveFyreConfig();

      // HACK:
      // passing options for showing only 3

      window.livefyreConfig.StreamOptions.initialNumVisible = 3;

      var url = this._cfg.path + 'djlivefyre?config=livefyreConfig';

      url += '&streaminfo=' + this.model.streamInfo;

      $.ajax({
        crossDomain: true,
        dataType: "script",
        timeout: 5000,
        url: url,
        success: function (data, textStatus, jqXHR) {
          //console.log("script loaded")
        },
        error: function (jqXHR, textStatus, errorThrown) {
          // create hidden log for QA
          var message = '<p>errorThrown: ' + errorThrown + '</p>';
          $('#livefyre-logs').html(message);
        }
      });
    }

  });
  return LivefyreCommentView;
});

/*global console, define, navigator, screen, window, document*/
define('article.app/LivefyreCommentWidget', [
  'vendor.asset.jquery/jquery',
  'article.app/LivefyreCommentView',
  'resp.module.livefyre/dj/widget/view/LivefyreCommentMobileView',
  'resp.module.livefyre/dj/widget/model/LivefyreCommentModel'
], function ($, LivefyreCommentView, LivefyreCommentMobileView, LivefyreCommentModel) {

  var LivefyreComments = function (options) {
    $.extend(this.cfg, options);
  };

  $.extend(LivefyreComments.prototype, {
    cfg: {},
    render: function () {
      try {
        var el = $('#livefyre-comment');
        this.cfg.el = el;
        var model = new LivefyreCommentModel(this.cfg);
        var viewClientType = (this.cfg.mobile()) ? LivefyreCommentMobileView : LivefyreCommentView;

        var view = new viewClientType({
          el: this.cfg.el,
          model: model
        }, this.cfg);
        view.render();

      } catch (e) {
        console.error('LivefyreComments::render ' + e.stack || e);
        return;
      }
    }
  });
  return LivefyreComments;
});

/*global sliderBox, scrim, suppressEvent, heightOfDrawer, console*/

define('article.app/content/scripts/nav-panel', ['vendor.asset.jquery/jquery'], function ($) {
    'use strict';

    var Nav = (function () {

      var pageFrame = $(".pageFrame");
      var drawerNav = $(".drawerNav");
      var sliderBox = $(".sliderBox");
      var scrim = $('<div class="navScrim" />');
      var hideNavTimer;
      var unClipTimer;
      var resurrectIframeTimer;
      var clipSliderTimer;
      var killIframeTimer;
      var isAndroid = (navigator.userAgent.match(/Android/i)) || (navigator.userAgent.match(/Chrome/i) && navigator.userAgent.match(/Linux/i)) ? true : false;

      // temp change for worldcupjapan
      if (!pageFrame.length) {
        pageFrame = $(".edition-japan");
      }

      function openSlider() {
        clearTimeout(hideNavTimer);
        clearTimeout(unClipTimer);
        clearTimeout(resurrectIframeTimer);
        showNav();
        pageFrame.addClass("sliderState-open transitioning");
        clipSliderTimer = setTimeout(clipSlider, 225); // This will truncate the silder/content area after it animates open.
        killIframeTimer = setTimeout(suppressIframes, 210); // Removes all iframes from the DOM to work around an obscure iOS 5 issue: http://stackoverflow.com/questions/7763458/ios5-webkit-overflow-scrolling-causes-touch-events-stopping-work
        pageFrame.off("click", "button.navButton", openSlider);
        //pageFrame.on("swipeleft", ".drawerNav, .sliderBox > *", closeSlider);
        pageFrame.on("click", ".sliderBox", closeSlider);
        $(window).on("pagehide", closeSlider);
        //pageFrame.on("touchmove", ".sliderBox", suppressEvent);
          // drawerNav.on("scroll", checkScrollPos);
      }

      function closeSlider(e) {
        e.preventDefault(); // Suppresses click-through on links and form elements.
        clearTimeout(killIframeTimer);
        clearTimeout(clipSliderTimer);
        resurrectIframeTimer = setTimeout(restoreIframes, 225); // Restores all iframes to the DOM.
        hideNavTimer = setTimeout(hideNav, 200); // Sets the nav panel to display:none after it animates closed.
        unClipTimer = setTimeout(unclipSlider, 210); // Restores the grid after nav is animated closed.
        pageFrame.addClass("transitioning").removeClass("sliderState-open");
        pageFrame.on("click", "button.navButton", openSlider);
        //Nav.pageFrame.off("swipeleft", ".drawerNav, .sliderBox > *", Nav.closeSlider);
        pageFrame.off("click", ".sliderBox", closeSlider);
        $(window).off("pagehide", closeSlider);
        /*pageFrame.off("touchmove", ".sliderBox", suppressEvent);
        if (Nav.isAndroid && $(document).scrollTop() > 1) {
          $('body').animate({
            scrollTop: 0
          }, 200);
        }*/
      }

      function showNav() {
        drawerNav.show();
      }

      function hideNav() {
        pageFrame.removeClass("transitioning");
        drawerNav.hide(); // .css("position","fixed"); // Improves performance if we hide the nav when it's beneath the content.
      }

      function clipSlider() {
        pageFrame.removeClass("transitioning");
        var clipHeight;
        //var overflow-scrolling = typeof($("body")[0].style["-webkit-overflow-scrolling"]) !== "undefined"; // <- Haven't tested this.
        if (isAndroid) {
        //clipHeight = window.innerHeight; // <- This is for functional overflow-touch navbars on Android.
          clipHeight = drawerNav.find(".touchNav").height();
        } else {
          clipHeight = $(window).height() + 60; // <- Extra 60 pixels for the location bar
        }
        pageFrame.css("max-height", clipHeight);
      }

      function suppressIframes() {
        $("iframe").each(function () {
          var thisFrame = this;
          var thisMark = $("<mark class='iframe'>");
          thisMark.data("iframe", thisFrame);
          $(thisFrame).before(thisMark).detach();
        });
      }

      function restoreIframes() {
        $("mark.iframe").each(function () {
          var myMark = $(this);
          var myIframe = myMark.data("iframe");
          myMark.after(myIframe).remove();
        });
      }

      function unclipSlider() {
        pageFrame.css("max-height", "1000000px");
      }

      function suppressEvent(e) {
        e.preventDefault(); // Used to prevent the user from scrolling in the content area.
      }

      function checkScrollPos() {
        var heightOfDrawer = drawerNav.height();
        var scrollDistance = drawerNav.scrollTop();
        var availScrollHeight = screen.height / window.devicePixelRatio;
        //alert(heightOfDrawer);
        if (scrollDistance > availScrollHeight) {
          drawerNav.scrollTop(0);
        }
        //alert(heightOfDrawer + ", " + scrollDistance + ", " + screen.height/window.devicePixelRatio);
      }

      // Nav.isIOS5 = navigator.userAgent.match(/OS 5(_\d)+ like Mac OS X/i) ? true : false;

      return {
        init: function() {
          pageFrame.on("click", "button.navButton", openSlider);
        }
      };

    }());

    return Nav;
  });

/*global define, p39_GPT_value_from_xml, googletag, googleAdSlots*/

define('article.app/googleads', ['dj.module.google_ads/googleadutils', 'vendor.asset.jquery/jquery'], function (googleadutils, $) {
    var googleAds = {

      init: function (options) {
        var self = this;

        var userExp = $('meta[name=user\\.exp]').attr('content'),
          article_template = $('meta[name=article\\.template]').attr('content');

        /*No ads in Print Mode. AD_L only should be displayed in Print Mode - handled by article_printmode_ad.js*/
        if (window.location.href.indexOf('#printMode') === -1) {

          $('div[data-dj-adwidgettype="googleCircAd"]').each(function (index, element) {
            googleadutils.getNodeAttributes(element);

            /** Temp: No ads for googlefcf **/
            var free_pass = element.nodeAttributes.adcircvalue;
            if (userExp === 'google_fcf' && article_template === 'snippet' && free_pass === 'snippet_free_pass') {
              return;
            }
            /** End Temp **/

            self.displayCircAd(element);
          });
        }
      },

      displayCircAd: function (element) {
        var self = this;
        var eleAttributes = element.nodeAttributes;

        if (eleAttributes.targetnode) { // shift ad to new location if location is specified
          $(element).appendTo($(eleAttributes.targetnode));
        }

        if (eleAttributes.showcircad === "true") {
          googleadutils.pushGoogleCircAd(eleAttributes);
        } else {
          var isNewsReelOrHeaderPromo = $(element).hasClass('subPromo') || $(element).hasClass('newsReelAd');
          if (!isNewsReelOrHeaderPromo) {
            $(element).parent().addClass('hidden');
          }
        }
      }

    };

    return googleAds;
  });

/* globals utag */
define('article.app/content/scripts/omnitool',
      ['article.app/context', 'vendor.asset.jquery/jquery', 'article.app/tealium', 'vendor.asset.underscore/underscore'],
    function (intent, $, tealium, _) {

      var slidePrevIndex, captionStatus;
      var omnitool = {
        setupTracking: function (slideshows) {
            for (var i = 0; i < slideshows.length; i++) {
              $(slideshows[i]).attr('id', i);
            }
          },

        trackGeneral: function (name) {
          var link_data = utag.data;
          link_data.link_name = utag.data["meta.article.headline"] + "_" + name;
          utag.link(utag.data);
        },

        trackBare: function (name) {
          var link_data = utag.data;
          link_data.link_name = name;
          utag.link(utag.data);
        },

        trackSlides: function (slideshow, indexElm) {
          if (slidePrevIndex === $(indexElm).text()) {
            return;
          } else{
            slidePrevIndex = $(indexElm).text();
          }
          var slideshow_num = ($(slideshow)).attr('id');
          var slide_num = $(indexElm).text();
          var link_data = utag.data;
          link_data.link_name  = utag.data["meta.article.headline"] +
                                  "_" + slideshow_num + "_" + slide_num;

          utag.link(utag.data);
        },

        trackCaptions: function (slideshow, captions) {
          var slideshow_num = ($(slideshow_num)).attr('id');
          if (captionStatus) {
            captionStatus = captions;
            var link_data = utag.data;
            link_data.link_name  = utag.data["meta.article.headline"] +
                                    "_" + slideshow_num + "_" + captionStatus;
            utag.link(utag.data);
          } else{
            captionStatus = captions;
          }
        },

        trackFull: function (slideshow, indexElm) {
          var slideshow_num = ($(slideshow)).attr('id');
          var slide_num = $(indexElm).text();
          var link_data = utag.data;
          link_data.link_name  = utag.data["meta.article.headline"] +
                                  "_" + slideshow_num + "_" + slide_num + "_FULL";
          utag.link(utag.data);
        },

        trackLinkOut: function (type, url) {
          var link_data = utag.data;
          link_data.link_name = utag.data["meta.article.headline"] +
                                 "_" + type + "_" + url;
          utag.link(utag.data);
        }
      }; //end omnitool obj


        //track related link on standalone slideshows
        var relatedLink = $('.related-link');
        relatedLink.on("mousedown", function(){
          omnitool.trackLinkOut("RelatedLink", relatedLink.attr('href'));
        });

        /*
         * Track slideshows on end slide
         */
        var popularSlideshows = $('.popular-slideshow');
        var trackPopularSlideshows = function() {
          omnitool.trackLinkOut("Popular Slideshow", popLink.attr('href'));
        };
        for (var i = 0; i < popularSlideshows.length; i++) {
          var popSlide = $(popularSlideshows[i]);
          var popLink = popSlide.find('.popular-link');
          popSlide.on("mousedown", trackPopularSlideshows);
        }

        /*
         * Author bios
         */
        var authors = $('.author.trigger.target.mobile-scrim');
        var trackBio = function() {
          omnitool.trackGeneral($(this).context.className);
        };
        for (i = 0; i <authors.length; i++) {
          var eachAuthor = $(authors[i]);
          var authorName = eachAuthor.find('.name');
          if(authorName){
            var authorStuff = [
              eachAuthor.find('.author.email'),
              eachAuthor.find('.author.bio'),
              eachAuthor.find('.author.twitter'),
              eachAuthor.find('.author.facebook'),
              eachAuthor.find('.author.google')
            ];

            for (var j = 0; j < authorStuff.length; j++) {
              authorStuff[j].addClass(authorName.text());
              authorStuff[j].on("click", trackBio);
            }
          }
        }

        /*
         * Image enlarge
         */
        var enlarge = $('.enlarge-image');
        var trackEnlargeImage = function() {
          omnitool.trackGeneral("ENLARGE_" + $(this).find("img").attr("src"));
        };
        for (i = 0; i < enlarge.length; i++){
          var singleImage = $(enlarge[i]).find('.image-container');
          singleImage.on("click", trackEnlargeImage);
        }

        /*
         * Rich text insets
         */
        var richText = $('.media-object-rich-text');
        var trackRichText = function() {
          omnitool.trackBare("RichTextLink");
        };
        for (i = 0; i < richText.length; i++){
          var richList = $(richText[i]).find("ul");
          var links = richList.find("li").find("a");
          links.on("mousedown", trackRichText);
        }

    var promisedOmnitool = {};

    _.each(omnitool, function(fn, method){
      promisedOmnitool[method] = function () {
        if (tealium.hasFired) {
          omnitool[method]();
        } else {
          $(document).on('tealium-loaded', omnitool[method]);
        }
      };
    });

    return promisedOmnitool;
  }
);


define('article.app/content/scripts/evernote', ['module', 'jquery'], function(module, $){

  function isIE () {
    var myNav = navigator.userAgent.toLowerCase();
    return (myNav.indexOf('msie') === -1) ? false : parseInt(myNav.split('msie')[1]);
  }

  return {
    init: function() {
      $(function() {

        // This breaks ie8
        if (isIE() && isIE() < 9) {
          return;
        }

        window.EVERNOTE_CLIP_INFO = {};

        var $evernoteElm = $('.icon.evernote');
        if ($evernoteElm.length === 0) {
          return;
        }

        // Parse article body for evernote (text + images)
        var article_text = $('#wsj-article-wrap :header, #wsj-article-wrap p,' +
                             '#wsj-article-wrap .media-object-image,' +
                             '#wsj-article-wrap .media-object-interactiveLink,' +
                             '#wsj-article-wrap .wsj-slideshow,' +
                             '.wsj-snippet-body p'
                            ).get();

        var container = "";
        article_text.forEach(function(tag, i) {
          if (tag.className.indexOf('media-object-image') > -1 ||
              tag.className.indexOf('media-object-interactiveLink') > -1 ||
              tag.className.indexOf('wsj-slideshow') > -1) { // An image
            var img = $(tag).find('img')[0] ? $(tag).find('img')[0].outerHTML : null;
            var caption = $(tag).find('.wsj-article-caption')[0] ? $(tag).find('.wsj-article-caption')[0].innerHTML : null;

            if (img !== null && $(img).attr('src')) {
              container += '<figure>' + img;
              if (caption !== null) {
                container += '<figcaption>' + caption + '</figcaption>';
              }
              container += '</figure>';
            }
          } else { // Regular text (header or paragraph)
            container += tag.outerHTML;
          }
        });

        window.EVERNOTE_CLIP_INFO[$evernoteElm.data('id')] = {
          title: $evernoteElm.data('headline'),
          url: $evernoteElm.data('url'),
          authors: $evernoteElm.data('authors'),
          contentHTML: container,
          summary: $evernoteElm.data('summary')
        };

        var po = document.createElement('script');
        po.type = 'text/javascript';
        po.async = true;
        po.src = 'https://cdn1.evernote.com/clipncite/widget.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(po, s);
        var po2 = document.createElement('script');
        po2.type = 'text/javascript';
        po2.async = true;
        po2.src = 'https://cdn1.evernote.com/clipncite/wsj_formatter.js';
        s.parentNode.insertBefore(po2, po.nextElementSibling || null);
        var po3 = document.createElement('script');
        po3.type = 'text/javascript';
        po3.async = true;
        po3.src = 'https://cdn1.evernote.com/clipncite/date_formatter.js';
        s.parentNode.insertBefore(po3, po2.nextElementSibling || null);
      });
    }
  };
});

/*global setTimeout, console, define, navigator, screen, window*/

define('resp.module.cookie_policy/cookie_policy', ['dj.responsive.resources/cookieutils', 'vendor.asset.jquery/jquery'], function (cookie, $) {
  var cookie_notice = {
    elements: {
      notice: $('.cookie-notice'),
      container: $('.cookie-notice-container'),
      btn: $('.cookie-notice .wrapper a.close')
    },

    init: function () {
      var self = this;
      var el = self.elements;
      el.container.addClass('on');
      setTimeout(function () { self.closeNotice(self); }, 15000);

      if ($('.cookie-notice-container.on').length > 0) {
        // In responsive page, if the notice is opening, other sticky elements (share tools, ads, etc. shall move down a little bit or the notice would cover them.
        $('.sticky_target').addClass('cookie_policy');
        // Never set cookie if the notice doesn't show
        cookie.setGroupCookie('DJCOOKIE', 'EU_Cookie_Policy_Shown', "true", 365);
      }

      el.btn.on("click", function (e) {
        e.preventDefault();
        e.stopPropagation();
        self.closeNotice(self);
      });
    },

    closeNotice: function (self) {
      self.elements.container.removeClass('on');
      $('.sticky_target').removeClass('cookie_policy');
      self.elements.container.addClass('closing');
    }

  };
  cookie_notice.init();
  return cookie_notice;
});

define("resp.module.cookie_policy/view/desktop",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<div class=\"cookie-notice-container\"> <div class=\"cookie-notice\"> <div class=\"wrapper\"> <p>{{#i18n}}We use cookies to help us deliver our online services. By using our website or by closing this message box, you agree to our use of cookies as described in our{{/i18n}} <a href=\"{{policy}}\" target=\"_blank\">{{#i18n}}Cookie Policy{{/i18n}}</a>{{#i18n}}<!-- i18n-1 -->{{/i18n}}.</p> <a class=\"close\" href=\"#\">{{#i18n}}Do not show again{{/i18n}}</a> </div> </div> </div> ");});define("resp.module.cookie_policy/view/empty",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<!-- empty cookie notice view --> ");});define("resp.module.cookie_policy/view/mobile",["vendor.asset.hogan/hogan"],function(Hogan){ return Hogan.compile("<link rel='stylesheet' media='all' type='text/css' href='{{style_cdn}}/img/resp.module.cookie_policy/latest/styles/cookie_policy_mobile.css'> <div class=\"cookie-notice-container\"> <div class=\"cookie-notice-wrapper\"> <div class=\"cookie-notice\"> <div class=\"wrapper\"> <p>{{#i18n}}We use cookies to help us deliver our online services. By using our website or by closing this message box, you agree to our use of cookies as described in our{{/i18n}} <a href=\"{{policy}}\" target=\"_blank\">{{#i18n}}Cookie Policy{{/i18n}}</a>{{#i18n}}<!-- i18n-1 -->{{/i18n}}.</p> </div> </div> <div class=\"closeMenu\"><a class=\"close\" href=\"#\">{{#i18n}}Do not show again{{/i18n}}</a></div> </div> </div> ");});

